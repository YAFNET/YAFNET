/*! Yet Another Forum.NET v4.0.4 | © Ingo Herbote | https://www.yetanotherforum.net/ */

(()=>{"use strict";var e={"./wwwroot/lib/pages/subscriptions.ts"(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{a(n.next(e))}catch(e){s(e)}}function c(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,c)}a((n=n.apply(e,t||[])).next())}))};const o=window||i.g;o.Subscriptions=class{constructor(e,t,i,s,r,c,a,d,l,u,h,p){var y;this.TextAppInstalled=e,this.TextSubscribed=t,this.TextBrowserNotSupported=i,this.TextIosHandling=s,this.TextStopped=r,this.TextNotificationsBlocked=c,this.TextNotificationsBlockedMobile=a,this.TextRequestingPermission=d,this.TextPermissionGranted=l,this.TextPermissionDenied=u,this.TextPermissionDeniedMobile=h,this.TextPermissionDismissed=p,"serviceWorker"in navigator&&navigator.serviceWorker.register("/serviceworker").then((e=>{y=e,"granted"===Notification.permission&&N(y,this.TextSubscribed)})).catch((e=>{console.log("Service Worker registration failed:",e)}));let g=null;const b=document.getElementById("status"),f=document.getElementById("enableBtn"),m=document.getElementById("enableText"),v=document.getElementById("stopBtn"),T=document.getElementById("installBtn"),w=document.getElementById("mobileInstructions"),x=document.getElementById("ApplicationServerKey").value,S=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),P=/iPhone|iPad|iPod/i.test(navigator.userAgent),k=window.navigator,B=window.matchMedia("(display-mode: standalone)").matches||k.standalone;let I;function D(e,t){b.textContent=e,b.className=`alert alert-${t} mt-3`}function N(e,t){e.pushManager.getSubscription().then((i=>{null===i?e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:x}).then((e=>{E(e,t)})).catch((e=>{console.error("Unable to subscribe to push",e)})):E(i,t)})),f.style.display="none",m.style.display="none",v.style.display="inline-block"}function E(e,t){const i={device:"",userID:0,boardID:0,endPoint:e.endpoint,p256dh:M(e.getKey("p256dh")),auth:M(e.getKey("auth"))};fetch("/api/Subscription/SubscribeDevice",{method:"POST",body:JSON.stringify(i),headers:{Accept:"application/json","Content-Type":"application/json;charset=utf-8",RequestVerificationToken:document.querySelector('input[name="__RequestVerificationToken"]').value}}).then((e=>{D(t,"success")})).catch((e=>{console.log(e)}))}function M(e){let t="";const i=new Uint8Array(e),n=i.byteLength;for(let e=0;e<n;e++)t+=String.fromCharCode(i[e]);return window.btoa(t)}S&&w.classList.remove("d-none"),T.style.display="none",o.addEventListener("beforeinstallprompt",(e=>{e.preventDefault(),I=e,T.style.display="inline-block"})),T.addEventListener("click",(()=>n(this,void 0,void 0,(function*(){if(I){I.prompt();const{outcome:e}=yield I.userChoice;"accepted"===e&&D(this.TextAppInstalled,"success"),I=null,T.style.display="none"}})))),f.addEventListener("click",(()=>n(this,void 0,void 0,(function*(){if(!("Notification"in window))return void D(this.TextBrowserNotSupported,"danger");if(P&&!B)return void D(this.TextIosHandling,"danger");const e=Notification.permission;if("denied"!==e)if("granted"!==e)try{D(this.TextRequestingPermission,"info"),S&&(yield new Promise((e=>setTimeout(e,500))));const e=yield Notification.requestPermission();"granted"===e?(D(this.TextPermissionGranted,"success"),N(y,this.TextSubscribed)):D("denied"===e?S?this.TextPermissionDeniedMobile:this.TextPermissionDenied:this.TextPermissionDismissed,"danger")}catch(e){D(`❌ ${e.message}`,"danger")}else N(y,this.TextSubscribed);else D(S?this.TextNotificationsBlocked:this.TextNotificationsBlockedMobile,"danger")})))),v.addEventListener("click",(()=>{!function(e){g&&(clearInterval(g),g=null),f.style.display="inline-block",v.style.display="none",y.pushManager.getSubscription().then((t=>{if(null!=t){const i={device:"",userID:0,boardID:0,endPoint:t.endpoint,p256dh:M(t.getKey("p256dh")),auth:M(t.getKey("auth"))};fetch("/api/Subscription/UnSubscribeDevice",{method:"POST",body:JSON.stringify(i),headers:{Accept:"application/json","Content-Type":"application/json;charset=utf-8",RequestVerificationToken:document.querySelector('input[name="__RequestVerificationToken"]').value}}).then((t=>{D(e,"info")})).catch((e=>{console.log(e)}))}}))}(this.TextStopped)}))}}}},t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();var i={};e["./wwwroot/lib/pages/subscriptions.ts"].call(i,0,i,t)})();
//# sourceMappingURL=subscriptions.min.js.map