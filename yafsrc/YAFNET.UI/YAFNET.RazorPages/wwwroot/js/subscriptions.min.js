/*! Yet Another Forum.NET v4.0.4 | © Ingo Herbote | https://www.yetanotherforum.net/ */

(()=>{"use strict";var e={"./wwwroot/lib/pages/subscriptions.ts"(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function r(e){try{a(n.next(e))}catch(e){s(e)}}function c(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,c)}a((n=n.apply(e,t||[])).next())}))};(window||i.g).Subscriptions=class{constructor(e,t,i,o,s,r,c,a,d,l,u,h){var p;this.TextAppInstalled=e,this.TextSubscribed=t,this.TextBrowserNotSupported=i,this.TextIosHandling=o,this.TextStopped=s,this.TextNotificationsBlocked=r,this.TextNotificationsBlockedMobile=c,this.TextRequestingPermission=a,this.TextPermissionGranted=d,this.TextPermissionDenied=l,this.TextPermissionDeniedMobile=u,this.TextPermissionDismissed=h,"serviceWorker"in navigator&&navigator.serviceWorker.register("/serviceworker").then((e=>{p=e,"granted"===Notification.permission&&N(p,this.TextSubscribed)})).catch((e=>{console.log("Service Worker registration failed:",e)}));let g=null;const m=document.getElementById("status"),b=document.getElementById("enableBtn"),f=document.getElementById("enableText"),y=document.getElementById("stopBtn"),T=document.getElementById("installBtn"),v=document.getElementById("mobileInstructions"),w=document.getElementById("ApplicationServerKey").value,x=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),S=/iPhone|iPad|iPod/i.test(navigator.userAgent),P=window.navigator,k=window.matchMedia("(display-mode: standalone)").matches||P.standalone;let B;function I(e,t){m.textContent=e,m.className=`alert alert-${t} mt-3`}function N(e,t){e.pushManager.getSubscription().then((i=>{null===i?e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:w}).then((e=>{D(e,t)})).catch((e=>{console.error("Unable to subscribe to push",e)})):D(i,t)})),b.style.display="none",f.style.display="none",y.style.display="inline-block"}function D(e,t){const i={device:"",userID:0,boardID:0,endPoint:e.endpoint,p256dh:E(e.getKey("p256dh")),auth:E(e.getKey("auth"))};fetch("/api/Subscription/SubscribeDevice",{method:"POST",body:JSON.stringify(i),headers:{Accept:"application/json","Content-Type":"application/json;charset=utf-8",RequestVerificationToken:document.querySelector('input[name="__RequestVerificationToken"]').value}}).then((e=>{I(t,"success")})).catch((e=>{console.log(e)}))}function E(e){let t="";const i=new Uint8Array(e),n=i.byteLength;for(let e=0;e<n;e++)t+=String.fromCharCode(i[e]);return window.btoa(t)}x&&v.classList.remove("d-none"),T.addEventListener("click",(()=>n(this,void 0,void 0,(function*(){if(B){B.prompt();const{outcome:e}=yield B.userChoice;"accepted"===e&&I(this.TextAppInstalled,"success"),B=null,T.style.display="none"}})))),b.addEventListener("click",(()=>n(this,void 0,void 0,(function*(){if(!("Notification"in window))return void I(this.TextBrowserNotSupported,"danger");if(S&&!k)return void I(this.TextIosHandling,"danger");const e=Notification.permission;if("denied"!==e)if("granted"!==e)try{I(this.TextRequestingPermission,"info"),x&&(yield new Promise((e=>setTimeout(e,500))));const e=yield Notification.requestPermission();"granted"===e?(I(this.TextPermissionGranted,"success"),N(p,this.TextSubscribed)):I("denied"===e?x?this.TextPermissionDeniedMobile:this.TextPermissionDenied:this.TextPermissionDismissed,"danger")}catch(e){I(`❌ ${e.message}`,"danger")}else N(p,this.TextSubscribed);else I(x?this.TextNotificationsBlocked:this.TextNotificationsBlockedMobile,"danger")})))),y.addEventListener("click",(()=>{!function(e){g&&(clearInterval(g),g=null),b.style.display="inline-block",y.style.display="none",p.pushManager.getSubscription().then((t=>{if(null!=t){const i={device:"",userID:0,boardID:0,endPoint:t.endpoint,p256dh:E(t.getKey("p256dh")),auth:E(t.getKey("auth"))};fetch("/api/Subscription/UnSubscribeDevice",{method:"POST",body:JSON.stringify(i),headers:{Accept:"application/json","Content-Type":"application/json;charset=utf-8",RequestVerificationToken:document.querySelector('input[name="__RequestVerificationToken"]').value}}).then((t=>{I(e,"info")})).catch((e=>{console.log(e)}))}}))}(this.TextStopped)}))}}}},t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();var i={};e["./wwwroot/lib/pages/subscriptions.ts"].call(i,0,i,t)})();
//# sourceMappingURL=subscriptions.min.js.map