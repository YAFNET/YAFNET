{"version":3,"file":"subscriptions.min.js","mappings":"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","sources":["webpack://yetanotherforum-net/./wwwroot/lib/pages/subscriptions.ts","webpack://yetanotherforum-net/webpack/bootstrap","webpack://yetanotherforum-net/webpack/runtime/global","webpack://yetanotherforum-net/webpack/startup"],"sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nconst _global = (window /* browser */ || global /* node */);\n_global.Subscriptions = class Subscriptions {\n    constructor(textAppInstalled, textSubscribed, textBrowserNotSupported, textIosHandling, textStopped, textNotificationsBlocked, textNotificationsBlockedMobile, textRequestingPermission, textPermissionGranted, textPermissionDenied, textPermissionDeniedMobile, textPermissionDismissed) {\n        this.TextAppInstalled = textAppInstalled;\n        this.TextSubscribed = textSubscribed;\n        this.TextBrowserNotSupported = textBrowserNotSupported;\n        this.TextIosHandling = textIosHandling;\n        this.TextStopped = textStopped;\n        this.TextNotificationsBlocked = textNotificationsBlocked;\n        this.TextNotificationsBlockedMobile = textNotificationsBlockedMobile;\n        this.TextRequestingPermission = textRequestingPermission;\n        this.TextPermissionGranted = textPermissionGranted;\n        this.TextPermissionDenied = textPermissionDenied;\n        this.TextPermissionDeniedMobile = textPermissionDeniedMobile;\n        this.TextPermissionDismissed = textPermissionDismissed;\n        var reg;\n        // Register Service Worker\n        if ('serviceWorker' in navigator) {\n            navigator.serviceWorker.register('/serviceworker')\n                .then(registration => {\n                reg = registration;\n                if (Notification.permission === 'granted') {\n                    getSubscription(reg, this.TextSubscribed);\n                }\n            })\n                .catch(error => {\n                console.log('Service Worker registration failed:', error);\n            });\n        }\n        let notificationInterval = null;\n        const statusDiv = document.getElementById('status');\n        const enableBtn = document.getElementById('enableBtn');\n        const enableText = document.getElementById('enableText');\n        const stopBtn = document.getElementById('stopBtn');\n        const installBtn = document.getElementById('installBtn');\n        const mobileInstructions = document.getElementById('mobileInstructions');\n        const applicationServerKey = document.getElementById('ApplicationServerKey').value;\n        // Detect mobile\n        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n        const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);\n        const navigatr = window.navigator;\n        const isStandalone = window.matchMedia('(display-mode: standalone)').matches || navigatr.standalone;\n        if (isMobile) {\n            mobileInstructions.classList.remove('d-none');\n        }\n        // PWA Install prompt\n        let deferredPrompt;\n        installBtn.addEventListener('click', () => __awaiter(this, void 0, void 0, function* () {\n            if (deferredPrompt) {\n                deferredPrompt.prompt();\n                const { outcome } = yield deferredPrompt.userChoice;\n                if (outcome === 'accepted') {\n                    showStatus(this.TextAppInstalled, 'success');\n                }\n                deferredPrompt = null;\n                installBtn.style.display = 'none';\n            }\n        }));\n        function showStatus(msg, type) {\n            statusDiv.textContent = msg;\n            statusDiv.className = `alert alert-${type} mt-3`;\n        }\n        function getSubscription(reg, textSubscribed) {\n            reg.pushManager.getSubscription().then(sub => {\n                if (sub === null) {\n                    reg.pushManager.subscribe({\n                        userVisibleOnly: true,\n                        applicationServerKey\n                    }).then(subs => {\n                        pushSubscription(subs, textSubscribed);\n                    }).catch(error => {\n                        console.error('Unable to subscribe to push', error);\n                    });\n                }\n                else {\n                    pushSubscription(sub, textSubscribed);\n                }\n            });\n            enableBtn.style.display = 'none';\n            enableText.style.display = 'none';\n            stopBtn.style.display = 'inline-block';\n        }\n        function pushSubscription(sub, textSubscribed) {\n            const deviceSubscription = {\n                device: '',\n                userID: 0,\n                boardID: 0,\n                endPoint: sub.endpoint,\n                p256dh: arrayBufferToBase64(sub.getKey('p256dh')),\n                auth: arrayBufferToBase64(sub.getKey('auth'))\n            };\n            const ajaxUrl = '/api/Subscription/SubscribeDevice';\n            fetch(ajaxUrl, {\n                method: 'POST',\n                body: JSON.stringify(deviceSubscription),\n                headers: {\n                    Accept: 'application/json',\n                    \"Content-Type\": 'application/json;charset=utf-8',\n                    \"RequestVerificationToken\": document.querySelector('input[name=\"__RequestVerificationToken\"]').value\n                }\n            }).then(data => {\n                showStatus(textSubscribed, 'success');\n            }).catch(error => {\n                console.log(error);\n            });\n        }\n        function arrayBufferToBase64(buffer) {\n            let binary = '';\n            const bytes = new Uint8Array(buffer);\n            const len = bytes.byteLength;\n            for (let i = 0; i < len; i++) {\n                binary += String.fromCharCode(bytes[i]);\n            }\n            return window.btoa(binary);\n        }\n        function stopNotifications(textStopped) {\n            if (notificationInterval) {\n                clearInterval(notificationInterval);\n                notificationInterval = null;\n            }\n            enableBtn.style.display = 'inline-block';\n            stopBtn.style.display = 'none';\n            // Unsubscribe from push notifications on server and client\n            reg.pushManager.getSubscription().then(sub => {\n                if (sub != null) {\n                    const deviceSubscription = {\n                        device: '',\n                        userID: 0,\n                        boardID: 0,\n                        endPoint: sub.endpoint,\n                        p256dh: arrayBufferToBase64(sub.getKey('p256dh')),\n                        auth: arrayBufferToBase64(sub.getKey('auth'))\n                    };\n                    const ajaxUrl = '/api/Subscription/UnSubscribeDevice';\n                    fetch(ajaxUrl, {\n                        method: 'POST',\n                        body: JSON.stringify(deviceSubscription),\n                        headers: {\n                            Accept: 'application/json',\n                            \"Content-Type\": 'application/json;charset=utf-8',\n                            \"RequestVerificationToken\": document.querySelector('input[name=\"__RequestVerificationToken\"]').value\n                        }\n                    }).then(data => {\n                        showStatus(textStopped, 'info');\n                    }).catch(error => {\n                        console.log(error);\n                    });\n                }\n            });\n        }\n        enableBtn.addEventListener('click', () => __awaiter(this, void 0, void 0, function* () {\n            if (!('Notification' in window)) {\n                showStatus(this.TextBrowserNotSupported, 'danger');\n                return;\n            }\n            // Special handling for iOS\n            if (isIOS && !isStandalone) {\n                showStatus(this.TextIosHandling, 'danger');\n                return;\n            }\n            const currentPermission = Notification.permission;\n            // If already denied, show instructions\n            if (currentPermission === 'denied') {\n                if (isMobile) {\n                    showStatus(this.TextNotificationsBlocked, 'danger');\n                }\n                else {\n                    showStatus(this.TextNotificationsBlockedMobile, 'danger');\n                }\n                return;\n            }\n            // If already granted, start immediately\n            if (currentPermission === 'granted') {\n                getSubscription(reg, this.TextSubscribed);\n                return;\n            }\n            // Request permission (only works if permission is 'default')\n            try {\n                showStatus(this.TextRequestingPermission, 'info');\n                // Add a small delay for mobile\n                if (isMobile) {\n                    yield new Promise(resolve => setTimeout(resolve, 500));\n                }\n                const permission = yield Notification.requestPermission();\n                if (permission === 'granted') {\n                    showStatus(this.TextPermissionGranted, 'success');\n                    // setTimeout(startNotifications, 500);\n                    getSubscription(reg, this.TextSubscribed);\n                }\n                else if (permission === 'denied') {\n                    if (isMobile) {\n                        showStatus(this.TextPermissionDeniedMobile, 'danger');\n                    }\n                    else {\n                        showStatus(this.TextPermissionDenied, 'danger');\n                    }\n                }\n                else {\n                    showStatus(this.TextPermissionDismissed, 'danger');\n                }\n            }\n            catch (error) {\n                showStatus(`âŒ ${error.message}`, 'danger');\n            }\n        }));\n        stopBtn.addEventListener('click', () => {\n            stopNotifications(this.TextStopped);\n        });\n    }\n};\n","// The require scope\nvar __webpack_require__ = {};\n\n","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = {};\n__webpack_modules__[\"./wwwroot/lib/pages/subscriptions.ts\"].call(__webpack_exports__,0,__webpack_exports__,__webpack_require__);\n"],"names":["__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","window","g","Subscriptions","constructor","textAppInstalled","textSubscribed","textBrowserNotSupported","textIosHandling","textStopped","textNotificationsBlocked","textNotificationsBlockedMobile","textRequestingPermission","textPermissionGranted","textPermissionDenied","textPermissionDeniedMobile","textPermissionDismissed","reg","TextAppInstalled","TextSubscribed","TextBrowserNotSupported","TextIosHandling","TextStopped","TextNotificationsBlocked","TextNotificationsBlockedMobile","TextRequestingPermission","TextPermissionGranted","TextPermissionDenied","TextPermissionDeniedMobile","TextPermissionDismissed","navigator","serviceWorker","register","registration","Notification","permission","getSubscription","catch","error","console","log","notificationInterval","statusDiv","document","getElementById","enableBtn","enableText","stopBtn","installBtn","mobileInstructions","applicationServerKey","isMobile","test","userAgent","isIOS","navigatr","isStandalone","matchMedia","matches","standalone","deferredPrompt","showStatus","msg","type","textContent","className","pushManager","sub","subscribe","userVisibleOnly","subs","pushSubscription","style","display","deviceSubscription","device","userID","boardID","endPoint","endpoint","p256dh","arrayBufferToBase64","getKey","auth","fetch","method","body","JSON","stringify","headers","Accept","querySelector","data","buffer","binary","bytes","Uint8Array","len","byteLength","i","String","fromCharCode","btoa","classList","remove","addEventListener","prompt","outcome","userChoice","currentPermission","setTimeout","requestPermission","message","clearInterval","stopNotifications","__webpack_require__","globalThis","Function","__webpack_exports__","__webpack_modules__","call"],"ignoreList":[],"sourceRoot":""}