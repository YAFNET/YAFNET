{"version":3,"file":"sceditor.min.js","sources":["sceditor.min.js","../src/formats/bbcode.js","../src/icons/fontawesome.js","../src/plugins/dragdrop.js","../src/plugins/undo.js","../src/plugins/plaintext.js","../src/plugins/mentions.js"],"sourcesContent":["(function () {\n\t'use strict';\n\n\t/**\n\t * Check if the passed argument is the\n\t * the passed type.\n\t *\n\t * @param {string} type\n\t * @param {*} arg\n\t * @returns {boolean}\n\t */\n\tfunction isTypeof(type, arg) {\n\t\treturn typeof arg === type;\n\t}\n\n\t/**\n\t * @type {function(*): boolean}\n\t */\n\tvar isString = isTypeof.bind(null, 'string');\n\n\t/**\n\t * @type {function(*): boolean}\n\t */\n\tvar isUndefined = isTypeof.bind(null, 'undefined');\n\n\t/**\n\t * @type {function(*): boolean}\n\t */\n\tvar isFunction = isTypeof.bind(null, 'function');\n\n\t/**\n\t * @type {function(*): boolean}\n\t */\n\tvar isNumber = isTypeof.bind(null, 'number');\n\n\n\t/**\n\t * Returns true if an object has no keys\n\t *\n\t * @param {!Object} obj\n\t * @returns {boolean}\n\t */\n\tfunction isEmptyObject(obj) {\n\t\treturn !Object.keys(obj).length;\n\t}\n\n\t/**\n\t * Extends the first object with any extra objects passed\n\t *\n\t * If the first argument is boolean and set to true\n\t * it will extend child arrays and objects recursively.\n\t *\n\t * @param {!Object|boolean} targetArg\n\t * @param {...Object} source\n\t * @return {Object}\n\t */\n\tfunction extend(targetArg, sourceArg) {\n\t\tconst isTargetBoolean = targetArg === !!targetArg;\n\t\tvar i = isTargetBoolean ? 2 : 1;\n\t\tconst target = isTargetBoolean ? sourceArg : targetArg;\n\t\tconst isDeep = isTargetBoolean ? targetArg : false;\n\n\t\tfunction isObject(value) {\n\t\t\treturn value !== null &&\n\t\t\t\ttypeof value === 'object' &&\n\t\t\t\tObject.getPrototypeOf(value) === Object.prototype;\n\t\t}\n\n\t\tfor (; i < arguments.length; i++) {\n\t\t\tconst source = arguments[i];\n\n\t\t\t// Copy all properties for jQuery compatibility\n\t\t\t/* eslint guard-for-in: off */\n\t\t\tfor (let key in source) {\n\t\t\t\tconst targetValue = target[key];\n\t\t\t\tconst value = source[key];\n\n\t\t\t\t// Skip undefined values to match jQuery\n\t\t\t\tif (isUndefined(value)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Skip special keys to prevent prototype pollution\n\t\t\t\tif (key === '__proto__' || key === 'constructor') {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst isValueObject = isObject(value);\n\t\t\t\tconst isValueArray = Array.isArray(value);\n\n\t\t\t\tif (isDeep && (isValueObject || isValueArray)) {\n\t\t\t\t\t// Can only merge if target type matches otherwise create\n\t\t\t\t\t// new target to merge into\n\t\t\t\t\tconst isSameType = isObject(targetValue) === isValueObject &&\n\t\t\t\t\t\tArray.isArray(targetValue) === isValueArray;\n\n\t\t\t\t\ttarget[key] = extend(\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t\tisSameType ? targetValue : (isValueArray ? [] : {}),\n\t\t\t\t\t\tvalue\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\ttarget[key] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn target;\n\t}\n\n\t/**\n\t * Removes an item from the passed array\n\t *\n\t * @param {!Array} arr\n\t * @param {*} item\n\t */\n\tfunction arrayRemove(arr, item) {\n\t\tconst i = arr.indexOf(item);\n\n\t\tif (i > -1) {\n\t\t\tarr.splice(i, 1);\n\t\t}\n\t}\n\n\t/**\n\t * Iterates over an array or object\n\t *\n\t * @param {!Object|Array} obj\n\t * @param {function(*, *)} fn\n\t */\n\tfunction each(obj, fn) {\n\t\tif (Array.isArray(obj) || 'length' in obj && isNumber(obj.length)) {\n\t\t\tfor (let i = 0; i < obj.length; i++) {\n\t\t\t\tfn(i, obj[i]);\n\t\t\t}\n\t\t} else {\n\t\t\tObject.keys(obj).forEach(function (key) {\n\t\t\t\tfn(key, obj[key]);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Cache of camelCase CSS property names\n\t * @type {Object<string, string>}\n\t */\n\tvar cssPropertyNameCache = {};\n\n\t/**\n\t * Node type constant for element nodes\n\t *\n\t * @type {number}\n\t */\n\tvar ELEMENT_NODE = 1;\n\n\t/**\n\t * Node type constant for text nodes\n\t *\n\t * @type {number}\n\t */\n\tvar TEXT_NODE = 3;\n\n\t/**\n\t * Node type constant for comment nodes\n\t *\n\t * @type {number}\n\t */\n\tvar COMMENT_NODE = 8;\n\n\tfunction toFloat(value) {\n\t\tvalue = parseFloat(value);\n\n\t\treturn isFinite(value) ? value : 0;\n\t}\n\n\t/**\n\t * Creates an element with the specified attributes\n\t *\n\t * Will create it in the current document unless context\n\t * is specified.\n\t *\n\t * @param {!string} tag\n\t * @param {!Object<string, string>} [attributes]\n\t * @param {!Document} [context]\n\t * @returns {!HTMLElement}\n\t */\n\tfunction createElement(tag, attributes, context) {\n\t\tvar node = (context || document).createElement(tag);\n\n\t\teach(attributes || {}, function (key, value) {\n\t\t\tif (key === 'style') {\n\t\t\t\tnode.style.cssText = value;\n\n\t\t\t} else if (key in node) {\n\t\t\t\tnode[key] = value;\n\t\t\t} else {\n\t\t\t\tnode.setAttribute(key, value);\n\t\t\t}\n\t\t});\n\n\t\treturn node;\n\t}\n\n\t/**\n\t * Gets the first parent node that matches the selector\n\t *\n\t * @param {!HTMLElement} node\n\t * @param {!string} [selector]\n\t * @returns {HTMLElement|undefined}\n\t */\n\tfunction parent(node, selector) {\n\t\tvar parent = node || {};\n\n\t\twhile ((parent = parent.parentNode) && !/(9|11)/.test(parent.nodeType)) {\n\t\t\tif (!selector || is(parent, selector)) {\n\t\t\t\treturn parent;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Checks the passed node and all parents and\n\t * returns the first matching node if any.\n\t *\n\t * @param {!HTMLElement} node\n\t * @param {!string} selector\n\t * @returns {HTMLElement|undefined}\n\t */\n\tfunction closest(node, selector) {\n\t\treturn is(node, selector) ? node : parent(node, selector);\n\t}\n\n\t/**\n\t * Removes the node from the DOM\n\t *\n\t * @param {!HTMLElement} node\n\t */\n\tfunction remove(node) {\n\t\tif (node.parentNode) {\n\t\t\tnode.parentNode.removeChild(node);\n\t\t}\n\t}\n\n\t/**\n\t * Appends child to parent node\n\t *\n\t * @param {!HTMLElement} node\n\t * @param {!HTMLElement} child\n\t */\n\tfunction appendChild(node, child) {\n\t\tnode.appendChild(child);\n\t}\n\n\t/**\n\t * Finds any child nodes that match the selector\n\t *\n\t * @param {!HTMLElement} node\n\t * @param {!string} selector\n\t * @returns {NodeList}\n\t */\n\tfunction find(node, selector) {\n\t\treturn node.querySelectorAll(selector);\n\t}\n\n\t/**\n\t * For on() and off() if to add/remove the event\n\t * to the capture phase\n\t *\n\t * @type {boolean}\n\t */\n\tvar EVENT_CAPTURE = true;\n\n\t/**\n\t * Adds an event listener for the specified events.\n\t *\n\t * Events should be a space separated list of events.\n\t *\n\t * If selector is specified the handler will only be\n\t * called when the event target matches the selector.\n\t *\n\t * @param {!Node} node\n\t * @param {string} events\n\t * @param {string} [selector]\n\t * @param {function(Object)} fn\n\t * @param {boolean} [capture=false]\n\t * @see off()\n\t */\n\t// eslint-disable-next-line max-params\n\tfunction on(node, events, selector, fn, capture) {\n\t\tevents.split(' ').forEach(function (event) {\n\t\t\tvar handler;\n\n\t\t\tif (isString(selector)) {\n\t\t\t\thandler = fn[`_sce-event-${event}${selector}`] || function (e) {\n\t\t\t\t\tvar target = e.target;\n\t\t\t\t\twhile (target && target !== node) {\n\t\t\t\t\t\tif (is(target, selector)) {\n\t\t\t\t\t\t\tfn.call(target, e);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttarget = target.parentNode;\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tfn[`_sce-event-${event}${selector}`] = handler;\n\t\t\t} else {\n\t\t\t\thandler = selector;\n\t\t\t\tcapture = fn;\n\t\t\t}\n\n\t\t\tnode.addEventListener(event, handler, capture || false);\n\t\t});\n\t}\n\n\t/**\n\t * Removes an event listener for the specified events.\n\t *\n\t * @param {!Node} node\n\t * @param {string} events\n\t * @param {string} [selector]\n\t * @param {function(Object)} fn\n\t * @param {boolean} [capture=false]\n\t * @see on()\n\t */\n\t// eslint-disable-next-line max-params\n\tfunction off(node, events, selector, fn, capture) {\n\t\tevents.split(' ').forEach(function (event) {\n\t\t\tvar handler;\n\n\t\t\tif (isString(selector)) {\n\t\t\t\thandler = fn[`_sce-event-${event}${selector}`];\n\t\t\t} else {\n\t\t\t\thandler = selector;\n\t\t\t\tcapture = fn;\n\t\t\t}\n\n\t\t\tnode.removeEventListener(event, handler, capture || false);\n\t\t});\n\t}\n\n\t/**\n\t * If only attr param is specified it will get\n\t * the value of the attr param.\n\t *\n\t * If value is specified but null the attribute\n\t * will be removed otherwise the attr value will\n\t * be set to the passed value.\n\t *\n\t * @param {!HTMLElement} node\n\t * @param {!string} attr\n\t * @param {?string} [value]\n\t */\n\tfunction attr(node, attr, value) {\n\t\tif (arguments.length < 3) {\n\t\t\treturn node.getAttribute(attr);\n\t\t}\n\n\t\t// eslint-disable-next-line eqeqeq, no-eq-null\n\t\tif (value == null) {\n\t\t\tremoveAttr(node, attr);\n\t\t} else {\n\t\t\tnode.setAttribute(attr, value);\n\t\t}\n\t}\n\n\t/**\n\t * Removes the specified attribute\n\t *\n\t * @param {!HTMLElement} node\n\t * @param {!string} attr\n\t */\n\tfunction removeAttr(node, attr) {\n\t\tnode.removeAttribute(attr);\n\t}\n\n\t/**\n\t * Sets the passed elements display to none\n\t *\n\t * @param {!HTMLElement} node\n\t */\n\tfunction hide(node) {\n\t\tcss(node, 'display', 'none');\n\t}\n\n\t/**\n\t * Sets the passed elements display to default\n\t *\n\t * @param {!HTMLElement} node\n\t */\n\tfunction show(node) {\n\t\tcss(node, 'display', '');\n\t}\n\n\t/**\n\t * Toggles an elements visibility\n\t *\n\t * @param {!HTMLElement} node\n\t */\n\tfunction toggle(node) {\n\t\tif (isVisible(node)) {\n\t\t\thide(node);\n\t\t} else {\n\t\t\tshow(node);\n\t\t}\n\t}\n\n\t/**\n\t * Gets a computed CSS values or sets an inline CSS value\n\t *\n\t * Rules should be in camelCase format and not\n\t * hyphenated like CSS properties.\n\t *\n\t * @param {!HTMLElement} node\n\t * @param {!Object|string} rule\n\t * @param {string|number} [value]\n\t * @return {string|number|undefined}\n\t */\n\tfunction css(node, rule, value) {\n\t\tif (arguments.length < 3) {\n\t\t\tif (isString(rule)) {\n\t\t\t\treturn node.nodeType === 1 ? getComputedStyle(node)[rule] : null;\n\t\t\t}\n\n\t\t\teach(rule,\n\t\t\t\tfunction (key, value) {\n\t\t\t\t\tcss(node, key, value);\n\t\t\t\t});\n\t\t} else {\n\t\t\t// isNaN returns false for null, false and empty strings\n\t\t\t// so need to check it's truthy or 0\n\t\t\tconst isNumeric = (value || value === 0) && !isNaN(value);\n\t\t\tnode.style[rule] = isNumeric ? value + 'px' : value;\n\t\t}\n\t}\n\n\n\t/**\n\t * Gets or sets the data attributes on a node\n\t *\n\t * Unlike the jQuery version this only stores data\n\t * in the DOM attributes which means only strings\n\t * can be stored.\n\t *\n\t * @param {Node} node\n\t * @param {string} [key]\n\t * @param {string} [value]\n\t * @return {Object|undefined}\n\t */\n\tfunction data(node, key, value) {\n\t\tconst argsLength = arguments.length;\n\t\tvar data = {};\n\n\t\tif (node.nodeType === ELEMENT_NODE) {\n\t\t\tif (argsLength === 1) {\n\t\t\t\teach(node.attributes,\n\t\t\t\t\tfunction (_, attr) {\n\t\t\t\t\t\tif (/^data\\-/i.test(attr.name)) {\n\t\t\t\t\t\t\tdata[attr.name.substr(5)] = attr.value;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\treturn data;\n\t\t\t}\n\n\t\t\tif (argsLength === 2) {\n\t\t\t\treturn attr(node, `data-${key}`);\n\t\t\t}\n\n\t\t\tattr(node, `data-${key}`, String(value));\n\t\t}\n\t}\n\n\t/**\n\t * Checks if node matches the given selector.\n\t *\n\t * @param {?HTMLElement} node\n\t * @param {string} selector\n\t * @returns {boolean}\n\t */\n\tfunction is(node, selector) {\n\t\tvar result = false;\n\n\t\tif (node && node.nodeType === ELEMENT_NODE) {\n\t\t\tresult = (node.matches ||\n\t\t\t\tnode.msMatchesSelector ||\n\t\t\t\tnode.webkitMatchesSelector).call(node, selector);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\n\t/**\n\t * Returns true if node contains child otherwise false.\n\t *\n\t * This differs from the DOM contains() method in that\n\t * if node and child are equal this will return false.\n\t *\n\t * @param {!Node} node\n\t * @param {HTMLElement} child\n\t * @returns {boolean}\n\t */\n\tfunction contains(node, child) {\n\t\treturn node !== child && node.contains && node.contains(child);\n\t}\n\n\t/**\n\t * @param {Node} node\n\t * @param {string} [selector]\n\t * @returns {?HTMLElement}\n\t */\n\tfunction previousElementSibling(node, selector) {\n\t\tconst prev = node.previousElementSibling;\n\n\t\tif (selector && prev) {\n\t\t\treturn is(prev, selector) ? prev : null;\n\t\t}\n\n\t\treturn prev;\n\t}\n\n\t/**\n\t * @param {!Node} node\n\t * @param {!Node} refNode\n\t * @returns {Node}\n\t */\n\tfunction insertBefore(node, refNode) {\n\t\treturn refNode.parentNode.insertBefore(node, refNode);\n\t}\n\n\t/**\n\t * @param {?HTMLElement} node\n\t * @returns {!Array.<string>}\n\t */\n\tfunction classes(node) {\n\t\treturn node.className.trim().split(/\\s+/);\n\t}\n\n\t/**\n\t * @param {?HTMLElement} node\n\t * @param {string} className\n\t * @returns {boolean}\n\t */\n\tfunction hasClass(node, className) {\n\t\treturn is(node, `.${className}`);\n\t}\n\n\t/**\n\t * @param {!HTMLElement} node\n\t * @param {string} className\n\t */\n\tfunction addClass(node, className) {\n\t\tconst classList = classes(node);\n\n\t\tif (classList.indexOf(className) < 0) {\n\t\t\tclassList.push(className);\n\t\t}\n\n\t\tnode.className = classList.join(' ');\n\t}\n\n\t/**\n\t * @param {!HTMLElement} node\n\t * @param {string} className\n\t */\n\tfunction removeClass(node, className) {\n\t\tconst classList = classes(node);\n\n\t\tarrayRemove(classList, className);\n\n\t\tnode.className = classList.join(' ');\n\t}\n\n\t/**\n\t * Toggles a class on node.\n\t *\n\t * If state is specified and is truthy it will add\n\t * the class.\n\t *\n\t * If state is specified and is falsey it will remove\n\t * the class.\n\t *\n\t * @param {HTMLElement} node\n\t * @param {string} className\n\t * @param {boolean} [state]\n\t */\n\tfunction toggleClass(node, className, state) {\n\t\tstate = isUndefined(state) ? !hasClass(node, className) : state;\n\n\t\tif (state) {\n\t\t\taddClass(node, className);\n\t\t} else {\n\t\t\tremoveClass(node, className);\n\t\t}\n\t}\n\n\t/**\n\t * Gets or sets the width of the passed node.\n\t *\n\t * @param {HTMLElement} node\n\t * @param {number|string} [value]\n\t * @returns {number|undefined}\n\t */\n\tfunction width(node, value) {\n\t\tif (isUndefined(value)) {\n\t\t\tconst cs = getComputedStyle(node);\n\t\t\tconst padding = toFloat(cs.paddingLeft) + toFloat(cs.paddingRight);\n\t\t\tconst border = toFloat(cs.borderLeftWidth) + toFloat(cs.borderRightWidth);\n\n\t\t\treturn node.offsetWidth - padding - border;\n\t\t}\n\n\t\tcss(node, 'width', value);\n\t}\n\n\t/**\n\t * Gets or sets the height of the passed node.\n\t *\n\t * @param {HTMLElement} node\n\t * @param {number|string} [value]\n\t * @returns {number|undefined}\n\t */\n\tfunction height(node, value) {\n\t\tif (isUndefined(value)) {\n\t\t\tconst cs = getComputedStyle(node);\n\t\t\tconst padding = toFloat(cs.paddingTop) + toFloat(cs.paddingBottom);\n\t\t\tconst border = toFloat(cs.borderTopWidth) + toFloat(cs.borderBottomWidth);\n\n\t\t\treturn node.offsetHeight - padding - border;\n\t\t}\n\n\t\tcss(node, 'height', value);\n\t}\n\n\t/**\n\t * Triggers a custom event with the specified name and\n\t * sets the detail property to the data object passed.\n\t *\n\t * @param {HTMLElement} node\n\t * @param {string} eventName\n\t * @param {Object} [data]\n\t */\n\tfunction trigger(node, eventName, data) {\n\t\tvar event;\n\n\t\tif (isFunction(window.CustomEvent)) {\n\t\t\tevent = new CustomEvent(eventName, {\n\t\t\t\tbubbles: true,\n\t\t\t\tcancelable: true,\n\t\t\t\tdetail: data\n\t\t\t});\n\t\t} else {\n\t\t\tevent = node.ownerDocument.createEvent('CustomEvent');\n\t\t\tevent.initCustomEvent(eventName, true, true, data);\n\t\t}\n\n\t\tnode.dispatchEvent(event);\n\t}\n\n\t/**\n\t * Returns if a node is visible.\n\t *\n\t * @param {HTMLElement}\n\t * @returns {boolean}\n\t */\n\tfunction isVisible(node) {\n\t\treturn !!node.getClientRects().length;\n\t}\n\n\t/**\n\t * Convert CSS property names into camel case\n\t *\n\t * @param {string} string\n\t * @returns {string}\n\t */\n\tfunction camelCase(string) {\n\t\treturn string\n\t\t\t.replace(/^-ms-/, 'ms-')\n\t\t\t.replace(/-(\\w)/g, function (match, char) {\n\t\t\t\treturn char.toUpperCase();\n\t\t\t});\n\t}\n\n\n\t/**\n\t * Loop all child nodes of the passed node\n\t *\n\t * The function should accept 1 parameter being the node.\n\t * If the function returns false the loop will be exited.\n\t *\n\t * @param  {HTMLElement} node\n\t * @param  {function} func           Callback which is called with every\n\t *                                   child node as the first argument.\n\t * @param  {boolean} innermostFirst  If the innermost node should be passed\n\t *                                   to the function before it's parents.\n\t * @param  {boolean} siblingsOnly    If to only traverse the nodes siblings\n\t * @param  {boolean} [reverse=false] If to traverse the nodes in reverse\n\t */\n\t// eslint-disable-next-line max-params\n\tfunction traverse(node, func, innermostFirst, siblingsOnly, reverse) {\n\t\tnode = reverse ? node.lastChild : node.firstChild;\n\n\t\twhile (node) {\n\t\t\tconst next = reverse ? node.previousSibling : node.nextSibling;\n\n\t\t\tif (\n\t\t\t\t(!innermostFirst && func(node) === false) ||\n\t\t\t\t(!siblingsOnly && traverse(\n\t\t\t\t\tnode, func, innermostFirst, siblingsOnly, reverse\n\t\t\t\t) === false) ||\n\t\t\t\t(innermostFirst && func(node) === false)\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tnode = next;\n\t\t}\n\t}\n\n\t/**\n\t * Like traverse but loops in reverse\n\t * @see traverse\n\t */\n\tfunction rTraverse(node, func, innermostFirst, siblingsOnly) {\n\t\ttraverse(node, func, innermostFirst, siblingsOnly, true);\n\t}\n\n\t/**\n\t * Parses HTML into a document fragment\n\t *\n\t * @param {string} html\n\t * @param {Document} [context]\n\t * @since 1.4.4\n\t * @return {DocumentFragment}\n\t */\n\tfunction parseHTML(html, context) {\n\t\tcontext = context || document;\n\n\t\tconst ret = context.createDocumentFragment();\n\t\tconst tmp = createElement('div', {}, context);\n\n\t\ttmp.innerHTML = html;\n\n\t\twhile (tmp.firstChild) {\n\t\t\tappendChild(ret, tmp.firstChild);\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\t/**\n\t * Checks if an element has any styling.\n\t *\n\t * It has styling if it is not a plain <div> or <p> or\n\t * if it has a class, style attribute or data.\n\t *\n\t * @param  {HTMLElement} elm\n\t * @return {boolean}\n\t * @since 1.4.4\n\t */\n\tfunction hasStyling(node) {\n\t\treturn node && (!is(node, 'p,div') || node.className ||\n\t\t\tattr(node, 'style') || !isEmptyObject(data(node)));\n\t}\n\n\t/**\n\t * Converts an element from one type to another.\n\t *\n\t * For example it can convert the element <b> to <strong>\n\t *\n\t * @param  {HTMLElement} element\n\t * @param  {string}      toTagName\n\t * @return {HTMLElement}\n\t * @since 1.4.4\n\t */\n\tfunction convertElement(element, toTagName) {\n\t\tvar newElement = createElement(toTagName, {}, element.ownerDocument);\n\n\t\teach(element.attributes, function (_, attribute) {\n\t\t\t// Some browsers parse invalid attributes names like\n\t\t\t// 'size\"2' which throw an exception when set, just\n\t\t\t// ignore these.\n\t\t\ttry {\n\t\t\t\tattr(newElement, attribute.name, attribute.value);\n\t\t\t} catch (_) {}\n\t\t});\n\n\t\twhile (element.firstChild) {\n\t\t\tappendChild(newElement, element.firstChild);\n\t\t}\n\n\t\telement.parentNode.replaceChild(newElement, element);\n\n\t\treturn newElement;\n\t}\n\n\t/**\n\t * List of block level elements separated by bars (|)\n\t *\n\t * @type {string}\n\t */\n\tvar blockLevelList = '|body|hr|p|div|h1|h2|h3|h4|h5|h6|address|pre|' +\n\t\t'form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|blockquote|center|' +\n\t\t'details|section|article|aside|nav|main|header|hgroup|footer|fieldset|' +\n\t\t'dl|dt|dd|figure|figcaption|';\n\n\t/**\n\t * List of elements that do not allow children separated by bars (|)\n\t *\n\t * @param {Node} node\n\t * @return {boolean}\n\t * @since  1.4.5\n\t */\n\tfunction canHaveChildren(node) {\n\t\t// 1  = Element\n\t\t// 9  = Document\n\t\t// 11 = Document Fragment\n\t\tif (!/11?|9/.test(node.nodeType)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// List of empty HTML tags separated by bar (|) character.\n\t\t// Source: http://www.w3.org/TR/html4/index/elements.html\n\t\t// Source: http://www.w3.org/TR/html5/syntax.html#void-elements\n\t\treturn ('|iframe|area|base|basefont|br|col|frame|hr|img|input|wbr' +\n\t\t\t'|isindex|link|meta|param|command|embed|keygen|source|track|' +\n\t\t\t'object|').indexOf(`|${node.nodeName.toLowerCase()}|`) < 0;\n\t}\n\n\t/**\n\t * Checks if an element is inline\n\t *\n\t * @param {HTMLElement} elm\n\t * @param {boolean} [includeCodeAsBlock=false]\n\t * @return {boolean}\n\t */\n\tfunction isInline(elm, includeCodeAsBlock) {\n\t\tvar tagName;\n\t\tconst nodeType = (elm || {}).nodeType || TEXT_NODE;\n\n\t\tif (nodeType !== ELEMENT_NODE) {\n\t\t\treturn nodeType === TEXT_NODE;\n\t\t}\n\n\t\ttagName = elm.tagName.toLowerCase();\n\n\t\tif (tagName === 'code') {\n\t\t\treturn !includeCodeAsBlock;\n\t\t}\n\n\t\treturn blockLevelList.indexOf(`|${tagName}|`) < 0;\n\t}\n\n\t/**\n\t * Copy the CSS from 1 node to another.\n\t *\n\t * Only copies CSS defined on the element e.g. style attr.\n\t *\n\t * @param {HTMLElement} from\n\t * @param {HTMLElement} to\n\t * @deprecated since v3.1.0\n\t */\n\tfunction copyCSS(from, to) {\n\t\tif (to.style && from.style) {\n\t\t\tto.style.cssText = from.style.cssText + to.style.cssText;\n\t\t}\n\t}\n\n\t/**\n\t * Checks if a DOM node is empty\n\t *\n\t * @param {Node} node\n\t * @returns {boolean}\n\t */\n\tfunction isEmpty(node) {\n\t\tif (node.lastChild && isEmpty(node.lastChild)) {\n\t\t\tremove(node.lastChild);\n\t\t}\n\n\t\treturn node.nodeType === 3 ? !node.nodeValue :\n\t\t\t(canHaveChildren(node) && !node.childNodes.length);\n\t}\n\n\t/**\n\t * Fixes block level elements inside in inline elements.\n\t *\n\t * Also fixes invalid list nesting by placing nested lists\n\t * inside the previous li tag or wrapping them in an li tag.\n\t *\n\t * @param {HTMLElement} node\n\t */\n\tfunction fixNesting(node) {\n\t\ttraverse(node, function (node) {\n\t\t\tconst list = 'ul,ol';\n\t\t\tconst isBlock = !isInline(node, true) && node.nodeType !== COMMENT_NODE;\n\t\t\tvar parent = node.parentNode;\n\n\t\t\t// Any blocklevel element inside an inline element needs fixing.\n\t\t\t// Also <p> tags that contain blocks should be fixed\n\t\t\tif (isBlock && (isInline(parent, true) || parent.tagName === 'P')) {\n\t\t\t\t// Find the last inline parent node\n\t\t\t\tlet lastInlineParent = node;\n\t\t\t\twhile (isInline(lastInlineParent.parentNode, true) ||\n\t\t\t\t\tlastInlineParent.parentNode.tagName === 'P') {\n\t\t\t\t\tlastInlineParent = lastInlineParent.parentNode;\n\t\t\t\t}\n\n\t\t\t\tconst before = extractContents(lastInlineParent, node);\n\t\t\t\tconst middle = node;\n\n\t\t\t\t// Clone inline styling and apply it to the blocks children\n\t\t\t\twhile (parent && isInline(parent, true)) {\n\t\t\t\t\tif (parent.nodeType === ELEMENT_NODE) {\n\t\t\t\t\t\tconst clone = parent.cloneNode();\n\t\t\t\t\t\twhile (middle.firstChild) {\n\t\t\t\t\t\t\tappendChild(clone, middle.firstChild);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tappendChild(middle, clone);\n\t\t\t\t\t}\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\n\t\t\t\tinsertBefore(middle, lastInlineParent);\n\t\t\t\tif (!isEmpty(before)) {\n\t\t\t\t\tinsertBefore(before, middle);\n\t\t\t\t}\n\t\t\t\tif (isEmpty(lastInlineParent)) {\n\t\t\t\t\tremove(lastInlineParent);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Fix invalid nested lists which should be wrapped in an li tag\n\t\t\tif (isBlock && is(node, list) && is(node.parentNode, list)) {\n\t\t\t\tlet li = previousElementSibling(node, 'li');\n\n\t\t\t\tif (!li) {\n\t\t\t\t\tli = createElement('li');\n\t\t\t\t\tinsertBefore(li, node);\n\t\t\t\t}\n\n\t\t\t\tappendChild(li, node);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Finds the common parent of two nodes\n\t *\n\t * @param {!HTMLElement} node1\n\t * @param {!HTMLElement} node2\n\t * @return {?HTMLElement}\n\t */\n\tfunction findCommonAncestor(node1, node2) {\n\t\twhile ((node1 = node1.parentNode)) {\n\t\t\tif (contains(node1, node2)) {\n\t\t\t\treturn node1;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @param {?Node}\n\t * @param {boolean} [previous=false]\n\t * @returns {?Node}\n\t */\n\tfunction getSibling(node, previous) {\n\t\tif (!node) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn (previous ? node.previousSibling : node.nextSibling) ||\n\t\t\tgetSibling(node.parentNode, previous);\n\t}\n\n\t/**\n\t * Removes unused whitespace from the root and all it's children.\n\t *\n\t * @param {!HTMLElement} root\n\t * @since 1.4.3\n\t */\n\tfunction removeWhiteSpace(root) {\n\t\tvar\tnodeValue, nodeType, next, previous, previousSibling,\n\t\t\tnextNode, trimStart\n\t        // Preserve newlines if is pre-line\n\t        ;\n\t\tconst cssWhiteSpace = css(root, 'whiteSpace');\n\t\tconst preserveNewLines = /line$/i.test(cssWhiteSpace);\n\t\tvar node = root.firstChild;\n\n\t\t// Skip pre & pre-wrap with any vendor prefix\n\t\tif (/pre(\\-wrap)?$/i.test(cssWhiteSpace)) {\n\t\t\treturn;\n\t\t}\n\n\t\twhile (node) {\n\t\t\tnextNode  = node.nextSibling;\n\t\t\tnodeValue = node.nodeValue;\n\t\t\tnodeType  = node.nodeType;\n\n\t\t\tif (nodeType === ELEMENT_NODE && node.firstChild) {\n\t\t\t\tremoveWhiteSpace(node);\n\t\t\t}\n\n\t\t\tif (nodeType === TEXT_NODE) {\n\t\t\t\tnext      = getSibling(node);\n\t\t\t\tprevious  = getSibling(node, true);\n\t\t\t\ttrimStart = false;\n\n\t\t\t\twhile (hasClass(previous, 'sceditor-ignore')) {\n\t\t\t\t\tprevious = getSibling(previous, true);\n\t\t\t\t}\n\n\t\t\t\t// If previous sibling isn't inline or is a textnode that\n\t\t\t\t// ends in whitespace, time the start whitespace\n\t\t\t\tif (isInline(node) && previous) {\n\t\t\t\t\tpreviousSibling = previous;\n\n\t\t\t\t\twhile (previousSibling.lastChild) {\n\t\t\t\t\t\tpreviousSibling = previousSibling.lastChild;\n\n\t\t\t\t\t\t// eslint-disable-next-line max-depth\n\t\t\t\t\t\twhile (hasClass(previousSibling, 'sceditor-ignore')) {\n\t\t\t\t\t\t\tpreviousSibling = getSibling(previousSibling, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\ttrimStart = previousSibling.nodeType === TEXT_NODE ?\n\t\t\t\t\t\t/[\\t\\n\\r ]$/.test(previousSibling.nodeValue) :\n\t\t\t\t\t\t!isInline(previousSibling);\n\t\t\t\t}\n\n\t\t\t\t// Clear zero width spaces\n\t\t\t\tnodeValue = nodeValue.replace(/\\u200B/g, '');\n\n\t\t\t\t// Strip leading whitespace\n\t\t\t\tif (!previous || !isInline(previous) || trimStart) {\n\t\t\t\t\tnodeValue = nodeValue.replace(\n\t\t\t\t\t\tpreserveNewLines ? /^[\\t ]+/ : /^[\\t\\n\\r ]+/,\n\t\t\t\t\t\t''\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Strip trailing whitespace\n\t\t\t\tif (!next || !isInline(next)) {\n\t\t\t\t\tnodeValue = nodeValue.replace(\n\t\t\t\t\t\tpreserveNewLines ? /[\\t ]+$/ : /[\\t\\n\\r ]+$/,\n\t\t\t\t\t\t''\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Remove empty text nodes\n\t\t\t\tif (!nodeValue.length) {\n\t\t\t\t\tremove(node);\n\t\t\t\t} else {\n\t\t\t\t\tnode.nodeValue = nodeValue.replace(\n\t\t\t\t\t\tpreserveNewLines ? /[\\t ]+/g : /[\\t\\n\\r ]+/g,\n\t\t\t\t\t\t' '\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tnode = nextNode;\n\t\t}\n\t}\n\n\t/**\n\t * Extracts all the nodes between the start and end nodes\n\t *\n\t * @param {HTMLElement} startNode\tThe node to start extracting at\n\t * @param {HTMLElement} endNode\t\tThe node to stop extracting at\n\t * @return {DocumentFragment}\n\t */\n\tfunction extractContents(startNode, endNode) {\n\t\tconst range = startNode.ownerDocument.createRange();\n\n\t\trange.setStartBefore(startNode);\n\t\trange.setEndAfter(endNode);\n\n\t\treturn range.extractContents();\n\t}\n\n\t/**\n\t * Gets the offset position of an element\n\t *\n\t * @param  {HTMLElement} node\n\t * @return {Object} An object with left and top properties\n\t */\n\tfunction getOffset(node) {\n\t\tvar\tleft = 0,\n\t\t\ttop = 0;\n\n\t\twhile (node) {\n\t\t\tleft += node.offsetLeft;\n\t\t\ttop  += node.offsetTop;\n\t\t\tnode  = node.offsetParent;\n\t\t}\n\n\t\treturn {\n\t\t\tleft: left,\n\t\t\ttop: top\n\t\t};\n\t}\n\n\t/**\n\t * Gets the value of a CSS property from the elements style attribute\n\t *\n\t * @param  {HTMLElement} elm\n\t * @param  {string} property\n\t * @return {string}\n\t */\n\tfunction getStyle(elm, property) {\n\t\tvar\tstyleValue;\n\t\tconst elmStyle = elm.style;\n\n\t\tif (!cssPropertyNameCache[property]) {\n\t\t\tcssPropertyNameCache[property] = camelCase(property);\n\t\t}\n\n\t\tproperty   = cssPropertyNameCache[property];\n\t\tstyleValue = elmStyle[property];\n\n\t\t// Add an exception for text-align\n\t\tif ('textAlign' === property) {\n\t\t\tstyleValue = styleValue || css(elm, property);\n\n\t\t\tif (css(elm.parentNode, property) === styleValue ||\n\t\t\t\tcss(elm, 'display') !== 'block' || is(elm, 'hr,th')) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}\n\n\t\treturn styleValue;\n\t}\n\n\t/**\n\t * Tests if an element has a style.\n\t *\n\t * If values are specified it will check that the styles value\n\t * matches one of the values\n\t *\n\t * @param  {HTMLElement} elm\n\t * @param  {string} property\n\t * @param  {string|array} [values]\n\t * @return {boolean}\n\t */\n\tfunction hasStyle(elm, property, values) {\n\t\tconst styleValue = getStyle(elm, property);\n\n\t\tif (!styleValue) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !values || styleValue === values ||\n\t\t\t(Array.isArray(values) && values.indexOf(styleValue) > -1);\n\t}\n\n\t/**\n\t * Returns true if both nodes have the same number of inline styles and all the\n\t * inline styles have matching values\n\t *\n\t * @param {HTMLElement} nodeA\n\t * @param {HTMLElement} nodeB\n\t * @returns {boolean}\n\t */\n\tfunction stylesMatch(nodeA, nodeB) {\n\t\tvar i = nodeA.style.length;\n\t\tif (i !== nodeB.style.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\twhile (i--) {\n\t\t\tconst prop = nodeA.style[i];\n\t\t\tif (nodeA.style[prop] !== nodeB.style[prop]) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns true if both nodes have the same number of attributes and all the\n\t * attribute values match\n\t *\n\t * @param {HTMLElement} nodeA\n\t * @param {HTMLElement} nodeB\n\t * @returns {boolean}\n\t */\n\tfunction attributesMatch(nodeA, nodeB) {\n\t\tvar i = nodeA.attributes.length;\n\t\tif (i !== nodeB.attributes.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\twhile (i--) {\n\t\t\tconst prop = nodeA.attributes[i];\n\t\t\tconst notMatches = prop.name === 'style' ?\n\t\t\t\t!stylesMatch(nodeA, nodeB) :\n\t\t\t\tprop.value !== attr(nodeB, prop.name);\n\n\t\t\tif (notMatches) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Removes an element placing its children in its place\n\t *\n\t * @param {HTMLElement} node\n\t */\n\tfunction removeKeepChildren(node) {\n\t\twhile (node.firstChild) {\n\t\t\tinsertBefore(node.firstChild, node);\n\t\t}\n\n\t\tremove(node);\n\t}\n\n\t/**\n\t * Merges inline styles and tags with parents where possible\n\t *\n\t * @param {Node} node\n\t * @since 3.1.0\n\t */\n\tfunction merge(node) {\n\t\tif (node.nodeType !== ELEMENT_NODE) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar parent = node.parentNode;\n\t\tvar tagName = node.tagName;\n\t\tvar mergeTags = /B|STRONG|EM|SPAN|FONT/;\n\n\t\t// Merge children (in reverse as children can be removed)\n\t\tvar i = node.childNodes.length;\n\t\twhile (i--) {\n\t\t\tmerge(node.childNodes[i]);\n\t\t}\n\n\t\t// Should only merge inline tags and should not merge <br> tags\n\t\tif (!isInline(node) || tagName === 'BR') {\n\t\t\treturn;\n\t\t}\n\n\t\t// Remove any inline styles that match the parent style\n\t\ti = node.style.length;\n\t\twhile (i--) {\n\t\t\tvar prop = node.style[i];\n\t\t\tif (css(parent, prop) === css(node, prop)) {\n\t\t\t\tnode.style.removeProperty(prop);\n\t\t\t}\n\t\t}\n\n\t\t// Can only remove / merge tags if no inline styling left.\n\t\t// If there is any inline style left then it means it at least partially\n\t\t// doesn't match the parent style so must stay\n\t\tif (!node.style.length) {\n\t\t\tremoveAttr(node, 'style');\n\n\t\t\t// Remove font attributes if match parent\n\t\t\tif (tagName === 'FONT') {\n\t\t\t\tif (css(node, 'fontFamily').toLowerCase() ===\n\t\t\t\t\tcss(parent, 'fontFamily').toLowerCase()) {\n\t\t\t\t\tremoveAttr(node, 'face');\n\t\t\t\t}\n\n\t\t\t\tif (css(node, 'color') === css(parent, 'color')) {\n\t\t\t\t\tremoveAttr(node, 'color');\n\t\t\t\t}\n\n\t\t\t\tif (css(node, 'fontSize') === css(parent, 'fontSize')) {\n\t\t\t\t\tremoveAttr(node, 'size');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Spans and font tags with no attributes can be safely removed\n\t\t\tif (!node.attributes.length && /SPAN|FONT/.test(tagName)) {\n\t\t\t\tremoveKeepChildren(node);\n\t\t\t} else if (mergeTags.test(tagName)) {\n\t\t\t\tvar isBold = /B|STRONG/.test(tagName);\n\t\t\t\tvar isItalic = tagName === 'EM';\n\n\t\t\t\twhile (parent &&\n\t\t\t\t\tisInline(parent) &&\n\t\t\t\t\t(!isBold || /bold|700/i.test(css(parent, 'fontWeight'))) &&\n\t\t\t\t\t(!isItalic || css(parent, 'fontStyle') === 'italic')) {\n\n\t\t\t\t\t// Remove if parent match\n\t\t\t\t\tif ((parent.tagName === tagName ||\n\t\t\t\t\t\t\t(isBold && /B|STRONG/.test(parent.tagName))) &&\n\t\t\t\t\t\tattributesMatch(parent, node)) {\n\t\t\t\t\t\tremoveKeepChildren(node);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Merge siblings if attributes, including inline styles, match\n\t\tvar next = node.nextSibling;\n\t\tif (next && next.tagName === tagName && attributesMatch(next, node)) {\n\t\t\tappendChild(node, next);\n\t\t\tremoveKeepChildren(next);\n\t\t}\n\t}\n\n\t/**\n\t * Default options for SCEditor\n\t * @type {Object}\n\t */\n\tvar defaultOptions = {\n\t\t/** @lends jQuery.sceditor.defaultOptions */\n\t\t/**\n\t\t * Toolbar buttons order and groups. Should be comma separated and\n\t\t * have a bar | to separate groups\n\t\t *\n\t\t * @type {string}\n\t\t */\n\t\ttoolbar: 'bold,italic,underline,strike|' +\n\t\t\t'font,size,color|mark|' +\n\t\t\t'email,link,unlink,quote,code|image|note|' +\n\t\t\t'bulletlist,orderedlist|left,center,right|' +\n\t\t\t'cut,copy,pastetext,removeformat|' +\n\t\t\t'undo,redo|' +\n\t\t\t'youtube,vimeo,instagram,facebook,media,extensions|source|reply',\n\n\t\t/**\n\t\t * Comma separated list of commands to excludes from the toolbar\n\t\t *\n\t\t * @type {string}\n\t\t */\n\t\ttoolbarExclude: null,\n\n\t\t/**\n\t\t * Maximum Number of allowed Characters\n\t\t *\n\t\t * @type {?number}\n\t\t*/\n\t\tmaxLength: null,\n\n\t\t/**\n\t\t * Stylesheet to include in the WYSIWYG editor. This is what will style\n\t\t * the WYSIWYG elements\n\t\t *\n\t\t * @type {Array}\n\t\t */\n\t\tstyles: [],\n\n\t\t/**\n\t\t * The bootstrap theme mode. This will be applied to the editor WYSIWYG mode (iframe)\n\t\t *\n\t\t * @type {string}\n\t\t*/\n\t\tthemeMode: attr(document.documentElement, 'data-bs-theme') || 'light',\n\n\t\t/**\n\t\t * Comma separated list of fonts for the font selector\n\t\t *\n\t\t * @type {string}\n\t\t */\n\t\tfonts: 'Arial,Arial Black,Comic Sans MS,Courier New,Georgia,Impact,' +\n\t\t\t'Sans-serif,Serif,Times New Roman,Trebuchet MS,Verdana',\n\n\t\t/**\n\t\t * Default format\n\t\t *\n\t\t * @type {string}\n\t\t*/\n\t\tformat: 'bbcode',\n\n\t\t/**\n\t\t * Default icon set\n\t     *\n\t     * @type {string}\n\t    */\n\t\ticons: 'fontawesome',\n\n\t\t/**\n\t\t * Comma separated list of code languages for the code block selector\n\t\t *\n\t\t * @type {Array}\n\t\t */\n\t\tcodeLanguages: [\n\t\t\t{ Value: 'markup', Text: 'Plain Text' },\n\t\t\t{ Value: 'bash', Text: 'Bash(shell)' },\n\t\t\t{ Value: 'c', Text: 'C' },\n\t\t\t{ Value: 'cpp', Text: 'C++' },\n\t\t\t{ Value: 'csharp', Text: 'C#' },\n\t\t\t{ Value: 'css', Text: 'CSS' },\n\t\t\t{ Value: 'scss', Text: 'SCSS' },\n\t\t\t{ Value: 'git', Text: 'Git' },\n\t\t\t{ Value: 'markup', Text: 'HTML' },\n\t\t\t{ Value: 'java', Text: 'Java' },\n\t\t\t{ Value: 'javascript', Text: 'JavaScript' },\n\t\t\t{ Value: 'json', Text: 'JSON' },\n\t\t\t{ Value: 'python', Text: 'Python' },\n\t\t\t{ Value: 'sql', Text: 'SQL' },\n\t\t\t{ Value: 'markup', Text: 'XML' },\n\t\t\t{ Value: 'vb', Text: 'Visual Basic' }\n\t\t],\n\n\t\t/**\n\t     * Comma separated list of note types for the alerts\n\t     *\n\t     * @type {Array}\n\t     */\n\t\tnoteTypes: 'primary,secondary,success,danger,warning,info,light,dark',\n\n\t\t/**\n\t\t * Colors should be comma separated and have a bar | to signal a new\n\t\t * column.\n\t\t *\n\t\t * If null the colors will be auto generated.\n\t\t *\n\t\t * @type {string}\n\t\t */\n\t\tcolors: '#000000,#44B8FF,#1E92F7,#0074D9,#005DC2,#00369B,#b3d5f4|' +\n\t\t\t'#444444,#C3FFFF,#9DF9FF,#7FDBFF,#68C4E8,#419DC1,#d9f4ff|' +\n\t\t\t'#666666,#72FF84,#4CEA5E,#2ECC40,#17B529,#008E02,#c0f0c6|' +\n\t\t\t'#888888,#FFFF44,#FFFA1E,#FFDC00,#E8C500,#C19E00,#fff5b3|' +\n\t\t\t'#aaaaaa,#FFC95F,#FFA339,#FF851B,#E86E04,#C14700,#ffdbbb|' +\n\t\t\t'#cccccc,#FF857A,#FF5F54,#FF4136,#E82A1F,#C10300,#ffc6c3|' +\n\t\t\t'#eeeeee,#FF56FF,#FF30DC,#F012BE,#D900A7,#B20080,#fbb8ec|' +\n\t\t\t'#ffffff,#F551FF,#CF2BE7,#B10DC9,#9A00B2,#9A00B2,#e8b6ef',\n\n\t\t/**\n\t\t * The locale to use.\n\t\t * @type {string}\n\t\t */\n\t\tlocale: attr(document.documentElement, 'lang') || 'en',\n\n\t\t/**\n\t\t * The Charset to use\n\t\t * @type {string}\n\t\t */\n\t\tcharset: 'utf-8',\n\n\t\t/**\n\t\t * Width of the editor. Set to null for automatic with\n\t\t *\n\t\t * @type {?number}\n\t\t */\n\t\twidth: '100%',\n\n\t\t/**\n\t\t * Height of the editor including toolbar. Set to null for automatic\n\t\t * height\n\t\t *\n\t\t * @type {?number}\n\t\t */\n\t\theight: null,\n\n\t\t/**\n\t\t * If to allow the editor to be resized\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tresizeEnabled: true,\n\n\t\t/**\n\t\t * Min resize to width, set to null for half textarea width or -1 for\n\t\t * unlimited\n\t\t *\n\t\t * @type {?number}\n\t\t */\n\t\tresizeMinWidth: null,\n\t\t/**\n\t\t * Min resize to height, set to null for half textarea height or -1 for\n\t\t * unlimited\n\t\t *\n\t\t * @type {?number}\n\t\t */\n\t\tresizeMinHeight: null,\n\t\t/**\n\t\t * Max resize to height, set to null for double textarea height or -1\n\t\t * for unlimited\n\t\t *\n\t\t * @type {?number}\n\t\t */\n\t\tresizeMaxHeight: null,\n\t\t/**\n\t\t * Max resize to width, set to null for double textarea width or -1 for\n\t\t * unlimited\n\t\t *\n\t\t * @type {?number}\n\t\t */\n\t\tresizeMaxWidth: null,\n\t\t/**\n\t\t * If resizing by height is enabled\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tresizeHeight: true,\n\t\t/**\n\t\t * If resizing by width is enabled\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tresizeWidth: true,\n\n\t\t/**\n\t\t * Date format, will be overridden if locale specifies one.\n\t\t *\n\t\t * The words year, month and day will be replaced with the users current\n\t\t * year, month and day.\n\t\t *\n\t\t * @type {string}\n\t\t */\n\t\tdateFormat: 'year-month-day',\n\n\t\t/**\n\t\t * Element to inset the toolbar into.\n\t\t *\n\t\t * @type {HTMLElement}\n\t\t */\n\t\ttoolbarContainer: null,\n\n\t\t/**\n\t\t * If to enable paste filtering. This is currently experimental, please\n\t\t * report any issues.\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tenablePasteFiltering: true,\n\n\t\t/**\n\t\t * If to completely disable pasting into the editor\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tdisablePasting: false,\n\n\t\t/**\n\t\t * If the editor is read only.\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\treadOnly: false,\n\n\t\t/**\n\t\t * If to set the editor to right-to-left mode.\n\t\t *\n\t\t * If set to null the direction will be automatically detected.\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\trtl: false,\n\n\t\t/**\n\t\t * If to auto focus the editor on page load\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tautofocus: false,\n\n\t\t/**\n\t\t * If to auto focus the editor to the end of the content\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tautofocusEnd: true,\n\n\t\t/**\n\t\t * If to auto expand the editor to fix the content\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tautoExpand: false,\n\n\t\t/**\n\t\t * If to auto update original textbox on blur\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tautoUpdate: false,\n\n\t\t/**\n\t\t * If to enable the browsers built in spell checker\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tspellcheck: true,\n\n\t\t/**\n\t\t * If to run the source editor when there is no WYSIWYG support. Only\n\t\t * really applies to mobile OS's.\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\trunWithoutWysiwygSupport: false,\n\n\t\t/**\n\t\t * If to load the editor in source mode and still allow switching\n\t\t * between WYSIWYG and source mode\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tstartInSourceMode: false,\n\n\t\t/**\n\t\t * Optional ID to give the editor.\n\t\t *\n\t\t * @type {string}\n\t\t */\n\t\tid: null,\n\n\t\t/**\n\t\t * Comma separated list of plugins\n\t\t *\n\t\t * @type {string}\n\t\t */\n\t\tplugins: 'undo,dragdrop',\n\n\t\t/**\n\t\t * z-index to set the editor container to. Needed for jQuery UI dialog.\n\t\t *\n\t\t * @type {?number}\n\t\t */\n\t\tzIndex: null,\n\n\t\t/**\n\t\t * If to trim the BBCode. Removes any spaces at the start and end of the\n\t\t * BBCode string.\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tbbcodeTrim: false,\n\n\t\t/**\n\t\t * If to disable removing block level elements by pressing backspace at\n\t\t * the start of them\n\t\t *\n\t\t * @type {boolean}\n\t\t */\n\t\tdisableBlockRemove: true,\n\n\t\t/**\n\t\t * Array of allowed URL (should be either strings or regex) for iframes.\n\t\t *\n\t\t * If it's a string then iframes where the start of the src matches the\n\t\t * specified string will be allowed.\n\t\t *\n\t\t * If it's a regex then iframes where the src matches the regex will be\n\t\t * allowed.\n\t\t *\n\t\t * @type {Array}\n\t\t */\n\t\tallowedIframeUrls: [],\n\n\t\t/**\n\t\t * BBCode parser options, only applies if using the editor in BBCode\n\t\t * mode.\n\t\t *\n\t\t * See SCEditor.BBCodeParser.defaults for list of valid options\n\t\t *\n\t\t * @type {Object}\n\t\t */\n\t\tparserOptions: {},\n\n\t\t/**\n\t\t * CSS that will be added to the to dropdown menu (eg. z-index)\n\t\t *\n\t\t * @type {Object}\n\t\t */\n\t\tdropDownCss: {},\n\n\t\t/**\n\t\t * An array of tags that are allowed in the editor content.\n\t\t * If a tag is not listed here, it will be removed when the content is\n\t\t * sanitized.\n\t\t *\n\t\t * 1 Tag is already added by default: ['iframe']. No need to add this\n\t\t * further.\n\t\t *\n\t\t * @type {Array}\n\t\t */\n\t\tallowedTags: [],\n\n\t\t/**\n\t\t * An array of attributes that are allowed on tags in the editor content.\n\t\t * If an attribute is not listed here, it will be removed when the content\n\t\t * is sanitized.\n\t\t *\n\t\t * 3 Attributes are already added by default:\n\t\t * \t['allowfullscreen', 'frameborder', 'target'].\n\t\t * No need to add these further.\n\t\t *\n\t\t * @type {Array}\n\t\t */\n\t\tallowedAttributes: ['contenteditable'],\n\n\t\t/**\n\t\t * Url for the BBCode Extensions json\n\t\t *\n\t\t * @type {string}\n\t\t*/\n\t\textensionsUrl: '',\n\n\t\t/**\n\t\t * Application root url\n\t\t *\n\t\t * @type {string}\n\t\t*/\n\t\troot: '',\n\n\t\t/**\n\t\t * Attachments preview url\n\t\t *\n\t\t * @type {string}\n\t\t*/\n\t\tattachmentsPreviewUrl: '',\n\n\t\t/**\n\t\t * Albums preview url\n\t\t *\n\t\t * @type {string}\n\t\t*/\n\t\talbumsPreviewUrl: '',\n\n\t\t/**\n\t\t * mentions url\n\t\t *\n\t\t * @type {string}\n\t\t*/\n\t\tmentionsUrl: '',\n\n\t\tonToggleMode: undefined,\n\n\t\t/**\n\t\t* Default path for the script files\n\t\t*\n\t\t* @type {string}\n\t\t*/\n\t\tbasePath: ''\n\t};\n\n\t// Must start with a valid scheme\n\t// \t\t^\n\t// Schemes that are considered safe\n\t// \t\t(https?|s?ftp|mailto|spotify|ssh|teamspeak|tel):|\n\t// Relative schemes (//:) are considered safe\n\t// \t\t(\\\\/\\\\/)|\n\t// Image data URI's are considered safe\n\t// \t\tdata:image\\\\/(png|bmp|gif|p?jpe?g);\n\tvar VALID_SCHEME_REGEX =\n\t\t/^(https?|s?ftp|mailto|spotify|ssh|teamspeak|tel):|(\\/\\/)|data:image\\/(png|bmp|gif|p?jpe?g);/i;\n\n\t/**\n\t * Escapes a string so it's safe to use in regex\n\t *\n\t * @param {string} str\n\t * @return {string}\n\t */\n\tfunction regex(str) {\n\t\treturn str.replace(/([\\-.*+?^=!:${}()|\\[\\]\\/\\\\])/g, '\\\\$1');\n\t}\n\t/**\n\t * Escapes all HTML entities in a string\n\t *\n\t * If noQuotes is set to false, all single and double\n\t * quotes will also be escaped\n\t *\n\t * @param {string} str\n\t * @param {boolean} [noQuotes=true]\n\t * @return {string}\n\t * @since 1.4.1\n\t */\n\tfunction entities(str, noQuotes) {\n\t\tif (!str) {\n\t\t\treturn str;\n\t\t}\n\n\t\tvar replacements = {\n\t\t\t'&': '&amp;',\n\t\t\t'<': '&lt;',\n\t\t\t'>': '&gt;',\n\t\t\t'  ': '&nbsp; ',\n\t\t\t'\\r\\n': '<br />',\n\t\t\t'\\r': '<br />',\n\t\t\t'\\n': '<br />'\n\t\t};\n\n\t\tif (noQuotes !== false) {\n\t\t\treplacements['\"'] = '&#34;';\n\t\t\treplacements['\\''] = '&#39;';\n\t\t\treplacements['`'] = '&#96;';\n\t\t}\n\n\t\tstr = str.replace(/ {2}|\\r\\n|[&<>\\r\\n'\"`]/g,\n\t\t\tfunction (match) {\n\t\t\t\treturn replacements[match] || match;\n\t\t\t});\n\n\t\treturn str;\n\t}\n\t/**\n\t * Escape URI scheme.\n\t *\n\t * Appends the current URL to a url if it has a scheme that is not:\n\t *\n\t * http\n\t * https\n\t * sftp\n\t * ftp\n\t * mailto\n\t * spotify\n\t * ssh\n\t * teamspeak\n\t * tel\n\t * //\n\t * data:image/(png|jpeg|jpg|pjpeg|bmp|gif);\n\t *\n\t * **IMPORTANT**: This does not escape any HTML in a url, for\n\t * that use the escape.entities() method.\n\t *\n\t * @param  {string} url\n\t * @return {string}\n\t * @since 1.4.5\n\t */\n\tfunction uriScheme(url) {\n\t\tconst hasScheme = /^[^\\/]*:/i;\n\t\tconst location = window.location;\n\n\t\t// Has no scheme or a valid scheme\n\t\tif ((!url || !hasScheme.test(url)) || VALID_SCHEME_REGEX.test(url)) {\n\t\t\treturn url;\n\t\t}\n\n\t\tconst path = location.pathname.split('/');\n\t\tpath.pop();\n\n\t\treturn location.protocol +\n\t\t\t'//' +\n\t\t\tlocation.host +\n\t\t\tpath.join('/') +\n\t\t\t'/' +\n\t\t\turl;\n\t}\n\n\t/**\n\t * HTML templates used by the editor and default commands\n\t * @type {Object}\n\t * @private\n\t */\n\tvar _templates = {\n\t\thtml:\n\t\t\t'<!DOCTYPE html>' +\n\t\t\t\t'<html data-bs-theme=\"{themeMode}\">' +\n\t\t\t\t'<head>' +\n\t\t\t\t'<meta http-equiv=\"Content-Type\" ' +\n\t\t\t\t'content=\"text/html;charset={charset}\" />' +\n\t\t\t\t'{styles}' +\n\t\t\t\t'</head>' +\n\t\t\t\t'<body style=\"min-height:265px\" contenteditable=\"true\" {spellcheck}><p></p>' +\n\t\t\t\t'</body>' +\n\t\t\t\t'</html>',\n\n\t\tstyle: '<link rel=\"stylesheet\" type=\"text/css\" href=\"{style}\" />',\n\n\t\ttoolbarButton: '<a class=\"btn sceditor-button sceditor-button-{name}\" ' +\n\t\t\t'data-sceditor-command=\"{name}\" unselectable=\"on\">' +\n\t\t\t'<span unselectable=\"on\">  </span></a>',\n\n\t\tcodeOpt: '<a class=\"sceditor-code-option dropdown-item\" href=\"#\" ' +\n\t\t\t'data-language=\"{language}\">{languageName}</a>',\n\n\t\tnoteOpt: '<option value=\"{type}\">{type}</option>',\n\n\t\textensionOpt: '<a class=\"sceditor-extension-option dropdown-item\" href=\"#\" ' +\n\t\t\t'data-language=\"{extension}\">{extension}</a>',\n\n\t\tfontOpt: '<a class=\"sceditor-font-option dropdown-item\" href=\"#\" ' +\n\t\t\t'data-font=\"{font}\"><font face=\"{font}\">{font}</font></a>',\n\n\t\tsizeOpt: '<a class=\"sceditor-fontsize-option dropdown-item\" data-size=\"{size}\" ' +\n\t\t\t'href=\"#\"><font size=\"{size}\">{size}</font></a>',\n\n\t\talbums:\n\t\t\t'<form class=\"m-3\"><div id=\"AlbumsListBox\" class=\"content\">' +\n\t\t\t\t'<div id=\"AlbumsListPager\"></div>' +\n\t\t\t\t'<div id=\"PostAlbumsLoader\" class=\"text-center\"><div class=\"fa-3x\"><i class=\"fas fa-spinner fa-pulse\"></i>' +\n\t\t\t\t'</div></div>' +\n\t\t\t\t'<div id=\"AlbumsListBox\" class=\"content\">' +\n\t\t\t\t'<div id=\"PostAlbumsListPlaceholder\" data-url=\"{root}\" style=\"clear: both; \">' +\n\t\t\t\t'<div class=\"container\"><div class=\"AlbumsList row\"></div></div>' +\n\t\t\t\t'</div></div>' +\n\t\t\t'</div></form>',\n\n\t\tnote:\n\t\t\t'<form class=\"m-3\">' +\n\t\t\t\t'<div class=\"mb-3\"><label for=\"type\" class=\"form-label\">{labelType}</label> ' +\n\t\t\t\t'<select class=\"form-select\" id=\"type\" aria-label=\"note type\">' +\n\t\t\t\t'{values}' +\n\t\t\t\t'</select> ' +\n\t\t\t\t'</div> ' +\n\t\t\t\t'<div class=\"mb-3\"><label for=\"txt\" class=\"form-label\">{labelText}</label> ' +\n\t\t\t\t'<textarea cols=\"20\" rows=\"7\" id=\"txt\" class=\"form-control textarea-input\"></textarea></div>' +\n\t\t\t\t'<input type=\"button\" class=\"btn btn-sm btn-primary button\" value=\"{insert}\" />' +\n\t\t\t\t'</div></form>',\n\n\t\tpastetext:\n\t\t\t'<form class=\"m-3\"><div class=\"mb-3\"><label for=\"txt\" class=\"form-label\">{label}</label> ' +\n\t\t\t\t'<textarea cols=\"20\" rows=\"7\" id=\"txt\" class=\"form-control textarea-input\"></textarea></div>' +\n\t\t\t\t'<input type=\"button\" class=\"btn btn-sm btn-primary button\" value=\"{insert}\" />' +\n\t\t\t\t'</div></form>',\n\n\t\timage:\n\t\t\t'<form class=\"m-3\"><div class=\"mb-3\"><label for=\"link\" class=\"form-label\">{url}</label> ' +\n\t\t\t\t'<input type=\"text\" id=\"link\" dir=\"ltr\" placeholder=\"https://\" class=\"form-control\" /></div>' +\n\t\t\t\t'<div class=\"mb-3\"><label for=\"des\" class=\"form-label\">{desc}</label> ' +\n\t\t\t\t'<input type=\"text\" id=\"des\" class=\"form-control\" /></div>' +\n\t\t\t'<input type=\"button\" class=\"btn btn-sm btn-primary button\" value=\"{insert}\" /></form>',\n\n\t\temail:\n\t\t\t'<form class=\"m-3\"><div class=\"mb-3\"><label for=\"email\" class=\"form-label\">{label}</label> ' +\n\t\t\t\t'<input type=\"text\" id=\"email\" dir=\"ltr\" class=\"form-control\" /></div>' +\n\t\t\t\t'<div class=\"mb-3\"><label for=\"des\" class=\"form-label\">{desc}</label> ' +\n\t\t\t\t'<input type=\"text\" id=\"des\" class=\"form-control\" /></div>' +\n\t\t\t\t'<input type=\"button\" class=\"btn btn-sm btn-primary button\" value=\"{insert}\" />' +\n\t\t\t\t'</form>',\n\n\t\tlink:\n\t\t\t'<form class=\"m-3\"><div class=\"mb-3\"><label for=\"link\" class=\"form-label\">{url}</label> ' +\n\t\t\t\t'<input type=\"text\" id=\"link\" dir=\"ltr\" placeholder=\"https://\" class=\"form-control\" /></div>' +\n\t\t\t\t'<div class=\"mb-3\"><label for=\"des\" class=\"form-label\">{desc}</label> ' +\n\t\t\t\t'<input type=\"text\" id=\"des\" class=\"form-control\" /></div>' +\n\t\t\t\t'<input type=\"button\" class=\"btn btn-sm btn-primary button\" value=\"{ins}\" /></form>',\n\n\t\tmediaMenu:\n\t\t\t'<form class=\"m-3\"><div class=\"mb-3\"><label for=\"link\" class=\"form-label\">{label}</label> ' +\n\t\t\t\t'<input type=\"url\" id=\"link\" dir=\"ltr\" placeholder=\"https://\" class=\"form-control\" /></div>' +\n\t\t\t\t'<input type=\"button\" class=\"btn btn-sm btn-primary button\" value=\"{insert}\" />' +\n\t\t\t\t'</form>',\n\n\t\tyoutubeMenu:\n\t\t\t'<form class=\"m-3\"><div class=\"mb-3\"><label for=\"link\" class=\"form-label\">{label}</label> ' +\n\t\t\t\t'<input type=\"text\" id=\"link\" dir=\"ltr\" placeholder=\"https://\" class=\"form-control\" /></div>' +\n\t\t\t\t'<input type=\"button\" class=\"btn btn-sm btn-primary button\" value=\"{insert}\" />' +\n\t\t\t\t'</form>',\n\n\t\tinstagramMenu:\n\t\t\t'<form class=\"m-3\"><div class=\"mb-3\"><label for=\"link\" class=\"form-label\">{label}</label> ' +\n\t\t\t\t'<input type=\"text\" id=\"link\" dir=\"ltr\" placeholder=\"https://\" class=\"form-control\" /></div>' +\n\t\t\t\t'<input type=\"button\" class=\"btn btn-sm btn-primary button\" value=\"{insert}\" />' +\n\t\t\t\t'</form>',\n\n\t\tfacebookMenu:\n\t\t\t'<form class=\"m-3\"><div class=\"mb-3\"><label for=\"link\" class=\"form-label\">{label}</label> ' +\n\t\t\t\t'<input type=\"text\" id=\"link\" dir=\"ltr\" placeholder=\"https://\" class=\"form-control\" /></div>' +\n\t\t\t\t'<input type=\"button\" class=\"btn btn-sm btn-primary button\" value=\"{insert}\" />' +\n\t\t\t\t'</form>',\n\n\t\tfacebook:\n\t\t\t'<div class=\"ratio ratio-1x1 border\" data-oembed-url=\"{url}\" data-facebook-url=\"{url}\"><iframe src=\"https://www.facebook.com/plugins/post.php?href={url}\"></iframe></div>',\n\n\t\tinstagram:\n\t\t\t'<div class=\"ratio ratio-1x1 border\" data-oembed-url=\"https://www.instagram.com/p/{id}\" data-instagram-url=\"{url}\"><iframe src=\"https://www.instagram.com/p/{id}/embed/captioned/\"></iframe></div>',\n\n\t\tyoutube:\n\t\t\t'<div data-oembed-url=\"https://youtube.com/embed/{id}\" data-youtube-url=\"{url}\" class=\"ratio ratio-16x9 border\"><iframe src=\"https://youtube.com/embed/{id}?hd=1\"></iframe></div>',\n\n\t\tvimeo:\n\t\t\t'<div data-oembed-url=\"https://vimeo.com/{vimeoId}\" data-vimeo-url=\"{url}\" class=\"ratio ratio-16x9 border\"><iframe src=\"https://player.vimeo.com/video/{vimeoId}?show_title=1&show_byline=1&show_portrait=1&fullscreen=1\"></iframe></div>'\n\t};\n\n\t/**\n\t * Replaces any params in a template with the passed params.\n\t *\n\t * If createHtml is passed it will return a DocumentFragment\n\t * containing the parsed template.\n\t *\n\t * @param {string} name\n\t * @param {Object} [params]\n\t * @param {boolean} [createHtml]\n\t * @returns {string|DocumentFragment}\n\t * @private\n\t */\n\tfunction _tmpl(name, params, createHtml) {\n\t\tvar template = _templates[name];\n\n\t\tObject.keys(params).forEach(function(name) {\n\t\t\ttemplate = template.replace(\n\t\t\t\tnew RegExp(regex(`{${name}}`), 'g'),\n\t\t\t\tparams[name]\n\t\t\t);\n\t\t});\n\n\t\tif (createHtml) {\n\t\t\ttemplate = parseHTML(template);\n\t\t}\n\n\t\treturn template;\n\t}\n\n\t/**\n\t * Fixes a bug in FF where it sometimes wraps\n\t * new lines in their own list item.\n\t * See issue #359\n\t */\n\tfunction fixFirefoxListBug(editor) {\n\t\t// Only apply to Firefox as will break other browsers.\n\t\tif ('mozHidden' in document) {\n\t\t\tlet node = editor.getBody();\n\t\t\tlet next;\n\n\t\t\twhile (node) {\n\t\t\t\tnext = node;\n\n\t\t\t\tif (next.firstChild) {\n\t\t\t\t\tnext = next.firstChild;\n\t\t\t\t} else {\n\n\t\t\t\t\twhile (next && !next.nextSibling) {\n\t\t\t\t\t\tnext = next.parentNode;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (next) {\n\t\t\t\t\t\tnext = next.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (node.nodeType === 3 && /[\\n\\r\\t]+/.test(node.nodeValue)) {\n\t\t\t\t\t// Only remove if newlines are collapsed\n\t\t\t\t\tif (!/^pre/.test(css(node.parentNode, 'whiteSpace'))) {\n\t\t\t\t\t\tremove(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tnode = next;\n\t\t\t}\n\t\t}\n\t}\n\n\n\t/**\n\t * Map of all the commands for SCEditor\n\t * @type {Object}\n\t * @name commands\n\t * @memberOf sceditor\n\t */\n\tvar defaultCmds = {\n\n\t\t// START_COMMAND: albums\n\t\talbums: {\n\t\t\texec: function (caller) {\n\t\t\t\tconst content = createElement('div');\n\t\t\t\tconst editor = this;\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('albums',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\troot: editor.opts.root\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\teditor.createDropDown(caller, 'albums', content);\n\n\t\t\t\tconst pageSize = 6;\n\t\t\t\tconst pageNumber = 0;\n\n\t\t\t\t// eslint-disable-next-line no-undef\n\t\t\t\tgetAlbumImagesData(pageSize, pageNumber, false);\n\t\t\t},\n\t\t\ttooltip: 'User Albums'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Attachments\n\t\tattachments: {\n\t\t\texec: function () {\n\t\t\t\tconst modal = new window.bootstrap.Modal('#UploadDialog');\n\n\t\t\t\tmodal.show();\n\t\t\t\tmodal._element.addEventListener('shown.bs.modal',\n\t\t\t\t\t_ => {\n\t\t\t\t\t\tconst pageSize = 6;\n\t\t\t\t\t\tconst pageNumber = 0;\n\n\t\t\t\t\t\t// eslint-disable-next-line no-undef\n\t\t\t\t\t\tgetPaginationData(pageSize, pageNumber, false);\n\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'User Attachments'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Bold\n\t\tbold: {\n\t\t\texec: 'bold',\n\t\t\ttooltip: 'Bold',\n\t\t\tshortcut: 'Ctrl+B'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Italic\n\t\titalic: {\n\t\t\texec: 'italic',\n\t\t\ttooltip: 'Italic',\n\t\t\tshortcut: 'Ctrl+I'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Underline\n\t\tunderline: {\n\t\t\texec: 'underline',\n\t\t\ttooltip: 'Underline',\n\t\t\tshortcut: 'Ctrl+U'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Strikethrough\n\t\tstrike: {\n\t\t\texec: 'strikethrough',\n\t\t\ttooltip: 'Strikethrough'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Mark\n\t\tmark: {\n\t\t\texec: function () {\n\t\t\t\tthis.wysiwygEditorInsertHtml(\n\t\t\t\t\t'<mark>',\n\t\t\t\t\t'</mark>'\n\t\t\t\t);\n\t\t\t},\n\t\t\ttooltip: 'Highlight',\n\t\t\tshortcut: 'Ctrl+H'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Left\n\t\tleft: {\n\t\t\tstate: function (node) {\n\t\t\t\tif (node && node.nodeType === 3) {\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\n\t\t\t\tif (node) {\n\t\t\t\t\tconst isLtr = css(node, 'direction') === 'ltr';\n\t\t\t\t\tconst align = css(node, 'textAlign');\n\n\t\t\t\t\t// Can be -moz-left\n\t\t\t\t\treturn /left/.test(align) ||\n\t\t\t\t\t\talign === (isLtr ? 'start' : 'end');\n\t\t\t\t}\n\t\t\t},\n\t\t\texec: 'justifyleft',\n\t\t\ttooltip: 'Align left'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Centre\n\t\tcenter: {\n\t\t\texec: 'justifycenter',\n\t\t\ttooltip: 'Center'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Right\n\t\tright: {\n\t\t\tstate: function (node) {\n\t\t\t\tif (node && node.nodeType === 3) {\n\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t}\n\n\t\t\t\tif (node) {\n\t\t\t\t\tconst isLtr = css(node, 'direction') === 'ltr';\n\t\t\t\t\tconst align = css(node, 'textAlign');\n\n\t\t\t\t\t// Can be -moz-right\n\t\t\t\t\treturn /right/.test(align) ||\n\t\t\t\t\t\talign === (isLtr ? 'end' : 'start');\n\t\t\t\t}\n\t\t\t},\n\t\t\texec: 'justifyright',\n\t\t\ttooltip: 'Align right'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Justify\n\t\tjustify: {\n\t\t\texec: 'justifyfull',\n\t\t\ttooltip: 'Justify'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Font\n\t\tfont: {\n\t\t\t_dropDown: function (editor, caller, callback) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'a',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tcallback(data(this, 'font'));\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.opts.fonts.split(',').forEach(function (font) {\n\t\t\t\t\tappendChild(content,\n\t\t\t\t\t\t_tmpl('fontOpt',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfont: font\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttrue));\n\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'font-picker', content);\n\t\t\t},\n\t\t\texec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.font._dropDown(editor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (fontName) {\n\t\t\t\t\t\teditor.execCommand('fontname', fontName);\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'Font Name'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Size\n\t\tsize: {\n\t\t\t_dropDown: function (editor, caller, callback) {\n\t\t\t\tconst content = createElement('div');\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'a',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tcallback(data(this, 'size'));\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\tfor (let i = 1; i <= 7; i++) {\n\t\t\t\t\tappendChild(content,\n\t\t\t\t\t\t_tmpl('sizeOpt',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tsize: i\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttrue));\n\t\t\t\t}\n\n\t\t\t\teditor.createDropDown(caller, 'fontsize-picker', content);\n\t\t\t},\n\t\t\texec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.size._dropDown(editor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (fontSize) {\n\t\t\t\t\t\teditor.execCommand('fontsize', fontSize);\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'Font Size'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Colour\n\t\tcolor: {\n\t\t\t_dropDown: function (editor, caller, callback) {\n\t\t\t\tconst content = createElement('div');\n\t\t\t\tvar html = '';\n\t\t\t\tconst cmd = defaultCmds.color;\n\n\t\t\t\tif (!cmd._htmlCache) {\n\t\t\t\t\teditor.opts.colors.split('|').forEach(function (column) {\n\t\t\t\t\t\thtml += '<div class=\"sceditor-color-column\">';\n\n\t\t\t\t\t\tcolumn.split(',').forEach(function (color) {\n\t\t\t\t\t\t\thtml +=\n\t\t\t\t\t\t\t\t`<a href=\"#\" class=\"sceditor-color-option\" style=\"background-color: ${color}\" data-color=\"${\n\t\t\t\t\t\t\t\tcolor}\"></a>`;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\thtml += '</div>';\n\t\t\t\t\t});\n\n\t\t\t\t\tcmd._htmlCache = html;\n\t\t\t\t}\n\n\t\t\t\tappendChild(content, parseHTML(cmd._htmlCache));\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'a',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tcallback(data(this, 'color'));\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'color-picker', content);\n\t\t\t},\n\t\t\texec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.color._dropDown(editor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (color) {\n\t\t\t\t\t\teditor.execCommand('forecolor', color);\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'Font Color'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Remove Format\n\t\tremoveformat: {\n\t\t\texec: 'removeformat',\n\t\t\ttooltip: 'Remove Formatting'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Cut\n\t\tcut: {\n\t\t\texec: 'cut',\n\t\t\ttooltip: 'Cut',\n\t\t\terrorMessage: 'Your browser does not allow the cut command. ' +\n\t\t\t\t'Please use the keyboard shortcut Ctrl/Cmd-X'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Copy\n\t\tcopy: {\n\t\t\texec: 'copy',\n\t\t\ttooltip: 'Copy',\n\t\t\terrorMessage: 'Your browser does not allow the copy command. ' +\n\t\t\t\t'Please use the keyboard shortcut Ctrl/Cmd-C'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Paste\n\t\tpaste: {\n\t\t\texec: 'paste',\n\t\t\ttooltip: 'Paste',\n\t\t\terrorMessage: 'Your browser does not allow the paste command. ' +\n\t\t\t\t'Please use the keyboard shortcut Ctrl/Cmd-V'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Paste Text\n\t\tpastetext: {\n\t\t\texec: function (caller) {\n\t\t\t\tvar val,\n\t\t\t\t\tcontent = createElement('div'),\n\t\t\t\t\teditor = this;\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('pastetext',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: editor._(\n\t\t\t\t\t\t\t\t'Paste your text inside the following box:'\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tinsert: editor._('Insert')\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'.button',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tval = find(content, '#txt')[0].value;\n\n\t\t\t\t\t\tif (val) {\n\t\t\t\t\t\t\teditor.wysiwygEditorInsertText(val);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'pastetext', content);\n\t\t\t},\n\t\t\ttooltip: 'Paste Text'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Bullet List\n\t\tbulletlist: {\n\t\t\texec: function () {\n\t\t\t\tfixFirefoxListBug(this);\n\t\t\t\tthis.execCommand('insertunorderedlist');\n\t\t\t},\n\t\t\ttooltip: 'Bullet list'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Ordered List\n\t\torderedlist: {\n\t\t\texec: function () {\n\t\t\t\tfixFirefoxListBug(this);\n\t\t\t\tthis.execCommand('insertorderedlist');\n\t\t\t},\n\t\t\ttooltip: 'Numbered list'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Table\n\t\ttable: {\n\t\t\texec: function (caller) {\n\t\t\t\tvar editor = this,\n\t\t\t\t\tcontent = createElement('div');\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('table',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trows: editor._('Rows:'),\n\t\t\t\t\t\t\tcols: editor._('Cols:'),\n\t\t\t\t\t\t\tinsert: editor._('Insert')\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'.button',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tconst rows = Number(find(content, '#rows')[0].value);\n\t\t\t\t\t\tconst cols = Number(find(content, '#cols')[0].value);\n\t\t\t\t\t\tvar html = '<table class=\"table\">';\n\n\t\t\t\t\t\tif (rows > 0 && cols > 0) {\n\t\t\t\t\t\t\thtml += Array(rows + 1).join(\n\t\t\t\t\t\t\t\t'<tr>' +\n\t\t\t\t\t\t\t\tArray(cols + 1).join(\n\t\t\t\t\t\t\t\t\t'<td class=\"border\"><br /></td>'\n\t\t\t\t\t\t\t\t) +\n\t\t\t\t\t\t\t\t'</tr>'\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\thtml += '</table>';\n\n\t\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(html);\n\t\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'inserttable', content);\n\t\t\t},\n\t\t\ttooltip: 'Insert a table'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Code\n\t\tcode: {\n\t\t\t_dropDown: function (editor, caller, callback) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'a',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tcallback(data(this, 'language'));\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.opts.codeLanguages.forEach(function (language) {\n\t\t\t\t\tappendChild(content,\n\t\t\t\t\t\t_tmpl('codeOpt',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlanguage: language.Value,\n\t\t\t\t\t\t\t\tlanguageName: language.Text\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttrue));\n\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'codeLanguage-picker', content);\n\t\t\t},\n\t\t\texec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.code._dropDown(editor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (codeLanguageName) {\n\n\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(\n\t\t\t\t\t\t\t`<pre class=\"border border-danger rounded m-2 p-2\"><code class=\"lang-${codeLanguageName}\">`,\n\t\t\t\t\t\t\t'</code></pre>'\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'Code'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Note\n\t\tnote: {\n\t\t\texec: function (caller) {\n\t\t\t\tvar type,\n\t\t\t\t\tval,\n\t\t\t\t\tcontent = createElement('div'),\n\t\t\t\t\teditor = this,\n\t\t\t\t\toptions = '';\n\n\t\t\t\teditor.opts.noteTypes.split(',').forEach(function (noteType) {\n\t\t\t\t\toptions +=\n\t\t\t\t\t\t_tmpl('noteOpt',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: noteType\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfalse);\n\t\t\t\t});\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('note',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabelType: editor._(\n\t\t\t\t\t\t\t\t'Select the note type:'\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tlabelText: editor._(\n\t\t\t\t\t\t\t\t'Enter the note inside the following box:'\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tinsert: editor._('Insert'),\n\t\t\t\t\t\t\tvalues: options\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'.button',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tval = find(content, '#txt')[0].value;\n\t\t\t\t\t\ttype = find(content, '#type')[0].value;\n\n\t\t\t\t\t\tif (val) {\n\t\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(\n\t\t\t\t\t\t\t\t`<div class=\"alert alert-${type}\" role=\"alert\">${val}</div>`);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'pastetext', content);\n\t\t\t},\n\t\t\ttooltip: 'Note'\n\t\t},\n\t\t// END_COMMAND\n\n\n\t\t// START_COMMAND: Code\n\t\textensions: {\n\t\t\t_dropDown: function (editor, caller, callback) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'a',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tcallback(data(this, 'language'));\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\tfetch(editor.opts.extensionsUrl,\n\t\t\t\t\t{\n\t\t\t\t\t\tmethod: 'GET'\n\t\t\t\t\t}).then(res => res.json()).then(data => {\n\t\t\t\t\tdata.forEach(function (extension) {\n\t\t\t\t\t\tif (!extension.useToolbar) {\n\t\t\t\t\t\t\tappendChild(content,\n\t\t\t\t\t\t\t\t_tmpl('extensionOpt',\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\textension: extension.name\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\ttrue));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'extensions-picker', content);\n\t\t\t},\n\t\t\texec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.extensions._dropDown(editor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (extension) {\n\n\t\t\t\t\t\teditor.wysiwygEditorInsertText(\n\t\t\t\t\t\t\t`[${extension}]`,\n\t\t\t\t\t\t\t`[/${extension}]`\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\n\n\t\t\t},\n\t\t\ttooltip: 'More BBCode'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Image\n\t\timage: {\n\t\t\t_dropDown: function (editor, caller, cb) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('image',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\turl: editor._('URL:'),\n\t\t\t\t\t\t\tdesc: editor._('Description (optional):'),\n\t\t\t\t\t\t\tinsert: editor._('Insert')\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\n\t\t\t\tvar linkInput = find(content, '#link')[0];\n\n\t\t\t\tfunction insertUrl(e) {\n\t\t\t\t\tconst desc = find(content, '#des')[0].value;\n\t\t\t\t\tif (linkInput.value) {\n\t\t\t\t\t\tcb(linkInput.value, desc);\n\t\t\t\t\t}\n\n\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\n\t\t\t\ton(content, 'click', '.button', insertUrl);\n\t\t\t\ton(content,\n\t\t\t\t\t'keypress',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\t// 13 = enter key\n\t\t\t\t\t\tif (e.which === 13 && linkInput.value) {\n\t\t\t\t\t\t\tinsertUrl(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tEVENT_CAPTURE);\n\n\t\t\t\teditor.createDropDown(caller, 'insertimage', content);\n\t\t\t},\n\t\t\texec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.image._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url, text) {\n\t\t\t\t\t\tvar attrs = '';\n\n\t\t\t\t\t\tif (text) {\n\t\t\t\t\t\t\tattrs += ` alt=\"${entities(text)}\"`;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tattrs += ` src=\"${entities(url)}\"`;\n\n\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(\n\t\t\t\t\t\t\t`<img${attrs} class=\"img-user-posted img-thumbnail\" />`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\ttooltip: 'Insert an image'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: E-mail\n\t\temail: {\n\t\t\t_dropDown: function (editor, caller, cb) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('email',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: editor._('E-mail:'),\n\t\t\t\t\t\t\tdesc: editor._('Description (optional):'),\n\t\t\t\t\t\t\tinsert: editor._('Insert')\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'.button',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tconst email = find(content, '#email')[0].value;\n\n\t\t\t\t\t\tif (email) {\n\t\t\t\t\t\t\tcb(email, find(content, '#des')[0].value);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'insertemail', content);\n\t\t\t},\n\t\t\texec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.email._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (email, text) {\n\t\t\t\t\t\tif (!editor.getRangeHelper().selectedHtml() || text) {\n\t\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(\n\t\t\t\t\t\t\t\t`<a href=\"mailto:${entities(email)}\">${entities((text || email))}</a>`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\teditor.execCommand('createlink', `mailto:${email}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\ttooltip: 'Insert an email'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Link\n\t\tlink: {\n\t\t\t_dropDown: function (editor, caller, cb) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('link',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\turl: editor._('URL:'),\n\t\t\t\t\t\t\tdesc: editor._('Description (optional):'),\n\t\t\t\t\t\t\tins: editor._('Insert')\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\tvar linkInput = find(content, '#link')[0];\n\n\t\t\t\tfunction insertUrl(e) {\n\t\t\t\t\tif (linkInput.value) {\n\t\t\t\t\t\tcb(linkInput.value, find(content, '#des')[0].value);\n\t\t\t\t\t}\n\n\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\n\t\t\t\ton(content, 'click', '.button', insertUrl);\n\t\t\t\ton(content,\n\t\t\t\t\t'keypress',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\t// 13 = enter key\n\t\t\t\t\t\tif (e.which === 13 && linkInput.value) {\n\t\t\t\t\t\t\tinsertUrl(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tEVENT_CAPTURE);\n\n\t\t\t\teditor.createDropDown(caller, 'insertlink', content);\n\t\t\t},\n\t\t\texec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.link._dropDown(editor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url, text) {\n\t\t\t\t\t\tif (text || !editor.getRangeHelper().selectedHtml()) {\n\t\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(\n\t\t\t\t\t\t\t\t`<a href=\"${entities(url)}\">${entities(text || url)}</a>`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\teditor.execCommand('createlink', url);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'Insert a link'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Unlink\n\t\tunlink: {\n\t\t\tstate: function () {\n\t\t\t\treturn closest(this.currentNode(), 'a') ? 0 : -1;\n\t\t\t},\n\t\t\texec: function () {\n\t\t\t\tconst anchor = closest(this.currentNode(), 'a');\n\n\t\t\t\tif (anchor) {\n\t\t\t\t\twhile (anchor.firstChild) {\n\t\t\t\t\t\tinsertBefore(anchor.firstChild, anchor);\n\t\t\t\t\t}\n\n\t\t\t\t\tremove(anchor);\n\t\t\t\t}\n\t\t\t},\n\t\t\ttooltip: 'Unlink'\n\t\t},\n\t\t// END_COMMAND\n\n\n\t\t// START_COMMAND: Quote\n\t\tquote: {\n\t\t\texec: function (caller, html, author) {\n\t\t\t\tvar before =\n\t\t\t\t\t'<div class=\"border rounded mx-3 mb-3 p-3 border-secondary shadow-sm\"><span contenteditable=\"false\"><i class=\"fa fa-quote-left text-primary fs-4 me-2\"></i></span>';\n\t\t\t\tvar end = '</div>';\n\n\t\t\t\t// if there is HTML passed set end to null so any selected\n\t\t\t\t// text is replaced\n\t\t\t\tif (html) {\n\t\t\t\t\tauthor = (author\n\t\t\t\t\t\t? `<cite class=\"card-text text-end d-block text-body-secondary small\">${\n\t\t\t\t\t\tentities(author)}</cite>`\n\t\t\t\t\t\t: '');\n\t\t\t\t\tbefore = before + html + author + end;\n\t\t\t\t\tend = null;\n\t\t\t\t\t// if not add a newline to the end of the inserted quote\n\t\t\t\t} else if (this.getRangeHelper().selectedHtml() === '') ;\n\n\t\t\t\tthis.wysiwygEditorInsertHtml(before, end);\n\t\t\t},\n\t\t\ttooltip: 'Insert a Quote'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: media\n\t\tmedia: {\n\t\t\t_dropDown: function (editor, caller, callback) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('mediaMenu',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: editor._('Media URL:'),\n\t\t\t\t\t\t\tinsert: editor._('Insert')\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'.button',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tconst url = find(content, '#link')[0].value;\n\n\t\t\t\t\t\tif (!url.startsWith('http')) {\n\t\t\t\t\t\t\talert('Not a valid URL!');\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcallback(url);\n\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'insertmedia', content);\n\t\t\t},\n\t\t\texec: function (btn) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.media._dropDown(editor,\n\t\t\t\t\tbtn,\n\t\t\t\t\tfunction (url) {\n\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(`[media]${url}[/media]`);\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'Insert an embed media like a YouTube video, facebook post or twitter status.'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: vimeo\n\t\tvimeo: {\n\t\t\t_dropDown: function (editor, caller, callback) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('youtubeMenu',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: editor._('Video URL:'),\n\t\t\t\t\t\t\tinsert: editor._('Insert')\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'.button',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tconst url = find(content, '#link')[0].value;\n\n\t\t\t\t\t\tif (url !== '') {\n\t\t\t\t\t\t\tconst matches = url.match(/vimeo\\..*\\/(\\d+)(?:$|\\/)/);\n\n\t\t\t\t\t\t\tcallback(url, matches[1]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'insertlink', content);\n\t\t\t},\n\t\t\texec: function (btn) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.vimeo._dropDown(editor,\n\t\t\t\t\tbtn,\n\t\t\t\t\tfunction (url, id) {\n\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(_tmpl('vimeo',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\turl: url,\n\t\t\t\t\t\t\t\tvimeoId: id\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'Insert a Vimeo video'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: instagram\n\t\tinstagram: {\n\t\t\t_dropDown: function (editor, caller, callback) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('instagramMenu',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: editor._('Instagram Post URL:'),\n\t\t\t\t\t\t\tinsert: editor._('Insert')\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'.button',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tconst url = find(content, '#link')[0].value;\n\t\t\t\t\t\tvar id = '';\n\n\t\t\t\t\t\tif (url !== '') {\n\t\t\t\t\t\t\tconst matches = url.match(/\\/(p|tv|reel)\\/(.*?)\\//);\n\n\t\t\t\t\t\t\tif (matches) {\n\t\t\t\t\t\t\t\tid = matches[2];\n\t\t\t\t\t\t\t\tcallback(url, id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'insertlink', content);\n\t\t\t},\n\t\t\texec: function (btn) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.instagram._dropDown(editor,\n\t\t\t\t\tbtn,\n\t\t\t\t\tfunction (url, id) {\n\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(_tmpl('instagram',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\turl: url,\n\t\t\t\t\t\t\t\tid: id\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'Insert an Instagram Post'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: facebook\n\t\tfacebook: {\n\t\t\t_dropDown: function (editor, caller, callback) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('facebookMenu',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: editor._('Facebook post URL:'),\n\t\t\t\t\t\t\tinsert: editor._('Insert')\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'.button',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tconst url = find(content, '#link')[0].value;\n\n\t\t\t\t\t\tcallback(url);\n\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'insertlink', content);\n\t\t\t},\n\t\t\texec: function (btn) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.facebook._dropDown(editor,\n\t\t\t\t\tbtn,\n\t\t\t\t\tfunction (url) {\n\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(_tmpl('facebook',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\turl: url\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'Insert an Facebook Post'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: youtube\n\t\tyoutube: {\n\t\t\t_dropDown: function (editor, caller, callback) {\n\t\t\t\tvar content = createElement('div');\n\n\t\t\t\tappendChild(content,\n\t\t\t\t\t_tmpl('youtubeMenu',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: editor._('Video URL:'),\n\t\t\t\t\t\t\tinsert: editor._('Insert')\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue));\n\n\t\t\t\ton(content,\n\t\t\t\t\t'click',\n\t\t\t\t\t'.button',\n\t\t\t\t\tfunction (e) {\n\t\t\t\t\t\tconst url = find(content, '#link')[0].value;\n\t\t\t\t\t\tconst idMatch = url.match(/(?:v=|v\\/|embed\\/|youtu.be\\/)?([a-zA-Z0-9_-]{11})/);\n\n\n\t\t\t\t\t\tif (idMatch && /^[a-zA-Z0-9_\\-]{11}$/.test(idMatch[1])) {\n\t\t\t\t\t\t\tcallback(url, idMatch[1]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\teditor.closeDropDown(true);\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\teditor.createDropDown(caller, 'insertlink', content);\n\t\t\t},\n\t\t\texec: function (btn) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tdefaultCmds.youtube._dropDown(editor,\n\t\t\t\t\tbtn,\n\t\t\t\t\tfunction (url, id) {\n\t\t\t\t\t\teditor.wysiwygEditorInsertHtml(_tmpl('youtube',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\turl: url,\n\t\t\t\t\t\t\t\tid: id\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t});\n\t\t\t},\n\t\t\ttooltip: 'Insert a YouTube video'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Date\n\t\tdate: {\n\t\t\t_date: function (editor) {\n\t\t\t\tconst now = new Date();\n\t\t\t\tvar year = now.getYear(),\n\t\t\t\t\tmonth = now.getMonth() + 1,\n\t\t\t\t\tday = now.getDate();\n\n\t\t\t\tif (year < 2000) {\n\t\t\t\t\tyear = 1900 + year;\n\t\t\t\t}\n\n\t\t\t\tif (month < 10) {\n\t\t\t\t\tmonth = `0${month}`;\n\t\t\t\t}\n\n\t\t\t\tif (day < 10) {\n\t\t\t\t\tday = `0${day}`;\n\t\t\t\t}\n\n\t\t\t\treturn editor.opts.dateFormat\n\t\t\t\t\t.replace(/year/i, year)\n\t\t\t\t\t.replace(/month/i, month)\n\t\t\t\t\t.replace(/day/i, day);\n\t\t\t},\n\t\t\texec: function () {\n\t\t\t\tthis.insertText(defaultCmds.date._date(this));\n\t\t\t},\n\t\t\ttxtExec: function () {\n\t\t\t\tthis.insertText(defaultCmds.date._date(this));\n\t\t\t},\n\t\t\ttooltip: 'Insert current date'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Time\n\t\ttime: {\n\t\t\t_time: function () {\n\t\t\t\tconst now = new Date();\n\t\t\t\tvar hours = now.getHours(),\n\t\t\t\t\tmins = now.getMinutes(),\n\t\t\t\t\tsecs = now.getSeconds();\n\n\t\t\t\tif (hours < 10) {\n\t\t\t\t\thours = `0${hours}`;\n\t\t\t\t}\n\n\t\t\t\tif (mins < 10) {\n\t\t\t\t\tmins = `0${mins}`;\n\t\t\t\t}\n\n\t\t\t\tif (secs < 10) {\n\t\t\t\t\tsecs = `0${secs}`;\n\t\t\t\t}\n\n\t\t\t\treturn hours + ':' + mins + ':' + secs;\n\t\t\t},\n\t\t\texec: function () {\n\t\t\t\tthis.insertText(defaultCmds.time._time());\n\t\t\t},\n\t\t\ttxtExec: function () {\n\t\t\t\tthis.insertText(defaultCmds.time._time());\n\t\t\t},\n\t\t\ttooltip: 'Insert current time'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Undo\n\t\tundo: {\n\t\t\texec: 'undo',\n\t\t\ttooltip: 'Undo',\n\t\t\tshortcut: 'Ctrl+Z'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Redo\n\t\tredo: {\n\t\t\texec: 'redo',\n\t\t\ttooltip: 'Redo',\n\t\t\tshortcut: 'Ctrl+Y'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Maximize\n\t\tmaximize: {\n\t\t\tstate: function () {\n\t\t\t\treturn this.maximize();\n\t\t\t},\n\t\t\texec: function () {\n\t\t\t\tthis.maximize(!this.maximize());\n\t\t\t\tthis.focus();\n\t\t\t},\n\t\t\ttxtExec: function () {\n\t\t\t\tthis.maximize(!this.maximize());\n\t\t\t\tthis.focus();\n\t\t\t},\n\t\t\ttooltip: 'Maximize',\n\t\t\tshortcut: 'Ctrl+Shift+M'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Source\n\t\tsource: {\n\t\t\tstate: function () {\n\t\t\t\treturn this.sourceMode();\n\t\t\t},\n\t\t\texec: function () {\n\t\t\t\tthis.toggleSourceMode();\n\t\t\t\tthis.focus();\n\t\t\t},\n\t\t\ttxtExec: function () {\n\t\t\t\tthis.toggleSourceMode();\n\t\t\t\tthis.focus();\n\t\t\t},\n\t\t\ttooltip: 'View source',\n\t\t\tshortcut: 'Ctrl+Shift+S'\n\t\t},\n\t\t// END_COMMAND\n\t\t// START_COMMAND: Reply\n\t\treply: {\n\t\t\texec: function () {\n\t\t\t\tif (document.getElementById('QuickReplyDialog') !== null) {\n\t\t\t\t\tdocument.querySelector('[data-bs-save*=\"modal\"]').click();\n\t\t\t\t} else if (document.querySelector('[formaction*=\"PostReply\"]') !== null) {\n\t\t\t\t\tdocument.querySelector('[formaction*=\"PostReply\"]').click();\n\t\t\t\t} else if (document.querySelector('[id*=\"QuickReply\"]') !== null) {\n\t\t\t\t\tdocument.querySelector('[id*=\"QuickReply\"]').click();\n\t\t\t\t} else if (document.querySelector('[id*=\"PostReply\"]') !== null) {\n\t\t\t\t\twindow.location.href = document.querySelector('[id*=\"PostReply\"]').href;\n\t\t\t\t}\n\t\t\t},\n\t\t\ttooltip: 'Post Reply',\n\t\t\tshortcut: 'Ctrl+Enter'\n\t\t},\n\t\t// END_COMMAND\n\n\n\t\t// this is here so that commands above can be removed\n\t\t// without having to remove the , after the last one.\n\t\t// Needed for IE.\n\t\tignore: {}\n\t};\n\n\tvar plugins = {};\n\n\t/**\n\t * Plugin Manager class\n\t * @class PluginManager\n\t * @name PluginManager\n\t */\n\tfunction PluginManager(thisObj) {\n\t\t/**\n\t\t * Alias of this\n\t\t *\n\t\t * @private\n\t\t * @type {Object}\n\t\t */\n\t\tvar base = this;\n\n\t\t/**\n\t\t * Array of all currently registered plugins\n\t\t *\n\t\t * @type {Array}\n\t\t * @private\n\t\t */\n\t\tvar registeredPlugins = [];\n\n\n\t\t/**\n\t\t * Changes a signals name from \"name\" into \"signalName\".\n\t\t *\n\t\t * @param  {string} signal\n\t\t * @return {string}\n\t\t * @private\n\t\t */\n\t\tvar formatSignalName = function (signal) {\n\t\t\treturn `signal${signal.charAt(0).toUpperCase()}${signal.slice(1)}`;\n\t\t};\n\n\t\t/**\n\t\t * Calls handlers for a signal\n\t\t *\n\t\t * @see call()\n\t\t * @see callOnlyFirst()\n\t\t * @param  {Array}   args\n\t\t * @param  {boolean} returnAtFirst\n\t\t * @return {*}\n\t\t * @private\n\t\t */\n\t\tvar callHandlers = function (args, returnAtFirst) {\n\t\t\targs = [].slice.call(args);\n\n\t\t\tvar\tidx, ret;\n\t\t\tconst signal = formatSignalName(args.shift());\n\n\t\t\tfor (idx = 0; idx < registeredPlugins.length; idx++) {\n\t\t\t\tif (signal in registeredPlugins[idx]) {\n\t\t\t\t\tret = registeredPlugins[idx][signal].apply(thisObj, args);\n\n\t\t\t\t\tif (returnAtFirst) {\n\t\t\t\t\t\treturn ret;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Calls all handlers for the passed signal\n\t\t *\n\t\t * @param  {string}    signal\n\t\t * @param  {...string} args\n\t\t * @function\n\t\t * @name call\n\t\t * @memberOf PluginManager.prototype\n\t\t */\n\t\tbase.call = function () {\n\t\t\tcallHandlers(arguments, false);\n\t\t};\n\n\t\t/**\n\t\t * Calls the first handler for a signal, and returns the\n\t\t *\n\t\t * @param  {string}    signal\n\t\t * @param  {...string} args\n\t\t * @return {*} The result of calling the handler\n\t\t * @function\n\t\t * @name callOnlyFirst\n\t\t * @memberOf PluginManager.prototype\n\t\t */\n\t\tbase.callOnlyFirst = function () {\n\t\t\treturn callHandlers(arguments, true);\n\t\t};\n\n\t\t/**\n\t\t * Checks if a signal has a handler\n\t\t *\n\t\t * @param  {string} signal\n\t\t * @return {boolean}\n\t\t * @function\n\t\t * @name hasHandler\n\t\t * @memberOf PluginManager.prototype\n\t\t */\n\t\tbase.hasHandler = function (signal) {\n\t\t\tvar i  = registeredPlugins.length;\n\t\t\tsignal = formatSignalName(signal);\n\n\t\t\twhile (i--) {\n\t\t\t\tif (signal in registeredPlugins[i]) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\t/**\n\t\t * Checks if the plugin exists in plugins\n\t\t *\n\t\t * @param  {string} plugin\n\t\t * @return {boolean}\n\t\t * @function\n\t\t * @name exists\n\t\t * @memberOf PluginManager.prototype\n\t\t */\n\t\tbase.exists = function (plugin) {\n\t\t\tif (plugin in plugins) {\n\t\t\t\tplugin = plugins[plugin];\n\n\t\t\t\treturn typeof plugin === 'function' &&\n\t\t\t\t\ttypeof plugin.prototype === 'object';\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\t/**\n\t\t * Checks if the passed plugin is currently registered.\n\t\t *\n\t\t * @param  {string} plugin\n\t\t * @return {boolean}\n\t\t * @function\n\t\t * @name isRegistered\n\t\t * @memberOf PluginManager.prototype\n\t\t */\n\t\tbase.isRegistered = function (plugin) {\n\t\t\tif (base.exists(plugin)) {\n\t\t\t\tlet idx = registeredPlugins.length;\n\n\t\t\t\twhile (idx--) {\n\t\t\t\t\tif (registeredPlugins[idx] instanceof plugins[plugin]) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\t/**\n\t\t * Registers a plugin to receive signals\n\t\t *\n\t\t * @param  {string} plugin\n\t\t * @return {boolean}\n\t\t * @function\n\t\t * @name register\n\t\t * @memberOf PluginManager.prototype\n\t\t */\n\t\tbase.register = function (plugin) {\n\t\t\tif (!base.exists(plugin) || base.isRegistered(plugin)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tplugin = new plugins[plugin]();\n\t\t\tregisteredPlugins.push(plugin);\n\n\t\t\tif ('init' in plugin) {\n\t\t\t\tplugin.init.call(thisObj);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * Deregisters a plugin.\n\t\t *\n\t\t * @param  {string} plugin\n\t\t * @return {boolean}\n\t\t * @function\n\t\t * @name deregister\n\t\t * @memberOf PluginManager.prototype\n\t\t */\n\t\tbase.deregister = function (plugin) {\n\t\t\tvar\tremovedPlugin,\n\t\t\t\tpluginIdx = registeredPlugins.length,\n\t\t\t\tremoved   = false;\n\n\t\t\tif (!base.isRegistered(plugin)) {\n\t\t\t\treturn removed;\n\t\t\t}\n\n\t\t\twhile (pluginIdx--) {\n\t\t\t\tif (registeredPlugins[pluginIdx] instanceof plugins[plugin]) {\n\t\t\t\t\tremovedPlugin = registeredPlugins.splice(pluginIdx, 1)[0];\n\t\t\t\t\tremoved       = true;\n\n\t\t\t\t\tif ('destroy' in removedPlugin) {\n\t\t\t\t\t\tremovedPlugin.destroy.call(thisObj);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn removed;\n\t\t};\n\n\t\t/**\n\t\t * Clears all plugins and removes the owner reference.\n\t\t *\n\t\t * Calling any functions on this object after calling\n\t\t * destroy will cause a JS error.\n\t\t *\n\t\t * @name destroy\n\t\t * @memberOf PluginManager.prototype\n\t\t */\n\t\tbase.destroy = function () {\n\t\t\tvar i = registeredPlugins.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tif ('destroy' in registeredPlugins[i]) {\n\t\t\t\t\tregisteredPlugins[i].destroy.call(thisObj);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tregisteredPlugins = [];\n\t\t\tthisObj    = null;\n\t\t};\n\t}\n\tPluginManager.plugins = plugins;\n\n\t/**\n\t * Gets the text, start/end node and offset for\n\t * length chars left or right of the passed node\n\t * at the specified offset.\n\t *\n\t * @param  {Node}  node\n\t * @param  {number}  offset\n\t * @param  {boolean} isLeft\n\t * @param  {number}  length\n\t * @return {Object}\n\t * @private\n\t */\n\tvar outerText = function (range, isLeft, length) {\n\t\tvar nodeValue, remaining, start, end, node,\n\t\t\ttext = '',\n\t\t\tnext = range.startContainer,\n\t\t\toffset = range.startOffset;\n\n\t\t// Handle cases where node is a paragraph and offset\n\t\t// refers to the index of a text node.\n\t\t// 3 = text node\n\t\tif (next && next.nodeType !== 3) {\n\t\t\tnext = next.childNodes[offset];\n\t\t\toffset = 0;\n\t\t}\n\n\t\tstart = end = offset;\n\n\t\twhile (length > text.length && next && next.nodeType === 3) {\n\t\t\tnodeValue = next.nodeValue;\n\t\t\tremaining = length - text.length;\n\n\t\t\t// If not the first node, start and end should be at their\n\t\t\t// max values as will be updated when getting the text\n\t\t\tif (node) {\n\t\t\t\tend = nodeValue.length;\n\t\t\t\tstart = 0;\n\t\t\t}\n\n\t\t\tnode = next;\n\n\t\t\tif (isLeft) {\n\t\t\t\tstart = Math.max(end - remaining, 0);\n\t\t\t\toffset = start;\n\n\t\t\t\ttext = nodeValue.substr(start, end - start) + text;\n\t\t\t\tnext = node.previousSibling;\n\t\t\t} else {\n\t\t\t\tend = Math.min(remaining, nodeValue.length);\n\t\t\t\toffset = start + end;\n\n\t\t\t\ttext += nodeValue.substr(start, end);\n\t\t\t\tnext = node.nextSibling;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tnode: node || next,\n\t\t\toffset: offset,\n\t\t\ttext: text\n\t\t};\n\t};\n\n\t/**\n\t * Range helper\n\t *\n\t * @class RangeHelper\n\t * @name RangeHelper\n\t */\n\tfunction RangeHelper(win, d, sanitize) {\n\t\tvar\t_createMarker, _prepareInput,\n\t\t\tdoc          = d || win.contentDocument || win.document,\n\t\t\tstartMarker  = 'sceditor-start-marker',\n\t\t\tendMarker    = 'sceditor-end-marker',\n\t\t\tbase         = this;\n\n\t\t/**\n\t\t * Inserts HTML into the current range replacing any selected\n\t\t * text.\n\t\t *\n\t\t * If endHTML is specified the selected contents will be put between\n\t\t * html and endHTML. If there is nothing selected html and endHTML are\n\t\t * just concatenate together.\n\t\t *\n\t\t * @param {string} html\n\t\t * @param {string} [endHTML]\n\t\t * @return False on fail\n\t\t * @function\n\t\t * @name insertHTML\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.insertHTML = function (html, endHTML) {\n\t\t\tconst range = base.selectedRange();\n\n\t\t\tif (!range) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (endHTML) {\n\t\t\t\thtml += base.selectedHtml() + endHTML;\n\t\t\t}\n\n\t\t\tconst div = createElement('p', {}, doc);\n\t\t\tconst node = doc.createDocumentFragment();\n\t\t\tdiv.innerHTML = sanitize(html);\n\n\t\t\twhile (div.firstChild) {\n\t\t\t\tappendChild(node, div.firstChild);\n\t\t\t}\n\n\t\t\tbase.insertNode(node);\n\t\t};\n\n\t\t/**\n\t\t * Prepares HTML to be inserted by adding a zero width space\n\t\t * if the last child is empty and adding the range start/end\n\t\t * markers to the last child.\n\t\t *\n\t\t * @param  {Node|string} node\n\t\t * @param  {Node|string} [endNode]\n\t\t * @param  {boolean} [returnHtml]\n\t\t * @return {Node|string}\n\t\t * @private\n\t\t */\n\t\t_prepareInput = function (node, endNode, returnHtml) {\n\t\t\tvar lastChild,\n\t\t\t\tfrag = doc.createDocumentFragment();\n\n\t\t\tif (typeof node === 'string') {\n\t\t\t\tif (endNode) {\n\t\t\t\t\tnode += base.selectedHtml() + endNode;\n\t\t\t\t}\n\n\t\t\t\tfrag = parseHTML(node);\n\t\t\t} else {\n\t\t\t\tappendChild(frag, node);\n\n\t\t\t\tif (endNode) {\n\t\t\t\t\tappendChild(frag, base.selectedRange().extractContents());\n\t\t\t\t\tappendChild(frag, endNode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!(lastChild = frag.lastChild)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twhile (!isInline(lastChild.lastChild, true)) {\n\t\t\t\tlastChild = lastChild.lastChild;\n\t\t\t}\n\n\t\t\tif (canHaveChildren(lastChild)) {\n\t\t\t\t// Webkit won't allow the cursor to be placed inside an\n\t\t\t\t// empty tag, so add a zero width space to it.\n\t\t\t\tif (!lastChild.lastChild) {\n\t\t\t\t\tappendChild(lastChild, document.createTextNode('\\u200B'));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlastChild = frag;\n\t\t\t}\n\n\t\t\tbase.removeMarkers();\n\n\t\t\t// Append marks to last child so when restored cursor will be in\n\t\t\t// the right place\n\t\t\tappendChild(lastChild, _createMarker(startMarker));\n\t\t\tappendChild(lastChild, _createMarker(endMarker));\n\n\t\t\tif (returnHtml) {\n\t\t\t\tconst div = createElement('div');\n\t\t\t\tappendChild(div, frag);\n\n\t\t\t\treturn div.innerHTML;\n\t\t\t}\n\n\t\t\treturn frag;\n\t\t};\n\n\t\t/**\n\t\t * The same as insertHTML except with DOM nodes instead\n\t\t *\n\t\t * <strong>Warning:</strong> the nodes must belong to the\n\t\t * document they are being inserted into. Some browsers\n\t\t * will throw exceptions if they don't.\n\t\t *\n\t\t * Returns boolean false on fail\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Node} endNode\n\t\t * @return {false|undefined}\n\t\t * @function\n\t\t * @name insertNode\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.insertNode = function (node, endNode) {\n\t\t\tvar\tfirst, last;\n\t\t\tconst input = _prepareInput(node, endNode);\n\t\t\tconst range = base.selectedRange();\n\t\t\tconst parent = range.commonAncestorContainer;\n\t\t\tvar emptyNodes = [];\n\n\t\t\tif (!input) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tfunction removeIfEmpty(node) {\n\t\t\t\t// Only remove empty node if it wasn't already empty\n\t\t\t\tif (node && isEmpty(node) && emptyNodes.indexOf(node) < 0) {\n\t\t\t\t\tremove(node);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (range.startContainer !== range.endContainer) {\n\t\t\t\teach(parent.childNodes, function (_, node) {\n\t\t\t\t\tif (isEmpty(node)) {\n\t\t\t\t\t\temptyNodes.push(node);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfirst = input.firstChild;\n\t\t\t\tlast = input.lastChild;\n\t\t\t}\n\n\t\t\trange.deleteContents();\n\n\t\t\t// FF allows <br /> to be selected but inserting a node\n\t\t\t// into <br /> will cause it not to be displayed so must\n\t\t\t// insert before the <br /> in FF.\n\t\t\t// 3 = TextNode\n\t\t\tif (parent && parent.nodeType !== 3 && !canHaveChildren(parent)) {\n\t\t\t\tinsertBefore(input, parent);\n\t\t\t} else {\n\t\t\t\trange.insertNode(input);\n\n\t\t\t\t// If a node was split or its contents deleted, remove any resulting\n\t\t\t\t// empty tags. For example:\n\t\t\t\t// <p>|test</p><div>test|</div>\n\t\t\t\t// When deleteContents could become:\n\t\t\t\t// <p></p>|<div></div>\n\t\t\t\t// So remove the empty ones\n\t\t\t\tremoveIfEmpty(first && first.previousSibling);\n\t\t\t\tremoveIfEmpty(last && last.nextSibling);\n\t\t\t}\n\n\t\t\tbase.restoreRange();\n\t\t};\n\n\t\t/**\n\t\t * Clones the selected Range\n\t\t *\n\t\t * @return {Range}\n\t\t * @function\n\t\t * @name cloneSelected\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.cloneSelected = function () {\n\t\t\tconst range = base.selectedRange();\n\n\t\t\tif (range) {\n\t\t\t\treturn range.cloneRange();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Gets the selected Range\n\t\t *\n\t\t * @return {Range}\n\t\t * @function\n\t\t * @name selectedRange\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.selectedRange = function () {\n\t\t\tvar\trange, firstChild;\n\t\t\tconst sel = win.getSelection();\n\n\t\t\tif (!sel) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// When creating a new range, set the start to the first child\n\t\t\t// element of the body element to avoid errors in FF.\n\t\t\tif (sel.rangeCount <= 0) {\n\t\t\t\tfirstChild = doc.body;\n\t\t\t\twhile (firstChild.firstChild) {\n\t\t\t\t\tfirstChild = firstChild.firstChild;\n\t\t\t\t}\n\n\t\t\t\trange = doc.createRange();\n\t\t\t\t// Must be setStartBefore otherwise it can cause infinite\n\t\t\t\t// loops with lists in WebKit. See issue 442\n\t\t\t\trange.setStartBefore(firstChild);\n\n\t\t\t\tsel.addRange(range);\n\t\t\t}\n\n\t\t\tif (sel.rangeCount > 0) {\n\t\t\t\trange = sel.getRangeAt(0);\n\t\t\t}\n\n\t\t\treturn range;\n\t\t};\n\n\t\t/**\n\t\t * Gets if there is currently a selection\n\t\t *\n\t\t * @return {boolean}\n\t\t * @function\n\t\t * @name hasSelection\n\t\t * @since 1.4.4\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.hasSelection = function () {\n\t\t\tconst sel = win.getSelection();\n\n\t\t\treturn sel && sel.rangeCount > 0;\n\t\t};\n\n\t\t/**\n\t\t * Gets the currently selected HTML\n\t\t *\n\t\t * @return {string}\n\t\t * @function\n\t\t * @name selectedHtml\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.selectedHtml = function () {\n\t\t\tvar\tdiv;\n\t\t\tconst range = base.selectedRange();\n\n\t\t\tif (range) {\n\t\t\t\tdiv = createElement('p', {}, doc);\n\t\t\t\tappendChild(div, range.cloneContents());\n\n\t\t\t\treturn div.innerHTML;\n\t\t\t}\n\n\t\t\treturn '';\n\t\t};\n\n\t\t/**\n\t\t * Gets the parent node of the selected contents in the range\n\t\t *\n\t\t * @return {HTMLElement}\n\t\t * @function\n\t\t * @name parentNode\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.parentNode = function () {\n\t\t\tconst range = base.selectedRange();\n\n\t\t\tif (range) {\n\t\t\t\treturn range.commonAncestorContainer;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Gets the first block level parent of the selected\n\t\t * contents of the range.\n\t\t *\n\t\t * @return {HTMLElement}\n\t\t * @function\n\t\t * @name getFirstBlockParent\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\t/**\n\t\t * Gets the first block level parent of the selected\n\t\t * contents of the range.\n\t\t *\n\t\t * @param {Node} [n] The element to get the first block level parent from\n\t\t * @return {HTMLElement}\n\t\t * @function\n\t\t * @name getFirstBlockParent^2\n\t\t * @since 1.4.1\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.getFirstBlockParent = function (node) {\n\t\t\tvar func = function (elm) {\n\t\t\t\tif (!isInline(elm, true)) {\n\t\t\t\t\treturn elm;\n\t\t\t\t}\n\n\t\t\t\telm = elm ? elm.parentNode : null;\n\n\t\t\t\treturn elm ? func(elm) : elm;\n\t\t\t};\n\n\t\t\treturn func(node || base.parentNode());\n\t\t};\n\n\t\t/**\n\t\t * Inserts a node at either the start or end of the current selection\n\t\t *\n\t\t * @param {Bool} start\n\t\t * @param {Node} node\n\t\t * @function\n\t\t * @name insertNodeAt\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.insertNodeAt = function (start, node) {\n\t\t\tconst currentRange = base.selectedRange();\n\t\t\tconst range = base.cloneSelected();\n\n\t\t\tif (!range) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\trange.collapse(start);\n\t\t\trange.insertNode(node);\n\n\t\t\t// Reselect the current range.\n\t\t\t// Fixes issue with Chrome losing the selection. Issue#82\n\t\t\tbase.selectRange(currentRange);\n\t\t};\n\n\t\t/**\n\t\t * Creates a marker node\n\t\t *\n\t\t * @param {string} id\n\t\t * @return {HTMLSpanElement}\n\t\t * @private\n\t\t */\n\t\t_createMarker = function (id) {\n\t\t\tbase.removeMarker(id);\n\n\t\t\tconst marker = createElement('span', {\n\t\t\t\tid: id,\n\t\t\t\tclassName: 'sceditor-selection sceditor-ignore',\n\t\t\t\tstyle: 'display:none;line-height:0'\n\t\t\t}, doc);\n\n\t\t\tmarker.innerHTML = ' ';\n\n\t\t\treturn marker;\n\t\t};\n\n\t\t/**\n\t\t * Inserts start/end markers for the current selection\n\t\t * which can be used by restoreRange to re-select the\n\t\t * range.\n\t\t *\n\t\t * @memberOf RangeHelper.prototype\n\t\t * @function\n\t\t * @name insertMarkers\n\t\t */\n\t\tbase.insertMarkers = function () {\n\t\t\tconst currentRange = base.selectedRange();\n\t\t\tconst startNode = _createMarker(startMarker);\n\n\t\t\tbase.removeMarkers();\n\t\t\tbase.insertNodeAt(true, startNode);\n\n\t\t\t// Fixes issue with end marker sometimes being placed before\n\t\t\t// the start marker when the range is collapsed.\n\t\t\tif (currentRange && currentRange.collapsed) {\n\t\t\t\tstartNode.parentNode.insertBefore(\n\t\t\t\t\t_createMarker(endMarker), startNode.nextSibling);\n\t\t\t} else {\n\t\t\t\tbase.insertNodeAt(false, _createMarker(endMarker));\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Gets the marker with the specified ID\n\t\t *\n\t\t * @param {string} id\n\t\t * @return {Node}\n\t\t * @function\n\t\t * @name getMarker\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.getMarker = function (id) {\n\t\t\treturn doc.getElementById(id);\n\t\t};\n\n\t\t/**\n\t\t * Removes the marker with the specified ID\n\t\t *\n\t\t * @param {string} id\n\t\t * @function\n\t\t * @name removeMarker\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.removeMarker = function (id) {\n\t\t\tconst marker = base.getMarker(id);\n\n\t\t\tif (marker) {\n\t\t\t\tremove(marker);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Removes the start/end markers\n\t\t *\n\t\t * @function\n\t\t * @name removeMarkers\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.removeMarkers = function () {\n\t\t\tbase.removeMarker(startMarker);\n\t\t\tbase.removeMarker(endMarker);\n\t\t};\n\n\t\t/**\n\t\t * Saves the current range location. Alias of insertMarkers()\n\t\t *\n\t\t * @function\n\t\t * @name saveRage\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.saveRange = function () {\n\t\t\tbase.insertMarkers();\n\t\t};\n\n\t\t/**\n\t\t * Select the specified range\n\t\t *\n\t\t * @param {Range} range\n\t\t * @function\n\t\t * @name selectRange\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.selectRange = function (range) {\n\t\t\tvar lastChild;\n\t\t\tconst sel = win.getSelection();\n\t\t\tconst container = range.endContainer;\n\n\t\t\t// Check if cursor is set after a BR when the BR is the only\n\t\t\t// child of the parent. In Firefox this causes a line break\n\t\t\t// to occur when something is typed. See issue #321\n\t\t\tif (range.collapsed && container &&\n\t\t\t\t!isInline(container, true)) {\n\n\t\t\t\tlastChild = container.lastChild;\n\t\t\t\twhile (lastChild && is(lastChild, '.sceditor-ignore')) {\n\t\t\t\t\tlastChild = lastChild.previousSibling;\n\t\t\t\t}\n\n\t\t\t\tif (is(lastChild, 'br')) {\n\t\t\t\t\tconst rng = doc.createRange();\n\t\t\t\t\trng.setEndAfter(lastChild);\n\t\t\t\t\trng.collapse(false);\n\n\t\t\t\t\tif (base.compare(range, rng)) {\n\t\t\t\t\t\trange.setStartBefore(lastChild);\n\t\t\t\t\t\trange.collapse(true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (sel) {\n\t\t\t\tbase.clear();\n\t\t\t\tsel.addRange(range);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Restores the last range saved by saveRange() or insertMarkers()\n\t\t *\n\t\t * @function\n\t\t * @name restoreRange\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.restoreRange = function () {\n\t\t\tvar\tisCollapsed,\n\t\t\t\trange = base.selectedRange();\n\t\t\tconst start = base.getMarker(startMarker);\n\t\t\tconst end = base.getMarker(endMarker);\n\n\t\t\tif (!start || !end || !range) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tisCollapsed = start.nextSibling === end;\n\n\t\t\trange = doc.createRange();\n\t\t\trange.setStartBefore(start);\n\t\t\trange.setEndAfter(end);\n\n\t\t\tif (isCollapsed) {\n\t\t\t\trange.collapse(true);\n\t\t\t}\n\n\t\t\tbase.selectRange(range);\n\t\t\tbase.removeMarkers();\n\t\t};\n\n\t\t/**\n\t\t * Selects the text left and right of the current selection\n\t\t *\n\t\t * @param {number} left\n\t\t * @param {number} right\n\t\t * @since 1.4.3\n\t\t * @function\n\t\t * @name selectOuterText\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.selectOuterText = function (left, right) {\n\t\t\tvar start, end;\n\t\t\tconst range = base.cloneSelected();\n\n\t\t\tif (!range) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\trange.collapse(false);\n\n\t\t\tstart = outerText(range, true, left);\n\t\t\tend = outerText(range, false, right);\n\n\t\t\trange.setStart(start.node, start.offset);\n\t\t\trange.setEnd(end.node, end.offset);\n\n\t\t\tbase.selectRange(range);\n\t\t};\n\n\t\t/**\n\t\t * Gets the text left or right of the current selection\n\t\t *\n\t\t * @param {boolean} before\n\t\t * @param {number} length\n\t\t * @return {string}\n\t\t * @since 1.4.3\n\t\t * @function\n\t\t * @name selectOuterText\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.getOuterText = function (before, length) {\n\t\t\tconst range = base.cloneSelected();\n\n\t\t\tif (!range) {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\trange.collapse(!before);\n\n\t\t\treturn outerText(range, before, length).text;\n\t\t};\n\n\t\t/**\n\t\t * Replaces keywords with values based on the current caret position\n\t\t *\n\t\t * @param {Array}   keywords\n\t\t * @param {boolean} includeAfter      If to include the text after the\n\t\t *                                    current caret position or just\n\t\t *                                    text before\n\t\t * @param {boolean} keywordsSorted    If the keywords array is pre\n\t\t *                                    sorted shortest to longest\n\t\t * @param {number}  longestKeyword    Length of the longest keyword\n\t\t * @param {boolean} requireWhitespace If the key must be surrounded\n\t\t *                                    by whitespace\n\t\t * @param {string}  keypressChar      If this is being called from\n\t\t *                                    a keypress event, this should be\n\t\t *                                    set to the pressed character\n\t\t * @return {boolean}\n\t\t * @function\n\t\t * @name replaceKeyword\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\t// eslint-disable-next-line max-params\n\t\tbase.replaceKeyword = function (\n\t\t\tkeywords,\n\t\t\tincludeAfter,\n\t\t\tkeywordsSorted,\n\t\t\tlongestKeyword,\n\t\t\trequireWhitespace,\n\t\t\tkeypressChar\n\t\t) {\n\t\t\tif (!keywordsSorted) {\n\t\t\t\tkeywords.sort(function (a, b) {\n\t\t\t\t\treturn a[0].length - b[0].length;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tvar outerText, match, matchPos, startIndex,\n\t\t\t\tleftLen, charsLeft, keyword, keywordLen;\n\t\t\tconst whitespaceRegex = '(^|[\\\\s\\xA0\\u2002\\u2003\\u2009])';\n\t\t\tvar keywordIdx      = keywords.length;\n\t\t\tconst whitespaceLen = requireWhitespace ? 1 : 0;\n\t\t\tvar maxKeyLen       = longestKeyword ||\n\t            keywords[keywordIdx - 1][0].length;\n\n\t\t\tif (requireWhitespace) {\n\t\t\t\tmaxKeyLen++;\n\t\t\t}\n\n\t\t\tkeypressChar = keypressChar || '';\n\t\t\touterText    = base.getOuterText(true, maxKeyLen);\n\t\t\tleftLen      = outerText.length;\n\t\t\touterText   += keypressChar;\n\n\t\t\tif (includeAfter) {\n\t\t\t\touterText += base.getOuterText(false, maxKeyLen);\n\t\t\t}\n\n\t\t\twhile (keywordIdx--) {\n\t\t\t\tkeyword    = keywords[keywordIdx][0];\n\t\t\t\tkeywordLen = keyword.length;\n\t\t\t\tstartIndex = Math.max(0, leftLen - keywordLen - whitespaceLen);\n\t\t\t\tmatchPos   = -1;\n\n\t\t\t\tif (requireWhitespace) {\n\t\t\t\t\tmatch = outerText\n\t\t\t\t\t\t.substr(startIndex)\n\t\t\t\t\t\t.match(new RegExp(whitespaceRegex +\n\t\t\t\t\t\t\tregex(keyword) + whitespaceRegex));\n\n\t\t\t\t\tif (match) {\n\t\t\t\t\t\t// Add the length of the text that was removed by\n\t\t\t\t\t\t// substr() and also add 1 for the whitespace\n\t\t\t\t\t\tmatchPos = match.index + startIndex + match[1].length;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tmatchPos = outerText.indexOf(keyword, startIndex);\n\t\t\t\t}\n\n\t\t\t\tif (matchPos > -1) {\n\t\t\t\t\t// Make sure the match is between before and\n\t\t\t\t\t// after, not just entirely in one side or the other\n\t\t\t\t\tif (matchPos <= leftLen &&\n\t\t\t\t\t\tmatchPos + keywordLen + whitespaceLen >= leftLen) {\n\t\t\t\t\t\tcharsLeft = leftLen - matchPos;\n\n\t\t\t\t\t\t// If the keypress char is white space then it should\n\t\t\t\t\t\t// not be replaced, only chars that are part of the\n\t\t\t\t\t\t// key should be replaced.\n\t\t\t\t\t\tbase.selectOuterText(\n\t\t\t\t\t\t\tcharsLeft,\n\t\t\t\t\t\t\tkeywordLen - charsLeft -\n\t\t\t\t\t\t\t\t(/^\\S/.test(keypressChar) ? 1 : 0)\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tbase.insertHTML(keywords[keywordIdx][1]);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\t/**\n\t\t * Compares two ranges.\n\t\t *\n\t\t * If rangeB is undefined it will be set to\n\t\t * the current selected range\n\t\t *\n\t\t * @param  {Range} rngA\n\t\t * @param  {Range} [rngB]\n\t\t * @return {boolean}\n\t\t * @function\n\t\t * @name compare\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.compare = function (rngA, rngB) {\n\t\t\tif (!rngB) {\n\t\t\t\trngB = base.selectedRange();\n\t\t\t}\n\n\t\t\tif (!rngA || !rngB) {\n\t\t\t\treturn !rngA && !rngB;\n\t\t\t}\n\n\t\t\treturn rngA.compareBoundaryPoints(Range.END_TO_END, rngB) === 0 &&\n\t\t\t\trngA.compareBoundaryPoints(Range.START_TO_START, rngB) === 0;\n\t\t};\n\n\t\t/**\n\t\t * Removes any current selection\n\t\t *\n\t\t * @since 1.4.6\n\t\t * @function\n\t\t * @name clear\n\t\t * @memberOf RangeHelper.prototype\n\t\t */\n\t\tbase.clear = function () {\n\t\t\tconst sel = win.getSelection();\n\n\t\t\tif (sel) {\n\t\t\t\tif (sel.removeAllRanges) {\n\t\t\t\t\tsel.removeAllRanges();\n\t\t\t\t} else if (sel.empty) {\n\t\t\t\t\tsel.empty();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tvar USER_AGENT = navigator.userAgent;\n\n\t/**\n\t * Detects if the browser is iOS\n\t *\n\t * Needed to fix iOS specific bugs\n\t *\n\t * @function\n\t * @name ios\n\t * @memberOf sceditor\n\t * @type {boolean}\n\t */\n\tvar ios = /iPhone|iPod|iPad| wosbrowser\\//i.test(USER_AGENT);\n\n\t/**\n\t * If the browser supports WYSIWYG editing (e.g. older mobile browsers).\n\t *\n\t * @function\n\t * @name isWysiwygSupported\n\t * @return {boolean}\n\t */\n\tvar isWysiwygSupported = (function () {\n\t\tvar match, isUnsupported;\n\n\t\t// IE is the only browser to support documentMode\n\t\tconst ie = !!window.document.documentMode;\n\t\tconst legacyEdge = '-ms-ime-align' in document.documentElement.style;\n\n\t\tconst div = document.createElement('div');\n\t\tdiv.contentEditable = true;\n\n\t\t// Check if the contentEditable attribute is supported\n\t\tif (!('contentEditable' in document.documentElement) ||\n\t\t\tdiv.contentEditable !== 'true') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// I think blackberry supports contentEditable or will at least\n\t\t// give a valid value for the contentEditable detection above\n\t\t// so it isn't included in the below tests.\n\n\t\t// I hate having to do UA sniffing but some mobile browsers say they\n\t\t// support contentediable when it isn't usable, i.e. you can't enter\n\t\t// text.\n\t\t// This is the only way I can think of to detect them which is also how\n\t\t// every other editor I've seen deals with this issue.\n\n\t\t// Exclude Opera mobile and mini\n\t\tisUnsupported = /Opera Mobi|Opera Mini/i.test(USER_AGENT);\n\n\t\tif (/Android/i.test(USER_AGENT)) {\n\t\t\tisUnsupported = true;\n\n\t\t\tif (/Safari/.test(USER_AGENT)) {\n\t\t\t\t// Android browser 534+ supports content editable\n\t\t\t\t// This also matches Chrome which supports content editable too\n\t\t\t\tmatch = /Safari\\/(\\d+)/.exec(USER_AGENT);\n\t\t\t\tisUnsupported = (!match || !match[1] ? true : match[1] < 534);\n\t\t\t}\n\t\t}\n\n\t\t// The current version of Amazon Silk supports it, older versions didn't\n\t\t// As it uses webkit like Android, assume it's the same and started\n\t\t// working at versions >= 534\n\t\tif (/ Silk\\//i.test(USER_AGENT)) {\n\t\t\tmatch = /AppleWebKit\\/(\\d+)/.exec(USER_AGENT);\n\t\t\tisUnsupported = (!match || !match[1] ? true : match[1] < 534);\n\t\t}\n\n\t\t// iOS 5+ supports content editable\n\t\tif (ios) {\n\t\t\t// Block any version <= 4_x(_x)\n\t\t\tisUnsupported = /OS [0-4](_\\d)+ like Mac/i.test(USER_AGENT);\n\t\t}\n\n\t\t// Firefox does support WYSIWYG on mobiles so override\n\t\t// any previous value if using FF\n\t\tif (/Firefox/i.test(USER_AGENT)) {\n\t\t\tisUnsupported = false;\n\t\t}\n\n\t\tif (/OneBrowser/i.test(USER_AGENT)) {\n\t\t\tisUnsupported = false;\n\t\t}\n\n\t\t// UCBrowser works but doesn't give a unique user agent\n\t\tif (navigator.vendor === 'UCWEB') {\n\t\t\tisUnsupported = false;\n\t\t}\n\n\t\t// IE and legacy edge are not supported any more\n\t\tif (ie || legacyEdge) {\n\t\t\tisUnsupported = true;\n\t\t}\n\n\t\treturn !isUnsupported;\n\t}());\n\n\t/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */\n\n\tconst {\n\t  entries,\n\t  setPrototypeOf,\n\t  isFrozen,\n\t  getPrototypeOf,\n\t  getOwnPropertyDescriptor\n\t} = Object;\n\tlet {\n\t  freeze,\n\t  seal,\n\t  create\n\t} = Object; // eslint-disable-line import/no-mutable-exports\n\tlet {\n\t  apply,\n\t  construct\n\t} = typeof Reflect !== 'undefined' && Reflect;\n\tif (!freeze) {\n\t  freeze = function freeze(x) {\n\t    return x;\n\t  };\n\t}\n\tif (!seal) {\n\t  seal = function seal(x) {\n\t    return x;\n\t  };\n\t}\n\tif (!apply) {\n\t  apply = function apply(fun, thisValue, args) {\n\t    return fun.apply(thisValue, args);\n\t  };\n\t}\n\tif (!construct) {\n\t  construct = function construct(Func, args) {\n\t    return new Func(...args);\n\t  };\n\t}\n\tconst arrayForEach = unapply(Array.prototype.forEach);\n\tconst arrayLastIndexOf = unapply(Array.prototype.lastIndexOf);\n\tconst arrayPop = unapply(Array.prototype.pop);\n\tconst arrayPush = unapply(Array.prototype.push);\n\tconst arraySplice = unapply(Array.prototype.splice);\n\tconst stringToLowerCase = unapply(String.prototype.toLowerCase);\n\tconst stringToString = unapply(String.prototype.toString);\n\tconst stringMatch = unapply(String.prototype.match);\n\tconst stringReplace = unapply(String.prototype.replace);\n\tconst stringIndexOf = unapply(String.prototype.indexOf);\n\tconst stringTrim = unapply(String.prototype.trim);\n\tconst objectHasOwnProperty = unapply(Object.prototype.hasOwnProperty);\n\tconst regExpTest = unapply(RegExp.prototype.test);\n\tconst typeErrorCreate = unconstruct(TypeError);\n\t/**\n\t * Creates a new function that calls the given function with a specified thisArg and arguments.\n\t *\n\t * @param func - The function to be wrapped and called.\n\t * @returns A new function that calls the given function with a specified thisArg and arguments.\n\t */\n\tfunction unapply(func) {\n\t  return function (thisArg) {\n\t    if (thisArg instanceof RegExp) {\n\t      thisArg.lastIndex = 0;\n\t    }\n\t    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n\t      args[_key - 1] = arguments[_key];\n\t    }\n\t    return apply(func, thisArg, args);\n\t  };\n\t}\n\t/**\n\t * Creates a new function that constructs an instance of the given constructor function with the provided arguments.\n\t *\n\t * @param func - The constructor function to be wrapped and called.\n\t * @returns A new function that constructs an instance of the given constructor function with the provided arguments.\n\t */\n\tfunction unconstruct(func) {\n\t  return function () {\n\t    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n\t      args[_key2] = arguments[_key2];\n\t    }\n\t    return construct(func, args);\n\t  };\n\t}\n\t/**\n\t * Add properties to a lookup table\n\t *\n\t * @param set - The set to which elements will be added.\n\t * @param array - The array containing elements to be added to the set.\n\t * @param transformCaseFunc - An optional function to transform the case of each element before adding to the set.\n\t * @returns The modified set with added elements.\n\t */\n\tfunction addToSet(set, array) {\n\t  let transformCaseFunc = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : stringToLowerCase;\n\t  if (setPrototypeOf) {\n\t    // Make 'in' and truthy checks like Boolean(set.constructor)\n\t    // independent of any properties defined on Object.prototype.\n\t    // Prevent prototype setters from intercepting set as a this value.\n\t    setPrototypeOf(set, null);\n\t  }\n\t  let l = array.length;\n\t  while (l--) {\n\t    let element = array[l];\n\t    if (typeof element === 'string') {\n\t      const lcElement = transformCaseFunc(element);\n\t      if (lcElement !== element) {\n\t        // Config presets (e.g. tags.js, attrs.js) are immutable.\n\t        if (!isFrozen(array)) {\n\t          array[l] = lcElement;\n\t        }\n\t        element = lcElement;\n\t      }\n\t    }\n\t    set[element] = true;\n\t  }\n\t  return set;\n\t}\n\t/**\n\t * Clean up an array to harden against CSPP\n\t *\n\t * @param array - The array to be cleaned.\n\t * @returns The cleaned version of the array\n\t */\n\tfunction cleanArray(array) {\n\t  for (let index = 0; index < array.length; index++) {\n\t    const isPropertyExist = objectHasOwnProperty(array, index);\n\t    if (!isPropertyExist) {\n\t      array[index] = null;\n\t    }\n\t  }\n\t  return array;\n\t}\n\t/**\n\t * Shallow clone an object\n\t *\n\t * @param object - The object to be cloned.\n\t * @returns A new object that copies the original.\n\t */\n\tfunction clone(object) {\n\t  const newObject = create(null);\n\t  for (const [property, value] of entries(object)) {\n\t    const isPropertyExist = objectHasOwnProperty(object, property);\n\t    if (isPropertyExist) {\n\t      if (Array.isArray(value)) {\n\t        newObject[property] = cleanArray(value);\n\t      } else if (value && typeof value === 'object' && value.constructor === Object) {\n\t        newObject[property] = clone(value);\n\t      } else {\n\t        newObject[property] = value;\n\t      }\n\t    }\n\t  }\n\t  return newObject;\n\t}\n\t/**\n\t * This method automatically checks if the prop is function or getter and behaves accordingly.\n\t *\n\t * @param object - The object to look up the getter function in its prototype chain.\n\t * @param prop - The property name for which to find the getter function.\n\t * @returns The getter function found in the prototype chain or a fallback function.\n\t */\n\tfunction lookupGetter(object, prop) {\n\t  while (object !== null) {\n\t    const desc = getOwnPropertyDescriptor(object, prop);\n\t    if (desc) {\n\t      if (desc.get) {\n\t        return unapply(desc.get);\n\t      }\n\t      if (typeof desc.value === 'function') {\n\t        return unapply(desc.value);\n\t      }\n\t    }\n\t    object = getPrototypeOf(object);\n\t  }\n\t  function fallbackValue() {\n\t    return null;\n\t  }\n\t  return fallbackValue;\n\t}\n\n\tconst html$1 = freeze(['a', 'abbr', 'acronym', 'address', 'area', 'article', 'aside', 'audio', 'b', 'bdi', 'bdo', 'big', 'blink', 'blockquote', 'body', 'br', 'button', 'canvas', 'caption', 'center', 'cite', 'code', 'col', 'colgroup', 'content', 'data', 'datalist', 'dd', 'decorator', 'del', 'details', 'dfn', 'dialog', 'dir', 'div', 'dl', 'dt', 'element', 'em', 'fieldset', 'figcaption', 'figure', 'font', 'footer', 'form', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'head', 'header', 'hgroup', 'hr', 'html', 'i', 'img', 'input', 'ins', 'kbd', 'label', 'legend', 'li', 'main', 'map', 'mark', 'marquee', 'menu', 'menuitem', 'meter', 'nav', 'nobr', 'ol', 'optgroup', 'option', 'output', 'p', 'picture', 'pre', 'progress', 'q', 'rp', 'rt', 'ruby', 's', 'samp', 'section', 'select', 'shadow', 'small', 'source', 'spacer', 'span', 'strike', 'strong', 'style', 'sub', 'summary', 'sup', 'table', 'tbody', 'td', 'template', 'textarea', 'tfoot', 'th', 'thead', 'time', 'tr', 'track', 'tt', 'u', 'ul', 'var', 'video', 'wbr']);\n\tconst svg$1 = freeze(['svg', 'a', 'altglyph', 'altglyphdef', 'altglyphitem', 'animatecolor', 'animatemotion', 'animatetransform', 'circle', 'clippath', 'defs', 'desc', 'ellipse', 'filter', 'font', 'g', 'glyph', 'glyphref', 'hkern', 'image', 'line', 'lineargradient', 'marker', 'mask', 'metadata', 'mpath', 'path', 'pattern', 'polygon', 'polyline', 'radialgradient', 'rect', 'stop', 'style', 'switch', 'symbol', 'text', 'textpath', 'title', 'tref', 'tspan', 'view', 'vkern']);\n\tconst svgFilters = freeze(['feBlend', 'feColorMatrix', 'feComponentTransfer', 'feComposite', 'feConvolveMatrix', 'feDiffuseLighting', 'feDisplacementMap', 'feDistantLight', 'feDropShadow', 'feFlood', 'feFuncA', 'feFuncB', 'feFuncG', 'feFuncR', 'feGaussianBlur', 'feImage', 'feMerge', 'feMergeNode', 'feMorphology', 'feOffset', 'fePointLight', 'feSpecularLighting', 'feSpotLight', 'feTile', 'feTurbulence']);\n\t// List of SVG elements that are disallowed by default.\n\t// We still need to know them so that we can do namespace\n\t// checks properly in case one wants to add them to\n\t// allow-list.\n\tconst svgDisallowed = freeze(['animate', 'color-profile', 'cursor', 'discard', 'font-face', 'font-face-format', 'font-face-name', 'font-face-src', 'font-face-uri', 'foreignobject', 'hatch', 'hatchpath', 'mesh', 'meshgradient', 'meshpatch', 'meshrow', 'missing-glyph', 'script', 'set', 'solidcolor', 'unknown', 'use']);\n\tconst mathMl$1 = freeze(['math', 'menclose', 'merror', 'mfenced', 'mfrac', 'mglyph', 'mi', 'mlabeledtr', 'mmultiscripts', 'mn', 'mo', 'mover', 'mpadded', 'mphantom', 'mroot', 'mrow', 'ms', 'mspace', 'msqrt', 'mstyle', 'msub', 'msup', 'msubsup', 'mtable', 'mtd', 'mtext', 'mtr', 'munder', 'munderover', 'mprescripts']);\n\t// Similarly to SVG, we want to know all MathML elements,\n\t// even those that we disallow by default.\n\tconst mathMlDisallowed = freeze(['maction', 'maligngroup', 'malignmark', 'mlongdiv', 'mscarries', 'mscarry', 'msgroup', 'mstack', 'msline', 'msrow', 'semantics', 'annotation', 'annotation-xml', 'mprescripts', 'none']);\n\tconst text = freeze(['#text']);\n\n\tconst html = freeze(['accept', 'action', 'align', 'alt', 'autocapitalize', 'autocomplete', 'autopictureinpicture', 'autoplay', 'background', 'bgcolor', 'border', 'capture', 'cellpadding', 'cellspacing', 'checked', 'cite', 'class', 'clear', 'color', 'cols', 'colspan', 'controls', 'controlslist', 'coords', 'crossorigin', 'datetime', 'decoding', 'default', 'dir', 'disabled', 'disablepictureinpicture', 'disableremoteplayback', 'download', 'draggable', 'enctype', 'enterkeyhint', 'face', 'for', 'headers', 'height', 'hidden', 'high', 'href', 'hreflang', 'id', 'inputmode', 'integrity', 'ismap', 'kind', 'label', 'lang', 'list', 'loading', 'loop', 'low', 'max', 'maxlength', 'media', 'method', 'min', 'minlength', 'multiple', 'muted', 'name', 'nonce', 'noshade', 'novalidate', 'nowrap', 'open', 'optimum', 'pattern', 'placeholder', 'playsinline', 'popover', 'popovertarget', 'popovertargetaction', 'poster', 'preload', 'pubdate', 'radiogroup', 'readonly', 'rel', 'required', 'rev', 'reversed', 'role', 'rows', 'rowspan', 'spellcheck', 'scope', 'selected', 'shape', 'size', 'sizes', 'span', 'srclang', 'start', 'src', 'srcset', 'step', 'style', 'summary', 'tabindex', 'title', 'translate', 'type', 'usemap', 'valign', 'value', 'width', 'wrap', 'xmlns', 'slot']);\n\tconst svg = freeze(['accent-height', 'accumulate', 'additive', 'alignment-baseline', 'amplitude', 'ascent', 'attributename', 'attributetype', 'azimuth', 'basefrequency', 'baseline-shift', 'begin', 'bias', 'by', 'class', 'clip', 'clippathunits', 'clip-path', 'clip-rule', 'color', 'color-interpolation', 'color-interpolation-filters', 'color-profile', 'color-rendering', 'cx', 'cy', 'd', 'dx', 'dy', 'diffuseconstant', 'direction', 'display', 'divisor', 'dur', 'edgemode', 'elevation', 'end', 'exponent', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'filterunits', 'flood-color', 'flood-opacity', 'font-family', 'font-size', 'font-size-adjust', 'font-stretch', 'font-style', 'font-variant', 'font-weight', 'fx', 'fy', 'g1', 'g2', 'glyph-name', 'glyphref', 'gradientunits', 'gradienttransform', 'height', 'href', 'id', 'image-rendering', 'in', 'in2', 'intercept', 'k', 'k1', 'k2', 'k3', 'k4', 'kerning', 'keypoints', 'keysplines', 'keytimes', 'lang', 'lengthadjust', 'letter-spacing', 'kernelmatrix', 'kernelunitlength', 'lighting-color', 'local', 'marker-end', 'marker-mid', 'marker-start', 'markerheight', 'markerunits', 'markerwidth', 'maskcontentunits', 'maskunits', 'max', 'mask', 'media', 'method', 'mode', 'min', 'name', 'numoctaves', 'offset', 'operator', 'opacity', 'order', 'orient', 'orientation', 'origin', 'overflow', 'paint-order', 'path', 'pathlength', 'patterncontentunits', 'patterntransform', 'patternunits', 'points', 'preservealpha', 'preserveaspectratio', 'primitiveunits', 'r', 'rx', 'ry', 'radius', 'refx', 'refy', 'repeatcount', 'repeatdur', 'restart', 'result', 'rotate', 'scale', 'seed', 'shape-rendering', 'slope', 'specularconstant', 'specularexponent', 'spreadmethod', 'startoffset', 'stddeviation', 'stitchtiles', 'stop-color', 'stop-opacity', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke', 'stroke-width', 'style', 'surfacescale', 'systemlanguage', 'tabindex', 'tablevalues', 'targetx', 'targety', 'transform', 'transform-origin', 'text-anchor', 'text-decoration', 'text-rendering', 'textlength', 'type', 'u1', 'u2', 'unicode', 'values', 'viewbox', 'visibility', 'version', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'width', 'word-spacing', 'wrap', 'writing-mode', 'xchannelselector', 'ychannelselector', 'x', 'x1', 'x2', 'xmlns', 'y', 'y1', 'y2', 'z', 'zoomandpan']);\n\tconst mathMl = freeze(['accent', 'accentunder', 'align', 'bevelled', 'close', 'columnsalign', 'columnlines', 'columnspan', 'denomalign', 'depth', 'dir', 'display', 'displaystyle', 'encoding', 'fence', 'frame', 'height', 'href', 'id', 'largeop', 'length', 'linethickness', 'lspace', 'lquote', 'mathbackground', 'mathcolor', 'mathsize', 'mathvariant', 'maxsize', 'minsize', 'movablelimits', 'notation', 'numalign', 'open', 'rowalign', 'rowlines', 'rowspacing', 'rowspan', 'rspace', 'rquote', 'scriptlevel', 'scriptminsize', 'scriptsizemultiplier', 'selection', 'separator', 'separators', 'stretchy', 'subscriptshift', 'supscriptshift', 'symmetric', 'voffset', 'width', 'xmlns']);\n\tconst xml = freeze(['xlink:href', 'xml:id', 'xlink:title', 'xml:space', 'xmlns:xlink']);\n\n\t// eslint-disable-next-line unicorn/better-regex\n\tconst MUSTACHE_EXPR = seal(/\\{\\{[\\w\\W]*|[\\w\\W]*\\}\\}/gm); // Specify template detection regex for SAFE_FOR_TEMPLATES mode\n\tconst ERB_EXPR = seal(/<%[\\w\\W]*|[\\w\\W]*%>/gm);\n\tconst TMPLIT_EXPR = seal(/\\$\\{[\\w\\W]*/gm); // eslint-disable-line unicorn/better-regex\n\tconst DATA_ATTR = seal(/^data-[\\-\\w.\\u00B7-\\uFFFF]+$/); // eslint-disable-line no-useless-escape\n\tconst ARIA_ATTR = seal(/^aria-[\\-\\w]+$/); // eslint-disable-line no-useless-escape\n\tconst IS_ALLOWED_URI = seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i // eslint-disable-line no-useless-escape\n\t);\n\tconst IS_SCRIPT_OR_DATA = seal(/^(?:\\w+script|data):/i);\n\tconst ATTR_WHITESPACE = seal(/[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g // eslint-disable-line no-control-regex\n\t);\n\tconst DOCTYPE_NAME = seal(/^html$/i);\n\tconst CUSTOM_ELEMENT = seal(/^[a-z][.\\w]*(-[.\\w]+)+$/i);\n\n\tvar EXPRESSIONS = /*#__PURE__*/Object.freeze({\n\t  __proto__: null,\n\t  ARIA_ATTR: ARIA_ATTR,\n\t  ATTR_WHITESPACE: ATTR_WHITESPACE,\n\t  CUSTOM_ELEMENT: CUSTOM_ELEMENT,\n\t  DATA_ATTR: DATA_ATTR,\n\t  DOCTYPE_NAME: DOCTYPE_NAME,\n\t  ERB_EXPR: ERB_EXPR,\n\t  IS_ALLOWED_URI: IS_ALLOWED_URI,\n\t  IS_SCRIPT_OR_DATA: IS_SCRIPT_OR_DATA,\n\t  MUSTACHE_EXPR: MUSTACHE_EXPR,\n\t  TMPLIT_EXPR: TMPLIT_EXPR\n\t});\n\n\t/* eslint-disable @typescript-eslint/indent */\n\t// https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\n\tconst NODE_TYPE = {\n\t  element: 1,\n\t  attribute: 2,\n\t  text: 3,\n\t  cdataSection: 4,\n\t  entityReference: 5,\n\t  // Deprecated\n\t  entityNode: 6,\n\t  // Deprecated\n\t  progressingInstruction: 7,\n\t  comment: 8,\n\t  document: 9,\n\t  documentType: 10,\n\t  documentFragment: 11,\n\t  notation: 12 // Deprecated\n\t};\n\tconst getGlobal = function getGlobal() {\n\t  return typeof window === 'undefined' ? null : window;\n\t};\n\t/**\n\t * Creates a no-op policy for internal use only.\n\t * Don't export this function outside this module!\n\t * @param trustedTypes The policy factory.\n\t * @param purifyHostElement The Script element used to load DOMPurify (to determine policy name suffix).\n\t * @return The policy created (or null, if Trusted Types\n\t * are not supported or creating the policy failed).\n\t */\n\tconst _createTrustedTypesPolicy = function _createTrustedTypesPolicy(trustedTypes, purifyHostElement) {\n\t  if (typeof trustedTypes !== 'object' || typeof trustedTypes.createPolicy !== 'function') {\n\t    return null;\n\t  }\n\t  // Allow the callers to control the unique policy name\n\t  // by adding a data-tt-policy-suffix to the script element with the DOMPurify.\n\t  // Policy creation with duplicate names throws in Trusted Types.\n\t  let suffix = null;\n\t  const ATTR_NAME = 'data-tt-policy-suffix';\n\t  if (purifyHostElement && purifyHostElement.hasAttribute(ATTR_NAME)) {\n\t    suffix = purifyHostElement.getAttribute(ATTR_NAME);\n\t  }\n\t  const policyName = 'dompurify' + (suffix ? '#' + suffix : '');\n\t  try {\n\t    return trustedTypes.createPolicy(policyName, {\n\t      createHTML(html) {\n\t        return html;\n\t      },\n\t      createScriptURL(scriptUrl) {\n\t        return scriptUrl;\n\t      }\n\t    });\n\t  } catch (_) {\n\t    // Policy creation failed (most likely another DOMPurify script has\n\t    // already run). Skip creating the policy, as this will only cause errors\n\t    // if TT are enforced.\n\t    console.warn('TrustedTypes policy ' + policyName + ' could not be created.');\n\t    return null;\n\t  }\n\t};\n\tconst _createHooksMap = function _createHooksMap() {\n\t  return {\n\t    afterSanitizeAttributes: [],\n\t    afterSanitizeElements: [],\n\t    afterSanitizeShadowDOM: [],\n\t    beforeSanitizeAttributes: [],\n\t    beforeSanitizeElements: [],\n\t    beforeSanitizeShadowDOM: [],\n\t    uponSanitizeAttribute: [],\n\t    uponSanitizeElement: [],\n\t    uponSanitizeShadowNode: []\n\t  };\n\t};\n\tfunction createDOMPurify() {\n\t  let window = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getGlobal();\n\t  const DOMPurify = root => createDOMPurify(root);\n\t  DOMPurify.version = '3.2.6';\n\t  DOMPurify.removed = [];\n\t  if (!window || !window.document || window.document.nodeType !== NODE_TYPE.document || !window.Element) {\n\t    // Not running in a browser, provide a factory function\n\t    // so that you can pass your own Window\n\t    DOMPurify.isSupported = false;\n\t    return DOMPurify;\n\t  }\n\t  let {\n\t    document\n\t  } = window;\n\t  const originalDocument = document;\n\t  const currentScript = originalDocument.currentScript;\n\t  const {\n\t    DocumentFragment,\n\t    HTMLTemplateElement,\n\t    Node,\n\t    Element,\n\t    NodeFilter,\n\t    NamedNodeMap = window.NamedNodeMap || window.MozNamedAttrMap,\n\t    HTMLFormElement,\n\t    DOMParser,\n\t    trustedTypes\n\t  } = window;\n\t  const ElementPrototype = Element.prototype;\n\t  const cloneNode = lookupGetter(ElementPrototype, 'cloneNode');\n\t  const remove = lookupGetter(ElementPrototype, 'remove');\n\t  const getNextSibling = lookupGetter(ElementPrototype, 'nextSibling');\n\t  const getChildNodes = lookupGetter(ElementPrototype, 'childNodes');\n\t  const getParentNode = lookupGetter(ElementPrototype, 'parentNode');\n\t  // As per issue #47, the web-components registry is inherited by a\n\t  // new document created via createHTMLDocument. As per the spec\n\t  // (http://w3c.github.io/webcomponents/spec/custom/#creating-and-passing-registries)\n\t  // a new empty registry is used when creating a template contents owner\n\t  // document, so we use that as our parent document to ensure nothing\n\t  // is inherited.\n\t  if (typeof HTMLTemplateElement === 'function') {\n\t    const template = document.createElement('template');\n\t    if (template.content && template.content.ownerDocument) {\n\t      document = template.content.ownerDocument;\n\t    }\n\t  }\n\t  let trustedTypesPolicy;\n\t  let emptyHTML = '';\n\t  const {\n\t    implementation,\n\t    createNodeIterator,\n\t    createDocumentFragment,\n\t    getElementsByTagName\n\t  } = document;\n\t  const {\n\t    importNode\n\t  } = originalDocument;\n\t  let hooks = _createHooksMap();\n\t  /**\n\t   * Expose whether this browser supports running the full DOMPurify.\n\t   */\n\t  DOMPurify.isSupported = typeof entries === 'function' && typeof getParentNode === 'function' && implementation && implementation.createHTMLDocument !== undefined;\n\t  const {\n\t    MUSTACHE_EXPR,\n\t    ERB_EXPR,\n\t    TMPLIT_EXPR,\n\t    DATA_ATTR,\n\t    ARIA_ATTR,\n\t    IS_SCRIPT_OR_DATA,\n\t    ATTR_WHITESPACE,\n\t    CUSTOM_ELEMENT\n\t  } = EXPRESSIONS;\n\t  let {\n\t    IS_ALLOWED_URI: IS_ALLOWED_URI$1\n\t  } = EXPRESSIONS;\n\t  /**\n\t   * We consider the elements and attributes below to be safe. Ideally\n\t   * don't add any new ones but feel free to remove unwanted ones.\n\t   */\n\t  /* allowed element names */\n\t  let ALLOWED_TAGS = null;\n\t  const DEFAULT_ALLOWED_TAGS = addToSet({}, [...html$1, ...svg$1, ...svgFilters, ...mathMl$1, ...text]);\n\t  /* Allowed attribute names */\n\t  let ALLOWED_ATTR = null;\n\t  const DEFAULT_ALLOWED_ATTR = addToSet({}, [...html, ...svg, ...mathMl, ...xml]);\n\t  /*\n\t   * Configure how DOMPurify should handle custom elements and their attributes as well as customized built-in elements.\n\t   * @property {RegExp|Function|null} tagNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any custom elements)\n\t   * @property {RegExp|Function|null} attributeNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any attributes not on the allow list)\n\t   * @property {boolean} allowCustomizedBuiltInElements allow custom elements derived from built-ins if they pass CUSTOM_ELEMENT_HANDLING.tagNameCheck. Default: `false`.\n\t   */\n\t  let CUSTOM_ELEMENT_HANDLING = Object.seal(create(null, {\n\t    tagNameCheck: {\n\t      writable: true,\n\t      configurable: false,\n\t      enumerable: true,\n\t      value: null\n\t    },\n\t    attributeNameCheck: {\n\t      writable: true,\n\t      configurable: false,\n\t      enumerable: true,\n\t      value: null\n\t    },\n\t    allowCustomizedBuiltInElements: {\n\t      writable: true,\n\t      configurable: false,\n\t      enumerable: true,\n\t      value: false\n\t    }\n\t  }));\n\t  /* Explicitly forbidden tags (overrides ALLOWED_TAGS/ADD_TAGS) */\n\t  let FORBID_TAGS = null;\n\t  /* Explicitly forbidden attributes (overrides ALLOWED_ATTR/ADD_ATTR) */\n\t  let FORBID_ATTR = null;\n\t  /* Decide if ARIA attributes are okay */\n\t  let ALLOW_ARIA_ATTR = true;\n\t  /* Decide if custom data attributes are okay */\n\t  let ALLOW_DATA_ATTR = true;\n\t  /* Decide if unknown protocols are okay */\n\t  let ALLOW_UNKNOWN_PROTOCOLS = false;\n\t  /* Decide if self-closing tags in attributes are allowed.\n\t   * Usually removed due to a mXSS issue in jQuery 3.0 */\n\t  let ALLOW_SELF_CLOSE_IN_ATTR = true;\n\t  /* Output should be safe for common template engines.\n\t   * This means, DOMPurify removes data attributes, mustaches and ERB\n\t   */\n\t  let SAFE_FOR_TEMPLATES = false;\n\t  /* Output should be safe even for XML used within HTML and alike.\n\t   * This means, DOMPurify removes comments when containing risky content.\n\t   */\n\t  let SAFE_FOR_XML = true;\n\t  /* Decide if document with <html>... should be returned */\n\t  let WHOLE_DOCUMENT = false;\n\t  /* Track whether config is already set on this instance of DOMPurify. */\n\t  let SET_CONFIG = false;\n\t  /* Decide if all elements (e.g. style, script) must be children of\n\t   * document.body. By default, browsers might move them to document.head */\n\t  let FORCE_BODY = false;\n\t  /* Decide if a DOM `HTMLBodyElement` should be returned, instead of a html\n\t   * string (or a TrustedHTML object if Trusted Types are supported).\n\t   * If `WHOLE_DOCUMENT` is enabled a `HTMLHtmlElement` will be returned instead\n\t   */\n\t  let RETURN_DOM = false;\n\t  /* Decide if a DOM `DocumentFragment` should be returned, instead of a html\n\t   * string  (or a TrustedHTML object if Trusted Types are supported) */\n\t  let RETURN_DOM_FRAGMENT = false;\n\t  /* Try to return a Trusted Type object instead of a string, return a string in\n\t   * case Trusted Types are not supported  */\n\t  let RETURN_TRUSTED_TYPE = false;\n\t  /* Output should be free from DOM clobbering attacks?\n\t   * This sanitizes markups named with colliding, clobberable built-in DOM APIs.\n\t   */\n\t  let SANITIZE_DOM = true;\n\t  /* Achieve full DOM Clobbering protection by isolating the namespace of named\n\t   * properties and JS variables, mitigating attacks that abuse the HTML/DOM spec rules.\n\t   *\n\t   * HTML/DOM spec rules that enable DOM Clobbering:\n\t   *   - Named Access on Window (7.3.3)\n\t   *   - DOM Tree Accessors (3.1.5)\n\t   *   - Form Element Parent-Child Relations (4.10.3)\n\t   *   - Iframe srcdoc / Nested WindowProxies (4.8.5)\n\t   *   - HTMLCollection (4.2.10.2)\n\t   *\n\t   * Namespace isolation is implemented by prefixing `id` and `name` attributes\n\t   * with a constant string, i.e., `user-content-`\n\t   */\n\t  let SANITIZE_NAMED_PROPS = false;\n\t  const SANITIZE_NAMED_PROPS_PREFIX = 'user-content-';\n\t  /* Keep element content when removing element? */\n\t  let KEEP_CONTENT = true;\n\t  /* If a `Node` is passed to sanitize(), then performs sanitization in-place instead\n\t   * of importing it into a new Document and returning a sanitized copy */\n\t  let IN_PLACE = false;\n\t  /* Allow usage of profiles like html, svg and mathMl */\n\t  let USE_PROFILES = {};\n\t  /* Tags to ignore content of when KEEP_CONTENT is true */\n\t  let FORBID_CONTENTS = null;\n\t  const DEFAULT_FORBID_CONTENTS = addToSet({}, ['annotation-xml', 'audio', 'colgroup', 'desc', 'foreignobject', 'head', 'iframe', 'math', 'mi', 'mn', 'mo', 'ms', 'mtext', 'noembed', 'noframes', 'noscript', 'plaintext', 'script', 'style', 'svg', 'template', 'thead', 'title', 'video', 'xmp']);\n\t  /* Tags that are safe for data: URIs */\n\t  let DATA_URI_TAGS = null;\n\t  const DEFAULT_DATA_URI_TAGS = addToSet({}, ['audio', 'video', 'img', 'source', 'image', 'track']);\n\t  /* Attributes safe for values like \"javascript:\" */\n\t  let URI_SAFE_ATTRIBUTES = null;\n\t  const DEFAULT_URI_SAFE_ATTRIBUTES = addToSet({}, ['alt', 'class', 'for', 'id', 'label', 'name', 'pattern', 'placeholder', 'role', 'summary', 'title', 'value', 'style', 'xmlns']);\n\t  const MATHML_NAMESPACE = 'http://www.w3.org/1998/Math/MathML';\n\t  const SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\n\t  const HTML_NAMESPACE = 'http://www.w3.org/1999/xhtml';\n\t  /* Document namespace */\n\t  let NAMESPACE = HTML_NAMESPACE;\n\t  let IS_EMPTY_INPUT = false;\n\t  /* Allowed XHTML+XML namespaces */\n\t  let ALLOWED_NAMESPACES = null;\n\t  const DEFAULT_ALLOWED_NAMESPACES = addToSet({}, [MATHML_NAMESPACE, SVG_NAMESPACE, HTML_NAMESPACE], stringToString);\n\t  let MATHML_TEXT_INTEGRATION_POINTS = addToSet({}, ['mi', 'mo', 'mn', 'ms', 'mtext']);\n\t  let HTML_INTEGRATION_POINTS = addToSet({}, ['annotation-xml']);\n\t  // Certain elements are allowed in both SVG and HTML\n\t  // namespace. We need to specify them explicitly\n\t  // so that they don't get erroneously deleted from\n\t  // HTML namespace.\n\t  const COMMON_SVG_AND_HTML_ELEMENTS = addToSet({}, ['title', 'style', 'font', 'a', 'script']);\n\t  /* Parsing of strict XHTML documents */\n\t  let PARSER_MEDIA_TYPE = null;\n\t  const SUPPORTED_PARSER_MEDIA_TYPES = ['application/xhtml+xml', 'text/html'];\n\t  const DEFAULT_PARSER_MEDIA_TYPE = 'text/html';\n\t  let transformCaseFunc = null;\n\t  /* Keep a reference to config to pass to hooks */\n\t  let CONFIG = null;\n\t  /* Ideally, do not touch anything below this line */\n\t  /* ______________________________________________ */\n\t  const formElement = document.createElement('form');\n\t  const isRegexOrFunction = function isRegexOrFunction(testValue) {\n\t    return testValue instanceof RegExp || testValue instanceof Function;\n\t  };\n\t  /**\n\t   * _parseConfig\n\t   *\n\t   * @param cfg optional config literal\n\t   */\n\t  // eslint-disable-next-line complexity\n\t  const _parseConfig = function _parseConfig() {\n\t    let cfg = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\t    if (CONFIG && CONFIG === cfg) {\n\t      return;\n\t    }\n\t    /* Shield configuration object from tampering */\n\t    if (!cfg || typeof cfg !== 'object') {\n\t      cfg = {};\n\t    }\n\t    /* Shield configuration object from prototype pollution */\n\t    cfg = clone(cfg);\n\t    PARSER_MEDIA_TYPE =\n\t    // eslint-disable-next-line unicorn/prefer-includes\n\t    SUPPORTED_PARSER_MEDIA_TYPES.indexOf(cfg.PARSER_MEDIA_TYPE) === -1 ? DEFAULT_PARSER_MEDIA_TYPE : cfg.PARSER_MEDIA_TYPE;\n\t    // HTML tags and attributes are not case-sensitive, converting to lowercase. Keeping XHTML as is.\n\t    transformCaseFunc = PARSER_MEDIA_TYPE === 'application/xhtml+xml' ? stringToString : stringToLowerCase;\n\t    /* Set configuration parameters */\n\t    ALLOWED_TAGS = objectHasOwnProperty(cfg, 'ALLOWED_TAGS') ? addToSet({}, cfg.ALLOWED_TAGS, transformCaseFunc) : DEFAULT_ALLOWED_TAGS;\n\t    ALLOWED_ATTR = objectHasOwnProperty(cfg, 'ALLOWED_ATTR') ? addToSet({}, cfg.ALLOWED_ATTR, transformCaseFunc) : DEFAULT_ALLOWED_ATTR;\n\t    ALLOWED_NAMESPACES = objectHasOwnProperty(cfg, 'ALLOWED_NAMESPACES') ? addToSet({}, cfg.ALLOWED_NAMESPACES, stringToString) : DEFAULT_ALLOWED_NAMESPACES;\n\t    URI_SAFE_ATTRIBUTES = objectHasOwnProperty(cfg, 'ADD_URI_SAFE_ATTR') ? addToSet(clone(DEFAULT_URI_SAFE_ATTRIBUTES), cfg.ADD_URI_SAFE_ATTR, transformCaseFunc) : DEFAULT_URI_SAFE_ATTRIBUTES;\n\t    DATA_URI_TAGS = objectHasOwnProperty(cfg, 'ADD_DATA_URI_TAGS') ? addToSet(clone(DEFAULT_DATA_URI_TAGS), cfg.ADD_DATA_URI_TAGS, transformCaseFunc) : DEFAULT_DATA_URI_TAGS;\n\t    FORBID_CONTENTS = objectHasOwnProperty(cfg, 'FORBID_CONTENTS') ? addToSet({}, cfg.FORBID_CONTENTS, transformCaseFunc) : DEFAULT_FORBID_CONTENTS;\n\t    FORBID_TAGS = objectHasOwnProperty(cfg, 'FORBID_TAGS') ? addToSet({}, cfg.FORBID_TAGS, transformCaseFunc) : clone({});\n\t    FORBID_ATTR = objectHasOwnProperty(cfg, 'FORBID_ATTR') ? addToSet({}, cfg.FORBID_ATTR, transformCaseFunc) : clone({});\n\t    USE_PROFILES = objectHasOwnProperty(cfg, 'USE_PROFILES') ? cfg.USE_PROFILES : false;\n\t    ALLOW_ARIA_ATTR = cfg.ALLOW_ARIA_ATTR !== false; // Default true\n\t    ALLOW_DATA_ATTR = cfg.ALLOW_DATA_ATTR !== false; // Default true\n\t    ALLOW_UNKNOWN_PROTOCOLS = cfg.ALLOW_UNKNOWN_PROTOCOLS || false; // Default false\n\t    ALLOW_SELF_CLOSE_IN_ATTR = cfg.ALLOW_SELF_CLOSE_IN_ATTR !== false; // Default true\n\t    SAFE_FOR_TEMPLATES = cfg.SAFE_FOR_TEMPLATES || false; // Default false\n\t    SAFE_FOR_XML = cfg.SAFE_FOR_XML !== false; // Default true\n\t    WHOLE_DOCUMENT = cfg.WHOLE_DOCUMENT || false; // Default false\n\t    RETURN_DOM = cfg.RETURN_DOM || false; // Default false\n\t    RETURN_DOM_FRAGMENT = cfg.RETURN_DOM_FRAGMENT || false; // Default false\n\t    RETURN_TRUSTED_TYPE = cfg.RETURN_TRUSTED_TYPE || false; // Default false\n\t    FORCE_BODY = cfg.FORCE_BODY || false; // Default false\n\t    SANITIZE_DOM = cfg.SANITIZE_DOM !== false; // Default true\n\t    SANITIZE_NAMED_PROPS = cfg.SANITIZE_NAMED_PROPS || false; // Default false\n\t    KEEP_CONTENT = cfg.KEEP_CONTENT !== false; // Default true\n\t    IN_PLACE = cfg.IN_PLACE || false; // Default false\n\t    IS_ALLOWED_URI$1 = cfg.ALLOWED_URI_REGEXP || IS_ALLOWED_URI;\n\t    NAMESPACE = cfg.NAMESPACE || HTML_NAMESPACE;\n\t    MATHML_TEXT_INTEGRATION_POINTS = cfg.MATHML_TEXT_INTEGRATION_POINTS || MATHML_TEXT_INTEGRATION_POINTS;\n\t    HTML_INTEGRATION_POINTS = cfg.HTML_INTEGRATION_POINTS || HTML_INTEGRATION_POINTS;\n\t    CUSTOM_ELEMENT_HANDLING = cfg.CUSTOM_ELEMENT_HANDLING || {};\n\t    if (cfg.CUSTOM_ELEMENT_HANDLING && isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck)) {\n\t      CUSTOM_ELEMENT_HANDLING.tagNameCheck = cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck;\n\t    }\n\t    if (cfg.CUSTOM_ELEMENT_HANDLING && isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)) {\n\t      CUSTOM_ELEMENT_HANDLING.attributeNameCheck = cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck;\n\t    }\n\t    if (cfg.CUSTOM_ELEMENT_HANDLING && typeof cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements === 'boolean') {\n\t      CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements = cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements;\n\t    }\n\t    if (SAFE_FOR_TEMPLATES) {\n\t      ALLOW_DATA_ATTR = false;\n\t    }\n\t    if (RETURN_DOM_FRAGMENT) {\n\t      RETURN_DOM = true;\n\t    }\n\t    /* Parse profile info */\n\t    if (USE_PROFILES) {\n\t      ALLOWED_TAGS = addToSet({}, text);\n\t      ALLOWED_ATTR = [];\n\t      if (USE_PROFILES.html === true) {\n\t        addToSet(ALLOWED_TAGS, html$1);\n\t        addToSet(ALLOWED_ATTR, html);\n\t      }\n\t      if (USE_PROFILES.svg === true) {\n\t        addToSet(ALLOWED_TAGS, svg$1);\n\t        addToSet(ALLOWED_ATTR, svg);\n\t        addToSet(ALLOWED_ATTR, xml);\n\t      }\n\t      if (USE_PROFILES.svgFilters === true) {\n\t        addToSet(ALLOWED_TAGS, svgFilters);\n\t        addToSet(ALLOWED_ATTR, svg);\n\t        addToSet(ALLOWED_ATTR, xml);\n\t      }\n\t      if (USE_PROFILES.mathMl === true) {\n\t        addToSet(ALLOWED_TAGS, mathMl$1);\n\t        addToSet(ALLOWED_ATTR, mathMl);\n\t        addToSet(ALLOWED_ATTR, xml);\n\t      }\n\t    }\n\t    /* Merge configuration parameters */\n\t    if (cfg.ADD_TAGS) {\n\t      if (ALLOWED_TAGS === DEFAULT_ALLOWED_TAGS) {\n\t        ALLOWED_TAGS = clone(ALLOWED_TAGS);\n\t      }\n\t      addToSet(ALLOWED_TAGS, cfg.ADD_TAGS, transformCaseFunc);\n\t    }\n\t    if (cfg.ADD_ATTR) {\n\t      if (ALLOWED_ATTR === DEFAULT_ALLOWED_ATTR) {\n\t        ALLOWED_ATTR = clone(ALLOWED_ATTR);\n\t      }\n\t      addToSet(ALLOWED_ATTR, cfg.ADD_ATTR, transformCaseFunc);\n\t    }\n\t    if (cfg.ADD_URI_SAFE_ATTR) {\n\t      addToSet(URI_SAFE_ATTRIBUTES, cfg.ADD_URI_SAFE_ATTR, transformCaseFunc);\n\t    }\n\t    if (cfg.FORBID_CONTENTS) {\n\t      if (FORBID_CONTENTS === DEFAULT_FORBID_CONTENTS) {\n\t        FORBID_CONTENTS = clone(FORBID_CONTENTS);\n\t      }\n\t      addToSet(FORBID_CONTENTS, cfg.FORBID_CONTENTS, transformCaseFunc);\n\t    }\n\t    /* Add #text in case KEEP_CONTENT is set to true */\n\t    if (KEEP_CONTENT) {\n\t      ALLOWED_TAGS['#text'] = true;\n\t    }\n\t    /* Add html, head and body to ALLOWED_TAGS in case WHOLE_DOCUMENT is true */\n\t    if (WHOLE_DOCUMENT) {\n\t      addToSet(ALLOWED_TAGS, ['html', 'head', 'body']);\n\t    }\n\t    /* Add tbody to ALLOWED_TAGS in case tables are permitted, see #286, #365 */\n\t    if (ALLOWED_TAGS.table) {\n\t      addToSet(ALLOWED_TAGS, ['tbody']);\n\t      delete FORBID_TAGS.tbody;\n\t    }\n\t    if (cfg.TRUSTED_TYPES_POLICY) {\n\t      if (typeof cfg.TRUSTED_TYPES_POLICY.createHTML !== 'function') {\n\t        throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a \"createHTML\" hook.');\n\t      }\n\t      if (typeof cfg.TRUSTED_TYPES_POLICY.createScriptURL !== 'function') {\n\t        throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a \"createScriptURL\" hook.');\n\t      }\n\t      // Overwrite existing TrustedTypes policy.\n\t      trustedTypesPolicy = cfg.TRUSTED_TYPES_POLICY;\n\t      // Sign local variables required by `sanitize`.\n\t      emptyHTML = trustedTypesPolicy.createHTML('');\n\t    } else {\n\t      // Uninitialized policy, attempt to initialize the internal dompurify policy.\n\t      if (trustedTypesPolicy === undefined) {\n\t        trustedTypesPolicy = _createTrustedTypesPolicy(trustedTypes, currentScript);\n\t      }\n\t      // If creating the internal policy succeeded sign internal variables.\n\t      if (trustedTypesPolicy !== null && typeof emptyHTML === 'string') {\n\t        emptyHTML = trustedTypesPolicy.createHTML('');\n\t      }\n\t    }\n\t    // Prevent further manipulation of configuration.\n\t    // Not available in IE8, Safari 5, etc.\n\t    if (freeze) {\n\t      freeze(cfg);\n\t    }\n\t    CONFIG = cfg;\n\t  };\n\t  /* Keep track of all possible SVG and MathML tags\n\t   * so that we can perform the namespace checks\n\t   * correctly. */\n\t  const ALL_SVG_TAGS = addToSet({}, [...svg$1, ...svgFilters, ...svgDisallowed]);\n\t  const ALL_MATHML_TAGS = addToSet({}, [...mathMl$1, ...mathMlDisallowed]);\n\t  /**\n\t   * @param element a DOM element whose namespace is being checked\n\t   * @returns Return false if the element has a\n\t   *  namespace that a spec-compliant parser would never\n\t   *  return. Return true otherwise.\n\t   */\n\t  const _checkValidNamespace = function _checkValidNamespace(element) {\n\t    let parent = getParentNode(element);\n\t    // In JSDOM, if we're inside shadow DOM, then parentNode\n\t    // can be null. We just simulate parent in this case.\n\t    if (!parent || !parent.tagName) {\n\t      parent = {\n\t        namespaceURI: NAMESPACE,\n\t        tagName: 'template'\n\t      };\n\t    }\n\t    const tagName = stringToLowerCase(element.tagName);\n\t    const parentTagName = stringToLowerCase(parent.tagName);\n\t    if (!ALLOWED_NAMESPACES[element.namespaceURI]) {\n\t      return false;\n\t    }\n\t    if (element.namespaceURI === SVG_NAMESPACE) {\n\t      // The only way to switch from HTML namespace to SVG\n\t      // is via <svg>. If it happens via any other tag, then\n\t      // it should be killed.\n\t      if (parent.namespaceURI === HTML_NAMESPACE) {\n\t        return tagName === 'svg';\n\t      }\n\t      // The only way to switch from MathML to SVG is via`\n\t      // svg if parent is either <annotation-xml> or MathML\n\t      // text integration points.\n\t      if (parent.namespaceURI === MATHML_NAMESPACE) {\n\t        return tagName === 'svg' && (parentTagName === 'annotation-xml' || MATHML_TEXT_INTEGRATION_POINTS[parentTagName]);\n\t      }\n\t      // We only allow elements that are defined in SVG\n\t      // spec. All others are disallowed in SVG namespace.\n\t      return Boolean(ALL_SVG_TAGS[tagName]);\n\t    }\n\t    if (element.namespaceURI === MATHML_NAMESPACE) {\n\t      // The only way to switch from HTML namespace to MathML\n\t      // is via <math>. If it happens via any other tag, then\n\t      // it should be killed.\n\t      if (parent.namespaceURI === HTML_NAMESPACE) {\n\t        return tagName === 'math';\n\t      }\n\t      // The only way to switch from SVG to MathML is via\n\t      // <math> and HTML integration points\n\t      if (parent.namespaceURI === SVG_NAMESPACE) {\n\t        return tagName === 'math' && HTML_INTEGRATION_POINTS[parentTagName];\n\t      }\n\t      // We only allow elements that are defined in MathML\n\t      // spec. All others are disallowed in MathML namespace.\n\t      return Boolean(ALL_MATHML_TAGS[tagName]);\n\t    }\n\t    if (element.namespaceURI === HTML_NAMESPACE) {\n\t      // The only way to switch from SVG to HTML is via\n\t      // HTML integration points, and from MathML to HTML\n\t      // is via MathML text integration points\n\t      if (parent.namespaceURI === SVG_NAMESPACE && !HTML_INTEGRATION_POINTS[parentTagName]) {\n\t        return false;\n\t      }\n\t      if (parent.namespaceURI === MATHML_NAMESPACE && !MATHML_TEXT_INTEGRATION_POINTS[parentTagName]) {\n\t        return false;\n\t      }\n\t      // We disallow tags that are specific for MathML\n\t      // or SVG and should never appear in HTML namespace\n\t      return !ALL_MATHML_TAGS[tagName] && (COMMON_SVG_AND_HTML_ELEMENTS[tagName] || !ALL_SVG_TAGS[tagName]);\n\t    }\n\t    // For XHTML and XML documents that support custom namespaces\n\t    if (PARSER_MEDIA_TYPE === 'application/xhtml+xml' && ALLOWED_NAMESPACES[element.namespaceURI]) {\n\t      return true;\n\t    }\n\t    // The code should never reach this place (this means\n\t    // that the element somehow got namespace that is not\n\t    // HTML, SVG, MathML or allowed via ALLOWED_NAMESPACES).\n\t    // Return false just in case.\n\t    return false;\n\t  };\n\t  /**\n\t   * _forceRemove\n\t   *\n\t   * @param node a DOM node\n\t   */\n\t  const _forceRemove = function _forceRemove(node) {\n\t    arrayPush(DOMPurify.removed, {\n\t      element: node\n\t    });\n\t    try {\n\t      // eslint-disable-next-line unicorn/prefer-dom-node-remove\n\t      getParentNode(node).removeChild(node);\n\t    } catch (_) {\n\t      remove(node);\n\t    }\n\t  };\n\t  /**\n\t   * _removeAttribute\n\t   *\n\t   * @param name an Attribute name\n\t   * @param element a DOM node\n\t   */\n\t  const _removeAttribute = function _removeAttribute(name, element) {\n\t    try {\n\t      arrayPush(DOMPurify.removed, {\n\t        attribute: element.getAttributeNode(name),\n\t        from: element\n\t      });\n\t    } catch (_) {\n\t      arrayPush(DOMPurify.removed, {\n\t        attribute: null,\n\t        from: element\n\t      });\n\t    }\n\t    element.removeAttribute(name);\n\t    // We void attribute values for unremovable \"is\" attributes\n\t    if (name === 'is') {\n\t      if (RETURN_DOM || RETURN_DOM_FRAGMENT) {\n\t        try {\n\t          _forceRemove(element);\n\t        } catch (_) {}\n\t      } else {\n\t        try {\n\t          element.setAttribute(name, '');\n\t        } catch (_) {}\n\t      }\n\t    }\n\t  };\n\t  /**\n\t   * _initDocument\n\t   *\n\t   * @param dirty - a string of dirty markup\n\t   * @return a DOM, filled with the dirty markup\n\t   */\n\t  const _initDocument = function _initDocument(dirty) {\n\t    /* Create a HTML document */\n\t    let doc = null;\n\t    let leadingWhitespace = null;\n\t    if (FORCE_BODY) {\n\t      dirty = '<remove></remove>' + dirty;\n\t    } else {\n\t      /* If FORCE_BODY isn't used, leading whitespace needs to be preserved manually */\n\t      const matches = stringMatch(dirty, /^[\\r\\n\\t ]+/);\n\t      leadingWhitespace = matches && matches[0];\n\t    }\n\t    if (PARSER_MEDIA_TYPE === 'application/xhtml+xml' && NAMESPACE === HTML_NAMESPACE) {\n\t      // Root of XHTML doc must contain xmlns declaration (see https://www.w3.org/TR/xhtml1/normative.html#strict)\n\t      dirty = '<html xmlns=\"http://www.w3.org/1999/xhtml\"><head></head><body>' + dirty + '</body></html>';\n\t    }\n\t    const dirtyPayload = trustedTypesPolicy ? trustedTypesPolicy.createHTML(dirty) : dirty;\n\t    /*\n\t     * Use the DOMParser API by default, fallback later if needs be\n\t     * DOMParser not work for svg when has multiple root element.\n\t     */\n\t    if (NAMESPACE === HTML_NAMESPACE) {\n\t      try {\n\t        doc = new DOMParser().parseFromString(dirtyPayload, PARSER_MEDIA_TYPE);\n\t      } catch (_) {}\n\t    }\n\t    /* Use createHTMLDocument in case DOMParser is not available */\n\t    if (!doc || !doc.documentElement) {\n\t      doc = implementation.createDocument(NAMESPACE, 'template', null);\n\t      try {\n\t        doc.documentElement.innerHTML = IS_EMPTY_INPUT ? emptyHTML : dirtyPayload;\n\t      } catch (_) {\n\t        // Syntax error if dirtyPayload is invalid xml\n\t      }\n\t    }\n\t    const body = doc.body || doc.documentElement;\n\t    if (dirty && leadingWhitespace) {\n\t      body.insertBefore(document.createTextNode(leadingWhitespace), body.childNodes[0] || null);\n\t    }\n\t    /* Work on whole document or just its body */\n\t    if (NAMESPACE === HTML_NAMESPACE) {\n\t      return getElementsByTagName.call(doc, WHOLE_DOCUMENT ? 'html' : 'body')[0];\n\t    }\n\t    return WHOLE_DOCUMENT ? doc.documentElement : body;\n\t  };\n\t  /**\n\t   * Creates a NodeIterator object that you can use to traverse filtered lists of nodes or elements in a document.\n\t   *\n\t   * @param root The root element or node to start traversing on.\n\t   * @return The created NodeIterator\n\t   */\n\t  const _createNodeIterator = function _createNodeIterator(root) {\n\t    return createNodeIterator.call(root.ownerDocument || root, root,\n\t    // eslint-disable-next-line no-bitwise\n\t    NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_COMMENT | NodeFilter.SHOW_TEXT | NodeFilter.SHOW_PROCESSING_INSTRUCTION | NodeFilter.SHOW_CDATA_SECTION, null);\n\t  };\n\t  /**\n\t   * _isClobbered\n\t   *\n\t   * @param element element to check for clobbering attacks\n\t   * @return true if clobbered, false if safe\n\t   */\n\t  const _isClobbered = function _isClobbered(element) {\n\t    return element instanceof HTMLFormElement && (typeof element.nodeName !== 'string' || typeof element.textContent !== 'string' || typeof element.removeChild !== 'function' || !(element.attributes instanceof NamedNodeMap) || typeof element.removeAttribute !== 'function' || typeof element.setAttribute !== 'function' || typeof element.namespaceURI !== 'string' || typeof element.insertBefore !== 'function' || typeof element.hasChildNodes !== 'function');\n\t  };\n\t  /**\n\t   * Checks whether the given object is a DOM node.\n\t   *\n\t   * @param value object to check whether it's a DOM node\n\t   * @return true is object is a DOM node\n\t   */\n\t  const _isNode = function _isNode(value) {\n\t    return typeof Node === 'function' && value instanceof Node;\n\t  };\n\t  function _executeHooks(hooks, currentNode, data) {\n\t    arrayForEach(hooks, hook => {\n\t      hook.call(DOMPurify, currentNode, data, CONFIG);\n\t    });\n\t  }\n\t  /**\n\t   * _sanitizeElements\n\t   *\n\t   * @protect nodeName\n\t   * @protect textContent\n\t   * @protect removeChild\n\t   * @param currentNode to check for permission to exist\n\t   * @return true if node was killed, false if left alive\n\t   */\n\t  const _sanitizeElements = function _sanitizeElements(currentNode) {\n\t    let content = null;\n\t    /* Execute a hook if present */\n\t    _executeHooks(hooks.beforeSanitizeElements, currentNode, null);\n\t    /* Check if element is clobbered or can clobber */\n\t    if (_isClobbered(currentNode)) {\n\t      _forceRemove(currentNode);\n\t      return true;\n\t    }\n\t    /* Now let's check the element's type and name */\n\t    const tagName = transformCaseFunc(currentNode.nodeName);\n\t    /* Execute a hook if present */\n\t    _executeHooks(hooks.uponSanitizeElement, currentNode, {\n\t      tagName,\n\t      allowedTags: ALLOWED_TAGS\n\t    });\n\t    /* Detect mXSS attempts abusing namespace confusion */\n\t    if (SAFE_FOR_XML && currentNode.hasChildNodes() && !_isNode(currentNode.firstElementChild) && regExpTest(/<[/\\w!]/g, currentNode.innerHTML) && regExpTest(/<[/\\w!]/g, currentNode.textContent)) {\n\t      _forceRemove(currentNode);\n\t      return true;\n\t    }\n\t    /* Remove any occurrence of processing instructions */\n\t    if (currentNode.nodeType === NODE_TYPE.progressingInstruction) {\n\t      _forceRemove(currentNode);\n\t      return true;\n\t    }\n\t    /* Remove any kind of possibly harmful comments */\n\t    if (SAFE_FOR_XML && currentNode.nodeType === NODE_TYPE.comment && regExpTest(/<[/\\w]/g, currentNode.data)) {\n\t      _forceRemove(currentNode);\n\t      return true;\n\t    }\n\t    /* Remove element if anything forbids its presence */\n\t    if (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName]) {\n\t      /* Check if we have a custom element to handle */\n\t      if (!FORBID_TAGS[tagName] && _isBasicCustomElement(tagName)) {\n\t        if (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, tagName)) {\n\t          return false;\n\t        }\n\t        if (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(tagName)) {\n\t          return false;\n\t        }\n\t      }\n\t      /* Keep content except for bad-listed elements */\n\t      if (KEEP_CONTENT && !FORBID_CONTENTS[tagName]) {\n\t        const parentNode = getParentNode(currentNode) || currentNode.parentNode;\n\t        const childNodes = getChildNodes(currentNode) || currentNode.childNodes;\n\t        if (childNodes && parentNode) {\n\t          const childCount = childNodes.length;\n\t          for (let i = childCount - 1; i >= 0; --i) {\n\t            const childClone = cloneNode(childNodes[i], true);\n\t            childClone.__removalCount = (currentNode.__removalCount || 0) + 1;\n\t            parentNode.insertBefore(childClone, getNextSibling(currentNode));\n\t          }\n\t        }\n\t      }\n\t      _forceRemove(currentNode);\n\t      return true;\n\t    }\n\t    /* Check whether element has a valid namespace */\n\t    if (currentNode instanceof Element && !_checkValidNamespace(currentNode)) {\n\t      _forceRemove(currentNode);\n\t      return true;\n\t    }\n\t    /* Make sure that older browsers don't get fallback-tag mXSS */\n\t    if ((tagName === 'noscript' || tagName === 'noembed' || tagName === 'noframes') && regExpTest(/<\\/no(script|embed|frames)/i, currentNode.innerHTML)) {\n\t      _forceRemove(currentNode);\n\t      return true;\n\t    }\n\t    /* Sanitize element content to be template-safe */\n\t    if (SAFE_FOR_TEMPLATES && currentNode.nodeType === NODE_TYPE.text) {\n\t      /* Get the element's text content */\n\t      content = currentNode.textContent;\n\t      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {\n\t        content = stringReplace(content, expr, ' ');\n\t      });\n\t      if (currentNode.textContent !== content) {\n\t        arrayPush(DOMPurify.removed, {\n\t          element: currentNode.cloneNode()\n\t        });\n\t        currentNode.textContent = content;\n\t      }\n\t    }\n\t    /* Execute a hook if present */\n\t    _executeHooks(hooks.afterSanitizeElements, currentNode, null);\n\t    return false;\n\t  };\n\t  /**\n\t   * _isValidAttribute\n\t   *\n\t   * @param lcTag Lowercase tag name of containing element.\n\t   * @param lcName Lowercase attribute name.\n\t   * @param value Attribute value.\n\t   * @return Returns true if `value` is valid, otherwise false.\n\t   */\n\t  // eslint-disable-next-line complexity\n\t  const _isValidAttribute = function _isValidAttribute(lcTag, lcName, value) {\n\t    /* Make sure attribute cannot clobber */\n\t    if (SANITIZE_DOM && (lcName === 'id' || lcName === 'name') && (value in document || value in formElement)) {\n\t      return false;\n\t    }\n\t    /* Allow valid data-* attributes: At least one character after \"-\"\n\t        (https://html.spec.whatwg.org/multipage/dom.html#embedding-custom-non-visible-data-with-the-data-*-attributes)\n\t        XML-compatible (https://html.spec.whatwg.org/multipage/infrastructure.html#xml-compatible and http://www.w3.org/TR/xml/#d0e804)\n\t        We don't need to check the value; it's always URI safe. */\n\t    if (ALLOW_DATA_ATTR && !FORBID_ATTR[lcName] && regExpTest(DATA_ATTR, lcName)) ; else if (ALLOW_ARIA_ATTR && regExpTest(ARIA_ATTR, lcName)) ; else if (!ALLOWED_ATTR[lcName] || FORBID_ATTR[lcName]) {\n\t      if (\n\t      // First condition does a very basic check if a) it's basically a valid custom element tagname AND\n\t      // b) if the tagName passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n\t      // and c) if the attribute name passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.attributeNameCheck\n\t      _isBasicCustomElement(lcTag) && (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, lcTag) || CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(lcTag)) && (CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.attributeNameCheck, lcName) || CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.attributeNameCheck(lcName)) ||\n\t      // Alternative, second condition checks if it's an `is`-attribute, AND\n\t      // the value passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n\t      lcName === 'is' && CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements && (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, value) || CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(value))) ; else {\n\t        return false;\n\t      }\n\t      /* Check value is safe. First, is attr inert? If so, is safe */\n\t    } else if (URI_SAFE_ATTRIBUTES[lcName]) ; else if (regExpTest(IS_ALLOWED_URI$1, stringReplace(value, ATTR_WHITESPACE, ''))) ; else if ((lcName === 'src' || lcName === 'xlink:href' || lcName === 'href') && lcTag !== 'script' && stringIndexOf(value, 'data:') === 0 && DATA_URI_TAGS[lcTag]) ; else if (ALLOW_UNKNOWN_PROTOCOLS && !regExpTest(IS_SCRIPT_OR_DATA, stringReplace(value, ATTR_WHITESPACE, ''))) ; else if (value) {\n\t      return false;\n\t    } else ;\n\t    return true;\n\t  };\n\t  /**\n\t   * _isBasicCustomElement\n\t   * checks if at least one dash is included in tagName, and it's not the first char\n\t   * for more sophisticated checking see https://github.com/sindresorhus/validate-element-name\n\t   *\n\t   * @param tagName name of the tag of the node to sanitize\n\t   * @returns Returns true if the tag name meets the basic criteria for a custom element, otherwise false.\n\t   */\n\t  const _isBasicCustomElement = function _isBasicCustomElement(tagName) {\n\t    return tagName !== 'annotation-xml' && stringMatch(tagName, CUSTOM_ELEMENT);\n\t  };\n\t  /**\n\t   * _sanitizeAttributes\n\t   *\n\t   * @protect attributes\n\t   * @protect nodeName\n\t   * @protect removeAttribute\n\t   * @protect setAttribute\n\t   *\n\t   * @param currentNode to sanitize\n\t   */\n\t  const _sanitizeAttributes = function _sanitizeAttributes(currentNode) {\n\t    /* Execute a hook if present */\n\t    _executeHooks(hooks.beforeSanitizeAttributes, currentNode, null);\n\t    const {\n\t      attributes\n\t    } = currentNode;\n\t    /* Check if we have attributes; if not we might have a text node */\n\t    if (!attributes || _isClobbered(currentNode)) {\n\t      return;\n\t    }\n\t    const hookEvent = {\n\t      attrName: '',\n\t      attrValue: '',\n\t      keepAttr: true,\n\t      allowedAttributes: ALLOWED_ATTR,\n\t      forceKeepAttr: undefined\n\t    };\n\t    let l = attributes.length;\n\t    /* Go backwards over all attributes; safely remove bad ones */\n\t    while (l--) {\n\t      const attr = attributes[l];\n\t      const {\n\t        name,\n\t        namespaceURI,\n\t        value: attrValue\n\t      } = attr;\n\t      const lcName = transformCaseFunc(name);\n\t      const initValue = attrValue;\n\t      let value = name === 'value' ? initValue : stringTrim(initValue);\n\t      /* Execute a hook if present */\n\t      hookEvent.attrName = lcName;\n\t      hookEvent.attrValue = value;\n\t      hookEvent.keepAttr = true;\n\t      hookEvent.forceKeepAttr = undefined; // Allows developers to see this is a property they can set\n\t      _executeHooks(hooks.uponSanitizeAttribute, currentNode, hookEvent);\n\t      value = hookEvent.attrValue;\n\t      /* Full DOM Clobbering protection via namespace isolation,\n\t       * Prefix id and name attributes with `user-content-`\n\t       */\n\t      if (SANITIZE_NAMED_PROPS && (lcName === 'id' || lcName === 'name')) {\n\t        // Remove the attribute with this value\n\t        _removeAttribute(name, currentNode);\n\t        // Prefix the value and later re-create the attribute with the sanitized value\n\t        value = SANITIZE_NAMED_PROPS_PREFIX + value;\n\t      }\n\t      /* Work around a security issue with comments inside attributes */\n\t      if (SAFE_FOR_XML && regExpTest(/((--!?|])>)|<\\/(style|title)/i, value)) {\n\t        _removeAttribute(name, currentNode);\n\t        continue;\n\t      }\n\t      /* Did the hooks approve of the attribute? */\n\t      if (hookEvent.forceKeepAttr) {\n\t        continue;\n\t      }\n\t      /* Did the hooks approve of the attribute? */\n\t      if (!hookEvent.keepAttr) {\n\t        _removeAttribute(name, currentNode);\n\t        continue;\n\t      }\n\t      /* Work around a security issue in jQuery 3.0 */\n\t      if (!ALLOW_SELF_CLOSE_IN_ATTR && regExpTest(/\\/>/i, value)) {\n\t        _removeAttribute(name, currentNode);\n\t        continue;\n\t      }\n\t      /* Sanitize attribute content to be template-safe */\n\t      if (SAFE_FOR_TEMPLATES) {\n\t        arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {\n\t          value = stringReplace(value, expr, ' ');\n\t        });\n\t      }\n\t      /* Is `value` valid for this attribute? */\n\t      const lcTag = transformCaseFunc(currentNode.nodeName);\n\t      if (!_isValidAttribute(lcTag, lcName, value)) {\n\t        _removeAttribute(name, currentNode);\n\t        continue;\n\t      }\n\t      /* Handle attributes that require Trusted Types */\n\t      if (trustedTypesPolicy && typeof trustedTypes === 'object' && typeof trustedTypes.getAttributeType === 'function') {\n\t        if (namespaceURI) ; else {\n\t          switch (trustedTypes.getAttributeType(lcTag, lcName)) {\n\t            case 'TrustedHTML':\n\t              {\n\t                value = trustedTypesPolicy.createHTML(value);\n\t                break;\n\t              }\n\t            case 'TrustedScriptURL':\n\t              {\n\t                value = trustedTypesPolicy.createScriptURL(value);\n\t                break;\n\t              }\n\t          }\n\t        }\n\t      }\n\t      /* Handle invalid data-* attribute set by try-catching it */\n\t      if (value !== initValue) {\n\t        try {\n\t          if (namespaceURI) {\n\t            currentNode.setAttributeNS(namespaceURI, name, value);\n\t          } else {\n\t            /* Fallback to setAttribute() for browser-unrecognized namespaces e.g. \"x-schema\". */\n\t            currentNode.setAttribute(name, value);\n\t          }\n\t          if (_isClobbered(currentNode)) {\n\t            _forceRemove(currentNode);\n\t          } else {\n\t            arrayPop(DOMPurify.removed);\n\t          }\n\t        } catch (_) {\n\t          _removeAttribute(name, currentNode);\n\t        }\n\t      }\n\t    }\n\t    /* Execute a hook if present */\n\t    _executeHooks(hooks.afterSanitizeAttributes, currentNode, null);\n\t  };\n\t  /**\n\t   * _sanitizeShadowDOM\n\t   *\n\t   * @param fragment to iterate over recursively\n\t   */\n\t  const _sanitizeShadowDOM = function _sanitizeShadowDOM(fragment) {\n\t    let shadowNode = null;\n\t    const shadowIterator = _createNodeIterator(fragment);\n\t    /* Execute a hook if present */\n\t    _executeHooks(hooks.beforeSanitizeShadowDOM, fragment, null);\n\t    while (shadowNode = shadowIterator.nextNode()) {\n\t      /* Execute a hook if present */\n\t      _executeHooks(hooks.uponSanitizeShadowNode, shadowNode, null);\n\t      /* Sanitize tags and elements */\n\t      _sanitizeElements(shadowNode);\n\t      /* Check attributes next */\n\t      _sanitizeAttributes(shadowNode);\n\t      /* Deep shadow DOM detected */\n\t      if (shadowNode.content instanceof DocumentFragment) {\n\t        _sanitizeShadowDOM(shadowNode.content);\n\t      }\n\t    }\n\t    /* Execute a hook if present */\n\t    _executeHooks(hooks.afterSanitizeShadowDOM, fragment, null);\n\t  };\n\t  // eslint-disable-next-line complexity\n\t  DOMPurify.sanitize = function (dirty) {\n\t    let cfg = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\t    let body = null;\n\t    let importedNode = null;\n\t    let currentNode = null;\n\t    let returnNode = null;\n\t    /* Make sure we have a string to sanitize.\n\t      DO NOT return early, as this will return the wrong type if\n\t      the user has requested a DOM object rather than a string */\n\t    IS_EMPTY_INPUT = !dirty;\n\t    if (IS_EMPTY_INPUT) {\n\t      dirty = '<!-->';\n\t    }\n\t    /* Stringify, in case dirty is an object */\n\t    if (typeof dirty !== 'string' && !_isNode(dirty)) {\n\t      if (typeof dirty.toString === 'function') {\n\t        dirty = dirty.toString();\n\t        if (typeof dirty !== 'string') {\n\t          throw typeErrorCreate('dirty is not a string, aborting');\n\t        }\n\t      } else {\n\t        throw typeErrorCreate('toString is not a function');\n\t      }\n\t    }\n\t    /* Return dirty HTML if DOMPurify cannot run */\n\t    if (!DOMPurify.isSupported) {\n\t      return dirty;\n\t    }\n\t    /* Assign config vars */\n\t    if (!SET_CONFIG) {\n\t      _parseConfig(cfg);\n\t    }\n\t    /* Clean up removed elements */\n\t    DOMPurify.removed = [];\n\t    /* Check if dirty is correctly typed for IN_PLACE */\n\t    if (typeof dirty === 'string') {\n\t      IN_PLACE = false;\n\t    }\n\t    if (IN_PLACE) {\n\t      /* Do some early pre-sanitization to avoid unsafe root nodes */\n\t      if (dirty.nodeName) {\n\t        const tagName = transformCaseFunc(dirty.nodeName);\n\t        if (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName]) {\n\t          throw typeErrorCreate('root node is forbidden and cannot be sanitized in-place');\n\t        }\n\t      }\n\t    } else if (dirty instanceof Node) {\n\t      /* If dirty is a DOM element, append to an empty document to avoid\n\t         elements being stripped by the parser */\n\t      body = _initDocument('<!---->');\n\t      importedNode = body.ownerDocument.importNode(dirty, true);\n\t      if (importedNode.nodeType === NODE_TYPE.element && importedNode.nodeName === 'BODY') {\n\t        /* Node is already a body, use as is */\n\t        body = importedNode;\n\t      } else if (importedNode.nodeName === 'HTML') {\n\t        body = importedNode;\n\t      } else {\n\t        // eslint-disable-next-line unicorn/prefer-dom-node-append\n\t        body.appendChild(importedNode);\n\t      }\n\t    } else {\n\t      /* Exit directly if we have nothing to do */\n\t      if (!RETURN_DOM && !SAFE_FOR_TEMPLATES && !WHOLE_DOCUMENT &&\n\t      // eslint-disable-next-line unicorn/prefer-includes\n\t      dirty.indexOf('<') === -1) {\n\t        return trustedTypesPolicy && RETURN_TRUSTED_TYPE ? trustedTypesPolicy.createHTML(dirty) : dirty;\n\t      }\n\t      /* Initialize the document to work on */\n\t      body = _initDocument(dirty);\n\t      /* Check we have a DOM node from the data */\n\t      if (!body) {\n\t        return RETURN_DOM ? null : RETURN_TRUSTED_TYPE ? emptyHTML : '';\n\t      }\n\t    }\n\t    /* Remove first element node (ours) if FORCE_BODY is set */\n\t    if (body && FORCE_BODY) {\n\t      _forceRemove(body.firstChild);\n\t    }\n\t    /* Get node iterator */\n\t    const nodeIterator = _createNodeIterator(IN_PLACE ? dirty : body);\n\t    /* Now start iterating over the created document */\n\t    while (currentNode = nodeIterator.nextNode()) {\n\t      /* Sanitize tags and elements */\n\t      _sanitizeElements(currentNode);\n\t      /* Check attributes next */\n\t      _sanitizeAttributes(currentNode);\n\t      /* Shadow DOM detected, sanitize it */\n\t      if (currentNode.content instanceof DocumentFragment) {\n\t        _sanitizeShadowDOM(currentNode.content);\n\t      }\n\t    }\n\t    /* If we sanitized `dirty` in-place, return it. */\n\t    if (IN_PLACE) {\n\t      return dirty;\n\t    }\n\t    /* Return sanitized string or DOM */\n\t    if (RETURN_DOM) {\n\t      if (RETURN_DOM_FRAGMENT) {\n\t        returnNode = createDocumentFragment.call(body.ownerDocument);\n\t        while (body.firstChild) {\n\t          // eslint-disable-next-line unicorn/prefer-dom-node-append\n\t          returnNode.appendChild(body.firstChild);\n\t        }\n\t      } else {\n\t        returnNode = body;\n\t      }\n\t      if (ALLOWED_ATTR.shadowroot || ALLOWED_ATTR.shadowrootmode) {\n\t        /*\n\t          AdoptNode() is not used because internal state is not reset\n\t          (e.g. the past names map of a HTMLFormElement), this is safe\n\t          in theory but we would rather not risk another attack vector.\n\t          The state that is cloned by importNode() is explicitly defined\n\t          by the specs.\n\t        */\n\t        returnNode = importNode.call(originalDocument, returnNode, true);\n\t      }\n\t      return returnNode;\n\t    }\n\t    let serializedHTML = WHOLE_DOCUMENT ? body.outerHTML : body.innerHTML;\n\t    /* Serialize doctype if allowed */\n\t    if (WHOLE_DOCUMENT && ALLOWED_TAGS['!doctype'] && body.ownerDocument && body.ownerDocument.doctype && body.ownerDocument.doctype.name && regExpTest(DOCTYPE_NAME, body.ownerDocument.doctype.name)) {\n\t      serializedHTML = '<!DOCTYPE ' + body.ownerDocument.doctype.name + '>\\n' + serializedHTML;\n\t    }\n\t    /* Sanitize final string template-safe */\n\t    if (SAFE_FOR_TEMPLATES) {\n\t      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], expr => {\n\t        serializedHTML = stringReplace(serializedHTML, expr, ' ');\n\t      });\n\t    }\n\t    return trustedTypesPolicy && RETURN_TRUSTED_TYPE ? trustedTypesPolicy.createHTML(serializedHTML) : serializedHTML;\n\t  };\n\t  DOMPurify.setConfig = function () {\n\t    let cfg = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\t    _parseConfig(cfg);\n\t    SET_CONFIG = true;\n\t  };\n\t  DOMPurify.clearConfig = function () {\n\t    CONFIG = null;\n\t    SET_CONFIG = false;\n\t  };\n\t  DOMPurify.isValidAttribute = function (tag, attr, value) {\n\t    /* Initialize shared config vars if necessary. */\n\t    if (!CONFIG) {\n\t      _parseConfig({});\n\t    }\n\t    const lcTag = transformCaseFunc(tag);\n\t    const lcName = transformCaseFunc(attr);\n\t    return _isValidAttribute(lcTag, lcName, value);\n\t  };\n\t  DOMPurify.addHook = function (entryPoint, hookFunction) {\n\t    if (typeof hookFunction !== 'function') {\n\t      return;\n\t    }\n\t    arrayPush(hooks[entryPoint], hookFunction);\n\t  };\n\t  DOMPurify.removeHook = function (entryPoint, hookFunction) {\n\t    if (hookFunction !== undefined) {\n\t      const index = arrayLastIndexOf(hooks[entryPoint], hookFunction);\n\t      return index === -1 ? undefined : arraySplice(hooks[entryPoint], index, 1)[0];\n\t    }\n\t    return arrayPop(hooks[entryPoint]);\n\t  };\n\t  DOMPurify.removeHooks = function (entryPoint) {\n\t    hooks[entryPoint] = [];\n\t  };\n\t  DOMPurify.removeAllHooks = function () {\n\t    hooks = _createHooksMap();\n\t  };\n\t  return DOMPurify;\n\t}\n\tvar purify = createDOMPurify();\n\n\tvar globalWin  = window;\n\tvar globalDoc  = document;\n\n\tvar IMAGE_MIME_REGEX = /^image\\/(p?jpe?g|gif|png|bmp)$/i;\n\n\t/**\n\t * Wrap inlines that are in the root in paragraphs.\n\t *\n\t * @param {HTMLBodyElement} body\n\t * @param {Document} doc\n\t * @private\n\t */\n\tfunction wrapInlines(body, doc) {\n\t\tvar wrapper;\n\n\t\ttraverse(body, function (node) {\n\t\t\tif (isInline(node, true)) {\n\t\t\t\t// Ignore text nodes unless they contain non-whitespace chars as\n\t\t\t\t// whitespace will be collapsed.\n\t\t\t\t// Ignore sceditor-ignore elements unless wrapping siblings\n\t\t\t\t// Should still wrap both if wrapping siblings.\n\t\t\t\tif (wrapper || node.nodeType === TEXT_NODE ?\n\t\t\t\t\t/\\S/.test(node.nodeValue) : !is(node, '.sceditor-ignore')) {\n\t\t\t\t\tif (!wrapper) {\n\t\t\t\t\t\twrapper = createElement('p', {}, doc);\n\t\t\t\t\t\tinsertBefore(wrapper, node);\n\t\t\t\t\t}\n\n\t\t\t\t\tappendChild(wrapper, node);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twrapper = null;\n\t\t\t}\n\t\t}, false, true);\n\t}\n\t/**\n\t * SCEditor - A lightweight WYSIWYG editor\n\t *\n\t * @param {HTMLTextAreaElement} original The textarea to be converted\n\t * @param {Object} userOptions\n\t * @class SCEditor\n\t * @name SCEditor\n\t */\n\tfunction SCEditor(original, userOptions) {\n\t\t/**\n\t\t * Alias of this\n\t\t *\n\t\t * @private\n\t\t */\n\t\tvar base = this;\n\n\t\t/**\n\t\t * Editor format like BBCode or HTML\n\t\t */\n\t\tvar format;\n\n\t\t/**\n\t\t * The div which contains the editor and toolbar\n\t\t *\n\t\t * @type {HTMLDivElement}\n\t\t * @private\n\t\t */\n\t\tvar editorContainer;\n\n\t\t/**\n\t\t * Map of events handlers bound to this instance.\n\t\t *\n\t\t * @type {Object}\n\t\t * @private\n\t\t */\n\t\tvar eventHandlers = {};\n\n\t\t/**\n\t\t * The editors toolbar\n\t\t *\n\t\t * @type {HTMLDivElement}\n\t\t * @private\n\t\t */\n\t\tvar toolbar;\n\n\t\t/**\n\t\t * The editors iframe which should be in design mode\n\t\t *\n\t\t * @type {HTMLIFrameElement}\n\t\t * @private\n\t\t */\n\t\tvar wysiwygEditor;\n\n\t\t/**\n\t\t * The editors window\n\t\t *\n\t\t * @type {Window}\n\t\t * @private\n\t\t */\n\t\tvar wysiwygWindow;\n\n\t\t/**\n\t\t * The WYSIWYG editors body element\n\t\t *\n\t\t * @type {HTMLBodyElement}\n\t\t * @private\n\t\t */\n\t\tvar wysiwygBody;\n\n\t\t/**\n\t\t * The WYSIWYG editors document\n\t\t *\n\t\t * @type {Document}\n\t\t * @private\n\t\t */\n\t\tvar wysiwygDocument;\n\n\t\t/**\n\t\t * The editors textarea for viewing source\n\t\t *\n\t\t * @type {HTMLTextAreaElement}\n\t\t * @private\n\t\t */\n\t\tvar sourceEditor;\n\n\t\tvar footer;\n\n\t\t/**\n\t\t * The current dropdown\n\t\t *\n\t\t * @type {HTMLDivElement}\n\t\t * @private\n\t\t */\n\t\tvar dropdown;\n\n\t\t/**\n\t\t * If the user is currently composing text via IME\n\t\t * @type {boolean}\n\t\t */\n\t\tvar isComposing;\n\n\t\t/**\n\t\t * Timer for valueChanged key handler\n\t\t * @type {number}\n\t\t */\n\t\tvar valueChangedKeyUpTimer;\n\n\t\t/**\n\t\t * The editors locale\n\t\t *\n\t\t * @private\n\t\t */\n\t\tvar locale;\n\n\t\t/**\n\t\t * The editors rangeHelper instance\n\t\t *\n\t\t * @type {RangeHelper}\n\t\t * @private\n\t\t */\n\t\tvar rangeHelper;\n\n\t\t/**\n\t\t * An array of button state handlers\n\t\t *\n\t\t * @type {Array.<Object>}\n\t\t * @private\n\t\t */\n\t\tvar btnStateHandlers = [];\n\n\t\t/**\n\t\t * Plugin manager instance\n\t\t *\n\t\t * @type {PluginManager}\n\t\t * @private\n\t\t */\n\t\tvar pluginManager;\n\n\t\t/**\n\t\t * The current node containing the selection/caret\n\t\t *\n\t\t * @type {Node}\n\t\t * @private\n\t\t */\n\t\tvar currentNode;\n\n\t\t/**\n\t\t * The first block level parent of the current node\n\t\t *\n\t\t * @type {node}\n\t\t * @private\n\t\t */\n\t\tvar currentBlockNode;\n\n\t\tvar backSpaceHandled;\n\n\t\t/**\n\t\t * The current node selection/caret\n\t\t *\n\t\t * @type {Object}\n\t\t * @private\n\t\t */\n\t\tvar currentSelection;\n\n\t\t/**\n\t\t * Used to make sure only 1 selection changed\n\t\t * check is called every 100ms.\n\t\t *\n\t\t * Helps improve performance as it is checked a lot.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @private\n\t\t */\n\t\tvar isSelectionCheckPending;\n\n\t\t/**\n\t\t * If content is required (equivalent to the HTML5 required attribute)\n\t\t *\n\t\t * @type {boolean}\n\t\t * @private\n\t\t */\n\t\tvar isRequired;\n\n\t\t/**\n\t\t * The inline CSS style element. Will be undefined\n\t\t * until css() is called for the first time.\n\t\t *\n\t\t * @type {HTMLStyleElement}\n\t\t * @private\n\t\t */\n\t\tvar inlineCss;\n\n\t\t/**\n\t\t * Object containing a list of shortcut handlers\n\t\t *\n\t\t * @type {Object}\n\t\t * @private\n\t\t */\n\t\tvar shortcutHandlers = {};\n\n\t\t/**\n\t\t * The min and max heights that autoExpand should stay within\n\t\t *\n\t\t * @type {Object}\n\t\t * @private\n\t\t */\n\t\tvar autoExpandBounds;\n\n\t\t/**\n\t\t * Timeout for the autoExpand function to throttle calls\n\t\t *\n\t\t * @private\n\t\t */\n\t\tvar autoExpandThrottle;\n\n\t\t/**\n\t\t * Cache of the current toolbar buttons\n\t\t *\n\t\t * @type {Object}\n\t\t * @private\n\t\t */\n\t\tvar toolbarButtons = {};\n\n\t\t/**\n\t\t * Last scroll position before maximizing so\n\t\t * it can be restored when finished.\n\t\t *\n\t\t * @type {number}\n\t\t * @private\n\t\t */\n\t\tvar maximizeScrollPosition;\n\n\t\t/**\n\t\t * Stores the contents while a paste is taking place.\n\t\t *\n\t\t * Needed to support browsers that lack clipboard API support.\n\t\t *\n\t\t * @type {?DocumentFragment}\n\t\t * @private\n\t\t */\n\t\tvar pasteContentFragment;\n\n\t\t/**\n\t\t * Current icon set if any\n\t\t *\n\t\t * @type {?Object}\n\t\t * @private\n\t\t */\n\t\tvar icons;\n\n\t\t/**\n\t\t * Private functions\n\t\t * @private\n\t\t */\n\t\tvar init,\n\t\t\thandleCommand,\n\t\t\tinitEditor,\n\t\t\tinitLocale,\n\t\t\tinitToolBar,\n\t\t\tinitOptions,\n\t\t\tinitEvents,\n\t\t\tinitResize,\n\t\t\thandlePasteEvt,\n\t\t\thandleCutCopyEvt,\n\t\t\thandlePasteData,\n\t\t\thandleKeyDown,\n\t\t\thandleBackSpace,\n\t\t\thandleKeyPress,\n\t\t\thandleFormReset,\n\t\t\thandleMouseDown,\n\t\t\thandleComposition,\n\t\t\thandleEvent,\n\t\t\thandleDocumentClick,\n\t\t\tloadScripts,\n\t\t\tupdateToolBar,\n\t\t\tupdateActiveButtons,\n\t\t\tsourceEditorSelectedText,\n\t\t\tappendNewLine,\n\t\t\tcheckSelectionChanged,\n\t\t\tcheckNodeChanged,\n\t\t\tautofocus,\n\t\t\tcurrentStyledBlockNode,\n\t\t\ttriggerValueChanged,\n\t\t\tvalueChangedBlur,\n\t\t\tvalueChangedKeyUp,\n\t\t\tautoUpdate,\n\t\t\tautoExpand;\n\n\t\t/**\n\t\t * All the commands supported by the editor\n\t\t * @name commands\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.commands = extend(true, {}, (userOptions.commands || defaultCmds));\n\n\t\t/**\n\t\t * Options for this editor instance\n\t\t * @name opts\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tvar options = base.opts = extend(\n\t\t\ttrue, {}, defaultOptions, userOptions\n\t\t);\n\n\t\tif (!Array.isArray(options.allowedIframeUrls)) {\n\t\t\toptions.allowedIframeUrls = [];\n\t\t}\n\n\t\toptions.allowedIframeUrls.push('https://youtube.com/embed/');\n\t\toptions.allowedIframeUrls.push('https://player.vimeo.com/video/');\n\t\toptions.allowedIframeUrls.push('https://www.instagram.com/p/');\n\t\toptions.allowedIframeUrls.push('https://www.facebook.com/plugins/');\n\n\t\t// Create new instance of DOMPurify for each editor instance so can\n\t\t// have different allowed iframe URLs\n\t\t// eslint-disable-next-line new-cap\n\t\tvar domPurify = purify();\n\n\t\t// Allow iframes for things like YouTube, see:\n\t\t// https://github.com/cure53/DOMPurify/issues/340#issuecomment-670758980\n\t\tdomPurify.addHook('uponSanitizeElement', function (node, data) {\n\t\t\tconst allowedUrls = options.allowedIframeUrls;\n\n\t\t\tif (data.tagName === 'iframe') {\n\t\t\t\tconst src = attr(node, 'src') || '';\n\n\t\t\t\tfor (let i = 0; i < allowedUrls.length; i++) {\n\t\t\t\t\tconst url = allowedUrls[i];\n\n\t\t\t\t\tif (isString(url) && src.substr(0, url.length) === url) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Handle regex\n\t\t\t\t\tif (url.test && url.test(src)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// No match so remove\n\t\t\t\tremove(node);\n\t\t\t}\n\t\t});\n\n\t\t// Convert target attribute into data-sce-target attributes so XHTML format\n\t\t// can allow them\n\t\tdomPurify.addHook('afterSanitizeAttributes', function (node) {\n\t\t\tif ('target' in node) {\n\t\t\t\tattr(node, 'data-sce-target', attr(node, 'target'));\n\t\t\t}\n\n\t\t\tremoveAttr(node, 'target');\n\t\t});\n\n\t\t/**\n\t\t * Sanitize HTML to avoid XSS\n\t\t *\n\t\t * @param {string} html\n\t\t * @return {string} html\n\t\t * @private\n\t\t */\n\t\tfunction sanitize(html) {\n\t\t\tconst allowedTags = ['iframe'].concat(options.allowedTags);\n\t\t\tconst allowedAttrs = ['allowfullscreen', 'frameborder', 'target']\n\t\t\t\t.concat(options.allowedAttributes);\n\n\t\t\treturn domPurify.sanitize(html, {\n\t\t\t\tADD_TAGS: allowedTags,\n\t\t\t\tADD_ATTR: allowedAttrs\n\t\t\t});\n\t\t}\n\t\t/**\n\t\t* Loads a JavaScript file and returns a Promise for when it is loaded\n\t\t*/\n\t\tconst loadScript = src => {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tconst script = document.createElement('script');\n\t\t\t\tscript.type = 'text/javascript';\n\t\t\t\tscript.onload = resolve;\n\t\t\t\tscript.onerror = reject;\n\t\t\t\tscript.src = src;\n\t\t\t\tdocument.head.append(script);\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Loads all scripts\n\t\t * @private\n\t\t */\n\t\tloadScripts = function () {\n\t\t\tif (options.locale && options.locale !== 'en') {\n\t\t\t\tconst promises = [];\n\t\t\t\tpromises.push(\n\t\t\t\t\tloadScript(`../${options.basePath}languages/${options.locale}.js`));\n\n\t\t\t\tPromise.all(promises).then(() => {\n\t\t\t\t\tinit();\n\t\t\t\t}).catch(() => console.error('Something went wrong.'));\n\t\t\t} else {\n\t\t\t\tinit();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Creates the editor iframe and textarea\n\t\t * @private\n\t\t */\n\t\tinit = function () {\n\t\t\toriginal._sceditor = base;\n\n\t\t\t// Load locale\n\t\t\tif (options.locale && options.locale !== 'en') {\n\t\t\t\tinitLocale();\n\t\t\t}\n\n\t\t\teditorContainer = createElement('div', {\n\t\t\t\tclassName: 'sceditor-container card'\n\t\t\t});\n\n\t\t\tinsertBefore(editorContainer, original);\n\t\t\tcss(editorContainer, 'z-index', options.zIndex);\n\n\t\t\tisRequired = original.required;\n\t\t\toriginal.required = false;\n\n\t\t\tconst FormatCtor = SCEditor.formats[options.format];\n\t\t\tformat = FormatCtor ? new FormatCtor() : {};\n\t\t\t/*\n\t\t\t * Plugins should be initialized before the formatters since\n\t\t\t * they may wish to add or change formatting handlers and\n\t\t\t * since the bbcode format caches its handlers,\n\t\t\t * such changes must be done first.\n\t\t\t */\n\t\t\tpluginManager = new PluginManager(base);\n\t\t\t(options.plugins || '').split(',').forEach(function (plugin) {\n\t\t\t\tpluginManager.register(plugin.trim());\n\t\t\t});\n\t\t\tif ('init' in format) {\n\t\t\t\tformat.init.call(base);\n\t\t\t}\n\n\t\t\t// create the editor\n\t\t\tinitToolBar();\n\t\t\tinitEditor();\n\t\t\tinitOptions();\n\t\t\tinitEvents();\n\n\t\t\t// force into source mode if is a browser that can't handle\n\t\t\t// full editing\n\t\t\tif (!isWysiwygSupported) {\n\t\t\t\tbase.toggleSourceMode();\n\t\t\t}\n\n\t\t\tupdateActiveButtons();\n\n\t\t\tvar loaded = function () {\n\t\t\t\toff(globalWin, 'load', loaded);\n\n\t\t\t\tif (options.autofocus) {\n\t\t\t\t\tautofocus(!!options.autofocusEnd);\n\t\t\t\t}\n\n\t\t\t\tautoExpand();\n\t\t\t\tappendNewLine();\n\t\t\t\t// TODO: use editor doc and window?\n\t\t\t\tpluginManager.call('ready');\n\t\t\t\tif ('onReady' in format) {\n\t\t\t\t\tformat.onReady.call(base);\n\t\t\t\t}\n\t\t\t};\n\t\t\ton(globalWin, 'load', loaded);\n\t\t\tif (globalDoc.readyState === 'complete') {\n\t\t\t\tloaded();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Init the locale variable with the specified locale if possible\n\t\t * @private\n\t\t * @return void\n\t\t */\n\t\tinitLocale = function () {\n\t\t\tvar lang;\n\n\t\t\tlocale = SCEditor.locale[options.locale];\n\n\t\t\tif (!locale) {\n\t\t\t\tlang = options.locale.split('-');\n\t\t\t\tlocale = SCEditor.locale[lang[0]];\n\t\t\t}\n\n\t\t\t// Locale DateTime format overrides any specified in the options\n\t\t\tif (locale && locale.dateFormat) {\n\t\t\t\toptions.dateFormat = locale.dateFormat;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Creates the editor iframe and textarea\n\t\t * @private\n\t\t */\n\t\tinitEditor = function () {\n\t\t\tsourceEditor  = createElement('textarea');\n\t\t\twysiwygEditor = createElement('iframe', {\n\t\t\t\tframeborder: 0,\n\t\t\t\tallowfullscreen: true\n\t\t\t});\n\n\t\t\tattr(wysiwygEditor, 'role', 'none');\n\n\t\t\tfooter = createElement('div');\n\t\t\taddClass(footer, 'card-footer');\n\t\t\taddClass(footer, 'text-body-secondary');\n\t\t\taddClass(footer, 'text-end');\n\t\t\taddClass(footer, 'small');\n\t\t\taddClass(footer, 'p-2');\n\n\t\t\tfooter.appendChild(parseHTML(base._('Characters remaining:') + '<span id=\"editor-Counter\" class=\"badge bg-secondary ms-1\">' + '</span>'));\n\n\t\t\t/*\n\t\t\t * This needs to be done right after they are created because,\n\t\t\t * for any reason, the user may not want the value to be tinkered\n\t\t\t * by any filters.\n\t\t\t */\n\t\t\tif (options.startInSourceMode) {\n\t\t\t\taddClass(editorContainer, 'sourceMode');\n\t\t\t\thide(wysiwygEditor);\n\t\t\t} else {\n\t\t\t\taddClass(editorContainer, 'wysiwygMode');\n\t\t\t\thide(sourceEditor);\n\t\t\t}\n\n\t\t\tif (!options.spellcheck) {\n\t\t\t\tattr(editorContainer, 'spellcheck', 'false');\n\t\t\t}\n\n\t\t\tif (globalWin.location.protocol === 'https:') {\n\t\t\t\tattr(wysiwygEditor, 'src', 'about:blank');\n\t\t\t}\n\n\t\t\tattr(sourceEditor, 'title', 'source');\n\t\t\tattr(sourceEditor, 'name', 'source');\n\n\t\t\t// Add the editor to the container\n\t\t\tappendChild(editorContainer, wysiwygEditor);\n\t\t\tappendChild(editorContainer, sourceEditor);\n\t\t\tappendChild(editorContainer, footer);\n\n\t\t\t// TODO: make this optional somehow\n\t\t\tbase.dimensions(\n\t\t\t\toptions.width || width(original),\n\t\t\t\toptions.height || height(original)\n\t\t\t);\n\n\t\t\twysiwygDocument = wysiwygEditor.contentDocument;\n\t\t\twysiwygDocument.open();\n\n\t\t\tvar styles = '';\n\n\t\t\toptions.styles.forEach((style) => {\n\t\t\t\tstyles += _tmpl('style', {style: style});\n\t\t\t});\n\n\t\t\twysiwygDocument.write(_tmpl('html', {\n\t\t\t\tspellcheck: options.spellcheck ? '' : 'spellcheck=\"false\"',\n\t\t\t\tcharset: options.charset,\n\t\t\t\tthemeMode: options.themeMode,\n\t\t\t\tstyles: styles\n\t\t\t}));\n\n\t\t\twysiwygDocument.close();\n\n\t\t\twysiwygBody = wysiwygDocument.body;\n\t\t\twysiwygWindow = wysiwygEditor.contentWindow;\n\n\t\t\tbase.readOnly(!!options.readOnly);\n\n\t\t\t// iframe overflow fix for iOS\n\t\t\tif (ios) {\n\t\t\t\theight(wysiwygBody, '100%');\n\t\t\t\ton(wysiwygBody, 'touchend', base.focus);\n\t\t\t}\n\n\t\t\tvar tabIndex = attr(original, 'tabindex');\n\t\t\tattr(sourceEditor, 'tabindex', tabIndex);\n\t\t\tattr(wysiwygEditor, 'tabindex', tabIndex);\n\n\t\t\trangeHelper = new RangeHelper(wysiwygWindow, null, sanitize);\n\n\t\t\t// load any textarea value into the editor\n\t\t\thide(original);\n\t\t\tbase.val(original.value);\n\n\t\t\tvar placeholder = options.placeholder ||\n\t\t\t\tattr(original, 'placeholder');\n\n\t\t\tif (placeholder) {\n\t\t\t\tsourceEditor.placeholder = placeholder;\n\t\t\t\tattr(wysiwygBody, 'placeholder', placeholder);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Initialises options\n\t\t * @private\n\t\t */\n\t\tinitOptions = function () {\n\t\t\t// auto-update original textbox on blur if option set to true\n\t\t\tif (options.autoUpdate) {\n\t\t\t\ton(wysiwygBody, 'blur', autoUpdate);\n\t\t\t\ton(sourceEditor, 'blur', autoUpdate);\n\t\t\t}\n\n\t\t\tif (options.rtl === null) {\n\t\t\t\toptions.rtl = css(sourceEditor, 'direction') === 'rtl';\n\t\t\t}\n\n\t\t\tbase.rtl(!!options.rtl);\n\n\t\t\tif (options.autoExpand) {\n\t\t\t\t// Need to update when images (or anything else) loads\n\t\t\t\ton(wysiwygBody, 'load', autoExpand, EVENT_CAPTURE);\n\t\t\t\ton(wysiwygBody, 'input keyup', autoExpand);\n\t\t\t}\n\n\t\t\tif (options.resizeEnabled) {\n\t\t\t\tinitResize();\n\t\t\t}\n\n\t\t\tattr(editorContainer, 'id', options.id);\n\t\t};\n\n\t\t/**\n\t\t * Initialises events\n\t\t * @private\n\t\t */\n\t\tinitEvents = function () {\n\t\t\tconst form = original.form;\n\t\t\tconst compositionEvents = 'compositionstart compositionend';\n\t\t\tconst eventsToForward = 'keydown keyup keypress focus blur contextmenu input';\n\t\t\tconst checkSelectionEvents = 'onselectionchange' in wysiwygDocument ?\n\t\t\t\t'selectionchange' :\n\t\t\t\t'keyup focus blur contextmenu mouseup touchend click';\n\n\t\t\ton(globalDoc, 'click', handleDocumentClick);\n\n\t\t\tif (form) {\n\t\t\t\ton(form, 'reset', handleFormReset);\n\t\t\t\ton(form, 'submit', base.updateOriginal, EVENT_CAPTURE);\n\t\t\t}\n\n\t\t\ton(window, 'pagehide', base.updateOriginal);\n\t\t\ton(window, 'pageshow', handleFormReset);\n\t\t\ton(wysiwygBody, 'keypress', handleKeyPress);\n\t\t\ton(wysiwygBody, 'keydown', handleKeyDown);\n\t\t\ton(wysiwygBody, 'keydown', handleBackSpace);\n\t\t\ton(wysiwygBody, 'keyup', appendNewLine);\n\t\t\ton(wysiwygBody, 'blur', valueChangedBlur);\n\t\t\ton(wysiwygBody, 'keyup', valueChangedKeyUp);\n\t\t\ton(wysiwygBody, 'paste', handlePasteEvt);\n\t\t\ton(wysiwygBody, 'cut copy', handleCutCopyEvt);\n\t\t\ton(wysiwygBody, compositionEvents, handleComposition);\n\t\t\ton(wysiwygBody, checkSelectionEvents, checkSelectionChanged);\n\t\t\ton(wysiwygBody, eventsToForward, handleEvent);\n\n\t\t\ton(wysiwygBody, 'blur', function () {\n\t\t\t\tif (!base.val()) {\n\t\t\t\t\taddClass(wysiwygBody, 'placeholder');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\ton(wysiwygBody, 'focus', function () {\n\t\t\t\tremoveClass(wysiwygBody, 'placeholder');\n\t\t\t});\n\n\t\t\ton(sourceEditor, 'blur', valueChangedBlur);\n\t\t\ton(sourceEditor, 'keyup', valueChangedKeyUp);\n\t\t\ton(sourceEditor, 'keydown', handleKeyDown);\n\t\t\ton(sourceEditor, compositionEvents, handleComposition);\n\t\t\ton(sourceEditor, eventsToForward, handleEvent);\n\n\t\t\ton(wysiwygDocument, 'mousedown', handleMouseDown);\n\t\t\ton(wysiwygDocument, checkSelectionEvents, checkSelectionChanged);\n\t\t\ton(wysiwygDocument, 'keyup', appendNewLine);\n\n\t\t\ton(editorContainer, 'selectionchanged', checkNodeChanged);\n\t\t\ton(editorContainer, 'selectionchanged', updateActiveButtons);\n\t\t\t// Custom events to forward\n\t\t\ton(\n\t\t\t\teditorContainer,\n\t\t\t\t'selectionchanged valuechanged nodechanged pasteraw paste',\n\t\t\t\thandleEvent\n\t\t\t);\n\t\t};\n\n\t\t/**\n\t\t * Creates the toolbar and appends it to the container\n\t\t * @private\n\t\t */\n\t\tinitToolBar = function () {\n\t\t\tvar\tgroup,\n\t\t\t\tcommands = base.commands,\n\t\t\t\texclude  = (options.toolbarExclude || '').split(',');\n\t\t\tconst groups = options.toolbar.split('|');\n\n\t\t\ttoolbar = createElement('div', {\n\t\t\t\tclassName: 'card-header btn-toolbar',\n\t\t\t\tunselectable: 'on'\n\t\t\t});\n\n\t\t\tif (options.icons in SCEditor.icons) {\n\t\t\t\ticons = new SCEditor.icons[options.icons]();\n\t\t\t}\n\n\t\t\teach(groups, function (_, menuItems) {\n\t\t\t\tgroup = createElement('div', {\n\t\t\t\t\tclassName: 'btn-group btn-group-sm m-1'\n\t\t\t\t});\n\n\t\t\t\teach(menuItems.split(','), function (_, commandName) {\n\t\t\t\t\tvar\tbutton, shortcut,\n\t\t\t\t\t\tcommand  = commands[commandName];\n\n\t\t\t\t\t// The commandName must be a valid command and not excluded\n\t\t\t\t\tif (!command || exclude.indexOf(commandName) > -1) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tshortcut = command.shortcut;\n\t\t\t\t\tbutton   = _tmpl('toolbarButton', {\n\t\t\t\t\t\tname: commandName\n\t\t\t\t\t}, true).firstChild;\n\n\t\t\t\t\tif (commandName === 'source') {\n\t\t\t\t\t\tbutton.classList.add('btn-secondary');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbutton.classList.add('btn-primary');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (icons && icons.create) {\n\t\t\t\t\t\tconst icon = icons.create(commandName);\n\t\t\t\t\t\tif (icon) {\n\t\t\t\t\t\t\tinsertBefore(icons.create(commandName),\n\t\t\t\t\t\t\t\tbutton.firstChild);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tbutton._sceTxtMode = !!command.txtExec;\n\t\t\t\t\tbutton._sceWysiwygMode = !!command.exec;\n\n\t\t\t\t\ttoggleClass(button, 'disabled', !command.exec);\n\t\t\t\t\ton(button, 'click', function (e) {\n\t\t\t\t\t\tif (!hasClass(button, 'disabled')) {\n\t\t\t\t\t\t\thandleCommand(button, command);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tupdateActiveButtons();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\t\t\t\t\t// Prevent editor losing focus when button clicked\n\t\t\t\t\ton(button, 'mousedown', function (e) {\n\t\t\t\t\t\tbase.closeDropDown();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\t\tif (command.tooltip) {\n\t\t\t\t\t\tattr(button, 'title',\n\t\t\t\t\t\t\tbase._(command.tooltip) +\n\t\t\t\t\t\t\t\t(shortcut ? ' (' + shortcut + ')' : '')\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (shortcut) {\n\t\t\t\t\t\tbase.addShortcut(shortcut, commandName);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (command.state) {\n\t\t\t\t\t\tbtnStateHandlers.push({\n\t\t\t\t\t\t\tname: commandName,\n\t\t\t\t\t\t\tstate: command.state\n\t\t\t\t\t\t});\n\t\t\t\t\t// exec string commands can be passed to queryCommandState\n\t\t\t\t\t} else if (isString(command.exec)) {\n\t\t\t\t\t\tbtnStateHandlers.push({\n\t\t\t\t\t\t\tname: commandName,\n\t\t\t\t\t\t\tstate: command.exec\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tappendChild(group, button);\n\t\t\t\t\ttoolbarButtons[commandName] = button;\n\t\t\t\t});\n\n\t\t\t\t// Exclude empty groups\n\t\t\t\tif (group.firstChild) {\n\t\t\t\t\tappendChild(toolbar, group);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Append the toolbar to the toolbarContainer option if given\n\t\t\tappendChild(options.toolbarContainer || editorContainer, toolbar);\n\t\t};\n\n\t\t/**\n\t\t * Creates the resizer.\n\t\t * @private\n\t\t */\n\t\tinitResize = function () {\n\t\t\tvar\tminHeight, maxHeight, minWidth, maxWidth,\n\t\t\t\tmouseMoveFunc, mouseUpFunc;\n\t\t\tconst grip = createElement('div', {\n\t\t\t\tclassName: 'sceditor-grip'\n\t\t\t});\n\t\t\tvar moveEvents  = 'touchmove mousemove',\n\t\t\t\tendEvents   = 'touchcancel touchend mouseup',\n\t\t\t\tstartX      = 0,\n\t\t\t\tstartY      = 0,\n\t\t\t\tnewX        = 0,\n\t\t\t\tnewY        = 0,\n\t\t\t\tstartWidth  = 0,\n\t\t\t\tstartHeight = 0;\n\t\t\tconst origWidth = width(editorContainer);\n\t\t\tconst origHeight = height(editorContainer);\n\t\t\tvar isDragging  = false,\n\t\t\t\trtl         = base.rtl();\n\n\t\t\tminHeight = options.resizeMinHeight || origHeight / 1.5;\n\t\t\tmaxHeight = options.resizeMaxHeight || origHeight * 2.5;\n\t\t\tminWidth  = options.resizeMinWidth  || origWidth  / 1.25;\n\t\t\tmaxWidth  = options.resizeMaxWidth  || origWidth  * 1.25;\n\n\t\t\tmouseMoveFunc = function (e) {\n\t\t\t\t// iOS uses window.event\n\t\t\t\tif (e.type === 'touchmove') {\n\t\t\t\t\te    = globalWin.event;\n\t\t\t\t\tnewX = e.changedTouches[0].pageX;\n\t\t\t\t\tnewY = e.changedTouches[0].pageY;\n\t\t\t\t} else {\n\t\t\t\t\tnewX = e.pageX;\n\t\t\t\t\tnewY = e.pageY;\n\t\t\t\t}\n\n\t\t\t\tvar\tnewHeight = startHeight + (newY - startY),\n\t\t\t\t\tnewWidth  = rtl ?\n\t\t\t\t\t\tstartWidth - (newX - startX) :\n\t\t\t\t\t\tstartWidth + (newX - startX);\n\n\t\t\t\tif (maxWidth > 0 && newWidth > maxWidth) {\n\t\t\t\t\tnewWidth = maxWidth;\n\t\t\t\t}\n\t\t\t\tif (minWidth > 0 && newWidth < minWidth) {\n\t\t\t\t\tnewWidth = minWidth;\n\t\t\t\t}\n\t\t\t\tif (!options.resizeWidth) {\n\t\t\t\t\tnewWidth = false;\n\t\t\t\t}\n\n\t\t\t\tif (maxHeight > 0 && newHeight > maxHeight) {\n\t\t\t\t\tnewHeight = maxHeight;\n\t\t\t\t}\n\t\t\t\tif (minHeight > 0 && newHeight < minHeight) {\n\t\t\t\t\tnewHeight = minHeight;\n\t\t\t\t}\n\t\t\t\tif (!options.resizeHeight) {\n\t\t\t\t\tnewHeight = false;\n\t\t\t\t}\n\n\t\t\t\tif (newWidth || newHeight) {\n\t\t\t\t\tbase.dimensions(newWidth, newHeight);\n\t\t\t\t}\n\n\t\t\t\te.preventDefault();\n\t\t\t};\n\n\t\t\tmouseUpFunc = function (e) {\n\t\t\t\tif (!isDragging) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tisDragging = false;\n\n\t\t\t\tremoveClass(editorContainer, 'resizing');\n\t\t\t\toff(globalDoc, moveEvents, mouseMoveFunc);\n\t\t\t\toff(globalDoc, endEvents, mouseUpFunc);\n\n\t\t\t\te.preventDefault();\n\t\t\t};\n\n\t\t\tif (icons && icons.create) {\n\t\t\t\tconst icon = icons.create('grip');\n\t\t\t\tif (icon) {\n\t\t\t\t\tappendChild(grip, icon);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tappendChild(editorContainer, footer);\n\t\t\tappendChild(editorContainer, grip);\n\n\t\t\ton(grip, 'touchstart mousedown', function (e) {\n\t\t\t\t// iOS uses window.event\n\t\t\t\tif (e.type === 'touchstart') {\n\t\t\t\t\te      = globalWin.event;\n\t\t\t\t\tstartX = e.touches[0].pageX;\n\t\t\t\t\tstartY = e.touches[0].pageY;\n\t\t\t\t} else {\n\t\t\t\t\tstartX = e.pageX;\n\t\t\t\t\tstartY = e.pageY;\n\t\t\t\t}\n\n\t\t\t\tstartWidth  = width(editorContainer);\n\t\t\t\tstartHeight = height(editorContainer);\n\t\t\t\tisDragging  = true;\n\n\t\t\t\taddClass(editorContainer, 'resizing');\n\t\t\t\ton(globalDoc, moveEvents, mouseMoveFunc);\n\t\t\t\ton(globalDoc, endEvents, mouseUpFunc);\n\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Autofocus the editor\n\t\t * @private\n\t\t */\n\t\tautofocus = function (focusEnd) {\n\t\t\tvar\trange, txtPos,\n\t\t\t\tnode = wysiwygBody.firstChild;\n\n\t\t\t// Can't focus invisible elements\n\t\t\tif (!isVisible(editorContainer)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (base.sourceMode()) {\n\t\t\t\ttxtPos = focusEnd ? sourceEditor.value.length : 0;\n\n\t\t\t\tsourceEditor.setSelectionRange(txtPos, txtPos);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tremoveWhiteSpace(wysiwygBody);\n\n\t\t\tif (focusEnd) {\n\t\t\t\tif (!(node = wysiwygBody.lastChild)) {\n\t\t\t\t\tnode = createElement('p', {}, wysiwygDocument);\n\t\t\t\t\tappendChild(wysiwygBody, node);\n\t\t\t\t}\n\n\t\t\t\twhile (node.lastChild) {\n\t\t\t\t\tnode = node.lastChild;\n\n\t\t\t\t\t// Should place the cursor before the last <br>\n\t\t\t\t\tif (is(node, 'br') && node.previousSibling) {\n\t\t\t\t\t\tnode = node.previousSibling;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trange = wysiwygDocument.createRange();\n\n\t\t\tif (!canHaveChildren(node)) {\n\t\t\t\trange.setStartBefore(node);\n\n\t\t\t\tif (focusEnd) {\n\t\t\t\t\trange.setStartAfter(node);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trange.selectNodeContents(node);\n\t\t\t}\n\n\t\t\trange.collapse(!focusEnd);\n\t\t\trangeHelper.selectRange(range);\n\t\t\tcurrentSelection = range;\n\n\t\t\tif (focusEnd) {\n\t\t\t\twysiwygBody.scrollTop = wysiwygBody.scrollHeight;\n\t\t\t}\n\n\t\t\tbase.focus();\n\t\t};\n\n\t\t/**\n\t\t * Gets if the editor is read only\n\t\t *\n\t\t * @since 1.3.5\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name readOnly\n\t\t * @return {boolean}\n\t\t */\n\t\t/**\n\t\t * Sets if the editor is read only\n\t\t *\n\t\t * @param {boolean} readOnly\n\t\t * @since 1.3.5\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name readOnly^2\n\t\t * @return {this}\n\t\t */\n\t\tbase.readOnly = function (readOnly) {\n\t\t\tif (typeof readOnly !== 'boolean') {\n\t\t\t\treturn !sourceEditor.readonly;\n\t\t\t}\n\n\t\t\twysiwygBody.contentEditable = !readOnly;\n\t\t\tsourceEditor.readonly = !readOnly;\n\n\t\t\tupdateToolBar(readOnly);\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Gets if the editor is in RTL mode\n\t\t *\n\t\t * @since 1.4.1\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name rtl\n\t\t * @return {boolean}\n\t\t */\n\t\t/**\n\t\t * Sets if the editor is in RTL mode\n\t\t *\n\t\t * @param {boolean} rtl\n\t\t * @since 1.4.1\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name rtl^2\n\t\t * @return {this}\n\t\t */\n\t\tbase.rtl = function (rtl) {\n\t\t\tconst dir = rtl ? 'rtl' : 'ltr';\n\n\t\t\tif (typeof rtl !== 'boolean') {\n\t\t\t\treturn attr(sourceEditor, 'dir') === 'rtl';\n\t\t\t}\n\n\t\t\tattr(wysiwygBody, 'dir', dir);\n\t\t\tattr(sourceEditor, 'dir', dir);\n\n\t\t\tremoveClass(editorContainer, 'rtl');\n\t\t\tremoveClass(editorContainer, 'ltr');\n\t\t\taddClass(editorContainer, dir);\n\n\t\t\tif (icons && icons.rtl) {\n\t\t\t\ticons.rtl(rtl);\n\t\t\t}\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Updates the toolbar to disable/enable the appropriate buttons\n\t\t * @private\n\t\t */\n\t\tupdateToolBar = function (disable) {\n\t\t\tvar mode = base.inSourceMode() ? '_sceTxtMode' : '_sceWysiwygMode';\n\n\t\t\teach(toolbarButtons, function (_, button) {\n\t\t\t\ttoggleClass(button, 'disabled', disable || !button[mode]);\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Gets the width of the editor in pixels\n\t\t *\n\t\t * @since 1.3.5\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name width\n\t\t * @return {number}\n\t\t */\n\t\t/**\n\t\t * Sets the width of the editor\n\t\t *\n\t\t * @param {number} width Width in pixels\n\t\t * @since 1.3.5\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name width^2\n\t\t * @return {this}\n\t\t */\n\t\t/**\n\t\t * Sets the width of the editor\n\t\t *\n\t\t * The saveWidth specifies if to save the width. The stored width can be\n\t\t * used for things like restoring from maximized state.\n\t\t *\n\t\t * @param {number}     width            Width in pixels\n\t\t * @param {boolean}\t[saveWidth=true] If to store the width\n\t\t * @since 1.4.1\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name width^3\n\t\t * @return {this}\n\t\t */\n\t\tbase.width = function (width$1, saveWidth) {\n\t\t\tif (!width$1 && width$1 !== 0) {\n\t\t\t\treturn width(editorContainer);\n\t\t\t}\n\n\t\t\tbase.dimensions(width$1, null, saveWidth);\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Returns an object with the properties width and height\n\t\t * which are the width and height of the editor in px.\n\t\t *\n\t\t * @since 1.4.1\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name dimensions\n\t\t * @return {object}\n\t\t */\n\t\t/**\n\t\t * <p>Sets the width and/or height of the editor.</p>\n\t\t *\n\t\t * <p>If width or height is not numeric it is ignored.</p>\n\t\t *\n\t\t * @param {number}\twidth\tWidth in px\n\t\t * @param {number}\theight\tHeight in px\n\t\t * @since 1.4.1\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name dimensions^2\n\t\t * @return {this}\n\t\t */\n\t\t/**\n\t\t * <p>Sets the width and/or height of the editor.</p>\n\t\t *\n\t\t * <p>If width or height is not numeric it is ignored.</p>\n\t\t *\n\t\t * <p>The save argument specifies if to save the new sizes.\n\t\t * The saved sizes can be used for things like restoring from\n\t\t * maximized state. This should normally be left as true.</p>\n\t\t *\n\t\t * @param {number}\t\twidth\t\tWidth in px\n\t\t * @param {number}\t\theight\t\tHeight in px\n\t\t * @param {boolean}\t[save=true]\tIf to store the new sizes\n\t\t * @since 1.4.1\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name dimensions^3\n\t\t * @return {this}\n\t\t */\n\t\tbase.dimensions = function (width$1, height$1, save) {\n\t\t\t// set undefined width/height to boolean false\n\t\t\twidth$1  = (!width$1 && width$1 !== 0) ? false : width$1;\n\t\t\theight$1 = (!height$1 && height$1 !== 0) ? false : height$1;\n\n\t\t\tif (width$1 === false && height$1 === false) {\n\t\t\t\treturn { width: base.width(), height: base.height() };\n\t\t\t}\n\n\t\t\tif (width$1 !== false) {\n\t\t\t\tif (save !== false) {\n\t\t\t\t\toptions.width = width$1;\n\t\t\t\t}\n\n\t\t\t\twidth(editorContainer, width$1);\n\t\t\t}\n\n\t\t\tif (height$1 !== false) {\n\t\t\t\tif (save !== false) {\n\t\t\t\t\toptions.height = height$1;\n\t\t\t\t}\n\n\t\t\t\theight(editorContainer, height$1);\n\t\t\t}\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Gets the height of the editor in px\n\t\t *\n\t\t * @since 1.3.5\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name height\n\t\t * @return {number}\n\t\t */\n\t\t/**\n\t\t * Sets the height of the editor\n\t\t *\n\t\t * @param {number} height Height in px\n\t\t * @since 1.3.5\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name height^2\n\t\t * @return {this}\n\t\t */\n\t\t/**\n\t\t * Sets the height of the editor\n\t\t *\n\t\t * The saveHeight specifies if to save the height.\n\t\t *\n\t\t * The stored height can be used for things like\n\t\t * restoring from maximized state.\n\t\t *\n\t\t * @param {number} height Height in px\n\t\t * @param {boolean} [saveHeight=true] If to store the height\n\t\t * @since 1.4.1\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name height^3\n\t\t * @return {this}\n\t\t */\n\t\tbase.height = function (height$1, saveHeight) {\n\t\t\tif (!height$1 && height$1 !== 0) {\n\t\t\t\treturn height(editorContainer);\n\t\t\t}\n\n\t\t\tbase.dimensions(null, height$1, saveHeight);\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Gets if the editor is maximised or not\n\t\t *\n\t\t * @since 1.4.1\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name maximize\n\t\t * @return {boolean}\n\t\t */\n\t\t/**\n\t\t * Sets if the editor is maximised or not\n\t\t *\n\t\t * @param {boolean} maximize If to maximise the editor\n\t\t * @since 1.4.1\n\t\t * @function\n\t\t * @memberOf SCEditor.prototype\n\t\t * @name maximize^2\n\t\t * @return {this}\n\t\t */\n\t\tbase.maximize = function (maximize) {\n\t\t\tconst maximizeSize = 'sceditor-maximize';\n\n\t\t\tif (isUndefined(maximize)) {\n\t\t\t\treturn hasClass(editorContainer, maximizeSize);\n\t\t\t}\n\n\t\t\tmaximize = !!maximize;\n\n\t\t\tif (maximize) {\n\t\t\t\tmaximizeScrollPosition = globalWin.scrollY;\n\t\t\t}\n\n\t\t\ttoggleClass(globalDoc.documentElement, maximizeSize, maximize);\n\t\t\ttoggleClass(globalDoc.body, maximizeSize, maximize);\n\t\t\ttoggleClass(editorContainer, maximizeSize, maximize);\n\t\t\tbase.width(maximize ? '100%' : options.width, false);\n\t\t\tbase.height(maximize ? '100%' : options.height, false);\n\n\t\t\tif (!maximize) {\n\t\t\t\tglobalWin.scrollTo(0, maximizeScrollPosition);\n\t\t\t}\n\n\t\t\tautoExpand();\n\n\t\t\treturn base;\n\t\t};\n\n\t\tautoExpand = function () {\n\t\t\tif (options.autoExpand && !autoExpandThrottle) {\n\t\t\t\tautoExpandThrottle = setTimeout(base.expandToContent, 200);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Expands or shrinks the editors height to the height of it's content\n\t\t *\n\t\t * Unless ignoreMaxHeight is set to true it will not expand\n\t\t * higher than the maxHeight option.\n\t\t *\n\t\t * @since 1.3.5\n\t\t * @param {boolean} [ignoreMaxHeight=false]\n\t\t * @function\n\t\t * @name expandToContent\n\t\t * @memberOf SCEditor.prototype\n\t\t * @see #resizeToContent\n\t\t */\n\t\tbase.expandToContent = function (ignoreMaxHeight) {\n\t\t\tif (base.maximize()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tclearTimeout(autoExpandThrottle);\n\t\t\tautoExpandThrottle = false;\n\n\t\t\tif (!autoExpandBounds) {\n\t\t\t\tconst height$1 = options.resizeMinHeight || options.height ||\n\t                height(original);\n\n\t\t\t\tautoExpandBounds = {\n\t\t\t\t\tmin: height$1,\n\t\t\t\t\tmax: options.resizeMaxHeight || (height$1 * 2)\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tconst range = globalDoc.createRange();\n\t\t\trange.selectNodeContents(wysiwygBody);\n\n\t\t\tconst rect = range.getBoundingClientRect();\n\t\t\tconst current = wysiwygDocument.documentElement.clientHeight - 1;\n\t\t\tconst spaceNeeded = rect.bottom - rect.top;\n\t\t\tvar newHeight = base.height() + 1 + (spaceNeeded - current);\n\n\t\t\tif (!ignoreMaxHeight && autoExpandBounds.max !== -1) {\n\t\t\t\tnewHeight = Math.min(newHeight, autoExpandBounds.max);\n\t\t\t}\n\n\t\t\tbase.height(Math.ceil(Math.max(newHeight, autoExpandBounds.min)));\n\t\t};\n\n\t\t/**\n\t\t * Destroys the editor, removing all elements and\n\t\t * event handlers.\n\t\t *\n\t\t * Leaves only the original textarea.\n\t\t *\n\t\t * @function\n\t\t * @name destroy\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.destroy = function () {\n\t\t\t// Don't destroy if the editor has already been destroyed\n\t\t\tif (!pluginManager) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tpluginManager.destroy();\n\n\t\t\trangeHelper   = null;\n\t\t\tpluginManager = null;\n\n\t\t\tif (dropdown) {\n\t\t\t\tremove(dropdown);\n\t\t\t}\n\n\t\t\toff(globalDoc, 'click', handleDocumentClick);\n\n\t\t\tconst form = original.form;\n\t\t\tif (form) {\n\t\t\t\toff(form, 'reset', handleFormReset);\n\t\t\t\toff(form, 'submit', base.updateOriginal, EVENT_CAPTURE);\n\t\t\t}\n\n\t\t\toff(window, 'pagehide', base.updateOriginal);\n\t\t\toff(window, 'pageshow', handleFormReset);\n\t\t\tremove(sourceEditor);\n\t\t\tremove(toolbar);\n\t\t\tremove(editorContainer);\n\n\t\t\tdelete original._sceditor;\n\t\t\tshow(original);\n\n\t\t\toriginal.required = isRequired;\n\t\t};\n\n\n\t\t/**\n\t\t * Creates a menu item drop down\n\t\t *\n\t\t * @param  {HTMLElement} menuItem The button to align the dropdown with\n\t\t * @param  {string} name          Used for styling the dropdown, will be\n\t\t *                                a class sceditor-name\n\t\t * @param  {HTMLElement} content  The HTML content of the dropdown\n\t\t * @function\n\t\t * @name createDropDown\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.createDropDown = function (menuItem, name, content) {\n\t\t\t// first click for create second click for close\n\t\t\tvar\tdropDownCss;\n\t\t\tconst dropDownClass = 'sceditor-' + name;\n\n\t\t\tbase.closeDropDown();\n\n\t\t\t// Only close the dropdown if it was already open\n\t\t\tif (dropdown && hasClass(dropdown, dropDownClass)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdropDownCss = extend({\n\t\t\t\ttop: menuItem.offsetTop,\n\t\t\t\tleft: menuItem.parentElement.offsetLeft + menuItem.offsetLeft,\n\t\t\t\tmarginTop: menuItem.clientHeight\n\t\t\t},\n\t\t\toptions.dropDownCss);\n\n\t\t\tdropdown = createElement('div', {\n\t\t\t\tclassName: 'dropdown-menu show sceditor-dropdown ' + dropDownClass\n\t\t\t});\n\n\t\t\tcss(dropdown, dropDownCss);\n\t\t\tappendChild(dropdown, content);\n\t\t\tappendChild(editorContainer, dropdown);\n\t\t\ton(dropdown, 'click focusin', function (e) {\n\t\t\t\t// stop clicks within the dropdown from being handled\n\t\t\t\te.stopPropagation();\n\t\t\t});\n\n\t\t\tif (dropdown) {\n\t\t\t\tconst first = find(dropdown, 'input,textarea')[0];\n\t\t\t\tif (first) {\n\t\t\t\t\tfirst.focus();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Handles any document click and closes the dropdown if open\n\t\t * @private\n\t\t */\n\t\thandleDocumentClick = function (e) {\n\t\t\t// ignore right clicks\n\t\t\tif (e.which !== 3 && dropdown && !e.defaultPrevented) {\n\t\t\t\tautoUpdate();\n\n\t\t\t\tbase.closeDropDown();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Handles the WYSIWYG editors cut & copy events\n\t\t *\n\t\t * By default browsers also copy inherited styling from the stylesheet and\n\t\t * browser default styling which is unnecessary.\n\t\t *\n\t\t * This will ignore inherited styles and only copy inline styling.\n\t\t * @private\n\t\t */\n\t\thandleCutCopyEvt = function (e) {\n\t\t\tconst range = rangeHelper.selectedRange();\n\t\t\tif (range) {\n\t\t\t\tconst container = createElement('div', {}, wysiwygDocument);\n\t\t\t\tlet firstParent;\n\n\t\t\t\t// Copy all inline parent nodes up to the first block parent so can\n\t\t\t\t// copy inline styles\n\t\t\t\tlet parent = range.commonAncestorContainer;\n\t\t\t\twhile (parent && isInline(parent, true)) {\n\t\t\t\t\tif (parent.nodeType === ELEMENT_NODE) {\n\t\t\t\t\t\tconst clone = parent.cloneNode();\n\t\t\t\t\t\tif (container.firstChild) {\n\t\t\t\t\t\t\tappendChild(clone, container.firstChild);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tappendChild(container, clone);\n\t\t\t\t\t\tfirstParent = firstParent || clone;\n\t\t\t\t\t}\n\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t}\n\n\t\t\t\tappendChild(firstParent || container, range.cloneContents());\n\t\t\t\tremoveWhiteSpace(container);\n\n\t\t\t\te.clipboardData.setData('text/html', container.innerHTML);\n\n\t\t\t\t// TODO: Refactor into private shared module with plaintext plugin\n\t\t\t\t// innerText adds two newlines after <p> tags so convert them to\n\t\t\t\t// <div> tags\n\t\t\t\teach(find(container, 'p'), function (_, elm) {\n\t\t\t\t\tconvertElement(elm, 'div');\n\t\t\t\t});\n\t\t\t\t// Remove collapsed <br> tags as innerText converts them to newlines\n\t\t\t\teach(find(container, 'br'), function (_, elm) {\n\t\t\t\t\tif (!elm.nextSibling || !isInline(elm.nextSibling, true)) {\n\t\t\t\t\t\tremove(elm);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// range.toString() doesn't include newlines so can't use that.\n\t\t\t\t// selection.toString() seems to use the same method as innerText\n\t\t\t\t// but needs to be normalised first so using container.innerText\n\t\t\t\tappendChild(wysiwygBody, container);\n\t\t\t\te.clipboardData.setData('text/plain', container.innerText);\n\t\t\t\tremove(container);\n\n\t\t\t\tif (e.type === 'cut') {\n\t\t\t\t\trange.deleteContents();\n\t\t\t\t}\n\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Handles the WYSIWYG editors paste event\n\t\t * @private\n\t\t */\n\t\thandlePasteEvt = function (e) {\n\t\t\tvar editable = wysiwygBody;\n\t\t\tconst clipboard = e.clipboardData;\n\n\t\t\t// Modern browsers with clipboard API - everything other than _very_\n\t\t\t// old android web views and UC browser which doesn't support the\n\t\t\t// paste event at all.\n\t\t\tif (clipboard) {\n\t\t\t\tconst data = {};\n\t\t\t\tconst types = clipboard.types;\n\t\t\t\tconst items = clipboard.items;\n\n\t\t\t\tfor (let i = 0; i < types.length; i++) {\n\t\t\t\t\t// Word sometimes adds copied text as an image so if HTML\n\t\t\t\t\t// exists prefer that over images\n\t\t\t\t\tif (types.indexOf('text/html') < 0) {\n\t\t\t\t\t\t// Normalise image pasting to paste as a data-uri\n\t\t\t\t\t\tif (globalWin.FileReader && items &&\n\t\t\t\t\t\t\tIMAGE_MIME_REGEX.test(items[i].type)) {\n\t\t\t\t\t\t\tpluginManager.call('pasteHtml', items[i].getAsFile());\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tdata[types[i]] = clipboard.getData(types[i]);\n\t\t\t\t}\n\t\t\t\t// Call plugins here with file?\n\t\t\t\tdata.text = data['text/plain'];\n\t\t\t\tif (!options.enablePasteFiltering) {\n\t\t\t\t\tdata.html = sanitize(data['text/html']);\n\t\t\t\t}\n\n\t\t\t\thandlePasteData(data);\n\t\t\t// If contentsFragment exists then we are already waiting for a\n\t\t\t// previous paste so let the handler for that handle this one too\n\t\t\t} else if (!pasteContentFragment) {\n\t\t\t\t// Save the scroll position so can be restored\n\t\t\t\t// when contents is restored\n\t\t\t\tvar scrollTop = editable.scrollTop;\n\n\t\t\t\trangeHelper.saveRange();\n\n\t\t\t\tpasteContentFragment = globalDoc.createDocumentFragment();\n\t\t\t\twhile (editable.firstChild) {\n\t\t\t\t\tappendChild(pasteContentFragment, editable.firstChild);\n\t\t\t\t}\n\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\tconst html = editable.innerHTML;\n\n\t\t\t\t\teditable.innerHTML = '';\n\t\t\t\t\tappendChild(editable, pasteContentFragment);\n\t\t\t\t\teditable.scrollTop = scrollTop;\n\t\t\t\t\tpasteContentFragment = false;\n\n\t\t\t\t\trangeHelper.restoreRange();\n\n\t\t\t\t\thandlePasteData({ html: sanitize(html) });\n\t\t\t\t}, 0);\n\t\t\t}\n\n\t\t\te.preventDefault();\n\t\t};\n\n\t\t/**\n\t\t * Gets the pasted data, filters it and then inserts it.\n\t\t * @param {Object} data\n\t\t * @private\n\t\t */\n\t\thandlePasteData = function (data) {\n\t\t\tconst pasteArea = createElement('div', {}, wysiwygDocument);\n\n\t\t\tpluginManager.call('pasteRaw', data);\n\t\t\ttrigger(editorContainer, 'pasteraw', data);\n\n\t\t\tif (data.html) {\n\t\t\t\t// Sanitize again in case plugins modified the HTML\n\t\t\t\tpasteArea.innerHTML = sanitize(data.html);\n\n\t\t\t\t// fix any invalid nesting\n\t\t\t\tfixNesting(pasteArea);\n\t\t\t} else {\n\t\t\t\tpasteArea.innerHTML = entities(data.text || '');\n\t\t\t}\n\n\t\t\tconst paste = {\n\t\t\t\tval: pasteArea.innerHTML\n\t\t\t};\n\n\t\t\tif ('fragmentToSource' in format) {\n\t\t\t\tpaste.val = format\n\t\t\t\t\t.fragmentToSource(paste.val, wysiwygDocument, currentNode);\n\t\t\t}\n\n\t\t\tpluginManager.call('paste', paste);\n\t\t\ttrigger(editorContainer, 'paste', paste);\n\n\t\t\tif ('fragmentToHtml' in format) {\n\t\t\t\tpaste.val = format\n\t\t\t\t\t.fragmentToHtml(paste.val, currentNode);\n\t\t\t}\n\n\t\t\tpluginManager.call('pasteHtml', paste);\n\n\t\t\tconst parent = rangeHelper.getFirstBlockParent();\n\t\t\tbase.wysiwygEditorInsertHtml(paste.val, null, true);\n\n\t\t\tmerge(parent);\n\t\t};\n\n\t\t/**\n\t\t * Closes any currently open drop down\n\t\t *\n\t\t * @param {boolean} [focus=false] If to focus the editor\n\t\t *                             after closing the drop down\n\t\t * @function\n\t\t * @name closeDropDown\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.closeDropDown = function (focus) {\n\t\t\tif (dropdown) {\n\t\t\t\tremove(dropdown);\n\t\t\t\tdropdown = null;\n\t\t\t}\n\n\t\t\tif (focus === true) {\n\t\t\t\tbase.focus();\n\t\t\t}\n\t\t};\n\n\n\t\t/**\n\t\t * Inserts HTML into WYSIWYG editor.\n\t\t *\n\t\t * If endHtml is specified, any selected text will be placed\n\t\t * between html and endHtml. If there is no selected text html\n\t\t * and endHtml will just be concatenate together.\n\t\t *\n\t\t * @param {string} html\n\t\t * @param {string} [endHtml=null]\n\t\t * @param {boolean} [overrideCodeBlocking=false] If to insert the html\n\t\t *                                               into code tags, by\n\t\t *                                               default code tags only\n\t\t *                                               support text.\n\t\t * @function\n\t\t * @name wysiwygEditorInsertHtml\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.wysiwygEditorInsertHtml = function (\n\t\t\thtml, endHtml, overrideCodeBlocking\n\t\t) {\n\t\t\tvar\tmarker, scrollTop, scrollTo;\n\t\t\tconst editorHeight = height(wysiwygEditor);\n\n\t\t\tbase.focus();\n\n\t\t\t// TODO: This code tag should be configurable and\n\t\t\t// should maybe convert the HTML into text instead\n\t\t\t// Don't apply to code elements\n\t\t\tif (!overrideCodeBlocking && closest(currentBlockNode, 'code')) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Insert the HTML and save the range so the editor can be scrolled\n\t\t\t// to the end of the selection. Also allows emoticons to be replaced\n\t\t\t// without affecting the cursor position\n\t\t\trangeHelper.insertHTML(html, endHtml);\n\t\t\trangeHelper.saveRange();\n\n\t\t\t// Fix any invalid nesting, e.g. if a quote or other block is inserted\n\t\t\t// into a paragraph\n\t\t\tfixNesting(wysiwygBody);\n\n\t\t\twrapInlines(wysiwygBody, wysiwygDocument);\n\n\t\t\t// Scroll the editor after the end of the selection\n\t\t\tmarker   = find(wysiwygBody, '#sceditor-end-marker')[0];\n\t\t\tshow(marker);\n\t\t\tscrollTop = wysiwygBody.scrollTop;\n\t\t\tscrollTo  = (getOffset(marker).top +\n\t\t\t\t(marker.offsetHeight * 1.5)) - editorHeight;\n\t\t\thide(marker);\n\n\t\t\t// Only scroll if marker isn't already visible\n\t\t\tif (scrollTo > scrollTop || scrollTo + editorHeight < scrollTop) {\n\t\t\t\twysiwygBody.scrollTop = scrollTo;\n\t\t\t}\n\n\t\t\ttriggerValueChanged(false);\n\t\t\trangeHelper.restoreRange();\n\n\t\t\t// Add a new line after the last block element\n\t\t\t// so can always add text after it\n\t\t\tappendNewLine();\n\t\t};\n\n\t\t/**\n\t\t * Like wysiwygEditorInsertHtml except it will convert any HTML\n\t\t * into text before inserting it.\n\t\t *\n\t\t * @param {string} text\n\t\t * @param {string} [endText=null]\n\t\t * @function\n\t\t * @name wysiwygEditorInsertText\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.wysiwygEditorInsertText = function (text, endText) {\n\t\t\tbase.wysiwygEditorInsertHtml(\n\t\t\t\tentities(text), entities(endText)\n\t\t\t);\n\t\t};\n\n\t\t/**\n\t\t * Inserts text into the WYSIWYG or source editor depending on which\n\t\t * mode the editor is in.\n\t\t *\n\t\t * If endText is specified any selected text will be placed between\n\t\t * text and endText. If no text is selected text and endText will\n\t\t * just be concatenate together.\n\t\t *\n\t\t * @param {string} text\n\t\t * @param {string} [endText=null]\n\t\t * @since 1.3.5\n\t\t * @function\n\t\t * @name insertText\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.insertText = function (text, endText) {\n\t\t\tif (base.inSourceMode()) {\n\t\t\t\tbase.sourceEditorInsertText(text, endText);\n\t\t\t} else {\n\t\t\t\tbase.wysiwygEditorInsertText(text, endText);\n\t\t\t}\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Like wysiwygEditorInsertHtml but inserts text into the\n\t\t * source mode editor instead.\n\t\t *\n\t\t * If endText is specified any selected text will be placed between\n\t\t * text and endText. If no text is selected text and endText will\n\t\t * just be concatenate together.\n\t\t *\n\t\t * The cursor will be placed after the text param. If endText is\n\t\t * specified the cursor will be placed before endText, so passing:<br />\n\t\t *\n\t\t * '[b]', '[/b]'\n\t\t *\n\t\t * Would cause the cursor to be placed:<br />\n\t\t *\n\t\t * [b]Selected text|[/b]\n\t\t *\n\t\t * @param {string} text\n\t\t * @param {string} [endText=null]\n\t\t * @since 1.4.0\n\t\t * @function\n\t\t * @name sourceEditorInsertText\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.sourceEditorInsertText = function (text, endText) {\n\t\t\tvar scrollTop, currentValue;\n\t\t\tconst startPos = sourceEditor.selectionStart;\n\t\t\tconst endPos = sourceEditor.selectionEnd;\n\n\t\t\tscrollTop = sourceEditor.scrollTop;\n\t\t\tsourceEditor.focus();\n\t\t\tcurrentValue = sourceEditor.value;\n\n\t\t\tif (endText) {\n\t\t\t\ttext += currentValue.substring(startPos, endPos) + endText;\n\t\t\t}\n\n\t\t\tsourceEditor.value = currentValue.substring(0, startPos) +\n\t\t\t\ttext +\n\t\t\t\tcurrentValue.substring(endPos, currentValue.length);\n\n\t\t\tsourceEditor.selectionStart = (startPos + text.length) -\n\t\t\t\t(endText ? endText.length : 0);\n\t\t\tsourceEditor.selectionEnd = sourceEditor.selectionStart;\n\n\t\t\tsourceEditor.scrollTop = scrollTop;\n\t\t\tsourceEditor.focus();\n\n\t\t\ttriggerValueChanged();\n\t\t};\n\n\t\t/**\n\t\t * Gets the current instance of the rangeHelper class\n\t\t * for the editor.\n\t\t *\n\t\t * @return {RangeHelper}\n\t\t * @function\n\t\t * @name getRangeHelper\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.getRangeHelper = function () {\n\t\t\treturn rangeHelper;\n\t\t};\n\n\t\t/**\n\t\t * Gets or sets the source editor caret position.\n\t\t *\n\t\t * @param {Object} [position]\n\t\t * @return {this}\n\t\t * @function\n\t\t * @since 1.4.5\n\t\t * @name sourceEditorCaret\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.sourceEditorCaret = function (position) {\n\t\t\tsourceEditor.focus();\n\n\t\t\tif (position) {\n\t\t\t\tsourceEditor.selectionStart = position.start;\n\t\t\t\tsourceEditor.selectionEnd = position.end;\n\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tstart: sourceEditor.selectionStart,\n\t\t\t\tend: sourceEditor.selectionEnd\n\t\t\t};\n\t\t};\n\n\t\t/**\n\t\t * Gets the value of the editor.\n\t\t *\n\t\t * If the editor is in WYSIWYG mode it will return the filtered\n\t\t * HTML from it (converted to BBCode if using the BBCode plugin).\n\t\t * It it's in Source Mode it will return the unfiltered contents\n\t\t * of the source editor (if using the BBCode plugin this will be\n\t\t * BBCode again).\n\t\t *\n\t\t * @since 1.3.5\n\t\t * @return {string}\n\t\t * @function\n\t\t * @name val\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\t/**\n\t\t * Sets the value of the editor.\n\t\t *\n\t\t * If filter set true the val will be passed through the filter\n\t\t * function. If using the BBCode plugin it will pass the val to\n\t\t * the BBCode filter to convert any BBCode into HTML.\n\t\t *\n\t\t * @param {string} val\n\t\t * @param {boolean} [filter=true]\n\t\t * @return {this}\n\t\t * @since 1.3.5\n\t\t * @function\n\t\t * @name val^2\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.val = function (val, filter) {\n\t\t\tif (!isString(val)) {\n\t\t\t\treturn base.inSourceMode() ?\n\t\t\t\t\tbase.getSourceEditorValue(false) :\n\t\t\t\t\tbase.getWysiwygEditorValue(filter);\n\t\t\t}\n\n\t\t\tif (!base.inSourceMode()) {\n\t\t\t\tif (filter !== false && 'toHtml' in format) {\n\t\t\t\t\tval = format.toHtml(val);\n\t\t\t\t}\n\n\t\t\t\tbase.setWysiwygEditorValue(val);\n\t\t\t} else {\n\t\t\t\tbase.setSourceEditorValue(val);\n\t\t\t}\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Inserts HTML/BBCode into the editor\n\t\t *\n\t\t * If end is supplied any selected text will be placed between\n\t\t * start and end. If there is no selected text start and end\n\t\t * will be concatenate together.\n\t\t *\n\t\t * If the filter param is set to true, the HTML/BBCode will be\n\t\t * passed through any plugin filters. If using the BBCode plugin\n\t\t * this will convert any BBCode into HTML.\n\t\t *\n\t\t * @param {string} start\n\t\t * @param {string} [end=null]\n\t\t * @param {boolean} [filter=true]\n\t\t * @param {boolean} [convertEmoticons=true] If to convert emoticons\n\t\t * @return {this}\n\t\t * @since 1.3.5\n\t\t * @function\n\t\t * @name insert\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\t/**\n\t\t * Inserts HTML/BBCode into the editor\n\t\t *\n\t\t * If end is supplied any selected text will be placed between\n\t\t * start and end. If there is no selected text start and end\n\t\t * will be concatenate together.\n\t\t *\n\t\t * If the filter param is set to true, the HTML/BBCode will be\n\t\t * passed through any plugin filters. If using the BBCode plugin\n\t\t * this will convert any BBCode into HTML.\n\t\t *\n\t\t * If the allowMixed param is set to true, HTML any will not be\n\t\t * escaped\n\t\t *\n\t\t * @param {string} start\n\t\t * @param {string} [end=null]\n\t\t * @param {boolean} [filter=true]\n\t\t * @param {boolean} [convertEmoticons=true] If to convert emoticons\n\t\t * @param {boolean} [allowMixed=false]\n\t\t * @return {this}\n\t\t * @since 1.4.3\n\t\t * @function\n\t\t * @name insert^2\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\t// eslint-disable-next-line max-params\n\t\tbase.insert = function (\n\t\t\tstart, end, filter, convertEmoticons, allowMixed\n\t\t) {\n\t\t\tif (base.inSourceMode()) {\n\t\t\t\tbase.sourceEditorInsertText(start, end);\n\t\t\t\treturn base;\n\t\t\t}\n\n\t\t\t// Add the selection between start and end\n\t\t\tif (end) {\n\t\t\t\tlet html = rangeHelper.selectedHtml();\n\n\t\t\t\tif (filter !== false && 'fragmentToSource' in format) {\n\t\t\t\t\thtml = format\n\t\t\t\t\t\t.fragmentToSource(html, wysiwygDocument, currentNode);\n\t\t\t\t}\n\n\t\t\t\tstart += html + end;\n\t\t\t}\n\t\t\t// TODO: This filter should allow empty tags as it's inserting.\n\t\t\tif (filter !== false && 'fragmentToHtml' in format) {\n\t\t\t\tstart = format.fragmentToHtml(start, currentNode);\n\t\t\t}\n\n\t\t\t// Convert any escaped HTML back into HTML if mixed is allowed\n\t\t\tif (filter !== false && allowMixed === true) {\n\t\t\t\tstart = start.replace(/&lt;/g, '<')\n\t\t\t\t\t.replace(/&gt;/g, '>')\n\t\t\t\t\t.replace(/&amp;/g, '&');\n\t\t\t}\n\n\t\t\tbase.wysiwygEditorInsertHtml(start);\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Gets the WYSIWYG editors HTML value.\n\t\t *\n\t\t * If using a plugin that filters the Ht Ml like the BBCode plugin\n\t\t * it will return the result of the filtering (BBCode) unless the\n\t\t * filter param is set to false.\n\t\t *\n\t\t * @param {boolean} [filter=true]\n\t\t * @return {string}\n\t\t * @function\n\t\t * @name getWysiwygEditorValue\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.getWysiwygEditorValue = function (filter) {\n\t\t\tvar\thtml;\n\t\t\t// Create a tmp node to store contents so it can be modified\n\t\t\t// without affecting anything else.\n\t\t\tconst tmp = createElement('div', {}, wysiwygDocument);\n\t\t\tconst childNodes = wysiwygBody.childNodes;\n\n\t\t\tfor (let i = 0; i < childNodes.length; i++) {\n\t\t\t\tappendChild(tmp, childNodes[i].cloneNode(true));\n\t\t\t}\n\n\t\t\tappendChild(wysiwygBody, tmp);\n\t\t\tfixNesting(tmp);\n\t\t\tremove(tmp);\n\n\t\t\thtml = tmp.innerHTML;\n\n\t\t\t// filter the HTML and DOM through any plugins\n\t\t\tif (filter !== false && format.hasOwnProperty('toSource')) {\n\t\t\t\thtml = format.toSource(html, wysiwygDocument);\n\t\t\t}\n\n\t\t\treturn html;\n\t\t};\n\n\t\t/**\n\t\t * Gets the WYSIWYG editor's iFrame Body.\n\t\t *\n\t\t * @return {HTMLElement}\n\t\t * @function\n\t\t * @since 1.4.3\n\t\t * @name getBody\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.getBody = function () {\n\t\t\treturn wysiwygBody;\n\t\t};\n\n\t\t/**\n\t\t * Gets the WYSIWYG editors container area (whole iFrame).\n\t\t *\n\t\t * @return {HTMLElement}\n\t\t * @function\n\t\t * @since 1.4.3\n\t\t * @name getContentAreaContainer\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.getContentAreaContainer = function () {\n\t\t\treturn wysiwygEditor;\n\t\t};\n\n\t\t/**\n\t\t * Gets the text editor value\n\t\t *\n\t\t * If using a plugin that filters the text like the BBCode plugin\n\t\t * it will return the result of the filtering which is BBCode to\n\t\t * HTML so it will return HTML. If filter is set to false it will\n\t\t * just return the contents of the source editor (BBCode).\n\t\t *\n\t\t * @param {boolean} [filter=true]\n\t\t * @return {string}\n\t\t * @function\n\t\t * @since 1.4.0\n\t\t * @name getSourceEditorValue\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.getSourceEditorValue = function (filter) {\n\t\t\tvar val = sourceEditor.value;\n\n\t\t\tif (filter !== false && 'toHtml' in format) {\n\t\t\t\tval = format.toHtml(val);\n\t\t\t}\n\n\t\t\treturn val;\n\t\t};\n\n\t\tbase.getSourceEditor = function () {\n\t\t\treturn sourceEditor;\n\t\t};\n\n\t\t/**\n\t\t * Sets the WYSIWYG HTML editor value. Should only be the HTML\n\t\t * contained within the body tags\n\t\t *\n\t\t * @param {string} value\n\t\t * @function\n\t\t * @name setWysiwygEditorValue\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.setWysiwygEditorValue = function (value) {\n\t\t\tif (!value) {\n\t\t\t\tvalue = '<p><br /></p>';\n\t\t\t}\n\n\t\t\twysiwygBody.innerHTML = sanitize(value);\n\n\t\t\tappendNewLine();\n\t\t\ttriggerValueChanged();\n\t\t\tautoExpand();\n\t\t};\n\n\t\t/**\n\t\t * Sets the text editor value\n\t\t *\n\t\t * @param {string} value\n\t\t * @function\n\t\t * @name setSourceEditorValue\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.setSourceEditorValue = function (value) {\n\t\t\tsourceEditor.value = value;\n\n\t\t\ttriggerValueChanged();\n\t\t};\n\n\t\t/**\n\t\t * Updates the textarea that the editor is replacing\n\t\t * with the value currently inside the editor.\n\t\t *\n\t\t * @function\n\t\t * @name updateOriginal\n\t\t * @since 1.4.0\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.updateOriginal = function () {\n\t\t\toriginal.value = base.val();\n\t\t};\n\n\t\t/**\n\t\t * If the editor is in source code mode\n\t\t *\n\t\t * @return {boolean}\n\t\t * @function\n\t\t * @name inSourceMode\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.inSourceMode = function () {\n\t\t\treturn hasClass(editorContainer, 'sourceMode');\n\t\t};\n\n\t\t/**\n\t\t * Gets if the editor is in sourceMode\n\t\t *\n\t\t * @return boolean\n\t\t * @function\n\t\t * @name sourceMode\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\t/**\n\t\t * Sets if the editor is in sourceMode\n\t\t *\n\t\t * @param {boolean} enable\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name sourceMode^2\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.sourceMode = function (enable) {\n\t\t\tconst inSourceMode = base.inSourceMode();\n\n\t\t\tif (typeof enable !== 'boolean') {\n\t\t\t\treturn inSourceMode;\n\t\t\t}\n\n\t\t\tif ((inSourceMode && !enable) || (!inSourceMode && enable)) {\n\t\t\t\tbase.toggleSourceMode();\n\t\t\t}\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Switches between the WYSIWYG and source modes\n\t\t *\n\t\t * @function\n\t\t * @name toggleSourceMode\n\t\t * @since 1.4.0\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.toggleSourceMode = function () {\n\t\t\tconst isInSourceMode = base.inSourceMode();\n\n\t\t\t// don't allow switching to WYSIWYG if doesn't support it\n\t\t\tif (!isWysiwygSupported && isInSourceMode) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!isInSourceMode) {\n\t\t\t\trangeHelper.saveRange();\n\t\t\t\trangeHelper.clear();\n\t\t\t}\n\n\t\t\tcurrentSelection = null;\n\t\t\tbase.blur();\n\n\t\t\tif (isInSourceMode) {\n\t\t\t\tbase.setWysiwygEditorValue(base.getSourceEditorValue());\n\t\t\t} else {\n\t\t\t\tbase.setSourceEditorValue(base.getWysiwygEditorValue());\n\t\t\t}\n\n\t\t\ttoggle(sourceEditor);\n\t\t\ttoggle(wysiwygEditor);\n\n\t\t\ttoggleClass(editorContainer, 'wysiwygMode', isInSourceMode);\n\t\t\ttoggleClass(editorContainer, 'sourceMode', !isInSourceMode);\n\n\t\t\tupdateToolBar();\n\t\t\tupdateActiveButtons();\n\n\t\t\tif (base.opts.onToggleMode !== undefined) {\n\t\t\t\tbase.opts.onToggleMode(base);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Gets the selected text of the source editor\n\t\t * @return {string}\n\t\t * @private\n\t\t */\n\t\tsourceEditorSelectedText = function () {\n\t\t\tsourceEditor.focus();\n\n\t\t\treturn sourceEditor.value.substring(\n\t\t\t\tsourceEditor.selectionStart,\n\t\t\t\tsourceEditor.selectionEnd\n\t\t\t);\n\t\t};\n\n\t\t/**\n\t\t * Handles the passed command\n\t\t * @private\n\t\t */\n\t\thandleCommand = function (caller, cmd) {\n\t\t\t// check if in text mode and handle text commands\n\t\t\tif (base.inSourceMode()) {\n\t\t\t\tif (cmd.txtExec) {\n\t\t\t\t\tif (Array.isArray(cmd.txtExec)) {\n\t\t\t\t\t\tbase.sourceEditorInsertText.apply(base, cmd.txtExec);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcmd.txtExec.call(base, caller, sourceEditorSelectedText());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (cmd.exec) {\n\t\t\t\tif (isFunction(cmd.exec)) {\n\t\t\t\t\tcmd.exec.call(base, caller);\n\t\t\t\t} else {\n\t\t\t\t\tbase.execCommand(\n\t\t\t\t\t\tcmd.exec,\n\t\t\t\t\t\tcmd.hasOwnProperty('execParam') ? cmd.execParam : null\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t};\n\n\t\t/**\n\t\t * Executes a command on the WYSIWYG editor\n\t\t *\n\t\t * @param {string} command\n\t\t * @param {String|Boolean} [param]\n\t\t * @function\n\t\t * @name execCommand\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.execCommand = function (command, param) {\n\t\t\tvar\texecuted    = false;\n\t\t\tconst commandObj = base.commands[command];\n\n\t\t\tbase.focus();\n\n\t\t\t// TODO: make configurable\n\t\t\t// don't apply any commands to code elements\n\t\t\tif (closest(rangeHelper.parentNode(), 'code')) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\texecuted = wysiwygDocument.execCommand(command, false, param);\n\t\t\t} catch (_) { }\n\n\t\t\t// show error if execution failed and an error message exists\n\t\t\tif (!executed && commandObj && commandObj.errorMessage) {\n\t\t\t\t/*global alert:false*/\n\t\t\t\talert(base._(commandObj.errorMessage));\n\t\t\t}\n\n\t\t\tupdateActiveButtons();\n\t\t};\n\n\t\t/**\n\t\t * Checks if the current selection has changed and triggers\n\t\t * the selectionchanged event if it has.\n\t\t *\n\t\t * In browsers other that don't support selectionchange event it will check\n\t\t * at most once every 100ms.\n\t\t * @private\n\t\t */\n\t\tcheckSelectionChanged = function () {\n\t\t\tfunction check() {\n\t\t\t\t// Don't create new selection if there isn't one (like after\n\t\t\t\t// blur event in iOS)\n\t\t\t\tif (wysiwygWindow.getSelection() &&\n\t\t\t\t\twysiwygWindow.getSelection().rangeCount <= 0) {\n\t\t\t\t\tcurrentSelection = null;\n\t\t\t\t// rangeHelper could be null if editor was destroyed\n\t\t\t\t// before the timeout had finished\n\t\t\t\t} else if (rangeHelper && !rangeHelper.compare(currentSelection)) {\n\t\t\t\t\tcurrentSelection = rangeHelper.cloneSelected();\n\n\t\t\t\t\t// If the selection is in an inline wrap it in a block.\n\t\t\t\t\t// Fixes #331\n\t\t\t\t\tif (currentSelection && currentSelection.collapsed) {\n\t\t\t\t\t\tlet parent = currentSelection.startContainer;\n\t\t\t\t\t\tconst offset = currentSelection.startOffset;\n\n\t\t\t\t\t\t// Handle if selection is placed before/after an element\n\t\t\t\t\t\tif (offset && parent.nodeType !== TEXT_NODE) {\n\t\t\t\t\t\t\tparent = parent.childNodes[offset];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\twhile (parent && parent.parentNode !== wysiwygBody) {\n\t\t\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (parent && isInline(parent, true)) {\n\t\t\t\t\t\t\trangeHelper.saveRange();\n\t\t\t\t\t\t\twrapInlines(wysiwygBody, wysiwygDocument);\n\t\t\t\t\t\t\trangeHelper.restoreRange();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\ttrigger(editorContainer, 'selectionchanged');\n\t\t\t\t}\n\n\t\t\t\tisSelectionCheckPending = false;\n\t\t\t}\n\n\t\t\tif (isSelectionCheckPending) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tisSelectionCheckPending = true;\n\n\t\t\t// Don't need to limit checking if browser supports the Selection API\n\t\t\tif ('onselectionchange' in wysiwygDocument) {\n\t\t\t\tcheck();\n\t\t\t} else {\n\t\t\t\tsetTimeout(check, 100);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Checks if the current node has changed and triggers\n\t\t * the nodechanged event if it has\n\t\t * @private\n\t\t */\n\t\tcheckNodeChanged = function () {\n\t\t\t// check if node has changed\n\t\t\tvar\toldNode;\n\t\t\tconst node = rangeHelper.parentNode();\n\n\t\t\tif (currentNode !== node) {\n\t\t\t\toldNode          = currentNode;\n\t\t\t\tcurrentNode      = node;\n\t\t\t\tcurrentBlockNode = rangeHelper.getFirstBlockParent(node);\n\n\t\t\t\ttrigger(editorContainer, 'nodechanged', {\n\t\t\t\t\toldNode: oldNode,\n\t\t\t\t\tnewNode: currentNode\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (backSpaceHandled) {\n\t\t\t\tcurrentBlockNode.querySelectorAll('span[style]').forEach(span => {\n\t\t\t\t\tif (span) {\n\t\t\t\t\t\tspan.outerHTML = span.innerHTML;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tbackSpaceHandled = false;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Gets the current node that contains the selection/caret in\n\t\t * WYSIWYG mode.\n\t\t *\n\t\t * Will be null in sourceMode or if there is no selection.\n\t\t *\n\t\t * @return {?Node}\n\t\t * @function\n\t\t * @name currentNode\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase.currentNode = function () {\n\t\t\treturn currentNode;\n\t\t};\n\n\t\t/**\n\t\t * Gets the first block level node that contains the\n\t\t * selection/caret in WYSIWYG mode.\n\t\t *\n\t\t * Will be null in sourceMode or if there is no selection.\n\t\t *\n\t\t * @return {?Node}\n\t\t * @function\n\t\t * @name currentBlockNode\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.4\n\t\t */\n\t\tbase.currentBlockNode = function () {\n\t\t\treturn currentBlockNode;\n\t\t};\n\n\t\t/**\n\t\t * Updates if buttons are active or not\n\t\t * @private\n\t\t */\n\t\tupdateActiveButtons = function () {\n\t\t\tvar firstBlock, parent;\n\t\t\tvar activeClass = 'active';\n\t\t\tconst doc = wysiwygDocument;\n\t\t\tconst isSource = base.sourceMode();\n\n\t\t\tif (base.readOnly()) {\n\t\t\t\teach(find(toolbar, activeClass), function (_, menuItem) {\n\t\t\t\t\tremoveClass(menuItem, activeClass);\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!isSource) {\n\t\t\t\tparent     = rangeHelper.parentNode();\n\t\t\t\tfirstBlock = rangeHelper.getFirstBlockParent(parent);\n\t\t\t}\n\n\t\t\tfor (let j = 0; j < btnStateHandlers.length; j++) {\n\t\t\t\tlet state = 0;\n\t\t\t\tconst btn = toolbarButtons[btnStateHandlers[j].name];\n\t\t\t\tconst stateFn = btnStateHandlers[j].state;\n\t\t\t\tconst isDisabled = (isSource && !btn._sceTxtMode) ||\n\t                (!isSource && !btn._sceWysiwygMode);\n\n\t\t\t\tif (isString(stateFn)) {\n\t\t\t\t\tif (!isSource) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tstate = doc.queryCommandEnabled(stateFn) ? 0 : -1;\n\n\t\t\t\t\t\t\t// eslint-disable-next-line max-depth\n\t\t\t\t\t\t\tif (state > -1) {\n\t\t\t\t\t\t\t\tstate = doc.queryCommandState(stateFn) ? 1 : 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (_) {}\n\t\t\t\t\t}\n\t\t\t\t} else if (!isDisabled) {\n\t\t\t\t\tstate = stateFn.call(base, parent, firstBlock);\n\t\t\t\t}\n\n\t\t\t\ttoggleClass(btn, 'disabled', isDisabled || state < 0);\n\t\t\t\ttoggleClass(btn, activeClass, state > 0);\n\t\t\t}\n\n\t\t\tif (icons && icons.update) {\n\t\t\t\ticons.update(isSource, parent, firstBlock);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Handles any key press in the WYSIWYG editor\n\t\t *\n\t\t * @private\n\t\t */\n\t\thandleKeyPress = function (e) {\n\t\t\t// FF bug: https://bugzilla.mozilla.org/show_bug.cgi?id=501496\n\t\t\tif (e.defaultPrevented) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbase.closeDropDown();\n\n\t\t\t// 13 = enter key\n\t\t\tif (e.which === 13) {\n\t\t\t\tconst LIST_TAGS = 'li,ul,ol';\n\n\t\t\t\t// \"Fix\" (cludge) for blocklevel elements being duplicated in some\n\t\t\t\t// browsers when enter is pressed instead of inserting a newline\n\t\t\t\tif (!is(currentBlockNode, LIST_TAGS) &&\n\t\t\t\t\thasStyling(currentBlockNode)) {\n\n\t\t\t\t\tconst br = createElement('br', {}, wysiwygDocument);\n\t\t\t\t\trangeHelper.insertNode(br);\n\n\t\t\t\t\t// Last <br> of a block will be collapsed  so need to make sure\n\t\t\t\t\t// the <br> that was inserted isn't the last node of a block.\n\t\t\t\t\tconst parent = br.parentNode;\n\t\t\t\t\tlet lastChild = parent.lastChild;\n\n\t\t\t\t\t// Sometimes an empty next node is created after the <br>\n\t\t\t\t\tif (lastChild && lastChild.nodeType === TEXT_NODE &&\n\t\t\t\t\t\tlastChild.nodeValue === '') {\n\t\t\t\t\t\tremove(lastChild);\n\t\t\t\t\t\tlastChild = parent.lastChild;\n\t\t\t\t\t}\n\n\t\t\t\t\t// If this is the last BR of a block and the previous\n\t\t\t\t\t// sibling is inline then will need an extra BR. This\n\t\t\t\t\t// is needed because the last BR of a block will be\n\t\t\t\t\t// collapsed. Fixes issue #248\n\t\t\t\t\tif (!isInline(parent, true) && lastChild === br &&\n\t\t\t\t\t\tisInline(br.previousSibling)) {\n\t\t\t\t\t\trangeHelper.insertHTML('<br>');\n\t\t\t\t\t}\n\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Makes sure that if there is a code or quote tag at the\n\t\t * end of the editor, that there is a new line after it.\n\t\t *\n\t\t * If there wasn't a new line at the end you wouldn't be able\n\t\t * to enter any text after a code/quote tag\n\t\t * @return {void}\n\t\t * @private\n\t\t */\n\t\tappendNewLine = function () {\n\t\t\t// Check all nodes in reverse until either add a new line\n\t\t\t// or reach a non-empty textnode or BR at which point can\n\t\t\t// stop checking.\n\t\t\trTraverse(wysiwygBody, function (node) {\n\t\t\t\t// Last block, add new line after if has styling\n\t\t\t\tif (node.nodeType === ELEMENT_NODE &&\n\t\t\t\t\t!/inline/.test(css(node, 'display'))) {\n\n\t\t\t\t\t// Add line break after if has styling\n\t\t\t\t\tif (!is(node, '.sceditor-nlf') && hasStyling(node)) {\n\t\t\t\t\t\tconst paragraph = createElement('p', {}, wysiwygDocument);\n\t\t\t\t\t\tparagraph.className = 'sceditor-nlf';\n\t\t\t\t\t\tparagraph.innerHTML = '<br />';\n\t\t\t\t\t\tappendChild(wysiwygBody, paragraph);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Last non-empty text node or line break.\n\t\t\t\t// No need to add line-break after them\n\t\t\t\tif ((node.nodeType === 3 && !/^\\s*$/.test(node.nodeValue)) ||\n\t\t\t\t\tis(node, 'br')) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Handles form reset event\n\t\t * @private\n\t\t */\n\t\thandleFormReset = function () {\n\t\t\tbase.val(original.value);\n\t\t};\n\n\t\t/**\n\t\t * Handles any mousedown press in the WYSIWYG editor\n\t\t * @private\n\t\t */\n\t\thandleMouseDown = function () {\n\t\t\tbase.closeDropDown();\n\t\t};\n\n\t\t/**\n\t\t * Translates the string into the locale language.\n\t\t *\n\t\t * Replaces any {0}, {1}, {2}, ect. with the params provided.\n\t\t *\n\t\t * @param {string} str\n\t\t * @param {...String} args\n\t\t * @return {string}\n\t\t * @function\n\t\t * @name _\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\tbase._ = function () {\n\t\t\tvar\tundef,\n\t\t\t\targs = arguments;\n\n\t\t\tif (locale && locale[args[0]]) {\n\t\t\t\targs[0] = locale[args[0]];\n\t\t\t} else {\n\t\t\t\tif (options.locale !== 'en') {\n\t\t\t\t\t/*(async () => {\n\t\t\t\t\t//var translatedText = await translateText(args[0], 'zh-tw');\n\t\t\t\t\t//console.log(`'${args[0]}': '${translatedText}',`);\n\t\t\t\t    })();*/\n\n\t\t\t\t\tconsole.info(`translation for '${args[0]}' is missing for locale '${options.locale}'`);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn args[0].replace(/\\{(\\d+)\\}/g, function (str, p1) {\n\t\t\t\treturn args[p1 - 0 + 1] !== undef ?\n\t\t\t\t\targs[p1 - 0 + 1] :\n\t\t\t\t\t`{${p1}}`;\n\t\t\t});\n\t\t};\n\n\t\t/*async function translateText(text, targetLang) {\n\t\t\ttry {\n\t\t\t\tconst url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${targetLang}&dt=t&q=${encodeURIComponent(text)}`;\n\n\t\t\t\tconst res = await fetch(url);\n\t\t\t\tif (!res.ok) {\n\t\t\t\t\tthrow new Error(`HTTP error! Status: ${res.status}`);\n\t\t\t\t}\n\n\t\t\t\tconst data = await res.json();\n\n\t\t\t\t// Extract translated text\n\t\t\t\tif (Array.isArray(data) && data[0] && Array.isArray(data[0][0])) {\n\t\t\t\t\treturn data[0].map(sentence => sentence[0]).join(' ');\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('Unexpected response format');\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Translation failed:', error.message);\n\t\t\t\treturn 'Error during translation.';\n\t\t\t}\n\t\t}*/\n\n\n\t\t/**\n\t\t * Passes events on to any handlers\n\t\t * @private\n\t\t * @return void\n\t\t */\n\t\thandleEvent = function (e) {\n\t\t\tif (pluginManager) {\n\t\t\t\t// Send event to all plugins\n\t\t\t\tpluginManager.call(e.type + 'Event', e, base);\n\t\t\t}\n\n\t\t\t// convert the event into a custom event to send\n\t\t\tconst name = (e.target === sourceEditor ? 'scesrc' : 'scewys') + e.type;\n\n\t\t\tif (eventHandlers[name]) {\n\t\t\t\teventHandlers[name].forEach(function (fn) {\n\t\t\t\t\tfn.call(base, e);\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Binds a handler to the specified events\n\t\t *\n\t\t * This function only binds to a limited list of\n\t\t * supported events.\n\t\t *\n\t\t * The supported events are:\n\t\t *\n\t\t * * keyup\n\t\t * * keydown\n\t\t * * Keypress\n\t\t * * blur\n\t\t * * focus\n\t\t * * input\n\t\t * * nodechanged - When the current node containing\n\t\t * \t\tthe selection changes in WYSIWYG mode\n\t\t * * contextmenu\n\t\t * * selectionchanged\n\t\t * * valuechanged\n\t\t *\n\t\t *\n\t\t * The events param should be a string containing the event(s)\n\t\t * to bind this handler to. If multiple, they should be separated\n\t\t * by spaces.\n\t\t *\n\t\t * @param  {string} events\n\t\t * @param  {Function} handler\n\t\t * @param  {boolean} excludeWysiwyg If to exclude adding this handler\n\t\t *                                  to the WYSIWYG editor\n\t\t * @param  {boolean} excludeSource  if to exclude adding this handler\n\t\t *                                  to the source editor\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name bind\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.1\n\t\t */\n\t\tbase.bind = function (events, handler, excludeWysiwyg, excludeSource) {\n\t\t\tevents = events.split(' ');\n\n\t\t\tvar i  = events.length;\n\t\t\twhile (i--) {\n\t\t\t\tif (isFunction(handler)) {\n\t\t\t\t\tconst wysEvent = 'scewys' + events[i];\n\t\t\t\t\tconst srcEvent = 'scesrc' + events[i];\n\t\t\t\t\t// Use custom events to allow passing the instance as the\n\t\t\t\t\t// 2nd argument.\n\t\t\t\t\t// Also allows unbinding without unbinding the editors own\n\t\t\t\t\t// event handlers.\n\t\t\t\t\tif (!excludeWysiwyg) {\n\t\t\t\t\t\teventHandlers[wysEvent] = eventHandlers[wysEvent] || [];\n\t\t\t\t\t\teventHandlers[wysEvent].push(handler);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!excludeSource) {\n\t\t\t\t\t\teventHandlers[srcEvent] = eventHandlers[srcEvent] || [];\n\t\t\t\t\t\teventHandlers[srcEvent].push(handler);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Start sending value changed events\n\t\t\t\t\tif (events[i] === 'valuechanged') {\n\t\t\t\t\t\ttriggerValueChanged.hasHandler = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Unbinds an event that was bound using bind().\n\t\t *\n\t\t * @param  {string} events\n\t\t * @param  {Function} handler\n\t\t * @param  {boolean} excludeWysiwyg If to exclude unbinding this\n\t\t *                                  handler from the WYSIWYG editor\n\t\t * @param  {boolean} excludeSource  if to exclude unbinding this\n\t\t *                                  handler from the source editor\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name unbind\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.1\n\t\t * @see bind\n\t\t */\n\t\tbase.unbind = function (events, handler, excludeWysiwyg, excludeSource) {\n\t\t\tevents = events.split(' ');\n\n\t\t\tvar i  = events.length;\n\t\t\twhile (i--) {\n\t\t\t\tif (isFunction(handler)) {\n\t\t\t\t\tif (!excludeWysiwyg) {\n\t\t\t\t\t\tarrayRemove(\n\t\t\t\t\t\t\teventHandlers['scewys' + events[i]] || [], handler);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!excludeSource) {\n\t\t\t\t\t\tarrayRemove(\n\t\t\t\t\t\t\teventHandlers['scesrc' + events[i]] || [], handler);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Blurs the editors input area\n\t\t *\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name blur\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.3.6\n\t\t */\n\t\t/**\n\t\t * Adds a handler to the editors blur event\n\t\t *\n\t\t * @param  {Function} handler\n\t\t * @param  {boolean} excludeWysiwyg If to exclude adding this handler\n\t\t *                                  to the WYSIWYG editor\n\t\t * @param  {boolean} excludeSource  if to exclude adding this handler\n\t\t *                                  to the source editor\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name blur^2\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.1\n\t\t */\n\t\tbase.blur = function (handler, excludeWysiwyg, excludeSource) {\n\t\t\tif (isFunction(handler)) {\n\t\t\t\tbase.bind('blur', handler, excludeWysiwyg, excludeSource);\n\t\t\t} else if (!base.sourceMode()) {\n\t\t\t\twysiwygBody.blur();\n\t\t\t} else {\n\t\t\t\tsourceEditor.blur();\n\t\t\t}\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Focuses the editors input area\n\t\t *\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name focus\n\t\t * @memberOf SCEditor.prototype\n\t\t */\n\t\t/**\n\t\t * Adds an event handler to the focus event\n\t\t *\n\t\t * @param  {Function} handler\n\t\t * @param  {boolean} excludeWysiwyg If to exclude adding this handler\n\t\t *                                  to the WYSIWYG editor\n\t\t * @param  {boolean} excludeSource  if to exclude adding this handler\n\t\t *                                  to the source editor\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name focus^2\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.1\n\t\t */\n\t\tbase.focus = function (handler, excludeWysiwyg, excludeSource) {\n\t\t\tif (isFunction(handler)) {\n\t\t\t\tbase.bind('focus', handler, excludeWysiwyg, excludeSource);\n\t\t\t} else if (!base.inSourceMode()) {\n\t\t\t\t// Already has focus so do nothing\n\t\t\t\tif (find(wysiwygDocument, ':focus').length) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst rng = rangeHelper.selectedRange();\n\n\t\t\t\t// Fix FF bug where it shows the cursor in the wrong place\n\t\t\t\t// if the editor hasn't had focus before. See issue #393\n\t\t\t\tif (!currentSelection) {\n\t\t\t\t\tautofocus(true);\n\t\t\t\t}\n\n\t\t\t\t// Check if cursor is set after a BR when the BR is the only\n\t\t\t\t// child of the parent. In Firefox this causes a line break\n\t\t\t\t// to occur when something is typed. See issue #321\n\t\t\t\tif (rng && rng.endOffset === 1 && rng.collapsed) {\n\t\t\t\t\tlet container;\n\t\t\t\t\tcontainer = rng.endContainer;\n\n\t\t\t\t\tif (container && container.childNodes.length === 1 &&\n\t\t\t\t\t\tis(container.firstChild, 'br')) {\n\t\t\t\t\t\trng.setStartBefore(container.firstChild);\n\t\t\t\t\t\trng.collapse(true);\n\t\t\t\t\t\trangeHelper.selectRange(rng);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\twysiwygWindow.focus();\n\t\t\t\twysiwygBody.focus();\n\t\t\t} else {\n\t\t\t\tsourceEditor.focus();\n\t\t\t}\n\n\t\t\tupdateActiveButtons();\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Adds a handler to the key down event\n\t\t *\n\t\t * @param  {Function} handler\n\t\t * @param  {boolean} excludeWysiwyg If to exclude adding this handler\n\t\t *                                  to the WYSIWYG editor\n\t\t * @param  {boolean} excludeSource  If to exclude adding this handler\n\t\t *                                  to the source editor\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name keyDown\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.1\n\t\t */\n\t\tbase.keyDown = function (handler, excludeWysiwyg, excludeSource) {\n\t\t\treturn base.bind('keydown', handler, excludeWysiwyg, excludeSource);\n\t\t};\n\n\t\t/**\n\t\t * Adds a handler to the key press event\n\t\t *\n\t\t * @param  {Function} handler\n\t\t * @param  {boolean} excludeWysiwyg If to exclude adding this handler\n\t\t *                                  to the WYSIWYG editor\n\t\t * @param  {boolean} excludeSource  If to exclude adding this handler\n\t\t *                                  to the source editor\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name keyPress\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.1\n\t\t */\n\t\tbase.keyPress = function (handler, excludeWysiwyg, excludeSource) {\n\t\t\treturn base\n\t\t\t\t.bind('keypress', handler, excludeWysiwyg, excludeSource);\n\t\t};\n\n\t\t/**\n\t\t * Adds a handler to the key up event\n\t\t *\n\t\t * @param  {Function} handler\n\t\t * @param  {boolean} excludeWysiwyg If to exclude adding this handler\n\t\t *                                  to the WYSIWYG editor\n\t\t * @param  {boolean} excludeSource  If to exclude adding this handler\n\t\t *                                  to the source editor\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name keyUp\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.1\n\t\t */\n\t\tbase.keyUp = function (handler, excludeWysiwyg, excludeSource) {\n\t\t\treturn base.bind('keyup', handler, excludeWysiwyg, excludeSource);\n\t\t};\n\n\t\t/**\n\t\t * Adds a handler to the node changed event.\n\t\t *\n\t\t * Happens whenever the node containing the selection/caret\n\t\t * changes in WYSIWYG mode.\n\t\t *\n\t\t * @param  {Function} handler\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name nodeChanged\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.1\n\t\t */\n\t\tbase.nodeChanged = function (handler) {\n\t\t\treturn base.bind('nodechanged', handler, false, true);\n\t\t};\n\n\t\t/**\n\t\t * Adds a handler to the selection changed event\n\t\t *\n\t\t * Happens whenever the selection changes in WYSIWYG mode.\n\t\t *\n\t\t * @param  {Function} handler\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name selectionChanged\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.1\n\t\t */\n\t\tbase.selectionChanged = function (handler) {\n\t\t\treturn base.bind('selectionchanged', handler, false, true);\n\t\t};\n\n\t\t/**\n\t\t * Adds a handler to the value changed event\n\t\t *\n\t\t * Happens whenever the current editor value changes.\n\t\t *\n\t\t * Whenever anything is inserted, the value changed or\n\t\t * 1.5 secs after text is typed. If a space is typed it will\n\t\t * cause the event to be triggered immediately instead of\n\t\t * after 1.5 seconds\n\t\t *\n\t\t * @param  {Function} handler\n\t\t * @param  {boolean} excludeWysiwyg If to exclude adding this handler\n\t\t *                                  to the WYSIWYG editor\n\t\t * @param  {boolean} excludeSource  If to exclude adding this handler\n\t\t *                                  to the source editor\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name valueChanged\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.5\n\t\t */\n\t\tbase.valueChanged = function (handler, excludeWysiwyg, excludeSource) {\n\t\t\treturn base\n\t\t\t\t.bind('valuechanged', handler, excludeWysiwyg, excludeSource);\n\t\t};\n\n\t\t/**\n\t\t * Gets the current WYSIWYG editors inline CSS\n\t\t *\n\t\t * @return {string}\n\t\t * @function\n\t\t * @name css\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.3\n\t\t */\n\t\t/**\n\t\t * Sets inline CSS for the WYSIWYG editor\n\t\t *\n\t\t * @param {string} css\n\t\t * @return {this}\n\t\t * @function\n\t\t * @name css^2\n\t\t * @memberOf SCEditor.prototype\n\t\t * @since 1.4.3\n\t\t */\n\t\tbase.css = function (css) {\n\t\t\tif (!inlineCss) {\n\t\t\t\tinlineCss = createElement('style', {\n\t\t\t\t\tid: 'inline'\n\t\t\t\t}, wysiwygDocument);\n\n\t\t\t\tappendChild(wysiwygDocument.head, inlineCss);\n\t\t\t}\n\n\t\t\tif (!isString(css)) {\n\t\t\t\treturn inlineCss.styleSheet ?\n\t\t\t\t\tinlineCss.styleSheet.cssText : inlineCss.innerHTML;\n\t\t\t}\n\n\t\t\tif (inlineCss.styleSheet) {\n\t\t\t\tinlineCss.styleSheet.cssText = css;\n\t\t\t} else {\n\t\t\t\tinlineCss.innerHTML = css;\n\t\t\t}\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Handles the keydown event, used for shortcuts\n\t\t * @private\n\t\t */\n\t\thandleKeyDown = function (e) {\n\t\t\tvar autoClosingTags = [\n\t\t\t\t'b', 'i', 'u', 'h', 'code', 'img', 'quote', 'left', 'center', 'right',\n\t\t\t\t'list', 'color',\n\t\t\t\t'size', 'albumimg', 'attach', 'youtube', 'vimeo',\n\t\t\t\t'instagram', 'twitter', 'facebook', 'googlewidget', 'spoiler', 'userlink', 'googlemaps',\n\t\t\t\t'hide', 'group-hide', 'hide-thanks', 'hide-reply-thanks', 'hide-reply', 'hide-posts', 'dailymotion',\n\t\t\t\t'audio', 'media','note'\n\t\t\t];\n\n\t\t\tvar\tshortcut   = [],\n\t\t\t\tSHIFT_KEYS = {\n\t\t\t\t\t'`': '~',\n\t\t\t\t\t'1': '!',\n\t\t\t\t\t'2': '@',\n\t\t\t\t\t'3': '#',\n\t\t\t\t\t'4': '$',\n\t\t\t\t\t'5': '%',\n\t\t\t\t\t'6': '^',\n\t\t\t\t\t'7': '&',\n\t\t\t\t\t'8': '*',\n\t\t\t\t\t'9': '(',\n\t\t\t\t\t'0': ')',\n\t\t\t\t\t'-': '_',\n\t\t\t\t\t'=': '+',\n\t\t\t\t\t';': ': ',\n\t\t\t\t\t'\\'': '\"',\n\t\t\t\t\t',': '<',\n\t\t\t\t\t'.': '>',\n\t\t\t\t\t'/': '?',\n\t\t\t\t\t'\\\\': '|',\n\t\t\t\t\t'[': '{',\n\t\t\t\t\t']': '}'\n\t\t\t\t},\n\t\t\t\tSPECIAL_KEYS = {\n\t\t\t\t\t8: 'backspace',\n\t\t\t\t\t9: 'tab',\n\t\t\t\t\t13: 'enter',\n\t\t\t\t\t19: 'pause',\n\t\t\t\t\t20: 'capslock',\n\t\t\t\t\t27: 'esc',\n\t\t\t\t\t32: 'space',\n\t\t\t\t\t33: 'pageup',\n\t\t\t\t\t34: 'pagedown',\n\t\t\t\t\t35: 'end',\n\t\t\t\t\t36: 'home',\n\t\t\t\t\t37: 'left',\n\t\t\t\t\t38: 'up',\n\t\t\t\t\t39: 'right',\n\t\t\t\t\t40: 'down',\n\t\t\t\t\t45: 'insert',\n\t\t\t\t\t46: 'del',\n\t\t\t\t\t91: 'win',\n\t\t\t\t\t92: 'win',\n\t\t\t\t\t93: 'select',\n\t\t\t\t\t96: '0',\n\t\t\t\t\t97: '1',\n\t\t\t\t\t98: '2',\n\t\t\t\t\t99: '3',\n\t\t\t\t\t100: '4',\n\t\t\t\t\t101: '5',\n\t\t\t\t\t102: '6',\n\t\t\t\t\t103: '7',\n\t\t\t\t\t104: '8',\n\t\t\t\t\t105: '9',\n\t\t\t\t\t106: '*',\n\t\t\t\t\t107: '+',\n\t\t\t\t\t109: '-',\n\t\t\t\t\t110: '.',\n\t\t\t\t\t111: '/',\n\t\t\t\t\t112: 'f1',\n\t\t\t\t\t113: 'f2',\n\t\t\t\t\t114: 'f3',\n\t\t\t\t\t115: 'f4',\n\t\t\t\t\t116: 'f5',\n\t\t\t\t\t117: 'f6',\n\t\t\t\t\t118: 'f7',\n\t\t\t\t\t119: 'f8',\n\t\t\t\t\t120: 'f9',\n\t\t\t\t\t121: 'f10',\n\t\t\t\t\t122: 'f11',\n\t\t\t\t\t123: 'f12',\n\t\t\t\t\t144: 'numlock',\n\t\t\t\t\t145: 'scrolllock',\n\t\t\t\t\t186: ';',\n\t\t\t\t\t187: '=',\n\t\t\t\t\t188: ',',\n\t\t\t\t\t189: '-',\n\t\t\t\t\t190: '.',\n\t\t\t\t\t191: '/',\n\t\t\t\t\t192: '`',\n\t\t\t\t\t219: '[',\n\t\t\t\t\t220: '\\\\',\n\t\t\t\t\t221: ']',\n\t\t\t\t\t222: '\\''\n\t\t\t\t},\n\t\t\t\tNUMPAD_SHIFT_KEYS = {\n\t\t\t\t\t109: '-',\n\t\t\t\t\t110: 'del',\n\t\t\t\t\t111: '/',\n\t\t\t\t\t96: '0',\n\t\t\t\t\t97: '1',\n\t\t\t\t\t98: '2',\n\t\t\t\t\t99: '3',\n\t\t\t\t\t100: '4',\n\t\t\t\t\t101: '5',\n\t\t\t\t\t102: '6',\n\t\t\t\t\t103: '7',\n\t\t\t\t\t104: '8',\n\t\t\t\t\t105: '9'\n\t\t\t\t},\n\t\t\t\twhich     = e.which,\n\t\t\t\tcharacter = SPECIAL_KEYS[which] ||\n\t\t\t\t\tString.fromCharCode(which).toLowerCase();\n\n\t\t\tif (e.ctrlKey || e.metaKey) {\n\t\t\t\tshortcut.push('ctrl');\n\t\t\t}\n\n\t\t\tif (e.altKey) {\n\t\t\t\tshortcut.push('alt');\n\t\t\t}\n\n\t\t\tif (e.shiftKey) {\n\t\t\t\tshortcut.push('shift');\n\n\t\t\t\tif (NUMPAD_SHIFT_KEYS[which]) {\n\t\t\t\t\tcharacter = NUMPAD_SHIFT_KEYS[which];\n\t\t\t\t} else if (SHIFT_KEYS[character]) {\n\t\t\t\t\tcharacter = SHIFT_KEYS[character];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Shift is 16, ctrl is 17 and alt is 18\n\t\t\tif (character && (which < 16 || which > 18)) {\n\t\t\t\tshortcut.push(character);\n\t\t\t}\n\n\t\t\tshortcut = shortcut.join('+');\n\t\t\tif (shortcutHandlers[shortcut] &&\n\t\t\t\tshortcutHandlers[shortcut].call(base) === false) {\n\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\t}\n\n\t\t\t// Close tag ']'\n\t\t\tif (e.key === ']' && base.inSourceMode()) {\n\t\t\t\tvar input = sourceEditor;\n\n\t\t\t\tconst position = input.selectionStart;\n\t\t\t\tconst before = input.value.slice(0, position);\n\t\t\t\tconst after = input.value.slice(input.selectionEnd, input.value.length);\n\t\t\t\tlet tagName;\n\n\t\t\t\ttry {\n\t\t\t\t\ttagName = before.match(/\\[([^\\]]+)$/)[1].match(/^([a-z1-6]+)/)[1];\n\t\t\t\t} catch (_) {\n\t\t\t\t\t// ignore\n\t\t\t\t}\n\n\t\t\t\tif (autoClosingTags.indexOf(tagName) > -1) {\n\t\t\t\t\tconst closeTag = `[/${tagName}]`;\n\n\t\t\t\t\tinput.value = before + closeTag + after;\n\t\t\t\t\tinput.selectionStart =\n\t\t\t\t\t\tinput.selectionEnd = position;\n\t\t\t\t\tinput.focus();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Adds a shortcut handler to the editor\n\t\t * @param  {string}          shortcut\n\t\t * @param  {String|Function} cmd\n\t\t * @return {sceditor}\n\t\t */\n\t\tbase.addShortcut = function (shortcut, cmd) {\n\t\t\tshortcut = shortcut.toLowerCase();\n\n\t\t\tif (isString(cmd)) {\n\t\t\t\tshortcutHandlers[shortcut] = function () {\n\t\t\t\t\thandleCommand(toolbarButtons[cmd], base.commands[cmd]);\n\n\t\t\t\t\treturn false;\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tshortcutHandlers[shortcut] = cmd;\n\t\t\t}\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Removes a shortcut handler\n\t\t * @param  {string} shortcut\n\t\t * @return {sceditor}\n\t\t */\n\t\tbase.removeShortcut = function (shortcut) {\n\t\t\tdelete shortcutHandlers[shortcut.toLowerCase()];\n\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Handles the backspace key press\n\t\t *\n\t\t * Will remove block styling like quotes/code ect if at the start.\n\t\t * @private\n\t\t */\n\t\thandleBackSpace = function (e) {\n\t\t\tvar node, offset, range, parent;\n\n\t\t\t// 8 is the backspace key\n\t\t\tif (e.which !== 8) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbackSpaceHandled = true;\n\n\t\t\tif (options.disableBlockRemove ||\n\t\t\t\t!(range = rangeHelper.selectedRange())) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tnode   = range.startContainer;\n\t\t\toffset = range.startOffset;\n\n\t\t\tif (offset !== 0 || !(parent = currentStyledBlockNode()) ||\n\t\t\t\tis(parent, 'body')) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twhile (node !== parent) {\n\t\t\t\twhile (node.previousSibling) {\n\t\t\t\t\tnode = node.previousSibling;\n\n\t\t\t\t\t// Everything but empty text nodes before the cursor\n\t\t\t\t\t// should prevent the style from being removed\n\t\t\t\t\tif (node.nodeType !== TEXT_NODE || node.nodeValue) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!(node = node.parentNode)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// The backspace was pressed at the start of\n\t\t\t// the container so clear the style\n\t\t\tbase.clearBlockFormatting(parent);\n\t\t\te.preventDefault();\n\t\t};\n\n\t\t/**\n\t\t * Gets the first styled block node that contains the cursor\n\t\t * @return {HTMLElement}\n\t\t */\n\t\tcurrentStyledBlockNode = function () {\n\t\t\tvar block = currentBlockNode;\n\n\t\t\twhile (!hasStyling(block) || isInline(block, true)) {\n\t\t\t\tif (!(block = block.parentNode) || is(block, 'body')) {\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn block;\n\t\t};\n\n\t\t/**\n\t\t * Clears the formatting of the passed block element.\n\t\t *\n\t\t * If block is false, if will clear the styling of the first\n\t\t * block level element that contains the cursor.\n\t\t * @param  {HTMLElement} block\n\t\t * @since 1.4.4\n\t\t */\n\t\tbase.clearBlockFormatting = function (block) {\n\t\t\tblock = block || currentStyledBlockNode();\n\n\t\t\tif (!block || is(block, 'body')) {\n\t\t\t\treturn base;\n\t\t\t}\n\n\t\t\trangeHelper.saveRange();\n\n\t\t\tblock.className = '';\n\n\t\t\tattr(block, 'style', '');\n\n\t\t\tif (!is(block, 'p,div,td')) {\n\t\t\t\tconvertElement(block, 'p');\n\t\t\t}\n\n\t\t\trangeHelper.restoreRange();\n\t\t\treturn base;\n\t\t};\n\n\t\t/**\n\t\t * Triggers the valueChanged signal if there is\n\t\t * a plugin that handles it.\n\t\t *\n\t\t * If rangeHelper.saveRange() has already been\n\t\t * called, then saveRange should be set to false\n\t\t * to prevent the range being saved twice.\n\t\t *\n\t\t * @since 1.4.5\n\t\t * @param {boolean} saveRange If to call rangeHelper.saveRange().\n\t\t * @private\n\t\t */\n\t\ttriggerValueChanged = function (saveRange) {\n\t\t\tif (!pluginManager ||\n\t\t\t\t(!pluginManager.hasHandler('valuechangedEvent') &&\n\t\t\t\t\t!triggerValueChanged.hasHandler)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar\tcurrentHtml;\n\t\t\tconst sourceMode = base.sourceMode();\n\t\t\tconst hasSelection = !sourceMode && rangeHelper.hasSelection();\n\n\t\t\t// Composition end isn't guaranteed to fire but must have\n\t\t\t// ended when triggerValueChanged() is called so reset it\n\t\t\tisComposing = false;\n\n\t\t\t// Don't need to save the range if sceditor-start-marker\n\t\t\t// is present as the range is already saved\n\t\t\tsaveRange = saveRange !== false &&\n\t\t\t\t!wysiwygDocument.getElementById('sceditor-start-marker');\n\n\t\t\t// Clear any current timeout as it's now been triggered\n\t\t\tif (valueChangedKeyUpTimer) {\n\t\t\t\tclearTimeout(valueChangedKeyUpTimer);\n\t\t\t\tvalueChangedKeyUpTimer = false;\n\t\t\t}\n\n\t\t\tif (hasSelection && saveRange) {\n\t\t\t\trangeHelper.saveRange();\n\t\t\t}\n\n\t\t\tcurrentHtml = sourceMode ? sourceEditor.value : wysiwygBody.innerHTML;\n\n\t\t\t// Only trigger if something has actually changed.\n\t\t\tif (currentHtml !== triggerValueChanged.lastVal) {\n\t\t\t\ttriggerValueChanged.lastVal = currentHtml;\n\n\t\t\t\ttrigger(editorContainer, 'valuechanged', {\n\t\t\t\t\trawValue: sourceMode ? base.val() : currentHtml\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (hasSelection && saveRange) {\n\t\t\t\trangeHelper.removeMarkers();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Should be called whenever there is a blur event\n\t\t * @private\n\t\t */\n\t\tvalueChangedBlur = function () {\n\t\t\tif (valueChangedKeyUpTimer) {\n\t\t\t\ttriggerValueChanged();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Should be called whenever there is a keypress event\n\t\t * @param  {Event} e The keypress event\n\t\t * @private\n\t\t */\n\t\tvalueChangedKeyUp = function (e) {\n\t\t\tconst which = e.which;\n\t\t\tconst lastChar = valueChangedKeyUp.lastChar;\n\t\t\tconst lastWasSpace = (lastChar === 13 || lastChar === 32);\n\t\t\tconst lastWasDelete = (lastChar === 8 || lastChar === 46);\n\n\t\t\tvalueChangedKeyUp.lastChar = which;\n\n\t\t\tif (isComposing) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// 13 = return & 32 = space\n\t\t\tif (which === 13 || which === 32) {\n\t\t\t\tif (!lastWasSpace) {\n\t\t\t\t\ttriggerValueChanged();\n\t\t\t\t} else {\n\t\t\t\t\tvalueChangedKeyUp.triggerNext = true;\n\t\t\t\t}\n\t\t\t// 8 = backspace & 46 = del\n\t\t\t} else if (which === 8 || which === 46) {\n\t\t\t\tif (!lastWasDelete) {\n\t\t\t\t\ttriggerValueChanged();\n\t\t\t\t} else {\n\t\t\t\t\tvalueChangedKeyUp.triggerNext = true;\n\t\t\t\t}\n\t\t\t} else if (valueChangedKeyUp.triggerNext) {\n\t\t\t\ttriggerValueChanged();\n\t\t\t\tvalueChangedKeyUp.triggerNext = false;\n\t\t\t}\n\n\t\t\t// Clear the previous timeout and set a new one.\n\t\t\tclearTimeout(valueChangedKeyUpTimer);\n\n\t\t\t// Trigger the event 1.5s after the last keypress if space\n\t\t\t// isn't pressed. This might need to be lowered, will need\n\t\t\t// to look into what the slowest average Chars Per Min is.\n\t\t\tvalueChangedKeyUpTimer = setTimeout(function () {\n\t\t\t\tif (!isComposing) {\n\t\t\t\t\ttriggerValueChanged();\n\t\t\t\t}\n\t\t\t}, 1500);\n\t\t};\n\n\t\thandleComposition = function (e) {\n\t\t\tisComposing = /start/i.test(e.type);\n\n\t\t\tif (!isComposing) {\n\t\t\t\ttriggerValueChanged();\n\t\t\t}\n\t\t};\n\n\t\tautoUpdate = function () {\n\t\t\tbase.updateOriginal();\n\t\t};\n\n\t\t// run the initializer\n\t\tloadScripts();\n\t}\n\n\t/**\n\t * Map containing the loaded SCEditor locales\n\t * @type {Object}\n\t * @name locale\n\t * @memberOf sceditor\n\t */\n\tSCEditor.locale = {};\n\n\tSCEditor.formats = {};\n\tSCEditor.icons = {};\n\n\n\t/**\n\t * Static command helper class\n\t * @class command\n\t * @name sceditor.command\n\t */\n\tSCEditor.command =\n\t/** @lends sceditor.command */\n\t{\n\t\t/**\n\t\t * Gets a command\n\t\t *\n\t\t * @param {string} name\n\t\t * @return {Object|null}\n\t\t * @since v1.3.5\n\t\t */\n\t\tget: function (name) {\n\t\t\treturn defaultCmds[name] || null;\n\t\t},\n\n\t\t/**\n\t\t * <p>Adds a command to the editor or updates an existing\n\t\t * command if a command with the specified name already exists.</p>\n\t\t *\n\t\t * <p>Once a command is add it can be included in the toolbar by\n\t\t * adding it's name to the toolbar option in the constructor. It\n\t\t * can also be executed manually by calling\n\t\t * {@link sceditor.execCommand}</p>\n\t\t *\n\t\t * @example\n\t\t * SCEditor.command.set(\"hello\",\n\t\t * {\n\t\t *     exec: function () {\n\t\t *         alert(\"Hello World!\");\n\t\t *     }\n\t\t * });\n\t\t *\n\t\t * @param {string} name\n\t\t * @param {Object} cmd\n\t\t * @return {this|false} Returns false if name or cmd is false\n\t\t * @since v1.3.5\n\t\t */\n\t\tset: function (name, cmd) {\n\t\t\tif (!name || !cmd) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// merge any existing command properties\n\t\t\tcmd = extend(defaultCmds[name] || {}, cmd);\n\n\t\t\tcmd.remove = function () {\n\t\t\t\tSCEditor.command.remove(name);\n\t\t\t};\n\n\t\t\tdefaultCmds[name] = cmd;\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Removes a command\n\t\t *\n\t\t * @param {string} name\n\t\t * @return {this}\n\t\t * @since v1.3.5\n\t\t */\n\t\tremove: function (name) {\n\t\t\tif (defaultCmds[name]) {\n\t\t\t\tdelete defaultCmds[name];\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\t};\n\n\t/**\n\t * SCEditor\n\t * http://www.sceditor.com/\n\t *\n\t * Copyright (C) 2011-2025, Sam Clarke (samclarke.com)\n\t *\n\t * SCEditor is licensed under the MIT license:\n\t *\thttp://www.opensource.org/licenses/mit-license.php\n\t *\n\t * @fileoverview SCEditor - A lightweight WYSIWYG BBCode and HTML editor\n\t * @author Sam Clarke\n\t */\n\n\n\twindow.sceditor = {\n\t\tcommand: SCEditor.command,\n\t\tcommands: defaultCmds,\n\t\tdefaultOptions: defaultOptions,\n\n\t\tios: ios,\n\t\tisWysiwygSupported: isWysiwygSupported,\n\n\t\tregexEscape: regex,\n\t\tescapeEntities: entities,\n\t\tescapeUriScheme: uriScheme,\n\n\t\tdom: {\n\t\t\tcss: css,\n\t\t\tattr: attr,\n\t\t\tremoveAttr: removeAttr,\n\t\t\tis: is,\n\t\t\tclosest: closest,\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\ttraverse: traverse,\n\t\t\trTraverse: rTraverse,\n\t\t\tparseHTML: parseHTML,\n\t\t\thasStyling: hasStyling,\n\t\t\tconvertElement: convertElement,\n\t\t\tblockLevelList: blockLevelList,\n\t\t\tcanHaveChildren: canHaveChildren,\n\t\t\tisInline: isInline,\n\t\t\tcopyCSS: copyCSS,\n\t\t\tfixNesting: fixNesting,\n\t\t\tfindCommonAncestor: findCommonAncestor,\n\t\t\tgetSibling: getSibling,\n\t\t\tremoveWhiteSpace: removeWhiteSpace,\n\t\t\textractContents: extractContents,\n\t\t\tgetOffset: getOffset,\n\t\t\tgetStyle: getStyle,\n\t\t\thasStyle: hasStyle\n\t\t},\n\t\tlocale: SCEditor.locale,\n\t\ticons: SCEditor.icons,\n\t\tutils: {\n\t\t\teach: each,\n\t\t\tisEmptyObject: isEmptyObject,\n\t\t\textend: extend\n\t\t},\n\t\tplugins: PluginManager.plugins,\n\t\tformats: SCEditor.formats,\n\t\tcreate: function (textarea, options) {\n\t\t\toptions = options || {};\n\n\t\t\t// Don't allow the editor to be initialised\n\t\t\t// on it's own source editor\n\t\t\tif (parent(textarea, '.sceditor-container')) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (options.runWithoutWysiwygSupport || isWysiwygSupported) {\n\t\t\t\t/*eslint no-new: off*/\n\t\t\t\t(new SCEditor(textarea, options));\n\t\t\t}\n\t\t},\n\t\tinstance: function (textarea) {\n\t\t\treturn textarea._sceditor;\n\t\t}\n\t};\n\n})();\n","/**\n * SCEditor BBCode Plugin\n * http://www.sceditor.com/\n *\n * Copyright (C) 2011-2025, Sam Clarke (samclarke.com)\n *\n * SCEditor is licensed under the MIT license:\n *\thttp://www.opensource.org/licenses/mit-license.php\n *\n * @fileoverview SCEditor BBCode Format\n * @author Sam Clarke\n */\n(function (sceditor) {\n\t/*eslint max-depth: off*/\n\t'use strict';\n\n\tvar escapeEntities = sceditor.escapeEntities;\n\tvar escapeUriScheme = sceditor.escapeUriScheme;\n\tvar dom = sceditor.dom;\n\tvar utils = sceditor.utils;\n\n\tvar css = dom.css;\n\tvar attr = dom.attr;\n\tvar is = dom.is;\n\tvar extend = utils.extend;\n\tvar each = utils.each;\n\n\tvar editorOptions;\n\n\tvar getEditorCommand = sceditor.command.get;\n\n\tvar QuoteType = {\n\t\t/** @lends BBCodeParser.QuoteType */\n\t\t/**\n\t\t * Always quote the attribute value\n\t\t * @type {Number}\n\t\t */\n\t\talways: 1,\n\n\t\t/**\n\t\t * Never quote the attributes value\n\t\t * @type {Number}\n\t\t */\n\t\tnever: 2,\n\n\t\t/**\n\t\t * Only quote the attributes value when it contains spaces to equals\n\t\t * @type {Number}\n\t\t */\n\t\tauto: 3\n\t};\n\n\tvar defaultCommandsOverrides = {\n\t\tbold: {\n\t\t\ttxtExec: ['[b]', '[/b]']\n\t\t},\n\t\titalic: {\n\t\t\ttxtExec: ['[i]', '[/i]']\n\t\t},\n\t\tunderline: {\n\t\t\ttxtExec: ['[u]', '[/u]']\n\t\t},\n\t\tstrike: {\n\t\t\ttxtExec: ['[s]', '[/s]']\n\t\t},\n\t\tmark: {\n\t\t\ttxtExec: ['[h]', '[/h]']\n\t\t},\n\t\tleft: {\n\t\t\ttxtExec: ['[left]', '[/left]']\n\t\t},\n\t\tcenter: {\n\t\t\ttxtExec: ['[center]', '[/center]']\n\t\t},\n\t\tright: {\n\t\t\ttxtExec: ['[right]', '[/right]']\n\t\t},\n\t\tjustify: {\n\t\t\ttxtExec: ['[justify]', '[/justify]']\n\t\t},\n\t\tfont: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('font')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (fontName) {\n\t\t\t\t\t\teditor.insertText(\n\t\t\t\t\t\t\t`[font=${fontName}]`,\n\t\t\t\t\t\t\t'[/font]'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tsize: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('size')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (fontSize) {\n\t\t\t\t\t\teditor.insertText(\n\t\t\t\t\t\t\t`[size=${fontSize}]`,\n\t\t\t\t\t\t\t'[/size]'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tcolor: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('color')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (color) {\n\t\t\t\t\t\teditor.insertText(\n\t\t\t\t\t\t\t`[color=${color}]`,\n\t\t\t\t\t\t\t'[/color]'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tbulletlist: {\n\t\t\ttxtExec: function (caller, selected) {\n\t\t\t\tthis.insertText(\n\t\t\t\t\t`[list]\\n[list]${selected.split(/\\r?\\n/).join('[/li]\\n[li]')}[/li]\\n[/ul]`\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\torderedlist: {\n\t\t\ttxtExec: function (caller, selected) {\n\t\t\t\tthis.insertText(\n\t\t\t\t\t`[list=I]\\n[li]${selected.split(/\\r?\\n/).join('[/li]\\n[li]')}[/li]\\n[/list]`\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\ttable: {\n\t\t\ttxtExec: ['[table][tr][td]', '[/td][/tr][/table]']\n\t\t},\n\t\tcode: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('code')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (language) {\n\t\t\t\t\t\teditor.insertText(\n\t\t\t\t\t\t\t`[code=${language}]`,\n\t\t\t\t\t\t\t'[/code]'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tnote: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('note')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (type) {\n\t\t\t\t\t\teditor.insertText(\n\t\t\t\t\t\t\t`[note=${type}]`,\n\t\t\t\t\t\t\t'[/note]'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\textensions: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('extensions')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (extension) {\n\t\t\t\t\t\teditor.insertText(\n\t\t\t\t\t\t\t`[${extension}]`,\n\t\t\t\t\t\t\t`[/${extension}]`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\timage: {\n\t\t\ttxtExec: function (caller, selected) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('image')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url, text) {\n\t\t\t\t\t\tif (text || selected) {\n\t\t\t\t\t\t\teditor.insertText(\n\t\t\t\t\t\t\t\t`[img=${url}]${text || selected || url}[/img]`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\teditor.insertText(`[img]${url}[/img]`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\temail: {\n\t\t\ttxtExec: function (caller, selected) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('email')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url, text) {\n\t\t\t\t\t\teditor.insertText(\n\t\t\t\t\t\t\t`[email=${url}]${text || selected || url}[/email]`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tlink: {\n\t\t\ttxtExec: function (caller, selected) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('link')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url, text) {\n\t\t\t\t\t\tif (selected || text) {\n\t\t\t\t\t\t\teditor.insertText(\n\t\t\t\t\t\t\t\t`[url=${url}]${text || selected || url}[/url]`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\teditor.insertText(`[url]${url}[/url]`);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tquote: {\n\t\t\ttxtExec: ['[quote]', '[/quote]']\n\t\t},\n\n\t\tuserlink: {\n\t\t\ttxtExec: ['[userlink]', '[/userlink]']\n\t\t},\n\t\talbums: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('albums')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url) {\n\t\t\t\t\t\teditor.insertText(`[albumid]${url}[/albumid]`);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tattachments: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('attachments')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url) {\n\t\t\t\t\t\teditor.insertText(`[attach]${url}[/attach]`);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tmedia: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('media')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url) {\n\t\t\t\t\t\teditor.insertText(`[media]${url}[/media]`);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tvimeo: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('vimeo')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url) {\n\t\t\t\t\t\teditor.insertText(`[vimeo]${url}[/vimeo]`);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tinstagram: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('instagram')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url) {\n\t\t\t\t\t\teditor.insertText(`[instagram]${url}[/instagram]`);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tfacebook: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('facebook')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url) {\n\t\t\t\t\t\teditor.insertText(`[facebook]${url}[/facebook]`);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\tyoutube: {\n\t\t\ttxtExec: function (caller) {\n\t\t\t\tvar editor = this;\n\n\t\t\t\tgetEditorCommand('youtube')._dropDown(\n\t\t\t\t\teditor,\n\t\t\t\t\tcaller,\n\t\t\t\t\tfunction (url) {\n\t\t\t\t\t\teditor.insertText(`[youtube]${url}[/youtube]`);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t};\n\n\tvar bbcodeHandlers = {\n\t\t// START_COMMAND: Bold\n\t\tb: {\n\t\t\ttags: {\n\t\t\t\tb: null,\n\t\t\t\tstrong: null\n\t\t\t},\n\t\t\tstyles: {\n\t\t\t\t// 401 is for FF 3.5\n\t\t\t\t'font-weight': ['bold', 'bolder', '401', '700', '800', '900']\n\t\t\t},\n\t\t\tformat: '[b]{0}[/b]',\n\t\t\thtml: '<strong>{0}</strong>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Italic\n\t\ti: {\n\t\t\ttags: {\n\t\t\t\ti: null,\n\t\t\t\tem: null\n\t\t\t},\n\t\t\tstyles: {\n\t\t\t\t'font-style': ['italic', 'oblique']\n\t\t\t},\n\t\t\tformat: '[i]{0}[/i]',\n\t\t\thtml: '<em>{0}</em>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Underline\n\t\tu: {\n\t\t\ttags: {\n\t\t\t\tu: null\n\t\t\t},\n\t\t\tstyles: {\n\t\t\t\t'text-decoration': ['underline']\n\t\t\t},\n\t\t\tformat: '[u]{0}[/u]',\n\t\t\thtml: '<u>{0}</u>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Strikethrough\n\t\ts: {\n\t\t\ttags: {\n\t\t\t\ts: null,\n\t\t\t\tstrike: null\n\t\t\t},\n\t\t\tstyles: {\n\t\t\t\t'text-decoration': ['line-through']\n\t\t\t},\n\t\t\tformat: '[s]{0}[/s]',\n\t\t\thtml: '<s>{0}</s>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Subscript\n\t\tsub: {\n\t\t\ttags: {\n\t\t\t\tsub: null\n\t\t\t},\n\t\t\tformat: '[sub]{0}[/sub]',\n\t\t\thtml: '<sub>{0}</sub>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Superscript\n\t\tsup: {\n\t\t\ttags: {\n\t\t\t\tsup: null\n\t\t\t},\n\t\t\tformat: '[sup]{0}[/sup]',\n\t\t\thtml: '<sup>{0}</sup>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: mark\n\t\th: {\n\t\t\ttags: {\n\t\t\t\th: null,\n\t\t\t\tmark: null\n\t\t\t},\n\t\t\tformat: '[h]{0}[/h]',\n\t\t\thtml: '<mark>{0}</mark>'\n\t\t},\n\t\t// END_COMMAND\n\n\n\t\t// START_COMMAND: Font\n\t\tfont: {\n\t\t\ttags: {\n\t\t\t\tfont: {\n\t\t\t\t\tface: null\n\t\t\t\t}\n\t\t\t},\n\t\t\tstyles: {\n\t\t\t\t'font-family': null\n\t\t\t},\n\t\t\tquoteType: QuoteType.never,\n\t\t\tformat: function (element, content) {\n\t\t\t\tvar font;\n\n\t\t\t\tif (!is(element, 'font') || !(font = attr(element, 'face'))) {\n\t\t\t\t\tfont = css(element, 'font-family');\n\t\t\t\t}\n\n\t\t\t\treturn `[font=${_stripQuotes(font)}]${content}[/font]`;\n\t\t\t},\n\t\t\thtml: '<font face=\"{defaultattr}\">{0}</font>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Size\n\t\tsize: {\n\t\t\ttags: {\n\t\t\t\tfont: {\n\t\t\t\t\tsize: null\n\t\t\t\t}\n\t\t\t},\n\t\t\tstyles: {\n\t\t\t\t'font-size': null\n\t\t\t},\n\t\t\tformat: function (element, content) {\n\t\t\t\tvar fontSize = attr(element, 'size'),\n\t\t\t\t\tsize = 2;\n\n\t\t\t\tif (!fontSize) {\n\t\t\t\t\tfontSize = css(element, 'fontSize');\n\t\t\t\t}\n\n\t\t\t\t// Most browsers return px value but IE returns 1-7\n\t\t\t\tif (fontSize.indexOf('px') > -1) {\n\t\t\t\t\t// convert size to an int\n\t\t\t\t\tfontSize = fontSize.replace('px', '') - 0;\n\n\t\t\t\t\tif (fontSize < 12) {\n\t\t\t\t\t\tsize = 1;\n\t\t\t\t\t}\n\t\t\t\t\tif (fontSize > 15) {\n\t\t\t\t\t\tsize = 3;\n\t\t\t\t\t}\n\t\t\t\t\tif (fontSize > 17) {\n\t\t\t\t\t\tsize = 4;\n\t\t\t\t\t}\n\t\t\t\t\tif (fontSize > 23) {\n\t\t\t\t\t\tsize = 5;\n\t\t\t\t\t}\n\t\t\t\t\tif (fontSize > 31) {\n\t\t\t\t\t\tsize = 6;\n\t\t\t\t\t}\n\t\t\t\t\tif (fontSize > 47) {\n\t\t\t\t\t\tsize = 7;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tsize = fontSize;\n\t\t\t\t}\n\n\t\t\t\treturn `[size=${size}]${content}[/size]`;\n\t\t\t},\n\t\t\thtml: '<font size=\"{defaultattr}\">{!0}</font>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Color\n\t\tcolor: {\n\t\t\ttags: {\n\t\t\t\tfont: {\n\t\t\t\t\tcolor: null\n\t\t\t\t}\n\t\t\t},\n\t\t\tstyles: {\n\t\t\t\tcolor: null\n\t\t\t},\n\t\t\tquoteType: QuoteType.never,\n\t\t\tformat: function (elm, content) {\n\t\t\t\tvar color;\n\n\t\t\t\tif (!is(elm, 'font') || !(color = attr(elm, 'color'))) {\n\t\t\t\t\tcolor = elm.style.color || css(elm, 'color');\n\t\t\t\t}\n\n\t\t\t\treturn `[color=${_normaliseColour(color)}]${content}[/color]`;\n\t\t\t},\n\t\t\thtml: function (token, attrs, content) {\n\t\t\t\treturn `<font color=\"${escapeEntities(_normaliseColour(attrs.defaultattr), true)}\">${content}</font>`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Lists\n\t\tul: {\n\t\t\ttags: {\n\t\t\t\tul: null\n\t\t\t},\n\t\t\tbreakStart: true,\n\t\t\tisInline: false,\n\t\t\tskipLastLineBreak: true,\n\t\t\tformat: '[list]{0}[/list]',\n\t\t\thtml: '<ul>{0}</ul>'\n\t\t},\n\t\tlist: {\n\t\t\tbreakStart: true,\n\t\t\tisInline: false,\n\t\t\tskipLastLineBreak: true,\n\t\t\tformat: '[list]{0}[/list]',\n\t\t\thtml: '<ul>{0}</ul>'\n\t\t},\n\t\tol: {\n\t\t\ttags: {\n\t\t\t\tol: null\n\t\t\t},\n\t\t\tbreakStart: true,\n\t\t\tisInline: false,\n\t\t\tskipLastLineBreak: true,\n\t\t\tformat: '[list=I]{0}[/list]',\n\t\t\thtml: '<ol>{0}</ol>'\n\t\t},\n\t\tli: {\n\t\t\ttags: {\n\t\t\t\tli: null\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tclosedBy: ['/ul', '/ol', '/list', '*', 'li'],\n\t\t\tformat: '[li]{0}[/li]',\n\t\t\thtml: '<li>{0}</li>'\n\t\t},\n\t\t'*': {\n\t\t\tisInline: false,\n\t\t\tclosedBy: ['/ul', '/ol', '/list', '*', 'li'],\n\t\t\thtml: '<li>{0}</li>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Table\n\t\ttable: {\n\t\t\ttags: {\n\t\t\t\ttable: null\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tisHtmlInline: true,\n\t\t\tskipLastLineBreak: true,\n\t\t\tformat: '[table]{0}[/table]',\n\t\t\thtml: '<table class=\"table\">{0}</table>'\n\t\t},\n\t\ttr: {\n\t\t\ttags: {\n\t\t\t\ttr: null\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tskipLastLineBreak: true,\n\t\t\tformat: '[tr]{0}[/tr]',\n\t\t\thtml: '<tr>{0}</tr>'\n\t\t},\n\t\tth: {\n\t\t\ttags: {\n\t\t\t\tth: null\n\t\t\t},\n\t\t\tallowsEmpty: true,\n\t\t\tisInline: false,\n\t\t\tformat: '[th]{0}[/th]',\n\t\t\thtml: '<th>{0}</th>'\n\t\t},\n\t\ttd: {\n\t\t\ttags: {\n\t\t\t\ttd: null\n\t\t\t},\n\t\t\tallowsEmpty: true,\n\t\t\tisInline: false,\n\t\t\tformat: '[td]{0}[/td]',\n\t\t\thtml: '<td class=\"border\">{0}</td>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Horizontal Rule\n\t\thr: {\n\t\t\ttags: {\n\t\t\t\thr: null\n\t\t\t},\n\t\t\tallowsEmpty: true,\n\t\t\tisSelfClosing: true,\n\t\t\tisInline: false,\n\t\t\tformat: '[hr]{0}',\n\t\t\thtml: '<hr />'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Image\n\t\timg: {\n\t\t\tallowsEmpty: true,\n\t\t\ttags: {\n\t\t\t\timg: {\n\t\t\t\t\tsrc: null,\n\t\t\t\t\tclass: 'img-user-posted img-thumbnail'\n\t\t\t\t}\n\t\t\t},\n\t\t\tallowedChildren: ['#'],\n\t\t\tquoteType: QuoteType.never,\n\t\t\tformat: function (element) {\n\t\t\t\tvar desc;\n\n\t\t\t\tdesc = attr(element, 'alt');\n\n\t\t\t\tif (desc) {\n\t\t\t\t\treturn `[img=${attr(element, 'src')}]${desc}[/img]`;\n\t\t\t\t}\n\n\t\t\t\treturn `[img]${attr(element, 'src')}[/img]`;\n\t\t\t},\n\t\t\thtml: function (token, attrs, content) {\n\t\t\t\tattrs.defaultattr =\n\t\t\t\t\tescapeEntities(attrs.defaultattr, true) || content;\n\n\t\t\t\treturn `<img src=\"${escapeUriScheme(attrs.defaultattr)}\" alt=\"${content\n\t\t\t\t}\" class=\"img-user-posted img-thumbnail\" />`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: userlink\n\t\tuserlink: {\n\t\t\tallowsEmpty: true,\n\t\t\ttags: {\n\t\t\t\tspan: {\n\t\t\t\t\tclass: 'badge rounded-pill text-bg-secondary fs-6'\n\t\t\t\t}\n\t\t\t},\n\t\t\tformat: function (element) {\n\t\t\t\treturn `[userlink]${attr(element, 'data-user')}[/userlink]`;\n\t\t\t},\n\t\t\thtml: function (token, attrs, content) {\n\n\t\t\t\treturn `<span class=\"badge rounded-pill text-bg-secondary fs-6\" data-user=\"${escapeEntities(content)\n\t\t\t\t}\">${escapeEntities(content)}</span>`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: albumimg\n\t\talbumimg: {\n\t\t\tallowsEmpty: true,\n\t\t\ttags: {\n\t\t\t\tdiv: {\n\t\t\t\t\tsrc: null,\n\t\t\t\t\tclass: 'card text-bg-dark'\n\t\t\t\t}\n\t\t\t},\n\t\t\tallowedChildren: ['#'],\n\t\t\tquoteType: QuoteType.never,\n\t\t\tformat: function (element) {\n\t\t\t\treturn `[albumimg]${attr(element, 'alt')}[/albumimg]`;\n\t\t\t},\n\t\t\thtml: function (token, attrs, content) {\n\t\t\t\tattrs.defaultattr =\n\t\t\t\t\tescapeEntities(attrs.defaultattr, true) || content;\n\n\t\t\t\treturn `<div class=\"card text-bg-dark\" style=\"max-width:200px\" alt=\"${content}\"><img src=\"${\n\t\t\t\t\teditorOptions.albumsPreviewUrl}${escapeUriScheme(attrs.defaultattr)\n\t\t\t\t}\" class=\"img-user-posted card-img-top\" style=\"max-height:200px;max-width:200px;object-fit:contain\"\"></div>`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: URL\n\t\turl: {\n\t\t\tallowsEmpty: true,\n\t\t\ttags: {\n\t\t\t\ta: {\n\t\t\t\t\thref: null\n\t\t\t\t}\n\t\t\t},\n\t\t\tquoteType: QuoteType.never,\n\t\t\tformat: function (element, content) {\n\t\t\t\tconst url = attr(element, 'href');\n\n\t\t\t\t// make sure this link is not an e-mail,\n\t\t\t\t// if it is return e-mail BBCode\n\t\t\t\tif (url.substr(0, 7) === 'mailto:') {\n\t\t\t\t\treturn `[email=\"${url.substr(7)}\"]${content}[/email]`;\n\t\t\t\t}\n\n\t\t\t\treturn `[url=${url}]${content}[/url]`;\n\t\t\t},\n\t\t\thtml: function (token, attrs, content) {\n\t\t\t\tattrs.defaultattr =\n\t\t\t\t\tescapeEntities(attrs.defaultattr, true) || content;\n\n\t\t\t\treturn `<a href=\"${escapeUriScheme(attrs.defaultattr)}\" class=\"link\">${content}</a>`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: E-mail\n\t\temail: {\n\t\t\tquoteType: QuoteType.never,\n\t\t\thtml: function (token, attrs, content) {\n\t\t\t\treturn `<a href=\"mailto:${escapeEntities(attrs.defaultattr, true) || content}\">${content}</a>`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Quote\n\t\tquote: {\n\t\t\ttags: {\n\t\t\t\tdiv: {\n\t\t\t\t\tclass: 'border rounded mx-3 mb-3 p-3 border-secondary shadow-sm'\n\t\t\t\t}\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tquoteType: QuoteType.never,\n\t\t\tformat: function (element, content) {\n\t\t\t\tvar author = '';\n\t\t\t\tvar cite;\n\t\t\t\tconst children = element.children;\n\n\t\t\t\tfor (let i = 0; !cite && i < children.length; i++) {\n\t\t\t\t\tif (is(children[i], 'cite')) {\n\t\t\t\t\t\tcite = children[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (cite) {\n\t\t\t\t\tauthor = cite && cite.textContent;\n\n\t\t\t\t\tif (cite) {\n\t\t\t\t\t\telement.removeChild(cite);\n\t\t\t\t\t}\n\n\t\t\t\t\tcontent = this.elementToBbcode(element);\n\n\t\t\t\t\tauthor = `=${author.replace(/(^\\s+|\\s+$)/g, '')}`;\n\n\t\t\t\t\tif (cite) {\n\t\t\t\t\t\telement.insertBefore(cite, element.firstChild);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn `[quote${author}]${content}[/quote]`;\n\t\t\t},\n\t\t\thtml: function (token, attrs, content) {\n\t\t\t\tif (attrs.defaultattr) {\n\t\t\t\t\tcontent = content +\n\t\t\t\t\t\t'<cite class=\"card-text text-end d-block text-body-secondary small\">' +\n\t\t\t\t\t\tescapeEntities(attrs.defaultattr) +\n\t\t\t\t\t\t'</cite>';\n\t\t\t\t}\n\n\t\t\t\treturn `<div class=\"border rounded mx-3 mb-3 p-3 border-secondary shadow-sm\"><span contenteditable=\"false\"><i class=\"fa fa-quote-left text-primary fs-4 me-2\"></i></span>${\n\t\t\t\t\tcontent}</div>`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Code\n\t\tcode: {\n\t\t\ttags: {\n\t\t\t\tcode: {\n\t\t\t\t\tclass: null\n\t\t\t\t}\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tallowedChildren: ['#', '#newline'],\n\t\t\tformat: function (element, content) {\n\t\t\t\tvar codeLanguage;\n\n\t\t\t\tif (!is(element, 'code') || !(codeLanguage = attr(element, 'class'))) {\n\t\t\t\t\tcodeLanguage = element.className.replace('lang-', '');\n\t\t\t\t}\n\n\t\t\t\treturn `[code=${codeLanguage.replace('lang-', '')}]${content}[/code]`;\n\t\t\t},\n\t\t\thtml:\n\t\t\t\t'<pre class=\"border border-danger rounded m-2 p-2\"><code class=\"lang-{defaultattr}\">{0}</code></pre>'\n\t\t},\n\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Note\n\t\tnote: {\n\t\t\ttags: {\n\t\t\t\tdiv: {\n\t\t\t\t\trole: 'alert'\n\t\t\t\t}\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tallowedChildren: ['#', '#newline'],\n\t\t\tformat: function (element, content) {\n\t\t\t\tvar type;\n\n\t\t\t\tif (!(type = attr(element, 'class'))) {\n\t\t\t\t\ttype = element.className.replace('alert alert-', '');\n\t\t\t\t}\n\n\t\t\t\treturn `[note=${type.replace('alert alert-', '')}]${content}[/note]`;\n\t\t\t},\n\t\t\thtml:\n\t\t\t\t'<div class=\"alert alert-{defaultattr}\" role=\"alert\">{0}</div>'\n\t\t},\n\n\t\t// END_COMMAND\n\n\n\t\t// START_COMMAND: Left\n\t\tleft: {\n\t\t\tstyles: {\n\t\t\t\t'text-align': [\n\t\t\t\t\t'left',\n\t\t\t\t\t'-webkit-left',\n\t\t\t\t\t'-moz-left',\n\t\t\t\t\t'-khtml-left'\n\t\t\t\t]\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tallowsEmpty: true,\n\t\t\tformat: '[left]{0}[/left]',\n\t\t\thtml: '<div align=\"left\">{0}</div>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Centre\n\t\tcenter: {\n\t\t\tstyles: {\n\t\t\t\t'text-align': [\n\t\t\t\t\t'center',\n\t\t\t\t\t'-webkit-center',\n\t\t\t\t\t'-moz-center',\n\t\t\t\t\t'-khtml-center'\n\t\t\t\t]\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tallowsEmpty: true,\n\t\t\tformat: '[center]{0}[/center]',\n\t\t\thtml: '<div align=\"center\">{0}</div>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Right\n\t\tright: {\n\t\t\tstyles: {\n\t\t\t\t'text-align': [\n\t\t\t\t\t'right',\n\t\t\t\t\t'-webkit-right',\n\t\t\t\t\t'-moz-right',\n\t\t\t\t\t'-khtml-right'\n\t\t\t\t]\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tallowsEmpty: true,\n\t\t\tformat: '[right]{0}[/right]',\n\t\t\thtml: '<div align=\"right\">{0}</div>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Justify\n\t\tjustify: {\n\t\t\tstyles: {\n\t\t\t\t'text-align': [\n\t\t\t\t\t'justify',\n\t\t\t\t\t'-webkit-justify',\n\t\t\t\t\t'-moz-justify',\n\t\t\t\t\t'-khtml-justify'\n\t\t\t\t]\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tallowsEmpty: true,\n\t\t\tformat: '[justify]{0}[/justify]',\n\t\t\thtml: '<div align=\"justify\">{0}</div>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Facebook\n\t\tfacebook: {\n\t\t\tallowsEmpty: true,\n\t\t\ttags: {\n\t\t\t\tdiv: {\n\t\t\t\t\t'data-facebook-url': null\n\t\t\t\t}\n\t\t\t},\n\t\t\tformat: function (element, content) {\n\t\t\t\telement = attr(element, 'data-facebook-url');\n\n\t\t\t\treturn element ? `[facebook]${element}[/facebook]` : content;\n\t\t\t},\n\t\t\thtml: function (token, attrs, content) {\n\t\t\t\tconst url = content;\n\n\t\t\t\treturn `<div class=\"ratio ratio-1x1\" data-oembed-url=\"${url}\" data-facebook-url=\"${url\n\t\t\t\t}\"><iframe src=\"https://www.facebook.com/plugins/post.php?href=${url}\"></iframe></div>`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Instagram\n\t\tinstagram: {\n\t\t\tallowsEmpty: true,\n\t\t\ttags: {\n\t\t\t\tdiv: {\n\t\t\t\t\t'data-instagram-url': null\n\t\t\t\t}\n\t\t\t},\n\t\t\tformat: function (element, content) {\n\t\t\t\telement = attr(element, 'data-instagram-url');\n\n\t\t\t\treturn element ? `[instagram]${element}[/instagram]` : content;\n\t\t\t},\n\t\t\thtml: function (token, attrs, content) {\n\t\t\t\tvar id = content;\n\n\t\t\t\tconst url = content;\n\n\t\t\t\tvar id = url.match(/\\/(p|tv|reel)\\/(.*?)\\//)[2];\n\n\t\t\t\treturn `<div class=\"ratio ratio-1x1\" data-oembed-url=\"https://www.instagram.com/p/${id\n\t\t\t\t}\" data-instagram-url=\"${url}\"><iframe src=\"https://www.instagram.com/p/${id\n\t\t\t\t}/embed/captioned/\"></iframe></div>`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Vimeo\n\t\tvimeo: {\n\t\t\tallowsEmpty: true,\n\t\t\ttags: {\n\t\t\t\tdiv: {\n\t\t\t\t\t'data-vimeo-url': null\n\t\t\t\t}\n\t\t\t},\n\t\t\tformat: function (element, content) {\n\t\t\t\telement = attr(element, 'data-vimeo-url');\n\n\t\t\t\treturn element ? `[vimeo]${element}[/vimeo]` : content;\n\t\t\t},\n\t\t\thtml: function (token, attrs, content) {\n\t\t\t\tconst url = content;\n\n\t\t\t\tconst id = url.match(/vimeo\\..*\\/(\\d+)(?:$|\\/)/)[1];\n\n\t\t\t\treturn `<div data-oembed-url=\"https://vimeo.com/${id}\" data-vimeo-url=\"${url\n\t\t\t\t}\" class=\"ratio ratio-16x9 border\"><iframe src=\"https://player.vimeo.com/video/${id\n\t\t\t\t}?show_title=1&show_byline=1&show_portrait=1&fullscreen=1\"></iframe></div>`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\n\t\t// START_COMMAND: YouTube\n\t\tyoutube: {\n\t\t\tallowsEmpty: true,\n\t\t\ttags: {\n\t\t\t\tdiv: {\n\t\t\t\t\t'data-youtube-url': null\n\t\t\t\t}\n\t\t\t},\n\t\t\tformat: function (element, content) {\n\t\t\t\telement = attr(element, 'data-youtube-url');\n\n\t\t\t\treturn element ? `[youtube]${element}[/youtube]` : content;\n\t\t\t},\n\t\t\thtml: function (token, attrs, content) {\n\t\t\t\tconst url = content;\n\n\t\t\t\tconst id = content.match(/(?:v=|v\\/|embed\\/|youtu.be\\/)?([a-zA-Z0-9_-]{11})/)[1];\n\n\t\t\t\treturn `<div data-oembed-url=\"https://youtube.com/embed/${id}\" data-youtube-url=\"${url\n\t\t\t\t}\" class=\"ratio ratio-16x9 border\"><iframe src=\"https://youtube.com/embed/${id\n\t\t\t\t}?hd=1\"></iframe></div>`;\n\t\t\t}\n\t\t},\n\t\t// END_COMMAND\n\n\n\t\t// START_COMMAND: Rtl\n\t\trtl: {\n\t\t\tstyles: {\n\t\t\t\tdirection: ['rtl']\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tformat: '[rtl]{0}[/rtl]',\n\t\t\thtml: '<div style=\"direction: rtl\">{0}</div>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// START_COMMAND: Ltr\n\t\tltr: {\n\t\t\tstyles: {\n\t\t\t\tdirection: ['ltr']\n\t\t\t},\n\t\t\tisInline: false,\n\t\t\tformat: '[ltr]{0}[/ltr]',\n\t\t\thtml: '<div style=\"direction: ltr\">{0}</div>'\n\t\t},\n\t\t// END_COMMAND\n\n\t\t// this is here so that commands above can be removed\n\t\t// without having to remove the , after the last one.\n\t\t// Needed for IE.\n\t\tignore: {}\n\t};\n\n\t/**\n\t * Formats a string replacing {name} with the values of\n\t * obj.name properties.\n\t *\n\t * If there is no property for the specified {name} then\n\t * it will be left intact.\n\t *\n\t * @param  {string} str\n\t * @param  {Object} obj\n\t * @return {string}\n\t * @since 2.0.0\n\t */\n\tfunction formatBBCodeString(str, obj) {\n\t\treturn str.replace(/\\{([^}]+)\\}/g,\n\t\t\tfunction (match, group) {\n\t\t\t\tvar undef,\n\t\t\t\t\tescape = true;\n\n\t\t\t\tif (group.charAt(0) === '!') {\n\t\t\t\t\tescape = false;\n\t\t\t\t\tgroup = group.substring(1);\n\t\t\t\t}\n\n\t\t\t\tif (group === '0') {\n\t\t\t\t\tescape = false;\n\t\t\t\t}\n\n\t\t\t\tif (obj[group] === undef) {\n\t\t\t\t\treturn match;\n\t\t\t\t}\n\n\t\t\t\treturn escape ? escapeEntities(obj[group], true) : obj[group];\n\t\t\t});\n\t}\n\n\tfunction isFunction(fn) {\n\t\treturn typeof fn === 'function';\n\t}\n\n\t/**\n\t * Removes any leading or trailing quotes ('\")\n\t *\n\t * @return string\n\t * @since v1.4.0\n\t */\n\tfunction _stripQuotes(str) {\n\t\treturn str ? str.replace(/\\\\(.)/g, '$1').replace(/^([\"'])(.*?)\\1$/, '$2') : str;\n\t}\n\n\t/**\n\t * Formats a string replacing {0}, {1}, {2}, ect. with\n\t * the params provided\n\t *\n\t * @param {string} str The string to format\n\t * @param {...string} arg The strings to replace\n\t * @return {string}\n\t * @since v1.4.0\n\t */\n\tfunction _formatString(str) {\n\t\tvar undef;\n\t\tvar args = arguments;\n\n\t\treturn str.replace(/\\{(\\d+)\\}/g,\n\t\t\tfunction (_, matchNum) {\n\t\t\t\treturn args[matchNum - 0 + 1] !== undef ? args[matchNum - 0 + 1] : `{${matchNum}}`;\n\t\t\t});\n\t}\n\n\tvar TOKEN_OPEN = 'open';\n\tvar TOKEN_CONTENT = 'content';\n\tvar TOKEN_NEWLINE = 'newline';\n\tvar TOKEN_CLOSE = 'close';\n\n\n\t/*\n\t * @typedef {Object} TokenizeToken\n\t * @property {string} type\n\t * @property {string} name\n\t * @property {string} val\n\t * @property {Object.<string, string>} attrs\n\t * @property {array} children\n\t * @property {TokenizeToken} closing\n\t */\n\n\t/**\n\t * Tokenize token object\n\t *\n\t * @param  {string} type The type of token this is,\n\t *                       should be one of tokenType\n\t * @param  {string} name The name of this token\n\t * @param  {string} val The originally matched string\n\t * @param  {array} attrs Any attributes. Only set on\n\t *                       TOKEN_TYPE_OPEN tokens\n\t * @param  {array} children Any children of this token\n\t * @param  {TokenizeToken} closing This tokens closing tag.\n\t *                                 Only set on TOKEN_TYPE_OPEN tokens\n\t * @class {TokenizeToken}\n\t * @name {TokenizeToken}\n\t * @memberOf BBCodeParser.prototype\n\t */\n\tfunction TokenizeToken(type, name, val, attrs, children, closing) {\n\t\tconst base = this;\n\n\t\tbase.type = type;\n\t\tbase.name = name;\n\t\tbase.val = val;\n\t\tbase.attrs = attrs || {};\n\t\tbase.children = children || [];\n\t\tbase.closing = closing || null;\n\t};\n\n\tTokenizeToken.prototype = {\n\t\t/** @lends BBCodeParser.prototype.TokenizeToken */\n\t\t/**\n\t\t * Clones this token\n\t\t *\n\t\t * @return {TokenizeToken}\n\t\t */\n\t\tclone: function () {\n\t\t\tconst base = this;\n\n\t\t\treturn new TokenizeToken(\n\t\t\t\tbase.type,\n\t\t\t\tbase.name,\n\t\t\t\tbase.val,\n\t\t\t\textend({}, base.attrs),\n\t\t\t\t[],\n\t\t\t\tbase.closing ? base.closing.clone() : null\n\t\t\t);\n\t\t},\n\t\t/**\n\t\t * Splits this token at the specified child\n\t\t *\n\t\t * @param  {TokenizeToken} splitAt The child to split at\n\t\t * @return {TokenizeToken} The right half of the split token or\n\t\t *                         empty clone if invalid splitAt lcoation\n\t\t */\n\t\tsplitAt: function (splitAt) {\n\t\t\tvar offsetLength;\n\t\t\tconst base = this;\n\t\t\tconst clone = base.clone();\n\t\t\tconst offset = base.children.indexOf(splitAt);\n\n\t\t\tif (offset > -1) {\n\t\t\t\t// Work out how many items are on the right side of the split\n\t\t\t\t// to pass to splice()\n\t\t\t\toffsetLength = base.children.length - offset;\n\t\t\t\tclone.children = base.children.splice(offset, offsetLength);\n\t\t\t}\n\n\t\t\treturn clone;\n\t\t}\n\t};\n\n\n\t/**\n\t * SCEditor BBCode parser class\n\t *\n\t * @param {Object} options\n\t * @class BBCodeParser\n\t * @name BBCodeParser\n\t * @since v1.4.0\n\t */\n\tfunction BBCodeParser(options) {\n\t\tvar base = this;\n\n\t\tbase.opts = extend({}, BBCodeParser.defaults, options);\n\n\t\t/**\n\t\t * Takes a BBCode string and splits it into open,\n\t\t * content and close tags.\n\t\t *\n\t\t * It does no checking to verify a tag has a matching open\n\t\t * or closing tag or if the tag is valid child of any tag\n\t\t * before it. For that the tokens should be passed to the\n\t\t * parse function.\n\t\t *\n\t\t * @param {string} str\n\t\t * @return {array}\n\t\t * @memberOf BBCodeParser.prototype\n\t\t */\n\t\tbase.tokenize = function (str) {\n\t\t\tvar matches, type, i;\n\t\t\tconst tokens = [];\n\t\t\t// The token types in reverse order of precedence\n\t\t\t// (they're looped in reverse)\n\t\t\tconst tokenTypes = [\n\t\t\t\t{\n\t\t\t\t\ttype: TOKEN_CONTENT,\n\t\t\t\t\tregex: /^([^\\[\\r\\n]+|\\[)/\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: TOKEN_NEWLINE,\n\t\t\t\t\tregex: /^(\\r\\n|\\r|\\n)/\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: TOKEN_OPEN,\n\t\t\t\t\tregex: /^\\[[^\\[\\]]+\\]/\n\t\t\t\t},\n\t\t\t\t// Close must come before open as they are\n\t\t\t\t// the same except close has a / at the start.\n\t\t\t\t{\n\t\t\t\t\ttype: TOKEN_CLOSE,\n\t\t\t\t\tregex: /^\\[\\/[^\\[\\]]+\\]/\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tstrloop:\n\t\t\twhile (str.length) {\n\t\t\t\ti = tokenTypes.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\ttype = tokenTypes[i].type;\n\n\t\t\t\t\t// Check if the string matches any of the tokens\n\t\t\t\t\tif (!(matches = str.match(tokenTypes[i].regex)) ||\n\t\t\t\t\t\t\t!matches[0]) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Add the match to the tokens list\n\t\t\t\t\ttokens.push(tokenizeTag(type, matches[0]));\n\n\t\t\t\t\t// Remove the match from the string\n\t\t\t\t\tstr = str.substr(matches[0].length);\n\n\t\t\t\t\t// The token has been added so start again\n\t\t\t\t\tcontinue strloop;\n\t\t\t\t}\n\n\t\t\t\t// If there is anything left in the string which doesn't match\n\t\t\t\t// any of the tokens then just assume it's content and add it.\n\t\t\t\tif (str.length) {\n\t\t\t\t\ttokens.push(tokenizeTag(TOKEN_CONTENT, str));\n\t\t\t\t}\n\n\t\t\t\tstr = '';\n\t\t\t}\n\n\t\t\treturn tokens;\n\t\t};\n\n\t\t/**\n\t\t * Extracts the name an params from a tag\n\t\t *\n\t\t * @param {string} type\n\t\t * @param {string} val\n\t\t * @return {Object}\n\t\t * @private\n\t\t */\n\t\tfunction tokenizeTag(type, val) {\n\t\t\tvar matches, attrs, name;\n\t\t\tconst openRegex = /\\[([^\\]\\s=]+)(?:([^\\]]+))?\\]/;\n\t\t\tconst closeRegex = /\\[\\/([^\\[\\]]+)\\]/;\n\n\t\t\t// Extract the name and attributes from opening tags and\n\t\t\t// just the name from closing tags.\n\t\t\tif (type === TOKEN_OPEN && (matches = val.match(openRegex))) {\n\t\t\t\tname = lower(matches[1]);\n\n\t\t\t\tif (matches[2] && (matches[2] = matches[2].trim())) {\n\t\t\t\t\tattrs = tokenizeAttrs(matches[2]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (type === TOKEN_CLOSE &&\n\t\t\t\t(matches = val.match(closeRegex))) {\n\t\t\t\tname = lower(matches[1]);\n\t\t\t}\n\n\t\t\tif (type === TOKEN_NEWLINE) {\n\t\t\t\tname = '#newline';\n\t\t\t}\n\n\t\t\t// Treat all tokens without a name and\n\t\t\t// all unknown BBCodes as content\n\t\t\tif (!name ||\n\t\t\t((type === TOKEN_OPEN || type === TOKEN_CLOSE) &&\n\t\t\t\t!bbcodeHandlers[name])) {\n\n\t\t\t\ttype = TOKEN_CONTENT;\n\t\t\t\tname = '#';\n\t\t\t}\n\n\t\t\treturn new TokenizeToken(type, name, val, attrs);\n\t\t}\n\n\t\t/**\n\t\t * Extracts the individual attributes from a string containing\n\t\t * all the attributes.\n\t\t *\n\t\t * @param {string} attrs\n\t\t * @return {Object} Assoc array of attributes\n\t\t * @private\n\t\t */\n\t\tfunction tokenizeAttrs(attrs) {\n\t\t\tvar matches\n\t\t\t\t/*\n\t\t\t\t([^\\s=]+)\t\t\t\tAnything that's not a space or equals\n\t\t\t\t=\t\t\t\t\t\tEquals sign =\n\t\t\t\t(?:\n\t\t\t\t\t(?:\n\t\t\t\t\t\t([\"'])\t\t\t\t\tThe opening quote\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\t(?:\\\\\\2|[^\\2])*?\tAnything that isn't the\n\t\t\t\t\t\t\t\t\t\t\t\tunescaped opening quote\n\t\t\t\t\t\t)\n\t\t\t\t\t\t\\2\t\t\t\t\t\tThe opening quote again which\n\t\t\t\t\t\t\t\t\t\t\t\twill close the string\n\t\t\t\t\t)\n\t\t\t\t\t\t|\t\t\t\tIf not a quoted string then match\n\t\t\t\t\t(\n\t\t\t\t\t\t(?:.(?!\\s\\S+=))*.?\t\tAnything that isn't part of\n\t\t\t\t\t\t\t\t\t\t\t\t[space][non-space][=] which\n\t\t\t\t\t\t\t\t\t\t\t\twould be a new attribute\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t\t*/;\n\t\t\tconst attrRegex = /([^\\s=]+)=(?:(?:([\"'])((?:\\\\\\2|[^\\2])*?)\\2)|((?:.(?!\\s\\S+=))*.))/g;\n\t\t\tconst ret = {};\n\n\t\t\t// if only one attribute then remove the = from the start and\n\t\t\t// strip any quotes\n\t\t\tif (attrs.charAt(0) === '=' && attrs.indexOf('=', 1) < 0) {\n\t\t\t\tret.defaultattr = _stripQuotes(attrs.substr(1));\n\t\t\t} else {\n\t\t\t\tif (attrs.charAt(0) === '=') {\n\t\t\t\t\tattrs = `defaultattr${attrs}`;\n\t\t\t\t}\n\n\t\t\t\t// No need to strip quotes here, the regex will do that.\n\t\t\t\twhile ((matches = attrRegex.exec(attrs))) {\n\t\t\t\t\tret[lower(matches[1])] =\n\t\t\t\t\t\t_stripQuotes(matches[3]) || matches[4];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\n\t\t/**\n\t\t * Parses a string into an array of BBCodes\n\t\t *\n\t\t * @param  {string}  str\n\t\t * @param  {boolean} preserveNewLines If to preserve all new lines, not\n\t\t *                                    strip any based on the passed\n\t\t *                                    formatting options\n\t\t * @return {array}                    Array of BBCode objects\n\t\t * @memberOf BBCodeParser.prototype\n\t\t */\n\t\tbase.parse = function (str, preserveNewLines) {\n\t\t\tconst ret = parseTokens(base.tokenize(str));\n\t\t\tconst opts = base.opts;\n\n\t\t\tif (opts.fixInvalidNesting) {\n\t\t\t\tfixNesting(ret);\n\t\t\t}\n\n\t\t\tnormaliseNewLines(ret, null, preserveNewLines);\n\n\t\t\tif (opts.removeEmptyTags) {\n\t\t\t\tremoveEmpty(ret);\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t};\n\n\t\t/**\n\t\t * Checks if an array of TokenizeToken's contains the\n\t\t * specified token.\n\t\t *\n\t\t * Checks the tokens name and type match another tokens\n\t\t * name and type in the array.\n\t\t *\n\t\t * @param  {string}    name\n\t\t * @param  {string} type\n\t\t * @param  {array}     arr\n\t\t * @return {Boolean}\n\t\t * @private\n\t\t */\n\t\tfunction hasTag(name, type, arr) {\n\t\t\tvar i = arr.length;\n\n\t\t\twhile (i--) {\n\t\t\t\tif (arr[i].type === type && arr[i].name === name) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\t/**\n\t\t * Checks if the child tag is allowed as one\n\t\t * of the parent tags children.\n\t\t *\n\t\t * @param  {TokenizeToken}  parent\n\t\t * @param  {TokenizeToken}  child\n\t\t * @return {Boolean}\n\t\t * @private\n\t\t */\n\t\tfunction isChildAllowed(parent, child) {\n\t\t\tconst parentBBCode = parent ? bbcodeHandlers[parent.name] : {};\n\t\t\tconst allowedChildren = parentBBCode.allowedChildren;\n\n\t\t\tif (base.opts.fixInvalidChildren && allowedChildren) {\n\t\t\t\treturn allowedChildren.indexOf(child.name || '#') > -1;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\t// TODO: Tidy this parseTokens() function up a bit.\n\t\t/**\n\t\t * Parses an array of tokens created by tokenize()\n\t\t *\n\t\t * @param  {array} toks\n\t\t * @return {array} Parsed tokens\n\t\t * @see tokenize()\n\t\t * @private\n\t\t */\n\t\tfunction parseTokens(toks) {\n\t\t\tvar token,\n\t\t\t\tbbcode,\n\t\t\t\tcurTok,\n\t\t\t\tclone,\n\t\t\t\ti,\n\t\t\t\tnext,\n\t\t\t\tcloned = [],\n\t\t\t\toutput = [],\n\t\t\t\topenTags = [],\n\t\t\t\t/**\n\t\t\t\t * Returns the currently open tag or undefined\n\t\t\t\t * @return {TokenizeToken}\n\t\t\t\t */\n\t\t\t\tcurrentTag = function () {\n\t\t\t\t\treturn last(openTags);\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Adds a tag to either the current tags children\n\t\t\t\t * or to the output array.\n\t\t\t\t * @param {TokenizeToken} token\n\t\t\t\t * @private\n\t\t\t\t */\n\t\t\t\taddTag = function (token) {\n\t\t\t\t\tif (currentTag()) {\n\t\t\t\t\t\tcurrentTag().children.push(token);\n\t\t\t\t\t} else {\n\t\t\t\t\t\toutput.push(token);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * Checks if this tag closes the current tag\n\t\t\t\t * @param  {string} name\n\t\t\t\t * @return {Void}\n\t\t\t\t */\n\t\t\t\tclosesCurrentTag = function (name) {\n\t\t\t\t\treturn currentTag() &&\n\t\t\t\t\t\t(bbcode = bbcodeHandlers[currentTag().name]) &&\n\t\t\t\t\t\tbbcode.closedBy &&\n\t\t\t\t\t\tbbcode.closedBy.indexOf(name) > -1;\n\t\t\t\t};\n\n\t\t\twhile ((token = toks.shift())) {\n\t\t\t\tnext = toks[0];\n\n\t\t\t\t/*\n\t\t\t\t * Fixes any invalid children.\n\t\t\t\t *\n\t\t\t\t * If it is an element which isn't allowed as a child of it's\n\t\t\t\t * parent then it will be converted to content of the parent\n\t\t\t\t * element. i.e.\n\t\t\t\t *     [code]Code [b]only[/b] allows text.[/code]\n\t\t\t\t * Will become:\n\t\t\t\t *     <code>Code [b]only[/b] allows text.</code>\n\t\t\t\t * Instead of:\n\t\t\t\t *     <code>Code <b>only</b> allows text.</code>\n\t\t\t\t */\n\t\t\t\t// Ignore tags that can't be children\n\t\t\t\tif (!isChildAllowed(currentTag(), token)) {\n\n\t\t\t\t\t// exclude closing tags of current tag\n\t\t\t\t\tif (token.type !== TOKEN_CLOSE ||\n\t\t\t\t\t\t!currentTag() ||\n\t\t\t\t\t\ttoken.name !== currentTag().name) {\n\t\t\t\t\t\ttoken.name = '#';\n\t\t\t\t\t\ttoken.type = TOKEN_CONTENT;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tswitch (token.type) {\n\t\t\t\t\tcase TOKEN_OPEN:\n\t\t\t\t\t// Check it this closes a parent,\n\t\t\t\t\t// e.g. for lists [*]one [*]two\n\t\t\t\t\t\tif (closesCurrentTag(token.name)) {\n\t\t\t\t\t\t\topenTags.pop();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\taddTag(token);\n\t\t\t\t\t\tbbcode = bbcodeHandlers[token.name];\n\n\t\t\t\t\t\t// If this tag is not self closing and it has a closing\n\t\t\t\t\t\t// tag then it is open and has children so add it to the\n\t\t\t\t\t\t// list of open tags. If has the closedBy property then\n\t\t\t\t\t\t// it is closed by other tags so include everything as\n\t\t\t\t\t\t// it's children until one of those tags is reached.\n\t\t\t\t\t\tif (bbcode &&\n\t\t\t\t\t\t!bbcode.isSelfClosing &&\n\t\t\t\t\t\t(bbcode.closedBy ||\n\t\t\t\t\t\t\thasTag(token.name, TOKEN_CLOSE, toks))) {\n\t\t\t\t\t\t\topenTags.push(token);\n\t\t\t\t\t\t} else if (!bbcode || !bbcode.isSelfClosing) {\n\t\t\t\t\t\t\ttoken.type = TOKEN_CONTENT;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase TOKEN_CLOSE:\n\t\t\t\t\t// check if this closes the current tag,\n\t\t\t\t\t// e.g. [/list] would close an open [*]\n\t\t\t\t\t\tif (currentTag() &&\n\t\t\t\t\t\ttoken.name !== currentTag().name &&\n\t\t\t\t\t\tclosesCurrentTag(`/${token.name}`)) {\n\n\t\t\t\t\t\t\topenTags.pop();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// If this is closing the currently open tag just pop\n\t\t\t\t\t\t// the close tag off the open tags array\n\t\t\t\t\t\tif (currentTag() && token.name === currentTag().name) {\n\t\t\t\t\t\t\tcurrentTag().closing = token;\n\t\t\t\t\t\t\topenTags.pop();\n\n\t\t\t\t\t\t// If this is closing an open tag that is the parent of\n\t\t\t\t\t\t// the current tag then clone all the tags including the\n\t\t\t\t\t\t// current one until reaching the parent that is being\n\t\t\t\t\t\t// closed. Close the parent and then add the clones back\n\t\t\t\t\t\t// in.\n\t\t\t\t\t\t} else if (hasTag(token.name, TOKEN_OPEN, openTags)) {\n\n\t\t\t\t\t\t\t// Remove the tag from the open tags\n\t\t\t\t\t\t\twhile ((curTok = openTags.pop())) {\n\n\t\t\t\t\t\t\t\t// If it's the tag that is being closed then\n\t\t\t\t\t\t\t\t// discard it and break the loop.\n\t\t\t\t\t\t\t\tif (curTok.name === token.name) {\n\t\t\t\t\t\t\t\t\tcurTok.closing = token;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Otherwise clone this tag and then add any\n\t\t\t\t\t\t\t\t// previously cloned tags as it's children\n\t\t\t\t\t\t\t\tclone = curTok.clone();\n\n\t\t\t\t\t\t\t\tif (cloned.length) {\n\t\t\t\t\t\t\t\t\tclone.children.push(last(cloned));\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tcloned.push(clone);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Place block linebreak before cloned tags\n\t\t\t\t\t\t\tif (next && next.type === TOKEN_NEWLINE) {\n\t\t\t\t\t\t\t\tbbcode = bbcodeHandlers[token.name];\n\t\t\t\t\t\t\t\tif (bbcode && bbcode.isInline === false) {\n\t\t\t\t\t\t\t\t\taddTag(next);\n\t\t\t\t\t\t\t\t\ttoks.shift();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Add the last cloned child to the now current tag\n\t\t\t\t\t\t\t// (the parent of the tag which was being closed)\n\t\t\t\t\t\t\taddTag(last(cloned));\n\n\t\t\t\t\t\t\t// Add all the cloned tags to the open tags list\n\t\t\t\t\t\t\ti = cloned.length;\n\t\t\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\t\t\topenTags.push(cloned[i]);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcloned.length = 0;\n\n\t\t\t\t\t\t// This tag is closing nothing so treat it as content\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttoken.type = TOKEN_CONTENT;\n\t\t\t\t\t\t\taddTag(token);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase TOKEN_NEWLINE:\n\t\t\t\t\t// handle things like\n\t\t\t\t\t//     [*]list\\nitem\\n[*]list1\n\t\t\t\t\t// where it should come out as\n\t\t\t\t\t//     [*]list\\nitem[/*]\\n[*]list1[/*]\n\t\t\t\t\t// instead of\n\t\t\t\t\t//     [*]list\\nitem\\n[/*][*]list1[/*]\n\t\t\t\t\t\tif (currentTag() &&\n\t\t\t\t\t\tnext &&\n\t\t\t\t\t\tclosesCurrentTag(\n\t\t\t\t\t\t\t(next.type === TOKEN_CLOSE ? '/' : '') +\n\t\t\t\t\t\t\tnext.name\n\t\t\t\t\t\t)) {\n\t\t\t\t\t\t// skip if the next tag is the closing tag for\n\t\t\t\t\t\t// the option tag, i.e. [/*]\n\t\t\t\t\t\t\tif (!(next.type === TOKEN_CLOSE &&\n\t\t\t\t\t\t\tnext.name === currentTag().name)) {\n\t\t\t\t\t\t\t\tbbcode = bbcodeHandlers[currentTag().name];\n\n\t\t\t\t\t\t\t\tif (bbcode && bbcode.breakAfter) {\n\t\t\t\t\t\t\t\t\topenTags.pop();\n\t\t\t\t\t\t\t\t} else if (bbcode &&\n\t\t\t\t\t\t\t\tbbcode.isInline === false &&\n\t\t\t\t\t\t\t\tbase.opts.breakAfterBlock &&\n\t\t\t\t\t\t\t\tbbcode.breakAfter !== false) {\n\t\t\t\t\t\t\t\t\topenTags.pop();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\taddTag(token);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault: // content\n\t\t\t\t\t\taddTag(token);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn output;\n\t\t}\n\n\t\t/**\n\t\t * Normalise all new lines\n\t\t *\n\t\t * Removes any formatting new lines from the BBCode\n\t\t * leaving only content ones. I.e. for a list:\n\t\t *\n\t\t * [list]\n\t\t * [*] list item one\n\t\t * with a line break\n\t\t * [*] list item two\n\t\t * [/list]\n\t\t *\n\t\t * would become\n\t\t *\n\t\t * [list] [*] list item one\n\t\t * with a line break [*] list item two [/list]\n\t\t *\n\t\t * Which makes it easier to convert to HTML or add\n\t\t * the formatting new lines back in when converting\n\t\t * back to BBCode\n\t\t *\n\t\t * @param  {array} children\n\t\t * @param  {TokenizeToken} parent\n\t\t * @param  {boolean} onlyRemoveBreakAfter\n\t\t * @return {void}\n\t\t */\n\t\tfunction normaliseNewLines(children, parent, onlyRemoveBreakAfter) {\n\t\t\tvar token,\n\t\t\t\tleft,\n\t\t\t\tright,\n\t\t\t\tparentBBCode,\n\t\t\t\tbbcode,\n\t\t\t\tremovedBreakEnd,\n\t\t\t\tremovedBreakBefore,\n\t\t\t\tremove;\n\t\t\tvar childrenLength = children.length;\n\t\t\t// TODO: this function really needs tidying up\n\t\t\tif (parent) {\n\t\t\t\tparentBBCode = bbcodeHandlers[parent.name];\n\t\t\t}\n\n\t\t\tvar i = childrenLength;\n\t\t\twhile (i--) {\n\t\t\t\tif (!(token = children[i])) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (token.type === TOKEN_NEWLINE) {\n\t\t\t\t\tleft = i > 0 ? children[i - 1] : null;\n\t\t\t\t\tright = i < childrenLength - 1 ? children[i + 1] : null;\n\t\t\t\t\tremove = false;\n\n\t\t\t\t\t// Handle the start and end new lines\n\t\t\t\t\t// e.g. [tag]\\n and \\n[/tag]\n\t\t\t\t\tif (!onlyRemoveBreakAfter &&\n\t\t\t\t\t\tparentBBCode &&\n\t\t\t\t\t\tparentBBCode.isSelfClosing !== true) {\n\t\t\t\t\t\t// First child of parent so must be opening line break\n\t\t\t\t\t\t// (breakStartBlock, breakStart) e.g. [tag]\\n\n\t\t\t\t\t\tif (!left) {\n\t\t\t\t\t\t\tif (parentBBCode.isInline === false &&\n\t\t\t\t\t\t\t\tbase.opts.breakStartBlock &&\n\t\t\t\t\t\t\t\tparentBBCode.breakStart !== false) {\n\t\t\t\t\t\t\t\tremove = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (parentBBCode.breakStart) {\n\t\t\t\t\t\t\t\tremove = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Last child of parent so must be end line break\n\t\t\t\t\t\t\t// (breakEndBlock, breakEnd)\n\t\t\t\t\t\t\t// e.g. \\n[/tag]\n\t\t\t\t\t\t\t// remove last line break (breakEndBlock, breakEnd)\n\t\t\t\t\t\t} else if (!removedBreakEnd && !right) {\n\t\t\t\t\t\t\tif (parentBBCode.isInline === false &&\n\t\t\t\t\t\t\t\tbase.opts.breakEndBlock &&\n\t\t\t\t\t\t\t\tparentBBCode.breakEnd !== false) {\n\t\t\t\t\t\t\t\tremove = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (parentBBCode.breakEnd) {\n\t\t\t\t\t\t\t\tremove = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tremovedBreakEnd = remove;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (left && left.type === TOKEN_OPEN) {\n\t\t\t\t\t\tif ((bbcode = bbcodeHandlers[left.name])) {\n\t\t\t\t\t\t\tif (!onlyRemoveBreakAfter) {\n\t\t\t\t\t\t\t\tif (bbcode.isInline === false &&\n\t\t\t\t\t\t\t\t\tbase.opts.breakAfterBlock &&\n\t\t\t\t\t\t\t\t\tbbcode.breakAfter !== false) {\n\t\t\t\t\t\t\t\t\tremove = true;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (bbcode.breakAfter) {\n\t\t\t\t\t\t\t\t\tremove = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (bbcode.isInline === false) {\n\t\t\t\t\t\t\t\tremove = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!onlyRemoveBreakAfter &&\n\t\t\t\t\t\t!removedBreakBefore &&\n\t\t\t\t\t\tright &&\n\t\t\t\t\t\tright.type === TOKEN_OPEN) {\n\n\t\t\t\t\t\tif ((bbcode = bbcodeHandlers[right.name])) {\n\t\t\t\t\t\t\tif (bbcode.isInline === false &&\n\t\t\t\t\t\t\t\tbase.opts.breakBeforeBlock &&\n\t\t\t\t\t\t\t\tbbcode.breakBefore !== false) {\n\t\t\t\t\t\t\t\tremove = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (bbcode.breakBefore) {\n\t\t\t\t\t\t\t\tremove = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tremovedBreakBefore = remove;\n\n\t\t\t\t\t\t\tif (remove) {\n\t\t\t\t\t\t\t\tchildren.splice(i, 1);\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (remove) {\n\t\t\t\t\t\tchildren.splice(i, 1);\n\t\t\t\t\t}\n\n\t\t\t\t\t// reset double removedBreakBefore removal protection.\n\t\t\t\t\t// This is needed for cases like \\n\\n[\\tag] where\n\t\t\t\t\t// only 1 \\n should be removed but without this they both\n\t\t\t\t\t// would be.\n\t\t\t\t\tremovedBreakBefore = false;\n\t\t\t\t} else if (token.type === TOKEN_OPEN) {\n\t\t\t\t\tnormaliseNewLines(token.children,\n\t\t\t\t\t\ttoken,\n\t\t\t\t\t\tonlyRemoveBreakAfter);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Fixes any invalid nesting.\n\t\t *\n\t\t * If it is a block level element inside 1 or more inline elements\n\t\t * then those inline elements will be split at the point where the\n\t\t * block level is and the block level element placed between the split\n\t\t * parts. i.e.\n\t\t *     [inline]A[blocklevel]B[/blocklevel]C[/inline]\n\t\t * Will become:\n\t\t *     [inline]A[/inline][blocklevel]B[/blocklevel][inline]C[/inline]\n\t\t *\n\t\t * @param {array} children\n\t\t * @param {array} [parents] Null if there is no parents\n\t\t * @param {boolea} [insideInline] If inside an inline element\n\t\t * @param {array} [rootArr] Root array if there is one\n\t\t * @return {array}\n\t\t * @private\n\t\t */\n\t\tfunction fixNesting(children, parents, insideInline, rootArr) {\n\t\t\tvar token, i, parent, parentIndex, parentParentChildren, right;\n\n\t\t\tconst isInline = function (token) {\n\t\t\t\tconst bbcode = bbcodeHandlers[token.name];\n\n\t\t\t\treturn !bbcode || bbcode.isInline !== false;\n\t\t\t};\n\n\t\t\tparents = parents || [];\n\t\t\trootArr = rootArr || children;\n\n\t\t\t// This must check the length each time as it can change when\n\t\t\t// tokens are moved to fix the nesting.\n\t\t\tfor (i = 0; i < children.length; i++) {\n\t\t\t\tif (!(token = children[i]) || token.type !== TOKEN_OPEN) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (insideInline && !isInline(token)) {\n\t\t\t\t\t// if this is a blocklevel element inside an inline one then\n\t\t\t\t\t// split the parent at the block level element\n\t\t\t\t\tparent = last(parents);\n\t\t\t\t\tright = parent.splitAt(token);\n\n\t\t\t\t\tparentParentChildren = parents.length > 1 ? parents[parents.length - 2].children : rootArr;\n\n\t\t\t\t\t// If parent inline is allowed inside this tag, clone it and\n\t\t\t\t\t// wrap this tags children in it.\n\t\t\t\t\tif (isChildAllowed(token, parent)) {\n\t\t\t\t\t\tconst clone = parent.clone();\n\t\t\t\t\t\tclone.children = token.children;\n\t\t\t\t\t\ttoken.children = [clone];\n\t\t\t\t\t}\n\n\t\t\t\t\tparentIndex = parentParentChildren.indexOf(parent);\n\t\t\t\t\tif (parentIndex > -1) {\n\t\t\t\t\t\t// remove the block level token from the right side of\n\t\t\t\t\t\t// the split inline element\n\t\t\t\t\t\tright.children.splice(0, 1);\n\n\t\t\t\t\t\t// insert the block level token and the right side after\n\t\t\t\t\t\t// the left side of the inline token\n\t\t\t\t\t\tparentParentChildren.splice(\n\t\t\t\t\t\t\tparentIndex + 1,\n\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t\tright\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\t// If token is a block and is followed by a newline,\n\t\t\t\t\t\t// then move the newline along with it to the new parent\n\t\t\t\t\t\tconst next = right.children[0];\n\t\t\t\t\t\tif (next && next.type === TOKEN_NEWLINE) {\n\t\t\t\t\t\t\tif (!isInline(token)) {\n\t\t\t\t\t\t\t\tright.children.splice(0, 1);\n\t\t\t\t\t\t\t\tparentParentChildren.splice(\n\t\t\t\t\t\t\t\t\tparentIndex + 2,\n\t\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\t\tnext\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// return to parents loop as the\n\t\t\t\t\t\t// children have now increased\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tparents.push(token);\n\n\t\t\t\tfixNesting(\n\t\t\t\t\ttoken.children,\n\t\t\t\t\tparents,\n\t\t\t\t\tinsideInline || isInline(token),\n\t\t\t\t\trootArr\n\t\t\t\t);\n\n\t\t\t\tparents.pop();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Removes any empty BBCodes which are not allowed to be empty.\n\t\t *\n\t\t * @param {array} tokens\n\t\t * @private\n\t\t */\n\t\tfunction removeEmpty(tokens) {\n\t\t\tvar token, bbcode;\n\n\t\t\t/**\n\t\t\t * Checks if all children are whitespace or not\n\t\t\t * @private\n\t\t\t */\n\t\t\tconst isTokenWhiteSpace = function (children) {\n\t\t\t\tvar j = children.length;\n\n\t\t\t\twhile (j--) {\n\t\t\t\t\tconst type = children[j].type;\n\n\t\t\t\t\tif (type === TOKEN_OPEN || type === TOKEN_CLOSE) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (type === TOKEN_CONTENT &&\n\t\t\t\t\t\t/\\S|\\u00A0/.test(children[j].val)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\tvar i = tokens.length;\n\t\t\twhile (i--) {\n\t\t\t\t// So skip anything that isn't a tag since only tags can be\n\t\t\t\t// empty, content can't\n\t\t\t\tif (!(token = tokens[i]) || token.type !== TOKEN_OPEN) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tbbcode = bbcodeHandlers[token.name];\n\n\t\t\t\t// Remove any empty children of this tag first so that if they\n\t\t\t\t// are all removed this one doesn't think it's not empty.\n\t\t\t\tremoveEmpty(token.children);\n\n\t\t\t\tif (isTokenWhiteSpace(token.children) &&\n\t\t\t\t\tbbcode &&\n\t\t\t\t\t!bbcode.isSelfClosing &&\n\t\t\t\t\t!bbcode.allowsEmpty) {\n\t\t\t\t\ttokens.splice.apply(tokens, [i, 1].concat(token.children));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Converts a BBCode string to HTML\n\t\t *\n\t\t * @param {string} str\n\t\t * @param {boolean}   preserveNewLines If to preserve all new lines, not\n\t\t *                                  strip any based on the passed\n\t\t *                                  formatting options\n\t\t * @return {string}\n\t\t * @memberOf BBCodeParser.prototype\n\t\t */\n\t\tbase.toHTML = function (str, preserveNewLines) {\n\t\t\treturn convertToHTML(base.parse(str, preserveNewLines), true);\n\t\t};\n\n\t\tbase.toHTMLFragment = function (str, preserveNewLines) {\n\t\t\treturn convertToHTML(base.parse(str, preserveNewLines), false);\n\t\t};\n\n\t\t/**\n\t\t * @private\n\t\t */\n\t\tfunction convertToHTML(tokens, isRoot) {\n\t\t\tvar undef,\n\t\t\t\ttoken,\n\t\t\t\tbbcode,\n\t\t\t\tcontent,\n\t\t\t\thtml,\n\t\t\t\tneedsBlockWrap,\n\t\t\t\tblockWrapOpen,\n\t\t\t\tisInline,\n\t\t\t\tlastChild,\n\t\t\t\tret = '';\n\n\t\t\tisInline = function (bbcode) {\n\t\t\t\treturn (!bbcode || (bbcode.isHtmlInline !== undef ? bbcode.isHtmlInline : bbcode.isInline)) !== false;\n\t\t\t};\n\n\t\t\twhile (tokens.length > 0) {\n\t\t\t\tif (!(token = tokens.shift())) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (token.type === TOKEN_OPEN) {\n\t\t\t\t\tlastChild = token.children[token.children.length - 1] || {};\n\t\t\t\t\tbbcode = bbcodeHandlers[token.name];\n\t\t\t\t\tneedsBlockWrap = isRoot && isInline(bbcode);\n\t\t\t\t\tcontent = convertToHTML(token.children, false);\n\n\t\t\t\t\tif (bbcode && bbcode.html) {\n\t\t\t\t\t\t// Only add a line break to the end if this is\n\t\t\t\t\t\t// blocklevel and the last child wasn't block-level\n\t\t\t\t\t\tif (!isInline(bbcode) &&\n\t\t\t\t\t\t\tisInline(bbcodeHandlers[lastChild.name]) &&\n\t\t\t\t\t\t\t!bbcode.isPreFormatted &&\n\t\t\t\t\t\t\t!bbcode.skipLastLineBreak) {\n\t\t\t\t\t\t\t// Add placeholder br to end of block level\n\t\t\t\t\t\t\t// elements\n\t\t\t\t\t\t\t//content += '<br />';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!isFunction(bbcode.html)) {\n\t\t\t\t\t\t\ttoken.attrs['0'] = content;\n\t\t\t\t\t\t\thtml = formatBBCodeString(\n\t\t\t\t\t\t\t\tbbcode.html,\n\t\t\t\t\t\t\t\ttoken.attrs\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\thtml = bbcode.html.call(\n\t\t\t\t\t\t\t\tbase,\n\t\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t\t\ttoken.attrs,\n\t\t\t\t\t\t\t\tcontent\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\thtml = token.val +\n\t\t\t\t\t\t\tcontent +\n\t\t\t\t\t\t\t(token.closing ? token.closing.val : '');\n\t\t\t\t\t}\n\t\t\t\t} else if (token.type === TOKEN_NEWLINE) {\n\t\t\t\t\tif (!isRoot) {\n\t\t\t\t\t\tret += '<br />';\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t// If not already in a block wrap then start a new block\n\t\t\t\t\tif (!blockWrapOpen) {\n\t\t\t\t\t\tret += '<div>';\n\t\t\t\t\t}\n\n\t\t\t\t\tret += '<br />';\n\n\t\t\t\t\t// Normally the div acts as a line-break with by moving\n\t\t\t\t\t// whatever comes after onto a new line.\n\t\t\t\t\t// If this is the last token, add an extra line-break so it\n\t\t\t\t\t// shows as there will be nothing after it.\n\t\t\t\t\tif (!tokens.length) {\n\t\t\t\t\t\tret += '<br />';\n\t\t\t\t\t}\n\n\t\t\t\t\tret += '</div>\\n';\n\t\t\t\t\tblockWrapOpen = false;\n\t\t\t\t\tcontinue;\n\t\t\t\t\t// content\n\t\t\t\t} else {\n\t\t\t\t\tneedsBlockWrap = isRoot;\n\t\t\t\t\thtml = escapeEntities(token.val, true);\n\t\t\t\t}\n\n\t\t\t\tif (needsBlockWrap && !blockWrapOpen) {\n\t\t\t\t\tret += '<div>';\n\t\t\t\t\tblockWrapOpen = true;\n\t\t\t\t} else if (!needsBlockWrap && blockWrapOpen) {\n\t\t\t\t\tret += '</div>\\n';\n\t\t\t\t\tblockWrapOpen = false;\n\t\t\t\t}\n\n\t\t\t\tret += html;\n\t\t\t}\n\n\t\t\tif (blockWrapOpen) {\n\t\t\t\tret += '</div>\\n';\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\n\t\t/**\n\t\t * Takes a BBCode string, parses it then converts it back to BBCode.\n\t\t *\n\t\t * This will auto fix the BBCode and format it with the specified\n\t\t * options.\n\t\t *\n\t\t * @param {string} str\n\t\t * @param {boolean} preserveNewLines If to preserve all new lines, not\n\t\t *                                strip any based on the passed\n\t\t *                                formatting options\n\t\t * @return {string}\n\t\t * @memberOf BBCodeParser.prototype\n\t\t */\n\t\tbase.toBBCode = function (str, preserveNewLines) {\n\t\t\treturn convertToBBCode(base.parse(str, preserveNewLines));\n\t\t};\n\n\t\t/**\n\t\t * Converts parsed tokens back into BBCode with the\n\t\t * formatting specified in the options and with any\n\t\t * fixes specified.\n\t\t *\n\t\t * @param  {array} toks Array of parsed tokens from base.parse()\n\t\t * @return {string}\n\t\t * @private\n\t\t */\n\t\tfunction convertToBBCode(toks) {\n\t\t\tvar token,\n\t\t\t\tattr,\n\t\t\t\tbbcode,\n\t\t\t\tisBlock,\n\t\t\t\tisSelfClosing,\n\t\t\t\tquoteType,\n\t\t\t\tbreakBefore,\n\t\t\t\tbreakStart,\n\t\t\t\tbreakEnd,\n\t\t\t\tbreakAfter,\n\t\t\t\tret = '';\n\n\t\t\twhile (toks.length > 0) {\n\t\t\t\tif (!(token = toks.shift())) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t// TODO: tidy this\n\t\t\t\tbbcode = bbcodeHandlers[token.name];\n\t\t\t\tisBlock = !(!bbcode || bbcode.isInline !== false);\n\t\t\t\tisSelfClosing = bbcode && bbcode.isSelfClosing;\n\n\t\t\t\tbreakBefore = (isBlock &&\n\t\t\t\t\t\tbase.opts.breakBeforeBlock &&\n\t\t\t\t\t\tbbcode.breakBefore !== false) ||\n\t\t\t\t\t(bbcode && bbcode.breakBefore);\n\n\t\t\t\tbreakStart = (isBlock &&\n\t\t\t\t\t\t!isSelfClosing &&\n\t\t\t\t\t\tbase.opts.breakStartBlock &&\n\t\t\t\t\t\tbbcode.breakStart !== false) ||\n\t\t\t\t\t(bbcode && bbcode.breakStart);\n\n\t\t\t\tbreakEnd = (isBlock &&\n\t\t\t\t\t\tbase.opts.breakEndBlock &&\n\t\t\t\t\t\tbbcode.breakEnd !== false) ||\n\t\t\t\t\t(bbcode && bbcode.breakEnd);\n\n\t\t\t\tbreakAfter = (isBlock &&\n\t\t\t\t\t\tbase.opts.breakAfterBlock &&\n\t\t\t\t\t\tbbcode.breakAfter !== false) ||\n\t\t\t\t\t(bbcode && bbcode.breakAfter);\n\n\t\t\t\tquoteType = (bbcode ? bbcode.quoteType : null) ||\n\t\t\t\t\tbase.opts.quoteType ||\n\t\t\t\t\tQuoteType.auto;\n\n\t\t\t\tif (!bbcode && token.type === TOKEN_OPEN) {\n\t\t\t\t\tret += token.val;\n\n\t\t\t\t\tif (token.children) {\n\t\t\t\t\t\tret += convertToBBCode(token.children);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (token.closing) {\n\t\t\t\t\t\tret += token.closing.val;\n\t\t\t\t\t}\n\t\t\t\t} else if (token.type === TOKEN_OPEN) {\n\t\t\t\t\tif (breakBefore) {\n\t\t\t\t\t\tret += '\\n';\n\t\t\t\t\t}\n\n\t\t\t\t\t// Convert the tag and it's attributes to BBCode\n\t\t\t\t\tret += `[${token.name}`;\n\t\t\t\t\tif (token.attrs) {\n\t\t\t\t\t\tif (token.attrs.defaultattr) {\n\t\t\t\t\t\t\tret += `=${quote(\n\t\t\t\t\t\t\t\ttoken.attrs.defaultattr,\n\t\t\t\t\t\t\t\tquoteType,\n\t\t\t\t\t\t\t\t'defaultattr'\n\t\t\t\t\t\t\t)}`;\n\n\t\t\t\t\t\t\tdelete token.attrs.defaultattr;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (attr in token.attrs) {\n\t\t\t\t\t\t\tif (token.attrs.hasOwnProperty(attr)) {\n\t\t\t\t\t\t\t\tret += ` ${attr}=${quote(token.attrs[attr], quoteType, attr)}`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tret += ']';\n\n\t\t\t\t\tif (breakStart) {\n\t\t\t\t\t\tret += '\\n';\n\t\t\t\t\t}\n\n\t\t\t\t\t// Convert the tags children to BBCode\n\t\t\t\t\tif (token.children) {\n\t\t\t\t\t\tret += convertToBBCode(token.children);\n\t\t\t\t\t}\n\n\t\t\t\t\t// add closing tag if not self closing\n\t\t\t\t\tif (!isSelfClosing && !bbcode.excludeClosing) {\n\t\t\t\t\t\tif (breakEnd) {\n\t\t\t\t\t\t\tret += '\\n';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tret += `[/${token.name}]`;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (breakAfter) {\n\t\t\t\t\t\tret += '\\n';\n\t\t\t\t\t}\n\n\t\t\t\t\t// preserve whatever was recognized as the\n\t\t\t\t\t// closing tag if it is a self closing tag\n\t\t\t\t\tif (token.closing && isSelfClosing) {\n\t\t\t\t\t\tret += token.closing.val;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tret += token.val;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\n\t\t/**\n\t\t * Quotes an attribute\n\t\t *\n\t\t * @param {string} str\n\t\t * @param {BBCodeParser.QuoteType} quoteType\n\t\t * @param {string} name\n\t\t * @return {string}\n\t\t * @private\n\t\t */\n\t\tfunction quote(str, quoteType, name) {\n\t\t\tconst needsQuotes = /\\s|=/.test(str);\n\n\t\t\tif (isFunction(quoteType)) {\n\t\t\t\treturn quoteType(str, name);\n\t\t\t}\n\n\t\t\tif (quoteType === QuoteType.never ||\n\t\t\t\t(quoteType === QuoteType.auto && !needsQuotes)) {\n\t\t\t\treturn str;\n\t\t\t}\n\n\t\t\treturn `\"${str.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"')}\"`;\n\t\t}\n\n\t\t/**\n\t\t * Returns the last element of an array or null\n\t\t *\n\t\t * @param {array} arr\n\t\t * @return {Object} Last element\n\t\t * @private\n\t\t */\n\t\tfunction last(arr) {\n\t\t\tif (arr.length) {\n\t\t\t\treturn arr[arr.length - 1];\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\t/**\n\t\t * Converts a string to lowercase.\n\t\t *\n\t\t * @param {string} str\n\t\t * @return {string} Lowercase version of str\n\t\t * @private\n\t\t */\n\t\tfunction lower(str) {\n\t\t\treturn str.toLowerCase();\n\t\t}\n\t};\n\n\t/**\n\t * Quote type\n\t * @type {Object}\n\t * @class QuoteType\n\t * @name BBCodeParser.QuoteType\n\t * @since 1.4.0\n\t */\n\tBBCodeParser.QuoteType = QuoteType;\n\n\t/**\n\t * Default BBCode parser options\n\t * @type {Object}\n\t */\n\tBBCodeParser.defaults = {\n\t\t/**\n\t\t * If to add a new line before block level elements\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tbreakBeforeBlock: false,\n\n\t\t/**\n\t\t * If to add a new line after the start of block level elements\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tbreakStartBlock: false,\n\n\t\t/**\n\t\t * If to add a new line before the end of block level elements\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tbreakEndBlock: false,\n\n\t\t/**\n\t\t * If to add a new line after block level elements\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tbreakAfterBlock: true,\n\n\t\t/**\n\t\t * If to remove empty tags\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tremoveEmptyTags: true,\n\n\t\t/**\n\t\t * If to fix invalid nesting,\n\t\t * i.e. block level elements inside inline elements.\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tfixInvalidNesting: true,\n\n\t\t/**\n\t\t * If to fix invalid children.\n\t\t * i.e. A tag which is inside a parent that doesn't\n\t\t * allow that type of tag.\n\t\t *\n\t\t * @type {Boolean}\n\t\t */\n\t\tfixInvalidChildren: true,\n\n\t\t/**\n\t\t * Attribute quote type\n\t\t *\n\t\t * @type {BBCodeParser.QuoteType}\n\t\t * @since 1.4.1\n\t\t */\n\t\tquoteType: QuoteType.auto,\n\n\t\t/**\n\t\t * Whether to use strict matching on attributes and styles.\n\t\t *\n\t\t * When true this will perform AND matching requiring all tag\n\t\t * attributes and styles to match.\n\t\t *\n\t\t * When false will perform OR matching and will match if any of\n\t\t * a tags attributes or styles match.\n\t\t *\n\t\t * @type {Boolean}\n\t\t * @since 3.1.0\n\t\t */\n\t\tstrictMatch: false\n\t};\n\n\t/**\n\t * Converts a number 0-255 to hex.\n\t *\n\t * Will return 00 if number is not a valid number.\n\t *\n\t * @param  {any} number\n\t * @return {string}\n\t * @private\n\t */\n\tfunction toHex(number) {\n\t\tnumber = parseInt(number, 10);\n\n\t\tif (isNaN(number)) {\n\t\t\treturn '00';\n\t\t}\n\n\t\tnumber = Math.max(0, Math.min(number, 255)).toString(16);\n\n\t\treturn number.length < 2 ? `0${number}` : number;\n\t}\n\n\t/**\n\t * Normalises a CSS colour to hex #xxxxxx format\n\t *\n\t * @param  {string} colorStr\n\t * @return {string}\n\t * @private\n\t */\n\tfunction _normaliseColour(colorStr) {\n\t\tvar match;\n\n\t\tcolorStr = colorStr || '#000';\n\n\t\t// rgb(n,n,n);\n\t\tif ((match =\n\t\t\tcolorStr.match(/rgb\\((\\d{1,3}),\\s*?(\\d{1,3}),\\s*?(\\d{1,3})\\)/i))) {\n\t\t\treturn '#' +\n\t\t\t\ttoHex(match[1]) +\n\t\t\t\ttoHex(match[2]) +\n\t\t\t\ttoHex(match[3]);\n\t\t}\n\n\t\t// expand shorthand\n\t\tif ((match = colorStr.match(/#([0-9a-f])([0-9a-f])([0-9a-f])\\s*?$/i))) {\n\t\t\treturn '#' +\n\t\t\t\tmatch[1] +\n\t\t\t\tmatch[1] +\n\t\t\t\tmatch[2] +\n\t\t\t\tmatch[2] +\n\t\t\t\tmatch[3] +\n\t\t\t\tmatch[3];\n\t\t}\n\n\t\treturn colorStr;\n\t}\n\n\t/**\n\t * SCEditor BBCode format\n\t * @since 2.0.0\n\t */\n\tfunction bbcodeFormat() {\n\t\tvar base = this;\n\n\t\tbase.stripQuotes = _stripQuotes;\n\n\t\t/**\n\t\t * cache of all the tags pointing to their bbcodes to enable\n\t\t * faster lookup of which bbcode a tag should have\n\t\t * @private\n\t\t */\n\t\tvar tagsToBBCodes = {};\n\n\t\t/**\n\t\t * Allowed children of specific HTML tags. Empty array if no\n\t\t * children other than text nodes are allowed\n\t\t * @private\n\t\t */\n\t\tvar validChildren = {\n\t\t\tul: ['li', 'ol', 'ul'],\n\t\t\tol: ['li', 'ol', 'ul'],\n\t\t\ttable: ['tr'],\n\t\t\ttr: ['td', 'th'],\n\t\t\tcode: ['br', 'p', 'div']\n\t\t};\n\n\t\t/**\n\t\t * Populates tagsToBBCodes and stylesToBBCodes for easier lookups\n\t\t *\n\t\t * @private\n\t\t */\n\t\tfunction buildBbcodeCache() {\n\t\t\teach(bbcodeHandlers,\n\t\t\t\tfunction (bbcode, handler) {\n\t\t\t\t\tvar\n\t\t\t\t\t\tisBlock = handler.isInline === false;\n\t\t\t\t\tconst tags = bbcodeHandlers[bbcode].tags;\n\t\t\t\t\tconst styles = bbcodeHandlers[bbcode].styles;\n\n\t\t\t\t\tif (styles) {\n\t\t\t\t\t\ttagsToBBCodes['*'] = tagsToBBCodes['*'] || {};\n\t\t\t\t\t\ttagsToBBCodes['*'][isBlock] =\n\t\t\t\t\t\t\ttagsToBBCodes['*'][isBlock] || {};\n\t\t\t\t\t\ttagsToBBCodes['*'][isBlock][bbcode] = [\n\t\t\t\t\t\t\t['style', Object.entries(styles)]\n\t\t\t\t\t\t];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (tags) {\n\t\t\t\t\t\teach(tags,\n\t\t\t\t\t\t\tfunction (tag, values) {\n\t\t\t\t\t\t\t\tif (values && values.style) {\n\t\t\t\t\t\t\t\t\tvalues.style = Object.entries(values.style);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\ttagsToBBCodes[tag] = tagsToBBCodes[tag] || {};\n\t\t\t\t\t\t\t\ttagsToBBCodes[tag][isBlock] =\n\t\t\t\t\t\t\t\t\ttagsToBBCodes[tag][isBlock] || {};\n\t\t\t\t\t\t\t\ttagsToBBCodes[tag][isBlock][bbcode] =\n\t\t\t\t\t\t\t\t\tvalues && Object.entries(values);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Handles adding newlines after block level elements\n\t\t *\n\t\t * @param {HTMLElement} element The element to convert\n\t\t * @param {string} content  The tags text content\n\t\t * @return {string}\n\t\t * @private\n\t\t */\n\t\tfunction handleBlockNewlines(element, content) {\n\t\t\tconst tag = element.nodeName.toLowerCase();\n\t\t\tconst isInline = dom.isInline;\n\t\t\tif (!isInline(element, true) || tag === 'br') {\n\t\t\t\tlet isLastBlockChild;\n\t\t\t\tlet parent;\n\t\t\t\tlet parentLastChild;\n\t\t\t\tlet previousSibling = element.previousSibling;\n\n\t\t\t\t// Skips selection makers and ignored elements\n\t\t\t\t// Skip empty inline elements\n\t\t\t\twhile (previousSibling &&\n\t\t\t\t\tpreviousSibling.nodeType === 1 &&\n\t\t\t\t\t!is(previousSibling, 'br') &&\n\t\t\t\t\tisInline(previousSibling, true) &&\n\t\t\t\t\t!previousSibling.firstChild) {\n\t\t\t\t\tpreviousSibling = previousSibling.previousSibling;\n\t\t\t\t}\n\n\t\t\t\t// If it's the last block of an inline that is the last\n\t\t\t\t// child of a block then it shouldn't cause a line break\n\t\t\t\t// <block><inline><br></inline></block>\n\t\t\t\tdo {\n\t\t\t\t\tparent = element.parentNode;\n\t\t\t\t\tparentLastChild = parent && parent.lastChild;\n\n\t\t\t\t\tisLastBlockChild = parentLastChild === element;\n\t\t\t\t\telement = parent;\n\t\t\t\t} while (parent && isLastBlockChild && isInline(parent, true));\n\n\t\t\t\t// If this block is:\n\t\t\t\t//\t* Not the last child of a block level element\n\t\t\t\t//\t* Is a <li> tag (lists are blocks)\n\t\t\t\tif (!isLastBlockChild || tag === 'li') {\n\t\t\t\t\tcontent += '\\n';\n\t\t\t\t}\n\n\t\t\t\t// Check for:\n\t\t\t\t// <block>text<block>text</block></block>\n\t\t\t\t//\n\t\t\t\t// The second opening <block> opening tag should cause a\n\t\t\t\t// line break because the previous sibing is inline.\n\t\t\t\tif (tag !== 'br' &&\n\t\t\t\t\tpreviousSibling &&\n\t\t\t\t\t!is(previousSibling, 'br') &&\n\t\t\t\t\tisInline(previousSibling, true)) {\n\t\t\t\t\tcontent = `\\n${content}`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn content;\n\t\t}\n\n\t\t/**\n\t\t * Handles a HTML tag and finds any matching BBCodes\n\t\t *\n\t\t * @param {HTMLElement} element The element to convert\n\t\t * @param {string} content  The Tags text content\n\t\t * @param {boolean} blockLevel\n\t\t * @return {string} Content with any matching BBCode tags\n\t\t *                  wrapped around it.\n\t\t * @private\n\t\t */\n\t\tfunction handleTags(element, content, blockLevel) {\n\t\t\tfunction isStyleMatch(style) {\n\t\t\t\tconst property = style[0];\n\t\t\t\tconst values = style[1];\n\t\t\t\tconst val = dom.getStyle(element, property);\n\t\t\t\tconst parent = element.parentNode;\n\n\t\t\t\t// if the parent has the same style use that instead of this one\n\t\t\t\t// so you don't end up with [i]parent[i]child[/i][/i]\n\t\t\t\tif (!val || parent && dom.hasStyle(parent, property, val)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn !values || values.includes(val);\n\t\t\t}\n\n\t\t\tfunction createAttributeMatch(isStrict) {\n\t\t\t\treturn function (attribute) {\n\t\t\t\t\tconst name = attribute[0];\n\t\t\t\t\tconst value = attribute[1];\n\n\t\t\t\t\t// code tags should skip most styles\n\t\t\t\t\tif (name === 'style' && element.nodeName === 'CODE') {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (name === 'style' && value) {\n\t\t\t\t\t\treturn value[isStrict ? 'every' : 'some'](isStyleMatch);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst val = attr(element, name);\n\n\t\t\t\t\t\treturn val && (!value || value.includes(val));\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tfunction handleTag(tag) {\n\t\t\t\tif (!tagsToBBCodes[tag] || !tagsToBBCodes[tag][blockLevel]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// loop all bbcodes for this tag\n\t\t\t\teach(tagsToBBCodes[tag][blockLevel],\n\t\t\t\t\tfunction (bbcode, attrs) {\n\t\t\t\t\t\tvar fn,\n\t\t\t\t\t\t\tformat,\n\t\t\t\t\t\t\tisStrict = bbcodeHandlers[bbcode].strictMatch;\n\n\t\t\t\t\t\tif (typeof isStrict === 'undefined') {\n\t\t\t\t\t\t\tisStrict = base.opts.strictMatch;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Skip if the element doesn't have the attribute or the\n\t\t\t\t\t\t// attribute doesn't match one of the required values\n\t\t\t\t\t\tfn = isStrict ? 'every' : 'some';\n\t\t\t\t\t\tif (attrs && !attrs[fn](createAttributeMatch(isStrict))) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tformat = bbcodeHandlers[bbcode].format;\n\t\t\t\t\t\tif (isFunction(format)) {\n\t\t\t\t\t\t\tcontent = format.call(base, element, content);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcontent = _formatString(format, content);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\thandleTag('*');\n\t\t\thandleTag(element.nodeName.toLowerCase());\n\t\t\treturn content;\n\t\t}\n\n\t\t/**\n\t\t * Converts a HTML dom element to BBCode starting from\n\t\t * the innermost element and working backwards\n\t\t *\n\t\t * @private\n\t\t * @param {HTMLElement}\telement\n\t\t * @param {boolean}\thasCodeParent\n\t\t * @return {string} BBCode\n\t\t * @memberOf SCEditor.plugins.bbcode.prototype\n\t\t */\n\t\tfunction elementToBbcode(element, hasCodeParent) {\n\t\t\tvar toBBCode = function (node, hasCodeParent, vChildren) {\n\t\t\t\tvar ret = '';\n\n\t\t\t\tdom.traverse(node,\n\t\t\t\t\tfunction (node) {\n\t\t\t\t\t\tvar content = '';\n\t\t\t\t\t\tconst nodeType = node.nodeType;\n\t\t\t\t\t\tconst tag = node.nodeName.toLowerCase();\n\t\t\t\t\t\tconst isCodeTag = tag === 'code';\n\t\t\t\t\t\tvar vChild = validChildren[tag];\n\t\t\t\t\t\tconst firstChild = node.firstChild;\n\t\t\t\t\t\tvar isValidChild = true;\n\n\t\t\t\t\t\tif (vChildren) {\n\t\t\t\t\t\t\tisValidChild = vChildren.indexOf(tag) > -1;\n\n\t\t\t\t\t\t\t// if this tag is one of the parents allowed children\n\t\t\t\t\t\t\t// then set this tags allowed children to whatever it\n\t\t\t\t\t\t\t// allows, otherwise set to what the parent allows\n\t\t\t\t\t\t\tif (!isValidChild) {\n\t\t\t\t\t\t\t\tvChild = vChildren;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// 1 = element\n\t\t\t\t\t\tif (nodeType === 1) {\n\t\t\t\t\t\t\t// skip empty nlf elements (new lines automatically\n\t\t\t\t\t\t\t// added after block level elements like quotes)\n\t\t\t\t\t\t\tif (is(node, '.sceditor-nlf') && !firstChild) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// don't convert iframe contents\n\t\t\t\t\t\t\tif (tag !== 'iframe') {\n\t\t\t\t\t\t\t\tcontent = toBBCode(node,\n\t\t\t\t\t\t\t\t\thasCodeParent || isCodeTag,\n\t\t\t\t\t\t\t\t\tvChild);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// TODO: isValidChild is no longer needed. Should use\n\t\t\t\t\t\t\t// valid children bbcodes instead by creating BBCode\n\t\t\t\t\t\t\t// tokens like the parser.\n\t\t\t\t\t\t\tif (isValidChild) {\n\t\t\t\t\t\t\t\t// Emoticons should be converted if they have found\n\t\t\t\t\t\t\t\t// their way into a code tag\n\t\t\t\t\t\t\t\tif (!hasCodeParent) {\n\t\t\t\t\t\t\t\t\tif (!isCodeTag) {\n\t\t\t\t\t\t\t\t\t\t// Parse inline codes first so they don't\n\t\t\t\t\t\t\t\t\t\t// contain block level codes\n\t\t\t\t\t\t\t\t\t\tcontent = handleTags(node, content, false);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tcontent = handleTags(node, content, true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tret += handleBlockNewlines(node, content);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tret += content;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// 3 = text\n\t\t\t\t\t\t} else if (nodeType === 3) {\n\t\t\t\t\t\t\tret += node.nodeValue;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfalse,\n\t\t\t\t\ttrue);\n\n\t\t\t\treturn ret;\n\t\t\t};\n\n\t\t\treturn toBBCode(element, hasCodeParent);\n\t\t};\n\n\t\t/**\n\t\t * Initializer\n\t\t * @private\n\t\t */\n\t\tbase.init = function () {\n\t\t\tbase.opts = this.opts;\n\t\t\tbase.elementToBbcode = elementToBbcode;\n\n\t\t\t// build the BBCode cache\n\t\t\tbuildBbcodeCache();\n\n\t\t\tthis.commands = extend(\n\t\t\t\ttrue,\n\t\t\t\t{},\n\t\t\t\tdefaultCommandsOverrides,\n\t\t\t\tthis.commands\n\t\t\t);\n\n\t\t\t// Add BBCode helper methods\n\t\t\tthis.toBBCode = base.toSource;\n\t\t\tthis.fromBBCode = base.toHtml;\n\t\t};\n\n\t\t/**\n\t\t * Converts BBCode into HTML\n\t\t *\n\t\t * @param {boolean} asFragment\n\t\t * @param {string} source\n\t\t * @param {boolean} [legacyAsFragment] Used by fromBBCode() method\n\t\t */\n\t\tfunction toHtml(asFragment, source, legacyAsFragment) {\n\t\t\tconst parser = new BBCodeParser(base.opts.parserOptions);\n\t\t\tconst toHTML = (asFragment || legacyAsFragment) ? parser.toHTMLFragment : parser.toHTML;\n\n\t\t\teditorOptions = base.opts;\n\n\t\t\treturn toHTML(base.opts.bbcodeTrim ? source.trim() : source);\n\t\t}\n\n\t\t/**\n\t\t * Converts HTML into BBCode\n\t\t *\n\t\t * @param {boolean} asFragment\n\t\t * @param {string}\thtml\n\t\t * @param {!Document} [context]\n\t\t * @param {!HTMLElement} [parent]\n\t\t * @return {string}\n\t\t * @private\n\t\t */\n\t\tfunction toSource(asFragment, html, context, parent) {\n\t\t\tcontext = context || document;\n\n\t\t\tvar bbcode, elements;\n\t\t\tconst hasCodeParent = !!dom.closest(parent, 'code');\n\t\t\tconst containerParent = context.createElement('div');\n\t\t\tconst container = context.createElement('div');\n\t\t\tconst parser = new BBCodeParser(base.opts.parserOptions);\n\n\t\t\tcontainer.innerHTML = html;\n\t\t\tcss(containerParent, 'visibility', 'hidden');\n\t\t\tcontainerParent.appendChild(container);\n\t\t\tcontext.body.appendChild(containerParent);\n\n\t\t\tif (asFragment) {\n\t\t\t\t// Add text before and after so removeWhiteSpace doesn't remove\n\t\t\t\t// leading and trailing whitespace\n\t\t\t\tcontainerParent.insertBefore(\n\t\t\t\t\tcontext.createTextNode('#'),\n\t\t\t\t\tcontainerParent.firstChild\n\t\t\t\t);\n\t\t\t\tcontainerParent.appendChild(context.createTextNode('#'));\n\t\t\t}\n\n\t\t\t// Match parents white-space handling\n\t\t\tif (parent) {\n\t\t\t\tcss(container, 'whiteSpace', css(parent, 'whiteSpace'));\n\t\t\t}\n\n\t\t\t// Remove all nodes with sceditor-ignore class\n\t\t\telements = container.getElementsByClassName('sceditor-ignore');\n\t\t\twhile (elements.length) {\n\t\t\t\telements[0].parentNode.removeChild(elements[0]);\n\t\t\t}\n\n\t\t\tdom.removeWhiteSpace(containerParent);\n\n\t\t\tbbcode = elementToBbcode(container, hasCodeParent);\n\n\t\t\tcontext.body.removeChild(containerParent);\n\n\t\t\tbbcode = parser.toBBCode(bbcode, true);\n\n\t\t\tif (base.opts.bbcodeTrim) {\n\t\t\t\tbbcode = bbcode.trim();\n\t\t\t}\n\n\t\t\treturn bbcode;\n\t\t};\n\n\t\tbase.toHtml = toHtml.bind(null, false);\n\t\tbase.fragmentToHtml = toHtml.bind(null, true);\n\t\tbase.toSource = toSource.bind(null, false);\n\t\tbase.fragmentToSource = toSource.bind(null, true);\n\t};\n\n\t/**\n\t * Gets a BBCode\n\t *\n\t * @param {string} name\n\t * @return {Object|null}\n\t * @since 2.0.0\n\t */\n\tbbcodeFormat.get = function (name) {\n\t\treturn bbcodeHandlers[name] || null;\n\t};\n\n\t/**\n\t * Adds a BBCode to the parser or updates an existing\n\t * BBCode if a BBCode with the specified name already exists.\n\t *\n\t * @param {string} name\n\t * @param {Object} bbcode\n\t * @return {this}\n\t * @since 2.0.0\n\t */\n\tbbcodeFormat.set = function (name, bbcode) {\n\t\tif (name && bbcode) {\n\t\t\t// merge any existing command properties\n\t\t\tbbcode = extend(bbcodeHandlers[name] || {}, bbcode);\n\n\t\t\tbbcode.remove = function () {\n\t\t\t\tdelete bbcodeHandlers[name];\n\t\t\t};\n\n\t\t\tbbcodeHandlers[name] = bbcode;\n\t\t}\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * Renames a BBCode\n\t *\n\t * This does not change the format or HTML handling, those must be\n\t * changed manually.\n\t *\n\t * @param  {string} name    [description]\n\t * @param  {string} newName [description]\n\t * @return {this|false}\n\t * @since 2.0.0\n\t */\n\tbbcodeFormat.rename = function (name, newName) {\n\t\tif (name in bbcodeHandlers) {\n\t\t\tbbcodeHandlers[newName] = bbcodeHandlers[name];\n\n\t\t\tdelete bbcodeHandlers[name];\n\t\t}\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * Removes a BBCode\n\t *\n\t * @param {string} name\n\t * @return {this}\n\t * @since 2.0.0\n\t */\n\tbbcodeFormat.remove = function (name) {\n\t\tif (name in bbcodeHandlers) {\n\t\t\tdelete bbcodeHandlers[name];\n\t\t}\n\n\t\treturn this;\n\t};\n\n\tbbcodeFormat.formatBBCodeString = formatBBCodeString;\n\n\tsceditor.formats.bbcode = bbcodeFormat;\n\tsceditor.BBCodeParser = BBCodeParser;\n}(sceditor));\n","/**\n * SCEditor SVG fontawesome plugin\n * http://www.sceditor.com/\n *\n * Copyright (C) 2011-2025, Sam Clarke (samclarke.com)\n *\n * SCEditor is licensed under the MIT license:\n *\thttp://www.opensource.org/licenses/mit-license.php\n *\n * @author Sam Clarke\n */\n(function (document, sceditor) {\n\t'use strict';\n\n\tvar dom = sceditor.dom;\n\n\t/* eslint max-len: off*/\n\tvar icons = {\n\t\t'albums': '<i class=\"fa-solid fa-images\"></i',\n\t\t'attachments': '<i class=\"fa-solid fa-paperclip\"></i',\n\t\t'bold': '<i class=\"fa-solid fa-bold\"></i>',\n\t\t'bulletlist': '<i class=\"fa-solid fa-list-ul\"></i>',\n\t\t'center': '<i class=\"fa-solid fa-align-center\"></i>',\n\t\t'code': '<i class=\"fa-solid fa-code\"></i>',\n\t\t'color':\n\t\t\t'<span class=\"fa-stack me-2 pe-2\"><i class=\"fas fa-font fa-stack-1x\"></i><i class=\"fa fa-xs fa-palette sce-color fa-badge\"></i></span>',\n\t\t'copy': '<i class=\"fa-solid fa-copy\"></i>',\n\t\t'cut': '<i class=\"fa-solid fa-scissors\"></i>',\n\t\t'email': '<i class=\"fa-solid fa-envelope\"></i>',\n\t\t'emojis': '<i class=\"fa-solid fa-face-smile\"></i>',\n\t\t'extensions': '<i class=\"fa-solid fa-plug\"></i>',\n\t\t'font':\n\t\t\t'<span class=\"fa-stack me-2 pe-2\"><i class=\"fas fa-font fa-stack-1x\"></i><i class=\"fa fa-xs fa-font fa-badge\"></i></span>',\n\t\t'format': '<i class=\"fa-solid fa-font\"></i>',\n\t\t'grip':\n\t\t\t'<svg xmlns=\"http://www.w3.org/2000/svg\"viewbox=\"0 0 16 16\" unselectable=\"on\"><path d=\"M14.656 5.156l-10 10 .688.688 10-10-.688-.688zm0 3l-7 7 .688.688 7-7-.688-.688zm0 3l-4 4 .688.688 4-4-.688-.688z\"/></svg>',\n\t\t'mark': '<i class=\"fa-solid fa-highlighter\"></i>',\n\t\t'horizontalrule': '<i class=\"fa-solid fa-grip-lines\"></i>',\n\t\t'image': '<i class=\"fa-solid fa-image\"></i>',\n\t\t'italic': '<i class=\"fa-solid fa-italic\"></i>',\n\t\t'justify': '<i class=\"fa-solid fa-align-justify\"></i>',\n\t\t'left': '<i class=\"fa-solid fa-align-left\"></i>',\n\t\t'link': '<i class=\"fa-solid fa-link\"></i>',\n\t\t'maximize': '<i class=\"fa-solid fa-maximize\"></i>',\n\t\t'media': '<i class=\"fa-solid fa-photo-film\"></i>',\n\t\t'note': '<i class=\"fa-solid fa-note-sticky\"></i>',\n\t\t'orderedlist': '<i class=\"fa-solid fa-list-ol\"></i>',\n\t\t'paste': '<i class=\"fa-solid fa-paste\"></i>',\n\t\t'pastetext': '<i class=\"fa-solid fa-paste\"></i>',\n\t\t'quote': '<i class=\"fa-solid fa-quote-left\"></i>',\n\t\t'redo': '<i class=\"fa-solid fa-redo\"></i>',\n\t\t'removeformat': '<i class=\"fa-solid fa-remove-format\"></i>',\n\t\t'reply': '<i class=\"fa-solid fa-reply\"></i>',\n\t\t'right': '<i class=\"fa-solid fa-align-right\"></i>',\n\t\t'size':\n\t\t\t'<span class=\"fa-stack me-2 pe-2\"><i class=\"fas fa-font fa-stack-1x\"></i><i class=\"fa fa-xs fa-up-down fa-badge\"></i></span>',\n\t\t'source': '<i class=\"fa-solid fa-file-code\"></i>',\n\t\t'strike': '<i class=\"fa-solid fa-strikethrough\"></i>',\n\t\t'table': '<i class=\"fa-solid fa-table\"></i>',\n\t\t'underline': '<i class=\"fa-solid fa-underline\"></i>',\n\t\t'undo': '<i class=\"fa-solid fa-undo\"></i>',\n\t\t'unlink': '<i class=\"fa-solid fa-link-slash\"></i>',\n\t\t'vimeo': '<i class=\"fa-brands fa-vimeo\"></i>',\n\t\t'instagram': '<i class=\"fa-brands fa-instagram\"></i>',\n\t\t'facebook': '<i class=\"fa-brands fa-facebook\"></i>',\n\t\t'youtube': '<i class=\"fa-brands fa-youtube\"></i>'\n\t};\n\n\tsceditor.icons.fontawesome = function () {\n\t\tvar nodes = {};\n\t\tvar colorPath;\n\n\t\treturn {\n\t\t\tcreate: function (command) {\n\t\t\t\tif (command in icons) {\n\t\t\t\t\tnodes[command] = sceditor.dom.parseHTML(\n\t\t\t\t\t\ticons[command]\n\t\t\t\t\t).firstChild;\n\n\t\t\t\t\tif (command === 'color') {\n\t\t\t\t\t\tcolorPath = nodes[command].querySelector('.sce-color');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn nodes[command];\n\t\t\t},\n\t\t\tupdate: function (isSourceMode, currentNode) {\n\t\t\t\tif (colorPath) {\n\t\t\t\t\tlet color = 'inherit';\n\n\t\t\t\t\tif (!isSourceMode && currentNode) {\n\t\t\t\t\t\tcolor = currentNode.ownerDocument\n\t\t\t\t\t\t\t.queryCommandValue('forecolor');\n\t\t\t\t\t}\n\n\t\t\t\t\tdom.css(colorPath, 'color', color);\n\t\t\t\t}\n\t\t\t},\n\t\t\trtl: function (isRtl) {\n\t\t\t\tconst gripNode = nodes.grip;\n\n\t\t\t\tif (gripNode) {\n\t\t\t\t\tconst transform = isRtl ? 'scaleX(-1)' : '';\n\n\t\t\t\t\tdom.css(gripNode, 'transform', transform);\n\t\t\t\t\tdom.css(gripNode, 'msTransform', transform);\n\t\t\t\t\tdom.css(gripNode, 'webkitTransform', transform);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t};\n\n\tsceditor.icons.fontawesome.icons = icons;\n})(document, sceditor);\n","/**\n * SCEditor Drag and Drop Plugin\n * http://www.sceditor.com/\n *\n * Copyright (C) 2011-2025, Sam Clarke (samclarke.com)\n *\n * SCEditor is licensed under the MIT license:\n *\thttp://www.opensource.org/licenses/mit-license.php\n *\n * @author Sam Clarke\n */\n(function (sceditor) {\n\t'use strict';\n\n\t/**\n\t * Place holder GIF shown while image is loading.\n\t * @type {string}\n\t * @private\n\t */\n\tvar loadingGif = 'data:image/gif;base64,R0lGODlhlgBkAPABAH19ffb29iH5BAAK' +\n\t\t'AAAAIf4aQ3JlYXRlZCB3aXRoIGFqYXhsb2FkLmluZm8AIf8LTkVUU0NBUEUyLjADAQA' +\n\t\t'AACwAAAAAlgBkAAAC1YyPqcvtD6OctNqLs968+w+G4kiW5omm6sq27gvH8kzX9o3n+s' +\n\t\t'73/g8MCofEovGITCqXzKbzCY1Kp9Sq9YrNarfcrvcLDovH5LL5jE6r1+y2+w2Py+f0u' +\n\t\t'v2OvwD2fP6iD/gH6Pc2GIhg2JeQSNjGuLf4GMlYKIloefAIUEl52ZmJyaY5mUhqyFnq' +\n\t\t'mQr6KRoaMKp66hbLumpQ69oK+5qrOyg4a6qYV2x8jJysvMzc7PwMHS09TV1tfY2drb3' +\n\t\t'N3e39DR4uPk5ebn6Onq6+zt7u/g4fL99UAAAh+QQACgAAACwAAAAAlgBkAIEAAAB9fX' +\n\t\t'329vYAAAAC3JSPqcvtD6OctNqLs968+w+G4kiW5omm6sq27gvH8kzX9o3n+s73/g8MC' +\n\t\t'ofEovGITCqXzKbzCY1Kp9Sq9YrNarfcrvcLDovH5LL5jE6r1+y2+w2Py+f0uv2OvwD2' +\n\t\t'fP4iABgY+CcoCNeHuJdQyLjIaOiWiOj4CEhZ+SbZd/nI2RipqYhQOThKGpAZCuBZyAr' +\n\t\t'ZprpqSupaCqtaazmLCRqai7rb2av5W5wqSShcm8fc7PwMHS09TV1tfY2drb3N3e39DR' +\n\t\t'4uPk5ebn6Onq6+zt7u/g4fLz9PX29/j5/vVAAAIfkEAAoAAAAsAAAAAJYAZACBAAAAf' +\n\t\t'X199vb2AAAAAuCUj6nL7Q+jnLTai7PevPsPhuJIluaJpurKtu4Lx/JM1/aN5/rO9/4P' +\n\t\t'DAqHxKLxiEwql8ym8wmNSqfUqvWKzWq33K73Cw6Lx+Sy+YxOq9fstvsNj8vn9Lr9jr8' +\n\t\t'E9nz+AgAYGLjQVwhXiJgguAiYgGjo9tinyCjoKLn3hpmJUGmJsBmguUnpCXCJOZraaX' +\n\t\t'oKShoJe9DqehCqKlnqiZobuzrbyvuIO8xqKpxIPKlwrPCbBx0tPU1dbX2Nna29zd3t/' +\n\t\t'Q0eLj5OXm5+jp6uvs7e7v4OHy8/T19vf4+fr7/P379UAAAh+QQACgAAACwAAAAAlgBk' +\n\t\t'AIEAAAB9fX329vYAAAAC4JSPqcvtD6OctNqLs968+w+G4kiW5omm6sq27gvH8kzX9o3' +\n\t\t'n+s73/g8MCofEovGITCqXzKbzCY1Kp9Sq9YrNarfcrvcLDovH5LL5jE6r1+y2+w2Py+' +\n\t\t'f0uv2OvwT2fP6iD7gAMEhICAeImIAYiFDoOPi22KcouZfw6BhZGUBZeYlp6LbJiTD6C' +\n\t\t'Qqg6Vm6eQqqKtkZ24iaKtrKunpQa9tmmju7Wwu7KFtMi3oYDMzompkHHS09TV1tfY2d' +\n\t\t'rb3N3e39DR4uPk5ebn6Onq6+zt7u/g4fLz9PX29/j5+vv8/f31QAADs=';\n\n\t/**\n\t * Basic check for browser support\n\t * @type {boolean}\n\t * @private\n\t */\n\tvar isSupported = typeof window.FileReader !== 'undefined';\n\n\tsceditor.plugins.dragdrop = function () {\n\t\tif (!isSupported) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst base = this;\n\t\tvar opts;\n\t\tvar editor;\n\t\tvar handleFile;\n\t\tvar container;\n\t\tvar cover;\n\t\tvar placeholderId = 0;\n\n\n\t\tfunction hideCover() {\n\t\t\tcover.style.display = 'none';\n\t\t\tcontainer.className = container.className.replace(/(^| )dnd( |$)/g, '');\n\t\t}\n\n\t\tfunction showCover() {\n\t\t\tif (cover.style.display === 'none') {\n\t\t\t\tcover.style.display = 'block';\n\t\t\t\tcontainer.className += ' dnd';\n\t\t\t}\n\t\t}\n\n\t\tfunction isAllowed() {\n\t\t\t// FF sets type to application/x-moz-file until it has been dropped\n\t\t\t/*if (file.type !== 'application/x-moz-file' && opts.allowedTypes &&\n\t\t\t\topts.allowedTypes.indexOf(file.type) < 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn opts.isAllowed ? opts.isAllowed(file) : true;*/\n\n\t\t\treturn true;\n\t\t};\n\n\t\tfunction createHolder(toReplace) {\n\t\t\tvar placeholder = document.createElement('img');\n\t\t\tplaceholder.src = loadingGif;\n\t\t\tplaceholder.className = 'sceditor-ignore';\n\t\t\tplaceholder.id = `sce-dragdrop-${placeholderId++}`;\n\n\t\t\tfunction replace(html) {\n\t\t\t\tconst node = editor\n\t\t\t\t\t.getBody()\n\t\t\t\t\t.ownerDocument\n\t\t\t\t\t.getElementById(placeholder.id);\n\n\t\t\t\tif (node) {\n\t\t\t\t\tif (typeof html === 'string') {\n\t\t\t\t\t\tnode.insertAdjacentHTML('afterend', html);\n\t\t\t\t\t}\n\n\t\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn function () {\n\t\t\t\tif (toReplace) {\n\t\t\t\t\ttoReplace.parentNode.replaceChild(placeholder, toReplace);\n\t\t\t\t} else {\n\t\t\t\t\teditor.wysiwygEditorInsertHtml(placeholder.outerHTML);\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tinsert: function (html) {\n\t\t\t\t\t\treplace(html);\n\t\t\t\t\t},\n\t\t\t\t\tcancel: replace\n\t\t\t\t};\n\t\t\t};\n\t\t}\n\n\t\tfunction handleDragOver(e) {\n\t\t\tconst dt = e.dataTransfer;\n\t\t\tconst files = dt.files.length || !dt.items ? dt.files : dt.items;\n\n\t\t\tfor (let i = 0; i < files.length; i++) {\n\t\t\t\t// Dragging a string should be left to default\n\t\t\t\tif (files[i].kind === 'string') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tshowCover();\n\t\t\te.preventDefault();\n\t\t}\n\n\t\tfunction handleDrop(e) {\n\t\t\tconst dt = e.dataTransfer;\n\t\t\tconst files = dt.files.length || !dt.items ? dt.files : dt.items;\n\n\t\t\thideCover();\n\n\t\t\tfor (let i = 0; i < files.length; i++) {\n\t\t\t\t// Dragging a string should be left to default\n\t\t\t\tif (files[i].kind === 'string') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (isAllowed(files[i])) {\n\t\t\t\t\thandleFile(files[i], createHolder());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\te.preventDefault();\n\t\t}\n\n\t\tbase.signalReady = function () {\n\t\t\teditor = this;\n\t\t\topts = editor.opts.dragdrop || {};\n\t\t\thandleFile = opts.handleFile;\n\t\t\t\n\t\t\tif (!handleFile)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcontainer = editor.getContentAreaContainer().parentNode;\n\n\t\t\tcover = container.appendChild(sceditor.dom.parseHTML(\n\t\t\t\t`<div class=\"sceditor-dnd-cover\" style=\"display: none\"></div>`\n\t\t\t).firstChild);\n\n\t\t\tcontainer.addEventListener('dragover', handleDragOver);\n\t\t\tcontainer.addEventListener('dragleave', hideCover);\n\t\t\tcontainer.addEventListener('dragend', hideCover);\n\t\t\tcontainer.addEventListener('drop', handleDrop);\n\n\t\t\teditor.getBody().addEventListener('dragover', handleDragOver);\n\t\t\teditor.getBody().addEventListener('drop', hideCover);\n\t\t};\n\n\t\tbase.signalPasteHtml = function (file) {\n\n\t\t\tif (!file)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tif (!opts.handleFile)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (file.val) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\thideCover();\n\t\t\t\n\t\t\tif (!('handlePaste' in opts) || opts.handlePaste) {\n\t\t\t\tif (isAllowed(file)) {\n\t\t\t\t\thandleFile(file, createHolder());\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t};\n})(sceditor);\n","(function (sceditor) {\n\t'use strict';\n\n\tsceditor.plugins.undo = function () {\n\t\tvar base = this;\n\t\tvar sourceEditor;\n\t\tvar editor;\n\t\tvar body;\n\t\tvar lastInputType = '';\n\t\tvar charChangedCount = 0;\n\t\tvar isInPatchedFn = false;\n\t\t/**\n\t\t * If currently restoring a state\n\t\t * Should ignore events while it's happening\n\t\t */\n\t\tvar isApplying = false;\n\t\t/**\n\t\t * If current selection change event has already been stored\n\t\t */\n\t\tvar isSelectionChangeHandled = false;\n\n\t\tvar undoLimit  = 50;\n\t\tvar undoStates = [];\n\t\tvar redoPosition = 0;\n\t\tvar lastState;\n\n\t\t/**\n\t\t * Sets the editor to the specified state.\n\t\t * @param  {Object} state\n\t\t * @private\n\t\t */\n\t\tfunction applyState(state) {\n\t\t\tisApplying = true;\n\t\t\teditor.sourceMode(state.sourceMode);\n\n\t\t\tif (state.sourceMode) {\n\t\t\t\teditor.val(state.value, false);\n\t\t\t\teditor.sourceEditorCaret(state.caret);\n\t\t\t} else {\n\t\t\t\teditor.getBody().innerHTML = state.value;\n\n\t\t\t\t// Caret may not exist for the first state in Firefox\n\t\t\t\tif (state.caret) {\n\t\t\t\t\tconst range = editor.getRangeHelper().selectedRange();\n\t\t\t\t\tsetRangePositions(range, state.caret);\n\t\t\t\t\teditor.getRangeHelper().selectRange(range);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\teditor.focus();\n\t\t\tisApplying = false;\n\t\t};\n\n\t\t/**\n\t\t * Patches a function on the object to call store() after invocation\n\t\t * @param {Object} obj\n\t\t * @param {string} fn\n\t\t */\n\t\tfunction patch(obj, fn) {\n\t\t\tvar origFn = obj[fn];\n\t\t\tobj[fn] = function () {\n\t\t\t\t// sourceMode calls other patched methods so need to ignore them\n\t\t\t\tconst ignore = isInPatchedFn;\n\n\t\t\t\t// Store caret position before any change is made\n\t\t\t\tif (!ignore && !isApplying && lastState &&\n\t\t\t\t\t\teditor.getRangeHelper().hasSelection()) {\n\t\t\t\t\tupdateLastState();\n\t\t\t\t}\n\n\t\t\t\tisInPatchedFn = true;\n\t\t\t\torigFn.apply(this, arguments);\n\n\t\t\t\tif (!ignore) {\n\t\t\t\t\tisInPatchedFn = false;\n\n\t\t\t\t\tif (!isApplying) {\n\t\t\t\t\t\tstoreState();\n\t\t\t\t\t\tlastInputType = '';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * Stores the editors current state\n\t\t */\n\t\tfunction storeState() {\n\t\t\tif (redoPosition) {\n\t\t\t\tundoStates.length -= redoPosition;\n\t\t\t\tredoPosition = 0;\n\t\t\t}\n\n\t\t\tif (undoLimit > 0 && undoStates.length > undoLimit) {\n\t\t\t\tundoStates.shift();\n\t\t\t}\n\n\t\t\tlastState = {};\n\t\t\tupdateLastState();\n\t\t\tundoStates.push(lastState);\n\t\t}\n\n\t\t/**\n\t\t * Updates the last saved state with the editors current state\n\t\t */\n\t\tfunction updateLastState() {\n\t\t\tconst sourceMode = editor.sourceMode();\n\t\t\tlastState.caret = sourceMode ? editor.sourceEditorCaret() :\n\t\t\t\tgetRangePositions(editor.getRangeHelper().selectedRange());\n\t\t\tlastState.sourceMode = sourceMode;\n\n\t\t\tconst value = sourceMode ?\n\t\t\t\teditor.getSourceEditorValue(false) :\n\t\t\t\teditor.getBody().innerHTML;\n\n\t\t\tconst countField = document.getElementById('editor-Counter'),\n\t\t\t\tmaxLimit = editor.opts.maxLength;\n\n\t\t\t// Update counter\n\t\t\tif (editor.val().length > maxLimit) {\n\t\t\t\tbase.undo();\n\t\t\t} else {\n\t\t\t\tcountField.textContent = maxLimit - editor.val().length;\n\t\t\t}\n\n\t\t\tlastState.value = value;\n\t\t}\n\n\t\tbase.init = function () {\n\t\t\t// this variable will be set to the instance of the editor\n\t\t\t// calling it, hence why the plugins \"this\" is saved to the base\n\t\t\t// variable.\n\t\t\teditor = this;\n\n\t\t\tundoLimit = editor.undoLimit || undoLimit;\n\n\t\t\teditor.addShortcut('ctrl+z', base.undo);\n\t\t\teditor.addShortcut('ctrl+shift+z', base.redo);\n\t\t\teditor.addShortcut('ctrl+y', base.redo);\n\t\t};\n\n\t\tfunction documentSelectionChangeHandler() {\n\t\t\tif (sourceEditor === document.activeElement) {\n\t\t\t\tbase.signalSelectionchangedEvent();\n\t\t\t}\n\t\t}\n\n\t\tbase.signalReady = function () {\n\t\t\tsourceEditor = editor.getContentAreaContainer().nextSibling;\n\t\t\tbody = editor.getBody();\n\n\t\t\t// Store initial state\n\t\t\tstoreState();\n\n\t\t\t// Patch methods that allow inserting content into the editor\n\t\t\t// programmatically\n\t\t\t// TODO: remove this when there is a built in event to handle it\n\t\t\tpatch(editor, 'setWysiwygEditorValue');\n\t\t\tpatch(editor, 'setSourceEditorValue');\n\t\t\tpatch(editor, 'sourceEditorInsertText');\n\t\t\tpatch(editor.getRangeHelper(), 'insertNode');\n\t\t\tpatch(editor, 'toggleSourceMode');\n\n\t\t\t/**\n\t\t\t * Handles the before input event so can override built in\n\t\t\t * undo / redo\n\t\t\t * @param {InputEvent} e\n\t\t\t */\n\t\t\tfunction beforeInputHandler(e) {\n\t\t\t\tif (e.inputType === 'historyUndo') {\n\t\t\t\t\tbase.undo();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t} else if (e.inputType === 'historyRedo') {\n\t\t\t\t\tbase.redo();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbody.addEventListener('beforeinput', beforeInputHandler);\n\t\t\tsourceEditor.addEventListener('beforeinput', beforeInputHandler);\n\n\t\t\t/**\n\t\t\t * Should always store state at the end of composing\n\t\t\t */\n\t\t\tfunction compositionHandler() {\n\t\t\t\tlastInputType = '';\n\t\t\t\tstoreState();\n\t\t\t}\n\t\t\tbody.addEventListener('compositionend', compositionHandler);\n\t\t\tsourceEditor.addEventListener('compositionend', compositionHandler);\n\n\t\t\t// Chrome doesn't trigger selectionchange on textarea so need to\n\t\t\t// listen to global event\n\t\t\tdocument.addEventListener('selectionchange',\n\t\t\t\tdocumentSelectionChangeHandler);\n\t\t};\n\n\t\tbase.destroy = function () {\n\t\t\tdocument.removeEventListener('selectionchange',\n\t\t\t\tdocumentSelectionChangeHandler);\n\t\t};\n\n\t\tbase.undo = function () {\n\t\t\tlastState = null;\n\n\t\t\tif (redoPosition < undoStates.length - 1) {\n\t\t\t\tredoPosition++;\n\t\t\t\tapplyState(undoStates[undoStates.length - 1 - redoPosition]);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\tbase.redo = function () {\n\t\t\tif (redoPosition > 0) {\n\t\t\t\tredoPosition--;\n\t\t\t\tapplyState(undoStates[undoStates.length - 1 - redoPosition]);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\t/**\n\t\t * Handle the selectionchanged event so can store the last caret\n\t\t * position before the input so undoing places it in the right place\n\t\t */\n\t\tbase.signalSelectionchangedEvent = function () {\n\t\t\tif (isApplying || isSelectionChangeHandled) {\n\t\t\t\tisSelectionChangeHandled = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (lastState) {\n\t\t\t\tupdateLastState();\n\t\t\t}\n\t\t\tlastInputType = '';\n\t\t};\n\n\t\t/**\n\t\t * Handles the input event\n\t\t * @param {InputEvent} e\n\t\t */\n\t\tbase.signalInputEvent = function (e) {\n\t\t\t// InputType is one of\n\t\t\t// https://rawgit.com/w3c/input-events/v1/index.html#interface-InputEvent-Attributes\n\t\t\t// Most should cause a full undo item to be added so only need to\n\t\t\t// handle a few of them\n\t\t\tconst inputType = e.inputType;\n\n\t\t\t// Should ignore selection changes that occur because of input\n\t\t\t// events as already handling them\n\t\t\tisSelectionChangeHandled = true;\n\n\t\t\t// inputType should be supported by all supported browsers\n\t\t\t// except IE 11 in runWithoutWysiwygSupport. Shouldn't be an issue\n\t\t\t// as native handling will mostly work there.\n\t\t\t// Ignore if composing as will handle composition end instead\n\t\t\tif (!inputType || e.isComposing) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch (e.inputType) {\n\t\t\t\tcase 'deleteContentBackward':\n\t\t\t\t\tif (lastState && lastInputType === inputType &&\n\t\t\t\t\t\tcharChangedCount < 20) {\n\t\t\t\t\t\tupdateLastState();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstoreState();\n\t\t\t\t\t\tcharChangedCount = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tlastInputType = inputType;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'insertText':\n\t\t\t\t\tcharChangedCount += e.data ? e.data.length : 1;\n\n\t\t\t\t\tif (lastState && lastInputType === inputType &&\n\t\t\t\t\t\t\tcharChangedCount < 20 && !/\\s$/.test(e.data)) {\n\t\t\t\t\t\tupdateLastState();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstoreState();\n\t\t\t\t\t\tcharChangedCount = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tlastInputType = inputType;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tlastInputType = 'sce-misc';\n\t\t\t\t\tcharChangedCount = 0;\n\t\t\t\t\tstoreState();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Creates a positions object form passed range\n\t\t * @param {Range} range\n\t\t * @return {Object<string, Array<number>}\n\t\t */\n\t\tfunction getRangePositions(range) {\n\t\t\t// In Firefox, range may not exist when the editor is first created\n\t\t\t// due to Firefox returning null from getSelection() when the\n\t\t\t// editors iframe is first created. See issue #910\n\t\t\tif (!range) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Merge any adjacent text nodes as it will be done by innerHTML\n\t\t\t// which would cause positions to be off if not done\n\t\t\tbody.normalize();\n\n\t\t\treturn {\n\t\t\t\tstartPositions:\n\t\t\t\t\tnodeToPositions(range.startContainer, range.startOffset),\n\t\t\t\tendPositions:\n\t\t\t\t\tnodeToPositions(range.endContainer, range.endOffset)\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * Sets the range start/end based on the positions object\n\t\t * @param {Range} range\n\t\t * @param {Object<string, Array<number>>} positions\n\t\t */\n\t\tfunction setRangePositions(range, positions) {\n\t\t\ttry {\n\t\t\t\tconst startPositions = positions.startPositions;\n\t\t\t\tconst endPositions = positions.endPositions;\n\n\t\t\t\trange.setStart(positionsToNode(body, startPositions),\n\t\t\t\t\tstartPositions[0]);\n\t\t\t\trange.setEnd(positionsToNode(body, endPositions),\n\t\t\t\t\tendPositions[0]);\n\t\t\t} catch (e) {\n\t\t\t\tif (console && console.warn) {\n\t\t\t\t\tconsole.warn('[SCEditor] Undo plugin lost caret', e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Converts the passed container and offset into positions array\n\t\t * @param {Node} container\n\t\t * @param {number} offset\n\t\t * @returns {Array<number>}\n\t\t */\n\t\tfunction nodeToPositions(container, offset) {\n\t\t\tconst positions = [offset];\n\t\t\tvar node = container;\n\n\t\t\twhile (node && node.tagName !== 'BODY') {\n\t\t\t\tpositions.push(nodeIndex(node));\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\n\t\t\treturn positions;\n\t\t}\n\n\t\t/**\n\t\t * Returns index of passed node\n\t\t * @param {Node} node\n\t\t * @returns {number}\n\t\t */\n\t\tfunction nodeIndex(node) {\n\t\t\tvar i = 0;\n\t\t\twhile ((node = node.previousSibling)) {\n\t\t\t\ti++;\n\t\t\t}\n\t\t\treturn i;\n\t\t}\n\n\t\t/**\n\t\t * Gets the container node from the positions array\n\t\t * @param {Node} node\n\t\t * @param {Array<number>} positions\n\t\t * @returns {Node}\n\t\t */\n\t\tfunction positionsToNode(node, positions) {\n\t\t\tfor (let i = positions.length - 1; node && i > 0; i--) {\n\t\t\t\tnode = node.childNodes[positions[i]];\n\t\t\t}\n\t\t\treturn node;\n\t\t}\n\t};\n}(sceditor));\n","/**\n * SCEditor Plain Text Plugin\n * http://www.sceditor.com/\n *\n * Copyright (C) 2011-2025, Sam Clarke (samclarke.com)\n *\n * SCEditor is licensed under the MIT license:\n *\thttp://www.opensource.org/licenses/mit-license.php\n *\n * @author Sam Clarke\n */\n(function (sceditor) {\n\t'use strict';\n\n\tvar utils = sceditor.utils;\n\tvar dom = sceditor.dom;\n\n\t/**\n\t * Options:\n\t *\n\t * pastetext.addButton - If to replace the plaintext button with a toggle\n\t *                       button that enables and disables plain text mode.\n\t *\n\t * pastetext.enabled - If the plain text button should be enabled at start\n\t *                     up. Only applies if addButton is enabled.\n\t */\n\tsceditor.plugins.plaintext = function () {\n\t\tvar plainTextEnabled = true;\n\n\t\tthis.init = function () {\n\t\t\tconst commands = this.commands;\n\t\t\tconst opts = this.opts;\n\n\t\t\tif (opts && opts.plaintext && opts.plaintext.addButton) {\n\t\t\t\tplainTextEnabled = opts.plaintext.enabled;\n\n\t\t\t\tcommands.pastetext = utils.extend(commands.pastetext || {}, {\n\t\t\t\t\tstate: function () {\n\t\t\t\t\t\treturn plainTextEnabled ? 1 : 0;\n\t\t\t\t\t},\n\t\t\t\t\texec: function () {\n\t\t\t\t\t\tplainTextEnabled = !plainTextEnabled;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tthis.signalPasteRaw = function (data) {\n\t\t\tif (plainTextEnabled) {\n\t\t\t\tif (data.html && !data.text) {\n\t\t\t\t\tconst div = document.createElement('div');\n\t\t\t\t\tdiv.innerHTML = data.html;\n\n\t\t\t\t\t// TODO: Refactor into private shared module with editor\n\t\t\t\t\t// innerText adds two newlines after <p> tags so convert\n\t\t\t\t\t// them to <div> tags\n\t\t\t\t\tutils.each(div.querySelectorAll('p'), function (_, elm) {\n\t\t\t\t\t\tdom.convertElement(elm, 'div');\n\t\t\t\t\t});\n\t\t\t\t\t// Remove collapsed <br> tags as innerText converts them to\n\t\t\t\t\t// newlines\n\t\t\t\t\tutils.each(div.querySelectorAll('br'), function (_, elm) {\n\t\t\t\t\t\tif (!elm.nextSibling ||\n\t\t\t\t\t\t!dom.isInline(elm.nextSibling, true)) {\n\t\t\t\t\t\t\telm.parentNode.removeChild(elm);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tdocument.body.appendChild(div);\n\t\t\t\t\tdata.text = div.innerText;\n\t\t\t\t\tdocument.body.removeChild(div);\n\t\t\t\t}\n\n\t\t\t\tdata.html = null;\n\t\t\t}\n\t\t};\n\t};\n}(sceditor));\n","/**\n * SCEditor Mentions Plugin\n * http://www.sceditor.com/\n *\n * Copyright (C) 2011-2025, Sam Clarke (samclarke.com)\n *\n * SCEditor is licensed under the MIT license:\n *\thttp://www.opensource.org/licenses/mit-license.php\n *\n * @author Sam Clarke\n */\n(function (sceditor) {\n\t'use strict';\n\n\tsceditor.plugins.mentions = function () {\n\t\tvar editor;\n\n\t\tthis.init = function () {\n\t\t\teditor = this;\n\t\t\teditor.opts.onToggleMode = initMentions;\n\t\t};\n\n\t\tthis.signalReady = function () {\n\t\t\tinitMentions();\n\t\t};\n\n\t\tfunction initMentions() {\n\t\t\tmentions({\n\t\t\t\telement: editor,\n\t\t\t\tlookup: 'user',\n\t\t\t\turl: editor.opts.mentionsUrl,\n\t\t\t\tonclick: function (data) { editor.insert(`[userlink]${data.name}[/userlink]`); }\n\t\t\t});\n\t\t}\n\n\t\tfunction mentions(opts = {}) {\n\t\t\topts = Object.assign({},\n\t\t\t\t{\n\t\t\t\t\tlookup: 'lookup',\n\t\t\t\t\tid: '',\n\t\t\t\t\tselector: '',\n\t\t\t\t\telement: null,\n\t\t\t\t\tsymbol: '@',\n\t\t\t\t\titems: [],\n\t\t\t\t\titem_template:\n\t\t\t\t\t\t'<a class=\"dropdown-item\" href=\"#\" style=\"font-family: var(--bs-body-font-family);\"><img src=\"${item.avatar}\" alt=\"avatar\" class=\"me-2 img-thumbnail\" style=\"max-width:20px;max-height:20px\" /> ${item.name}</a>',\n\t\t\t\t\tonclick: undefined,\n\t\t\t\t\turl: ''\n\t\t\t\t},\n\t\t\t\topts);\n\n\t\t\tconst $e = opts.element.inSourceMode()\n\t\t\t\t? opts.element.getSourceEditor()\n\t\t\t\t: opts.element.getContentAreaContainer().contentWindow.document.body;\n\n\t\t\tif (!$e)\n\t\t\t\treturn console.error('Invalid element selector', opts);\n\n\t\t\tvar $lookup = document.createElement('div');\n\t\t\t$lookup.classList = `fixed-top autohide ${opts.lookup}`;\n\t\t\t$e.parentNode.insertBefore($lookup, $e.nextSibling);\n\n\t\t\t$e.addEventListener('keydown', processKey);\n\t\t\t$e.addEventListener('keyup', showLookup);\n\t\t\t$e.addEventListener('click', hideLookup);\n\n\t\t\tvar start, end, prevWord;\n\n\t\t\tvar isFixed = false;\n\t\t\tvar $el = $lookup.parentNode;\n\t\t\twhile ($el && $el.nodeName.toLowerCase() !== 'body' && !isFixed) {\n\t\t\t\tisFixed = window.getComputedStyle($el).getPropertyValue('position').toLowerCase() === 'fixed';\n\t\t\t\t$el = $el.parentElement;\n\t\t\t}\n\n\t\t\tfunction showLookup(event) {\n\t\t\t\tif (event.code === 'Escape') {\n\t\t\t\t\treturn hideLookup();\n\t\t\t\t}\n\n\t\t\t\tvar sel, text, curr;\n\n\t\t\t\tif (opts.element.inSourceMode()) {\n\t\t\t\t\tsel = document.getSelection();\n\t\t\t\t\tvar $parent = opts.element.getSourceEditor();\n\t\t\t\t\ttext = $parent.value || \"\";\n\t\t\t\t\tcurr = sel.baseOffset;\n\n\t\t\t\t} else {\n\t\t\t\t\tsel = opts.element.getContentAreaContainer().contentWindow.document.getSelection();\n\n\t\t\t\t\ttext = opts.element.val() || \"\";\n\t\t\t\t\tcurr = sel.baseOffset;\n\t\t\t\t}\n\n\t\t\t\tvar getLength = arr => arr instanceof Array && arr.length > 0 ? arr[0].length : 0;\n\n\t\t\t\tstart = curr - getLength(text.slice(0, curr).match(/[\\S]+$/g));\n\t\t\t\tend = curr + getLength(text.slice(curr).match(/^[\\S]+/g));\n\n\t\t\t\tvar word = text.substring(start, end);\n\n\t\t\t\tif (!word || word[0] !== opts.symbol) {\n\t\t\t\t\tprevWord = '';\n\t\t\t\t\treturn hideLookup();\n\t\t\t\t}\n\n\t\t\t\tif (word === prevWord)\n\t\t\t\t\treturn;\n\n\t\t\t\tprevWord = word;\n\n\t\t\t\tvar pos = { x: 0, y: 0 };\n\n\t\t\t\tvar parentRect = opts.element.inSourceMode()\n\t\t\t\t\t? opts.element.getSourceEditor().getBoundingClientRect()\n\t\t\t\t\t: opts.element.getContentAreaContainer().contentWindow.document.body.getBoundingClientRect();\n\n\t\t\t\tpos.y = parentRect.top + 30;\n\t\t\t\tpos.x = parentRect.left + 20;\n\n\t\t\t\t$lookup.style.left = pos.x + 'px';\n\t\t\t\t$lookup.style.top = pos.y + 'px';\n\n\t\t\t\t// query\n\t\t\t\tvar query = word.slice(1);\n\n\t\t\t\tvar token = '';\n\t\t\t\tvar tokenInput = document.querySelector('input[name=\"__RequestVerificationToken\"]');\n\n\t\t\t\tif (tokenInput != null) {\n\t\t\t\t\ttoken = tokenInput.value;\n\t\t\t\t}\n\n\t\t\t\tif (query.length >= 3) {\n\t\t\t\t\tfetch(opts.url.replace('{q}', query),\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmethod: 'GET',\n\t\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\t\"Accept\": 'application/json',\n\t\t\t\t\t\t\t\t\t\"Content-Type\": 'application/json;charset=utf-8',\n\t\t\t\t\t\t\t\t\t\"RequestVerificationToken\": token\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(response => response.json())\n\t\t\t\t\t\t.then(data => opts.items = data);\n\t\t\t\t}\n\n\t\t\t\tvar items = opts.items\n\t\t\t\t\t.filter(e => e.name.toLowerCase().includes(word.slice(1).toLowerCase()))\n\t\t\t\t\t.map(item => eval(\n\t\t\t\t\t\t'`<li class=\"mention-li-nt ${opts.lookup}\" data-name = \"${item.name}\" data-id = \"${item.id}\">' +\n\t\t\t\t\t\topts.item_template +\n\t\t\t\t\t\t'</li>`'));\n\n\t\t\t\tif (!items.length)\n\t\t\t\t\treturn hideLookup();\n\n\t\t\t\t$lookup.innerHTML = `<ul class=\"dropdown-menu show\">${items.join('')}</ul>`;\n\t\t\t\t[...$lookup.firstElementChild.children]\n\t\t\t\t\t.forEach($el => $el.addEventListener('click', onClick) ||\n\t\t\t\t\t\t$el.addEventListener('mouseenter', onHover));\n\t\t\t\t$lookup.firstElementChild.children[0].classList.add('active');\n\n\n\t\t\t\tif ($lookup.hasAttribute('hidden'))\n\t\t\t\t\t$lookup.removeAttribute('hidden');\n\n\t\t\t\tvar bounding = $lookup.getBoundingClientRect();\n\t\t\t\tif (!(bounding.top >= 0 &&\n\t\t\t\t\tbounding.left >= 0 &&\n\t\t\t\t\tbounding.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&\n\t\t\t\t\tbounding.right <= (window.innerWidth || document.documentElement.clientWidth)))\n\t\t\t\t\t$lookup.style.top = parseInt($lookup.style.top) - 10 - $lookup.clientHeight + 'px';\n\t\t\t}\n\n\t\t\tfunction hideLookup() {\n\t\t\t\tif (!$lookup.hasAttribute('hidden'))\n\t\t\t\t\t$lookup.setAttribute('hidden', true);\n\t\t\t}\n\n\t\t\tfunction onClick(event) {\n\t\t\t\tconst deleteItem = event.target.classList.contains('mention-li-nt')\n\t\t\t\t\t? event.target\n\t\t\t\t\t: event.target.parentElement;\n\n\t\t\t\topts.onclick(deleteItem.dataset);\n\n\t\t\t\tconst value = opts.element.val();\n\n\t\t\t\topts.element.val(value.replace(value.substring(start + 1, end), ''));\n\n\t\t\t\thideLookup();\n\t\t\t}\n\n\t\t\tfunction onHover(event) {\n\t\t\t\tconst $el = event.target.closest('.mention-li-nt');\n\t\t\t\tif ($el.classList.contains('active'))\n\t\t\t\t\treturn;\n\n\t\t\t\t[...$lookup.firstElementChild.children]\n\t\t\t\t\t.filter($el => $el.classList.contains('active'))\n\t\t\t\t\t.forEach($el => $el.classList.remove('active'));\n\t\t\t\t$el.classList.add('active');\n\t\t\t}\n\n\t\t\tfunction processKey(event) {\n\t\t\t\tconst code = event.key;\n\t\t\t\tif (['ArrowUp', 'ArrowDown', 'Enter'].indexOf(code) == -1 || $lookup.hasAttribute('hidden'))\n\t\t\t\t\treturn;\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tif (code == 'Enter')\n\t\t\t\t\treturn $lookup.querySelector('.active').click();\n\n\t\t\t\tconst $children = [...$lookup.firstElementChild.children];\n\t\t\t\tconst curr = $children.findIndex($el => $el.classList.contains('active'));\n\t\t\t\t$children[curr].classList.remove('active');\n\n\t\t\t\tconst $next = $children[($children.length + curr + (code == 'ArrowUp' ? -1 : 1)) % $children.length];\n\t\t\t\t$next.classList.add('active');\n\t\t\t\t$next.scrollIntoView(false);\n\t\t\t}\n\t\t}\n\t};\n}(sceditor));\n"],"names":["isTypeof","type","arg","isString","bind","isUndefined","isFunction","isNumber","isEmptyObject","obj","Object","keys","length","extend","targetArg","sourceArg","isTargetBoolean","i","target","isDeep","isObject","value","getPrototypeOf","prototype","arguments","key","source","isValueArray","isSameType","targetValue","isValueObject","Array","isArray","arrayRemove","arr","item","indexOf","splice","each","fn","let","forEach","cssPropertyNameCache","ELEMENT_NODE","TEXT_NODE","COMMENT_NODE","toFloat","parseFloat","isFinite","createElement","tag","attributes","context","node","document","style","cssText","setAttribute","parent","selector","parentNode","test","nodeType","is","closest","remove","removeChild","appendChild","child","find","querySelectorAll","on","events","capture","split","event","handler","e","call","addEventListener","off","removeEventListener","attr","getAttribute","removeAttr","removeAttribute","hide","css","show","toggle","isVisible","rule","getComputedStyle","isNumeric","isNaN","data","argsLength","_","name","substr","String","result","matches","msMatchesSelector","webkitMatchesSelector","insertBefore","refNode","classes","className","trim","hasClass","addClass","classList","push","join","removeClass","toggleClass","state","width","padding","border","cs","paddingLeft","paddingRight","borderLeftWidth","borderRightWidth","offsetWidth","height","paddingTop","paddingBottom","borderTopWidth","borderBottomWidth","offsetHeight","trigger","eventName","window","CustomEvent","bubbles","cancelable","detail","ownerDocument","createEvent","initCustomEvent","dispatchEvent","getClientRects","traverse","func","innermostFirst","siblingsOnly","reverse","lastChild","firstChild","next","previousSibling","nextSibling","rTraverse","parseHTML","html","ret","createDocumentFragment","tmp","innerHTML","hasStyling","convertElement","element","toTagName","newElement","attribute","replaceChild","blockLevelList","canHaveChildren","nodeName","toLowerCase","isInline","elm","includeCodeAsBlock","tagName","isEmpty","nodeValue","childNodes","fixNesting","isBlock","lastInlineParent","before","extractContents","middle","clone","cloneNode","prev","previousElementSibling","li","getSibling","previous","removeWhiteSpace","root","nextNode","trimStart","cssWhiteSpace","preserveNewLines","replace","startNode","endNode","range","createRange","setStartBefore","setEndAfter","getOffset","left","top","offsetLeft","offsetTop","offsetParent","getStyle","property","elmStyle","match","char","toUpperCase","styleValue","attributesMatch","nodeA","nodeB","prop","removeKeepChildren","defaultOptions","toolbar","toolbarExclude","maxLength","styles","themeMode","documentElement","fonts","format","icons","codeLanguages","Value","Text","noteTypes","colors","locale","charset","resizeEnabled","resizeMinWidth","resizeMinHeight","resizeMaxHeight","resizeMaxWidth","resizeHeight","resizeWidth","dateFormat","toolbarContainer","enablePasteFiltering","disablePasting","readOnly","rtl","autofocus","autofocusEnd","autoExpand","autoUpdate","spellcheck","runWithoutWysiwygSupport","startInSourceMode","id","plugins","zIndex","bbcodeTrim","disableBlockRemove","allowedIframeUrls","parserOptions","dropDownCss","allowedTags","allowedAttributes","extensionsUrl","attachmentsPreviewUrl","albumsPreviewUrl","mentionsUrl","onToggleMode","undefined","basePath","VALID_SCHEME_REGEX","regex","str","entities","noQuotes","replacements","&","<",">","  ","\r\n","\r","\n","_templates","toolbarButton","codeOpt","noteOpt","extensionOpt","fontOpt","sizeOpt","albums","note","pastetext","image","email","link","mediaMenu","youtubeMenu","instagramMenu","facebookMenu","facebook","instagram","youtube","vimeo","_tmpl","params","createHtml","template","RegExp","fixFirefoxListBug","editor","getBody","defaultCmds","exec","caller","content","this","opts","createDropDown","getAlbumImagesData","tooltip","attachments","modal","bootstrap","Modal","_element","getPaginationData","bold","shortcut","italic","underline","strike","mark","wysiwygEditorInsertHtml","isLtr","align","center","right","justify","font","_dropDown","callback","closeDropDown","preventDefault","fontName","execCommand","size","fontSize","color","cmd","_htmlCache","column","removeformat","cut","errorMessage","copy","paste","val","label","insert","wysiwygEditorInsertText","bulletlist","orderedlist","table","rows","cols","Number","code","language","languageName","codeLanguageName","options","noteType","labelType","labelText","values","extensions","fetch","method","then","res","json","extension","useToolbar","cb","linkInput","url","desc","insertUrl","which","text","attrs","getRangeHelper","selectedHtml","ins","unlink","currentNode","anchor","quote","author","end","media","startsWith","alert","btn","vimeoId","idMatch","date","_date","now","Date","year","getYear","month","getMonth","day","getDate","insertText","txtExec","time","_time","hours","getHours","mins","getMinutes","secs","getSeconds","undo","redo","maximize","focus","sourceMode","toggleSourceMode","reply","getElementById","querySelector","click","location","href","ignore","PluginManager","thisObj","formatSignalName","signal","charAt","slice","callHandlers","args","returnAtFirst","shift","idx","registeredPlugins","apply","base","callOnlyFirst","hasHandler","exists","plugin","isRegistered","register","init","deregister","removedPlugin","pluginIdx","removed","destroy","outerText","isLeft","remaining","start","startContainer","offset","startOffset","Math","max","min","RangeHelper","win","d","sanitize","_createMarker","_prepareInput","doc","contentDocument","startMarker","endMarker","insertHTML","endHTML","selectedRange","div","insertNode","returnHtml","frag","createTextNode","removeMarkers","first","last","input","commonAncestorContainer","emptyNodes","removeIfEmpty","endContainer","deleteContents","restoreRange","cloneSelected","cloneRange","sel","getSelection","rangeCount","body","addRange","getRangeAt","hasSelection","cloneContents","getFirstBlockParent","insertNodeAt","currentRange","collapse","selectRange","removeMarker","marker","insertMarkers","collapsed","getMarker","saveRange","container","rng","compare","clear","isCollapsed","selectOuterText","setStart","setEnd","getOuterText","replaceKeyword","keywords","includeAfter","keywordsSorted","longestKeyword","requireWhitespace","keypressChar","sort","a","b","matchPos","startIndex","leftLen","charsLeft","keyword","keywordLen","whitespaceRegex","keywordIdx","whitespaceLen","maxKeyLen","index","rngA","rngB","compareBoundaryPoints","Range","END_TO_END","START_TO_START","removeAllRanges","empty","USER_AGENT","navigator","userAgent","ios","isWysiwygSupported","ie","documentMode","legacyEdge","contentEditable","isUnsupported","vendor","entries","setPrototypeOf","isFrozen","getOwnPropertyDescriptor","freeze","seal","create","construct","Reflect","arrayForEach","x","fun","thisValue","Func","unapply","arrayLastIndexOf","lastIndexOf","arrayPop","pop","arrayPush","arraySplice","stringToLowerCase","stringToString","toString","stringMatch","stringReplace","stringIndexOf","stringTrim","objectHasOwnProperty","hasOwnProperty","regExpTest","typeErrorCreate","TypeError","_len2","_key2","thisArg","lastIndex","_len","_key","addToSet","set","array","lcElement","transformCaseFunc","l","object","newObject","constructor","lookupGetter","get","html$1","svg$1","svgFilters","svgDisallowed","mathMl$1","mathMlDisallowed","svg","mathMl","xml","MUSTACHE_EXPR","ERB_EXPR","TMPLIT_EXPR","DATA_ATTR","ARIA_ATTR","IS_ALLOWED_URI","IS_SCRIPT_OR_DATA","ATTR_WHITESPACE","DOCTYPE_NAME","CUSTOM_ELEMENT","EXPRESSIONS","__proto__","_createHooksMap","afterSanitizeAttributes","afterSanitizeElements","afterSanitizeShadowDOM","beforeSanitizeAttributes","beforeSanitizeElements","beforeSanitizeShadowDOM","uponSanitizeAttribute","uponSanitizeElement","uponSanitizeShadowNode","NODE_TYPE","cdataSection","entityReference","entityNode","progressingInstruction","comment","documentType","documentFragment","notation","purify","createDOMPurify","DOMPurify","version","Element","isSupported","originalDocument","currentScript","DocumentFragment","HTMLTemplateElement","Node","NodeFilter","NamedNodeMap","MozNamedAttrMap","HTMLFormElement","DOMParser","trustedTypes","ElementPrototype","getNextSibling","getChildNodes","getParentNode","isRegexOrFunction","testValue","Function","_parseConfig","cfg","CONFIG","PARSER_MEDIA_TYPE","SUPPORTED_PARSER_MEDIA_TYPES","ALLOWED_TAGS","DEFAULT_ALLOWED_TAGS","ALLOWED_ATTR","DEFAULT_ALLOWED_ATTR","ALLOWED_NAMESPACES","DEFAULT_ALLOWED_NAMESPACES","URI_SAFE_ATTRIBUTES","DEFAULT_URI_SAFE_ATTRIBUTES","ADD_URI_SAFE_ATTR","DATA_URI_TAGS","DEFAULT_DATA_URI_TAGS","ADD_DATA_URI_TAGS","FORBID_CONTENTS","DEFAULT_FORBID_CONTENTS","FORBID_TAGS","FORBID_ATTR","USE_PROFILES","ALLOW_ARIA_ATTR","ALLOW_DATA_ATTR","ALLOW_UNKNOWN_PROTOCOLS","ALLOW_SELF_CLOSE_IN_ATTR","SAFE_FOR_TEMPLATES","SAFE_FOR_XML","WHOLE_DOCUMENT","RETURN_DOM","RETURN_DOM_FRAGMENT","RETURN_TRUSTED_TYPE","FORCE_BODY","SANITIZE_DOM","SANITIZE_NAMED_PROPS","KEEP_CONTENT","IN_PLACE","IS_ALLOWED_URI$1","ALLOWED_URI_REGEXP","NAMESPACE","HTML_NAMESPACE","MATHML_TEXT_INTEGRATION_POINTS","HTML_INTEGRATION_POINTS","CUSTOM_ELEMENT_HANDLING","tagNameCheck","attributeNameCheck","allowCustomizedBuiltInElements","ADD_TAGS","ADD_ATTR","tbody","TRUSTED_TYPES_POLICY","createHTML","createScriptURL","trustedTypesPolicy","emptyHTML","purifyHostElement","createPolicy","suffix","ATTR_NAME","policyName","hasAttribute","scriptUrl","console","warn","_removeAttribute","getAttributeNode","from","_forceRemove","_initDocument","dirty","leadingWhitespace","dirtyPayload","parseFromString","implementation","createDocument","IS_EMPTY_INPUT","getElementsByTagName","_createNodeIterator","createNodeIterator","SHOW_ELEMENT","SHOW_COMMENT","SHOW_TEXT","SHOW_PROCESSING_INSTRUCTION","SHOW_CDATA_SECTION","_isClobbered","textContent","namespaceURI","hasChildNodes","_isNode","importNode","hooks","createHTMLDocument","writable","configurable","enumerable","SET_CONFIG","MATHML_NAMESPACE","SVG_NAMESPACE","COMMON_SVG_AND_HTML_ELEMENTS","formElement","ALL_SVG_TAGS","ALL_MATHML_TAGS","_executeHooks","hook","_sanitizeElements","firstElementChild","_checkValidNamespace","parentTagName","Boolean","expr","_isBasicCustomElement","childClone","__removalCount","_isValidAttribute","lcTag","lcName","_sanitizeAttributes","hookEvent","attrName","attrValue","keepAttr","forceKeepAttr","initValue","getAttributeType","setAttributeNS","_sanitizeShadowDOM","fragment","shadowNode","shadowIterator","returnNode","importedNode","nodeIterator","shadowroot","shadowrootmode","serializedHTML","outerHTML","doctype","setConfig","clearConfig","isValidAttribute","addHook","entryPoint","hookFunction","removeHook","removeHooks","removeAllHooks","globalWin","globalDoc","IMAGE_MIME_REGEX","wrapInlines","wrapper","SCEditor","original","userOptions","editorContainer","wysiwygEditor","wysiwygWindow","wysiwygBody","wysiwygDocument","sourceEditor","footer","dropdown","isComposing","valueChangedKeyUpTimer","rangeHelper","pluginManager","currentBlockNode","backSpaceHandled","currentSelection","isSelectionCheckPending","isRequired","inlineCss","autoExpandBounds","autoExpandThrottle","maximizeScrollPosition","pasteContentFragment","handleCommand","initEditor","initLocale","initToolBar","initOptions","initEvents","initResize","handlePasteEvt","handleCutCopyEvt","handlePasteData","handleKeyDown","handleBackSpace","handleKeyPress","handleFormReset","handleMouseDown","handleComposition","handleEvent","handleDocumentClick","updateToolBar","updateActiveButtons","sourceEditorSelectedText","appendNewLine","checkSelectionChanged","checkNodeChanged","currentStyledBlockNode","triggerValueChanged","valueChangedBlur","valueChangedKeyUp","eventHandlers","btnStateHandlers","shortcutHandlers","toolbarButtons","commands","domPurify","concat","allowedAttrs","allowedUrls","src","loadScript","Promise","resolve","reject","script","onload","onerror","head","append","loadScripts","promises","all","catch","error","_sceditor","required","loaded","onReady","FormatCtor","formats","readyState","lang","frameborder","allowfullscreen","protocol","dimensions","open","tabIndex","write","close","contentWindow","placeholder","form","compositionEvents","eventsToForward","checkSelectionEvents","updateOriginal","group","exclude","groups","unselectable","menuItems","commandName","button","command","add","_sceTxtMode","_sceWysiwygMode","addShortcut","grip","moveEvents","endEvents","startX","startY","newX","newY","startWidth","startHeight","origWidth","origHeight","isDragging","minHeight","maxHeight","minWidth","maxWidth","mouseMoveFunc","changedTouches","pageX","pageY","newHeight","newWidth","mouseUpFunc","icon","touches","focusEnd","txtPos","setSelectionRange","selectNodeContents","setStartAfter","scrollTop","scrollHeight","readonly","dir","disable","mode","inSourceMode","width$1","saveWidth","height$1","save","saveHeight","maximizeSize","scrollY","scrollTo","setTimeout","expandToContent","ignoreMaxHeight","current","clearTimeout","rect","getBoundingClientRect","clientHeight","spaceNeeded","bottom","ceil","menuItem","dropDownClass","parentElement","marginTop","stopPropagation","defaultPrevented","firstParent","clipboardData","setData","innerText","editable","clipboard","types","items","FileReader","getAsFile","getData","pasteArea","fragmentToSource","fragmentToHtml","merge","removeProperty","isBold","isItalic","endHtml","overrideCodeBlocking","editorHeight","endText","sourceEditorInsertText","currentValue","startPos","selectionStart","endPos","selectionEnd","substring","sourceEditorCaret","position","filter","setSourceEditorValue","toHtml","setWysiwygEditorValue","getSourceEditorValue","getWysiwygEditorValue","convertEmoticons","allowMixed","toSource","getContentAreaContainer","getSourceEditor","enable","isInSourceMode","blur","execParam","param","executed","commandObj","check","oldNode","newNode","span","firstBlock","activeClass","isSource","j","stateFn","isDisabled","queryCommandEnabled","queryCommandState","update","br","paragraph","info","p1","undef","excludeWysiwyg","excludeSource","wysEvent","srcEvent","unbind","endOffset","keyDown","keyPress","keyUp","nodeChanged","selectionChanged","valueChanged","styleSheet","SHIFT_KEYS","`","1","2","3","4","5","6","7","8","9","0","-","=",";","'",",",".","/","\\","[","]","NUMPAD_SHIFT_KEYS","109","110","111","96","97","98","99","100","101","102","103","104","105","character","13","19","20","27","32","33","34","35","36","37","38","39","40","45","46","91","92","93","106","107","112","113","114","115","116","117","118","119","120","121","122","123","144","145","186","187","188","189","190","191","192","219","220","221","222","fromCharCode","ctrlKey","metaKey","altKey","shiftKey","after","closeTag","removeShortcut","clearBlockFormatting","block","currentHtml","lastVal","rawValue","lastChar","lastWasSpace","lastWasDelete","triggerNext","sceditor","regexEscape","escapeEntities","escapeUriScheme","path","pathname","host","dom","copyCSS","to","findCommonAncestor","node1","node2","contains","hasStyle","utils","textarea","instance","editorOptions","getEditorCommand","QuoteType","always","never","auto","defaultCommandsOverrides","selected","userlink","bbcodeHandlers","tags","strong","font-weight","em","font-style","u","text-decoration","s","sub","sup","h","face","font-family","quoteType","_stripQuotes","font-size","_normaliseColour","token","defaultattr","ul","breakStart","skipLastLineBreak","list","ol","closedBy","*","isHtmlInline","tr","th","allowsEmpty","td","hr","isSelfClosing","img","class","allowedChildren","albumimg","cite","children","elementToBbcode","codeLanguage","role","text-align","data-facebook-url","data-instagram-url","data-vimeo-url","data-youtube-url","direction","ltr","formatBBCodeString","escape","TOKEN_OPEN","TOKEN_CONTENT","TOKEN_NEWLINE","TOKEN_CLOSE","TokenizeToken","closing","BBCodeParser","tokenizeTag","lower","attrRegex","hasTag","isChildAllowed","fixInvalidChildren","convertToHTML","tokens","isRoot","bbcode","needsBlockWrap","blockWrapOpen","isPreFormatted","needsQuotes","defaults","tokenize","tokenTypes","strloop","parse","toks","currentTag","openTags","addTag","output","closesCurrentTag","cloned","curTok","breakAfter","breakAfterBlock","fixInvalidNesting","parents","insideInline","rootArr","parentIndex","parentParentChildren","splitAt","normaliseNewLines","onlyRemoveBreakAfter","parentBBCode","removedBreakEnd","removedBreakBefore","childrenLength","breakEndBlock","breakEnd","breakStartBlock","breakBeforeBlock","breakBefore","removeEmptyTags","removeEmpty","isTokenWhiteSpace","toHTML","toHTMLFragment","toBBCode","convertToBBCode","excludeClosing","toHex","number","parseInt","colorStr","bbcodeFormat","tagsToBBCodes","stripQuotes","validChildren","handleTags","blockLevel","isStyleMatch","includes","handleTag","isStrict","strictMatch","matchNum","hasCodeParent","vChildren","isCodeTag","vChild","isValidChild","parentLastChild","isLastBlockChild","asFragment","legacyAsFragment","parser","elements","containerParent","getElementsByClassName","fromBBCode","offsetLength","rename","newName","emojis","horizontalrule","fontawesome","colorPath","nodes","isSourceMode","queryCommandValue","isRtl","gripNode","transform","dragdrop","handleFile","cover","placeholderId","hideCover","display","isAllowed","createHolder","toReplace","insertAdjacentHTML","cancel","handleDragOver","dt","dataTransfer","files","kind","handleDrop","signalReady","signalPasteHtml","file","handlePaste","lastState","lastInputType","charChangedCount","isInPatchedFn","isApplying","isSelectionChangeHandled","undoLimit","undoStates","redoPosition","applyState","caret","positions","startPositions","endPositions","positionsToNode","patch","origFn","updateLastState","storeState","normalize","nodeToPositions","countField","maxLimit","documentSelectionChangeHandler","activeElement","signalSelectionchangedEvent","beforeInputHandler","inputType","compositionHandler","signalInputEvent","plaintext","plainTextEnabled","addButton","enabled","signalPasteRaw","mentions","initMentions","lookup","onclick","assign","symbol","item_template","$e","$lookup","prevWord","isFixed","processKey","showLookup","hideLookup","$el","getPropertyValue","curr","$parent","getLength","baseOffset","word","pos","y","parentRect","query","tokenInput","headers","Accept","Content-Type","RequestVerificationToken","response","map","eval","onClick","onHover","bounding","innerHeight","innerWidth","clientWidth","deleteItem","dataset","$children","findIndex","$next","scrollIntoView"],"mappings":"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"}