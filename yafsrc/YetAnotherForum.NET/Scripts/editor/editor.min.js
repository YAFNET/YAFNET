var yafEditor=function(e,t,o,i,n,l,a,r,s){this.Name=e,this.InsertNote=r,this.TypeTitle=s,this.UrlTitle=t,this.UrlDescription=o,this.UrlImageTitle=i,this.UrlImageDescription=n,this.Description=l,this.MediaTitle=a,document.querySelector(".BBCodeEditor").addEventListener("keydown",function(e){!e.ctrlKey||e.altKey||66!=e.which&&73!=e.which&&85!=e.which&&81!=e.which&&13!=e.which||(66==e.which?wrapSelection(this,"[b]","[/b]"):73==e.which?wrapSelection(this,"[i]","[/i]"):85==e.which?wrapSelection(this,"[u]","[/u]"):81==e.which?wrapSelection(this,"[quote]","[/quote]"):13==e.which&&(null!=document.querySelector('[id*="QuickReply"]')?document.querySelector('[id*="QuickReply"]').click():null!=document.querySelector('[id*="PostReply"]')&&(window.location.href=document.querySelector('[id*="PostReply"]').href)))})};function removeFormat(e){var t,o,i,n,l;e.setSelectionRange&&(t=e.selectionStart,n=(i=e.value.substring(t,o=e.selectionEnd)).replace(/\[.*?\]/g,""),l=i.length-n.length,e.value=e.value.replace(i,n),setSelectionRange(e,t,o-l))}function setSelectionRange(e,t,o){e.setSelectionRange?(e.focus(),e.setSelectionRange(t,o)):e.createTextRange&&((e=e.createTextRange()).collapse(!0),e.moveEnd("character",o),e.moveStart("character",t),e.select())}function setCaretToPos(e,t){setSelectionRange(e,t,t)}function replaceSelection(e,t){var o,i;e.setSelectionRange?(o=e.selectionStart,i=e.selectionEnd,e.value=e.value.substring(0,o)+t+e.value.substring(i),o!=i?setSelectionRange(e,o,o+t.length):setCaretToPos(e,o+t.length)):(e.value+=t,e.focus())}function removeFromSelection(e,t,o){var i,n,l;e.setSelectionRange&&(i=e.selectionStart,-1!=(l=e.value.substring(i,n=e.selectionEnd)).indexOf(t))&&-1!=l.indexOf(o)&&(e.value=e.value.substring(0,i)+e.value.substring(i+t.length,n-o.length)+e.value.substring(n),i!=n?setSelectionRange(e,i,n-o.length-t.length):setCaretToPos(e,i+t.length))}function wrapSelection(e,t,o){var i,n;e.setSelectionRange?(i=e.selectionStart,n=e.selectionEnd,e.value=e.value.substring(0,i)+t+e.value.substring(i,n)+o+e.value.substring(n),i!=n?setSelectionRange(e,i,t.length+o.length+n):setCaretToPos(e,i+t.length)):(e.value+=t,e.focus(),e.value+=o),e.dispatchEvent(new Event("change"))}function getCurrentSelection(e){return!!e.setSelectionRange&&e.selectionStart!=e.selectionEnd}yafEditor.prototype.FormatText=function(e,t){var o=document.getElementById(this.Name);switch(e){case"undo":document.execCommand("undo");break;case"redo":document.execCommand("redo");break;case"bold":wrapSelection(o,"[b]","[/b]");break;case"italic":wrapSelection(o,"[i]","[/i]");break;case"underline":wrapSelection(o,"[u]","[/u]");break;case"highlight":wrapSelection(o,"[h]","[/h]");break;case"code":wrapSelection(o,"[code]","[/code]");break;case"codelang":wrapSelection(o,`[code=${t}]`,"[/code]");break;case"media":getCurrentSelection(o)?wrapSelection(o,"[media]","[/media]"):bootbox.prompt({title:this.MediaTitle,placeholder:"https://",callback:function(e){replaceSelection(o,`[media]${e}[/media]`)}});break;case"createNote":bootbox.confirm({title:this.InsertNote,message:`<form><div class="mb-3">
                                 <label for="type" class="form-label">${this.TypeTitle}</label> 
                                 <select class="form-select" id="type" aria-label="note type">
                                     <option value="primary">primary</option>
                                     <option value="secondary">secondary</option>
                                     <option value="success">success</option>
                                     <option value="danger">danger</option>
                                     <option value="warning">warning</option>
                                     <option value="info">info</option>
                                     <option value="light">light</option>
                                     <option value="dark">dark</option>
                                 </select>
                             </div>
                             <div class="mb-3">
                                 <label for="txt" class="form-label">${this.InsertNote}</label>
                                 <textarea cols="20" rows="7" id="txt" class="form-control textarea-input"></textarea>
                             </div></form>
                                 `,callback:function(e){var t;e&&(e=document.getElementById("type").value,t=document.getElementById("txt").value,replaceSelection(o,`[note=${e}]${t}[/note]`))}});break;case"img":getCurrentSelection(o)?wrapSelection(o,"[img]","[/img]"):bootbox.confirm({title:this.UrlImageTitle,message:`<form><div class="mb-3">
                 <label for="url" class="form-label">${this.UrlImageTitle}</label> 
                 <input type="text" class="form-control" id="url" placeholder="https://" />
             </div>
             <div class="mb-3">
                 <label for="desc" class="form-label">${this.UrlImageDescription}</label>
                 <input type="text" class="form-control" id="desc" placeholder="${this.Description}" />
             </div></form>
                 `,callback:function(e){var t;e&&(e=document.getElementById("url").value,t=document.getElementById("desc").value,replaceSelection(o,""!==t&&null!==t?`[img=${e}]${t}[/img]`:`[img]${e}[/img]`))}});break;case"quote":wrapSelection(o,"[quote]","[/quote]");break;case"justifyleft":wrapSelection(o,"[left]","[/left]");break;case"justifycenter":wrapSelection(o,"[center]","[/center]");break;case"justifyright":wrapSelection(o,"[right]","[/right]");break;case"indent":wrapSelection(o,"[indent]","[/indent]");break;case"outdent":getCurrentSelection(o)&&removeFromSelection(o,"[indent]","[/indent]");break;case"removeFormat":getCurrentSelection(o)&&removeFormat(o);break;case"createlink":bootbox.confirm({title:this.UrlTitle,message:`<form><div class="mb-3">
                  <label for="url" class="form-label">${this.UrlTitle}</label> 
                  <input type="text" class="form-control" id="url" placeholder="https://" />
              </div>
              <div class="mb-3">
                  <label for="desc" class="form-label">${this.UrlDescription}</label>
                  <input type="text" class="form-control" id="desc" placeholder="${this.Description}" />
              </div></form>
                  `,callback:function(e){var t;e&&(e=document.getElementById("url").value,t=document.getElementById("desc").value,replaceSelection(o,""!==t&&null!=t?`[url=${e}]${t}[/url]`:`[url]${e}[/url]`))}});break;case"unorderedlist":wrapSelection(o,"[list][*]","[/list]");break;case"orderedlist":wrapSelection(o,"[list=1][*]","[/list]");break;case"color":wrapSelection(o,`[color=${t}]`,"[/color]");break;case"fontsize":wrapSelection(o,`[size=${t}]`,"[/size]");break;case"albumimg":replaceSelection(o,`[albumimg]${t}[/albumimg]`);break;case"attach":replaceSelection(o,`[attach]${t}[/attach]`);break;case"userlink":replaceSelection(o,`[userlink]${t}[/userlink]`);break;case"selectAll":o.select();break;case"cut":getCurrentSelection(o)&&document.execCommand("cut");break;case"copy":getCurrentSelection(o)&&document.execCommand("copy");break;case"paste":navigator.clipboard.readText().then(function(e){o.value+=e});break;default:wrapSelection(o,`[${e}]`,`[/${e}]`)}};var AutoCloseTags=function(e){this.textarea=e,this.autoClosingTags=["b","i","u","h","code","img","quote","left","center","right","indent","list","color","size","albumimg","attach","youtube","vimeo","instagram","twitter","facebook","googlewidget","spoiler","userlink","googlemaps","hide","group-hide","hide-thanks","hide-reply-thanks","hide-reply","hide-posts","dailymotion","audio","media"],this.enableAutoCloseTags()};function mentions(opts={}){opts=Object.assign({},{lookup:"lookup",id:"",selector:"",element:null,symbol:"@",items:[],item_template:'<a class="dropdown-item" href="#"><img src="${item.avatar}" alt="avatar" class="me-2 img-thumbnail" style="max-width:20px;max-height:20px" /> ${item.name}</a>',onclick:void 0,url:""},opts);let $e=opts.id&&document.getElementById(opts.id)||opts.selector&&document.querySelector(opts.selector)||opts.element;if(!$e)return console.error("Invalid element selector",opts);for(var $lookup=document.createElement("div"),range,start,end,prevWord,isFixed=($lookup.classList="fixed-top autohide "+opts.lookup,$e.parentNode.insertBefore($lookup,$e.nextSibling),$e.addEventListener("keydown",processKey),$e.addEventListener("keyup",showLookup),$e.addEventListener("click",hideLookup),!1),$el=$lookup.parentNode;$el&&"body"!==$el.nodeName.toLowerCase()&&!isFixed;)isFixed="fixed"===window.getComputedStyle($el).getPropertyValue("position").toLowerCase(),$el=$el.parentElement;function showLookup(event){if("Escape"===event.code)return hideLookup();var sel=window.getSelection(),$parent=$lookup.parentNode.querySelector("textarea"),text=sel.anchorNode.querySelector("textarea").value||"",curr=$parent.selectionStart,getLength=e=>e instanceof Array&&0<e.length?e[0].length:0,word=(start=curr-getLength(text.slice(0,curr).match(/[\S]+$/g)),end=curr+getLength(text.slice(curr).match(/^[\S]+/g)),text.substring(start,end));if(!word||word[0]!==opts.symbol)return prevWord="",hideLookup();if(word!==prevWord){prevWord=word;var pos={x:0,y:0},parentRect=$parent.getBoundingClientRect(),query=(pos.y=parentRect.top+30,pos.x=parentRect.left+20,$lookup.style.left=pos.x+"px",$lookup.style.top=pos.y+"px",word.slice(1)),items=(3<=query.length&&fetch(opts.url.replace("{q}",query)).then(e=>e.json()).then(e=>opts.items=e),opts.items.filter(e=>e.name.toLowerCase().includes(word.slice(1).toLowerCase())).map(item=>eval('`<li class="mention-li-nt ${opts.lookup}" data-name = "${item.name}" data-id = "${item.id}">'+opts.item_template+"</li>`")));if(!items.length)return hideLookup();$lookup.innerHTML=`<ul class="dropdown-menu show">${items.join("")}</ul>`,[...$lookup.firstElementChild.children].forEach(e=>e.addEventListener("click",onClick)||e.addEventListener("mouseenter",onHover)),$lookup.firstElementChild.children[0].classList.add("active"),$lookup.hasAttribute("hidden")&&$lookup.removeAttribute("hidden");var bounding=$lookup.getBoundingClientRect();0<=bounding.top&&0<=bounding.left&&bounding.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&bounding.right<=(window.innerWidth||document.documentElement.clientWidth)||($lookup.style.top=parseInt($lookup.style.top)-10-$lookup.clientHeight+"px")}}function hideLookup(){$lookup.hasAttribute("hidden")||$lookup.setAttribute("hidden",!0)}function onClick(e){e=e.target.classList.contains("mention-li-nt")?e.target:e.target.parentElement,opts.onclick(e.dataset),e=$lookup.parentNode.querySelector("textarea");e.value=e.value.replace(e.value.substring(start+1,end),""),hideLookup()}function onHover(e){e=e.target.closest(".mention-li-nt");e.classList.contains("active")||([...$lookup.firstElementChild.children].filter(e=>e.classList.contains("active")).forEach(e=>e.classList.remove("active")),e.classList.add("active"))}function processKey(e){var t=e.key;if(-1!=["ArrowUp","ArrowDown","Enter"].indexOf(t)&&!$lookup.hasAttribute("hidden")){if(e.preventDefault(),"Enter"==t)return $lookup.querySelector(".active").click();var e=[...$lookup.firstElementChild.children],o=e.findIndex(e=>e.classList.contains("active")),o=(e[o].classList.remove("active"),e[(e.length+o+("ArrowUp"==t?-1:1))%e.length]);o.classList.add("active"),o.scrollIntoView(!1)}}}AutoCloseTags.prototype={enableAutoCloseTags:function(){var l=this;this.textarea.addEventListener("keydown",function(t){if("]"===t.key){var o,t=this.selectionStart,i=this.value.slice(0,t),n=this.value.slice(this.selectionEnd,this.value.length);let e;try{e=i.match(/\[([^\]]+)$/)[1].match(/^([a-z1-6]+)/)[1]}catch(e){return}-1!==l.autoClosingTags.indexOf(e)&&(o=`[/${e}]`,this.value=i+o+n,this.selectionStart=this.selectionEnd=t,this.focus())}})}},document.addEventListener("DOMContentLoaded",function(){new AutoCloseTags(document.querySelector(".BBCodeEditor"))});